exports.id=4317,exports.ids=[4317],exports.modules={48808:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.req=t.json=t.toBuffer=void 0;let s=o(r(32615)),a=o(r(35240));async function c(e){let t=0,r=[];for await(let n of e)t+=n.length,r.push(n);return Buffer.concat(r,t)}async function l(e){let t=(await c(e)).toString("utf8");try{return JSON.parse(t)}catch(e){throw e.message+=` (input: ${t})`,e}}t.toBuffer=c,t.json=l,t.req=function(e,t={}){let r=(("string"==typeof e?e:e.href).startsWith("https:")?a:s).request(e,t),n=new Promise((e,t)=>{r.once("response",e).once("error",t).end()});return r.then=n.then.bind(n),r}},15887:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Agent=void 0;let a=o(r(98216)),c=o(r(32615)),l=r(35240);s(r(48808),t);let u=Symbol("AgentBaseInternalState");class d extends c.Agent{constructor(e){super(e),this[u]={}}isSecureEndpoint(e){if(e){if("boolean"==typeof e.secureEndpoint)return e.secureEndpoint;if("string"==typeof e.protocol)return"https:"===e.protocol}let{stack:t}=Error();return"string"==typeof t&&t.split("\n").some(e=>-1!==e.indexOf("(https.js:")||-1!==e.indexOf("node:https:"))}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let t=new a.Socket({writable:!1});return this.sockets[e].push(t),this.totalSocketCount++,t}decrementSockets(e,t){if(!this.sockets[e]||null===t)return;let r=this.sockets[e],n=r.indexOf(t);-1!==n&&(r.splice(n,1),this.totalSocketCount--,0===r.length&&delete this.sockets[e])}getName(e){return this.isSecureEndpoint(e)?l.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,t,r){let n={...t,secureEndpoint:this.isSecureEndpoint(t)},i=this.getName(n),o=this.incrementSockets(i);Promise.resolve().then(()=>this.connect(e,n)).then(s=>{if(this.decrementSockets(i,o),s instanceof c.Agent)try{return s.addRequest(e,n)}catch(e){return r(e)}this[u].currentSocket=s,super.createSocket(e,t,r)},e=>{this.decrementSockets(i,o),r(e)})}createConnection(){let e=this[u].currentSocket;if(this[u].currentSocket=void 0,!e)throw Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[u].defaultPort??("https:"===this.protocol?443:80)}set defaultPort(e){this[u]&&(this[u].defaultPort=e)}get protocol(){return this[u].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[u]&&(this[u].protocol=e)}}t.Agent=d},21344:(e,t,r)=>{"use strict";var n=r(78893).Buffer,i=r(78893).SlowBuffer;function o(e,t){if(!n.isBuffer(e)||!n.isBuffer(t)||e.length!==t.length)return!1;for(var r=0,i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r}e.exports=o,o.install=function(){n.prototype.equal=i.prototype.equal=function(e){return o(this,e)}};var s=n.prototype.equal,a=i.prototype.equal;o.restore=function(){n.prototype.equal=s,i.prototype.equal=a}},68243:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))}),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){let e;return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(24401)(t);let{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},24401:(e,t,r)=>{e.exports=function(e){function t(e){let r,i,o;let s=null;function a(...e){if(!a.enabled)return;let n=Number(new Date),i=n-(r||n);a.diff=i,a.prev=r,a.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,n)=>{if("%%"===r)return"%";o++;let i=t.formatters[n];if("function"==typeof i){let t=e[o];r=i.call(a,t),e.splice(o,1),o--}return r}),t.formatArgs.call(a,e),(a.log||t.log).apply(a,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){let n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function i(e,t){let r=0,n=0,i=-1,o=0;for(;r<e.length;)if(n<t.length&&(t[n]===e[r]||"*"===t[n]))"*"===t[n]?(i=n,o=r):r++,n++;else{if(-1===i)return!1;n=i+1,r=++o}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){let e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){for(let r of(t.save(e),t.namespaces=e,t.names=[],t.skips=[],("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean)))"-"===r[0]?t.skips.push(r.slice(1)):t.names.push(r)},t.enabled=function(e){for(let r of t.skips)if(i(e,r))return!1;for(let r of t.names)if(i(e,r))return!0;return!1},t.humanize=r(25424),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},2873:(e,t,r)=>{"undefined"==typeof process||"renderer"===process.type||process.__nwjs?e.exports=r(68243):e.exports=r(16870)},16870:(e,t,r)=>{let n=r(74175),i=r(21764);t.init=function(e){e.inspectOpts={};let r=Object.keys(t.inspectOpts);for(let n=0;n<r.length;n++)e.inspectOpts[r[n]]=t.inspectOpts[r[n]]},t.log=function(...e){return process.stderr.write(i.formatWithOptions(t.inspectOpts,...e)+"\n")},t.formatArgs=function(r){let{namespace:n,useColors:i}=this;if(i){let t=this.color,i="\x1b[3"+(t<8?t:"8;5;"+t),o=`  ${i};1m${n} \u001B[0m`;r[0]=o+r[0].split("\n").join("\n"+o),r.push(i+"m+"+e.exports.humanize(this.diff)+"\x1b[0m")}else r[0]=(t.inspectOpts.hideDate?"":new Date().toISOString()+" ")+n+" "+r[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?!!t.inspectOpts.colors:n.isatty(process.stderr.fd)},t.destroy=i.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{let e=r(13336);e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase()),n=process.env[t];return n=!!/^(yes|on|true|enabled)$/i.test(n)||!/^(no|off|false|disabled)$/i.test(n)&&("null"===n?null:Number(n)),e[r]=n,e},{}),e.exports=r(24401)(t);let{formatters:o}=e.exports;o.o=function(e){return this.inspectOpts.colors=this.useColors,i.inspect(e,this.inspectOpts).split("\n").map(e=>e.trim()).join(" ")},o.O=function(e){return this.inspectOpts.colors=this.useColors,i.inspect(e,this.inspectOpts)}},79141:(e,t,r)=>{"use strict";var n=r(66437).Buffer,i=r(18596);function o(e){if(n.isBuffer(e))return e;if("string"==typeof e)return n.from(e,"base64");throw TypeError("ECDSA signature must be a Base64 string or a Buffer")}function s(e,t,r){for(var n=0;t+n<r&&0===e[t+n];)++n;return e[t+n]>=128&&--n,n}e.exports={derToJose:function(e,t){e=o(e);var r=i(t),s=r+1,a=e.length,c=0;if(48!==e[c++])throw Error('Could not find expected "seq"');var l=e[c++];if(129===l&&(l=e[c++]),a-c<l)throw Error('"seq" specified length of "'+l+'", only "'+(a-c)+'" remaining');if(2!==e[c++])throw Error('Could not find expected "int" for "r"');var u=e[c++];if(a-c-2<u)throw Error('"r" specified length of "'+u+'", only "'+(a-c-2)+'" available');if(s<u)throw Error('"r" specified length of "'+u+'", max of "'+s+'" is acceptable');var d=c;if(c+=u,2!==e[c++])throw Error('Could not find expected "int" for "s"');var h=e[c++];if(a-c!==h)throw Error('"s" specified length of "'+h+'", expected "'+(a-c)+'"');if(s<h)throw Error('"s" specified length of "'+h+'", max of "'+s+'" is acceptable');var p=c;if((c+=h)!==a)throw Error('Expected to consume entire buffer, but "'+(a-c)+'" bytes remain');var f=r-u,g=r-h,m=n.allocUnsafe(f+u+g+h);for(c=0;c<f;++c)m[c]=0;e.copy(m,c,d+Math.max(-f,0),d+u),c=r;for(var y=c;c<y+g;++c)m[c]=0;return e.copy(m,c,p+Math.max(-g,0),p+h),m=(m=m.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,t){e=o(e);var r=i(t),a=e.length;if(a!==2*r)throw TypeError('"'+t+'" signatures must be "'+2*r+'" bytes, saw "'+a+'"');var c=s(e,0,r),l=s(e,r,e.length),u=r-c,d=r-l,h=2+u+1+1+d,p=h<128,f=n.allocUnsafe((p?2:3)+h),g=0;return f[g++]=48,p?f[g++]=h:(f[g++]=129,f[g++]=255&h),f[g++]=2,f[g++]=u,c<0?(f[g++]=0,g+=e.copy(f,g,0,r)):g+=e.copy(f,g,c,r),f[g++]=2,f[g++]=d,l<0?(f[g++]=0,e.copy(f,g,r)):e.copy(f,g,r+l),f}}},18596:e=>{"use strict";function t(e){return(e/8|0)+(e%8==0?0:1)}var r={ES256:t(256),ES384:t(384),ES512:t(521)};e.exports=function(e){var t=r[e];if(t)return t;throw Error('Unknown algorithm "'+e+'"')}},9674:e=>{"use strict";e.exports=(e,t=process.argv)=>{let r=e.startsWith("-")?"":1===e.length?"-":"--",n=t.indexOf(r+e),i=t.indexOf("--");return -1!==n&&(-1===i||n<i)}},37766:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpProxyAgent=void 0;let a=o(r(98216)),c=o(r(82452)),l=s(r(2873)),u=r(17702),d=r(15887),h=r(17360),p=(0,l.default)("http-proxy-agent");class f extends d.Agent{constructor(e,t){super(t),this.proxy="string"==typeof e?new h.URL(e):e,this.proxyHeaders=t?.headers??{},p("Creating new HttpProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),n=this.proxy.port?parseInt(this.proxy.port,10):"https:"===this.proxy.protocol?443:80;this.connectOpts={...t?function(e,...t){let r;let n={};for(r in e)t.includes(r)||(n[r]=e[r]);return n}(t,"headers"):null,host:r,port:n}}addRequest(e,t){e._header=null,this.setRequestProps(e,t),super.addRequest(e,t)}setRequestProps(e,t){let{proxy:r}=this,n=t.secureEndpoint?"https:":"http:",i=e.getHeader("host")||"localhost",o=`${n}//${i}`,s=new h.URL(e.path,o);80!==t.port&&(s.port=String(t.port)),e.path=String(s);let a="function"==typeof this.proxyHeaders?this.proxyHeaders():{...this.proxyHeaders};if(r.username||r.password){let e=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;a["Proxy-Authorization"]=`Basic ${Buffer.from(e).toString("base64")}`}for(let t of(a["Proxy-Connection"]||(a["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close"),Object.keys(a))){let r=a[t];r&&e.setHeader(t,r)}}async connect(e,t){let r,n,i;return e._header=null,e.path.includes("://")||this.setRequestProps(e,t),p("Regenerating stored HTTP header string for request"),e._implicitHeader(),e.outputData&&e.outputData.length>0&&(p("Patching connection write() output buffer with updated header"),n=(r=e.outputData[0].data).indexOf("\r\n\r\n")+4,e.outputData[0].data=e._header+r.substring(n),p("Output buffer: %o",e.outputData[0].data)),"https:"===this.proxy.protocol?(p("Creating `tls.Socket`: %o",this.connectOpts),i=c.connect(this.connectOpts)):(p("Creating `net.Socket`: %o",this.connectOpts),i=a.connect(this.connectOpts)),await (0,u.once)(i,"connect"),i}}f.protocols=["http","https"],t.HttpProxyAgent=f},30890:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpsProxyAgent=void 0;let a=o(r(98216)),c=o(r(82452)),l=s(r(27790)),u=s(r(2873)),d=r(15887),h=r(17360),p=r(53879),f=(0,u.default)("https-proxy-agent"),g=e=>void 0===e.servername&&e.host&&!a.isIP(e.host)?{...e,servername:e.host}:e;class m extends d.Agent{constructor(e,t){super(t),this.options={path:void 0},this.proxy="string"==typeof e?new h.URL(e):e,this.proxyHeaders=t?.headers??{},f("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),n=this.proxy.port?parseInt(this.proxy.port,10):"https:"===this.proxy.protocol?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?T(t,"headers"):null,host:r,port:n}}async connect(e,t){let r;let{proxy:n}=this;if(!t.host)throw TypeError('No "host" provided');"https:"===n.protocol?(f("Creating `tls.Socket`: %o",this.connectOpts),r=c.connect(g(this.connectOpts))):(f("Creating `net.Socket`: %o",this.connectOpts),r=a.connect(this.connectOpts));let i="function"==typeof this.proxyHeaders?this.proxyHeaders():{...this.proxyHeaders},o=a.isIPv6(t.host)?`[${t.host}]`:t.host,s=`CONNECT ${o}:${t.port} HTTP/1.1\r
`;if(n.username||n.password){let e=`${decodeURIComponent(n.username)}:${decodeURIComponent(n.password)}`;i["Proxy-Authorization"]=`Basic ${Buffer.from(e).toString("base64")}`}for(let e of(i.Host=`${o}:${t.port}`,i["Proxy-Connection"]||(i["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close"),Object.keys(i)))s+=`${e}: ${i[e]}\r
`;let u=(0,p.parseProxyResponse)(r);r.write(`${s}\r
`);let{connect:d,buffered:h}=await u;if(e.emit("proxyConnect",d),this.emit("proxyConnect",d,e),200===d.statusCode)return(e.once("socket",y),t.secureEndpoint)?(f("Upgrading socket connection to TLS"),c.connect({...T(g(t),"host","path","port"),socket:r})):r;r.destroy();let m=new a.Socket({writable:!1});return m.readable=!0,e.once("socket",e=>{f("Replaying proxy buffer for failed request"),(0,l.default)(e.listenerCount("data")>0),e.push(h),e.push(null)}),m}}function y(e){e.resume()}function T(e,...t){let r;let n={};for(r in e)t.includes(r)||(n[r]=e[r]);return n}m.protocols=["http","https"],t.HttpsProxyAgent=m},53879:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseProxyResponse=void 0;let i=(0,n(r(2873)).default)("https-proxy-agent:parse-proxy-response");t.parseProxyResponse=function(e){return new Promise((t,r)=>{let n=0,o=[];function s(){let c=e.read();c?function(c){o.push(c),n+=c.length;let l=Buffer.concat(o,n),u=l.indexOf("\r\n\r\n");if(-1===u){i("have not received end of HTTP headers yet..."),s();return}let d=l.slice(0,u).toString("ascii").split("\r\n"),h=d.shift();if(!h)return e.destroy(),r(Error("No header received from proxy CONNECT response"));let p=h.split(" "),f=+p[1],g=p.slice(2).join(" "),m={};for(let t of d){if(!t)continue;let n=t.indexOf(":");if(-1===n)return e.destroy(),r(Error(`Invalid header from proxy CONNECT response: "${t}"`));let i=t.slice(0,n).toLowerCase(),o=t.slice(n+1).trimStart(),s=m[i];"string"==typeof s?m[i]=[s,o]:Array.isArray(s)?s.push(o):m[i]=o}i("got proxy server response: %o %o",h,m),a(),t({connect:{statusCode:f,statusText:g,headers:m},buffered:l})}(c):e.once("readable",s)}function a(){e.removeListener("end",c),e.removeListener("error",l),e.removeListener("readable",s)}function c(){a(),i("onend"),r(Error("Proxy connection ended before receiving CONNECT response"))}function l(e){a(),i("onerror %o",e),r(e)}e.on("error",l),e.on("end",c),s()})}},17797:(e,t,r)=>{var n=r(32806);e.exports=function(e,t){t=t||{};var r=n.decode(e,t);if(!r)return null;var i=r.payload;if("string"==typeof i)try{var o=JSON.parse(i);null!==o&&"object"==typeof o&&(i=o)}catch(e){}return!0===t.complete?{header:r.header,payload:i,signature:r.signature}:i}},49165:(e,t,r)=>{e.exports={decode:r(17797),verify:r(55013),sign:r(52574),JsonWebTokenError:r(98347),NotBeforeError:r(76320),TokenExpiredError:r(49597)}},98347:e=>{var t=function(e,t){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=e,t&&(this.inner=t)};t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,e.exports=t},76320:(e,t,r)=>{var n=r(98347),i=function(e,t){n.call(this,e),this.name="NotBeforeError",this.date=t};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i},49597:(e,t,r)=>{var n=r(98347),i=function(e,t){n.call(this,e),this.name="TokenExpiredError",this.expiredAt=t};i.prototype=Object.create(n.prototype),i.prototype.constructor=i,e.exports=i},57914:(e,t,r)=>{let n=r(98819);e.exports=n.satisfies(process.version,">=15.7.0")},19330:(e,t,r)=>{var n=r(98819);e.exports=n.satisfies(process.version,"^6.12.0 || >=8.0.0")},35695:(e,t,r)=>{let n=r(98819);e.exports=n.satisfies(process.version,">=16.9.0")},31550:(e,t,r)=>{var n=r(25424);e.exports=function(e,t){var r=t||Math.floor(Date.now()/1e3);if("string"==typeof e){var i=n(e);if(void 0===i)return;return Math.floor(r+i/1e3)}if("number"==typeof e)return r+e}},3101:(e,t,r)=>{let n=r(57914),i=r(35695),o={ec:["ES256","ES384","ES512"],rsa:["RS256","PS256","RS384","PS384","RS512","PS512"],"rsa-pss":["PS256","PS384","PS512"]},s={ES256:"prime256v1",ES384:"secp384r1",ES512:"secp521r1"};e.exports=function(e,t){if(!e||!t)return;let r=t.asymmetricKeyType;if(!r)return;let a=o[r];if(!a)throw Error(`Unknown key type "${r}".`);if(!a.includes(e))throw Error(`"alg" parameter for "${r}" key type must be one of: ${a.join(", ")}.`);if(n)switch(r){case"ec":let c=t.asymmetricKeyDetails.namedCurve,l=s[e];if(c!==l)throw Error(`"alg" parameter "${e}" requires curve "${l}".`);break;case"rsa-pss":if(i){let r=parseInt(e.slice(-3),10),{hashAlgorithm:n,mgf1HashAlgorithm:i,saltLength:o}=t.asymmetricKeyDetails;if(n!==`sha${r}`||i!==n)throw Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}.`);if(void 0!==o&&o>r>>3)throw Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}.`)}}}},52574:(e,t,r)=>{let n=r(31550),i=r(19330),o=r(3101),s=r(32806),a=r(62292),c=r(14001),l=r(63560),u=r(43666),d=r(20960),h=r(25895),p=r(17806),{KeyObject:f,createSecretKey:g,createPrivateKey:m}=r(84770),y=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];i&&y.splice(3,0,"PS256","PS384","PS512");let T={expiresIn:{isValid:function(e){return l(e)||h(e)&&e},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return l(e)||h(e)&&e},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return h(e)||Array.isArray(e)},message:'"audience" must be a string or array'},algorithm:{isValid:a.bind(null,y),message:'"algorithm" must be a valid string enum value'},header:{isValid:d,message:'"header" must be an object'},encoding:{isValid:h,message:'"encoding" must be a string'},issuer:{isValid:h,message:'"issuer" must be a string'},subject:{isValid:h,message:'"subject" must be a string'},jwtid:{isValid:h,message:'"jwtid" must be a string'},noTimestamp:{isValid:c,message:'"noTimestamp" must be a boolean'},keyid:{isValid:h,message:'"keyid" must be a string'},mutatePayload:{isValid:c,message:'"mutatePayload" must be a boolean'},allowInsecureKeySizes:{isValid:c,message:'"allowInsecureKeySizes" must be a boolean'},allowInvalidAsymmetricKeyTypes:{isValid:c,message:'"allowInvalidAsymmetricKeyTypes" must be a boolean'}},E={iat:{isValid:u,message:'"iat" should be a number of seconds'},exp:{isValid:u,message:'"exp" should be a number of seconds'},nbf:{isValid:u,message:'"nbf" should be a number of seconds'}};function C(e,t,r,n){if(!d(r))throw Error('Expected "'+n+'" to be a plain object.');Object.keys(r).forEach(function(i){let o=e[i];if(!o){if(!t)throw Error('"'+i+'" is not allowed in "'+n+'"');return}if(!o.isValid(r[i]))throw Error(o.message)})}let A={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},I=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];e.exports=function(e,t,r,i){var a,c;"function"==typeof r?(i=r,r={}):r=r||{};let l="object"==typeof e&&!Buffer.isBuffer(e),u=Object.assign({alg:r.algorithm||"HS256",typ:l?"JWT":void 0,kid:r.keyid},r.header);function d(e){if(i)return i(e);throw e}if(!t&&"none"!==r.algorithm)return d(Error("secretOrPrivateKey must have a value"));if(null!=t&&!(t instanceof f))try{t=m(t)}catch(e){try{t=g("string"==typeof t?Buffer.from(t):t)}catch(e){return d(Error("secretOrPrivateKey is not valid key material"))}}if(u.alg.startsWith("HS")&&"secret"!==t.type)return d(Error(`secretOrPrivateKey must be a symmetric key when using ${u.alg}`));if(/^(?:RS|PS|ES)/.test(u.alg)){if("private"!==t.type)return d(Error(`secretOrPrivateKey must be an asymmetric key when using ${u.alg}`));if(!r.allowInsecureKeySizes&&!u.alg.startsWith("ES")&&void 0!==t.asymmetricKeyDetails&&t.asymmetricKeyDetails.modulusLength<2048)return d(Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${u.alg}`))}if(void 0===e)return d(Error("payload is required"));if(l){try{a=e,C(E,!0,a,"payload")}catch(e){return d(e)}r.mutatePayload||(e=Object.assign({},e))}else{let t=I.filter(function(e){return void 0!==r[e]});if(t.length>0)return d(Error("invalid "+t.join(",")+" option for "+typeof e+" payload"))}if(void 0!==e.exp&&void 0!==r.expiresIn)return d(Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(void 0!==e.nbf&&void 0!==r.notBefore)return d(Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{c=r,C(T,!1,c,"options")}catch(e){return d(e)}if(!r.allowInvalidAsymmetricKeyTypes)try{o(u.alg,t)}catch(e){return d(e)}let h=e.iat||Math.floor(Date.now()/1e3);if(r.noTimestamp?delete e.iat:l&&(e.iat=h),void 0!==r.notBefore){try{e.nbf=n(r.notBefore,h)}catch(e){return d(e)}if(void 0===e.nbf)return d(Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(void 0!==r.expiresIn&&"object"==typeof e){try{e.exp=n(r.expiresIn,h)}catch(e){return d(e)}if(void 0===e.exp)return d(Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(A).forEach(function(t){let n=A[t];if(void 0!==r[t]){if(void 0!==e[n])return d(Error('Bad "options.'+t+'" option. The payload already has an "'+n+'" property.'));e[n]=r[t]}});let y=r.encoding||"utf8";if("function"==typeof i)i=i&&p(i),s.createSign({header:u,privateKey:t,payload:e,encoding:y}).once("error",i).once("done",function(e){if(!r.allowInsecureKeySizes&&/^(?:RS|PS)/.test(u.alg)&&e.length<256)return i(Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${u.alg}`));i(null,e)});else{let n=s.sign({header:u,payload:e,secret:t,encoding:y});if(!r.allowInsecureKeySizes&&/^(?:RS|PS)/.test(u.alg)&&n.length<256)throw Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${u.alg}`);return n}}},55013:(e,t,r)=>{let n=r(98347),i=r(76320),o=r(49597),s=r(17797),a=r(31550),c=r(3101),l=r(19330),u=r(32806),{KeyObject:d,createSecretKey:h,createPublicKey:p}=r(84770),f=["RS256","RS384","RS512"],g=["ES256","ES384","ES512"],m=["RS256","RS384","RS512"],y=["HS256","HS384","HS512"];l&&(f.splice(f.length,0,"PS256","PS384","PS512"),m.splice(m.length,0,"PS256","PS384","PS512")),e.exports=function(e,t,r,l){let T,E,C;if("function"!=typeof r||l||(l=r,r={}),r||(r={}),r=Object.assign({},r),T=l||function(e,t){if(e)throw e;return t},r.clockTimestamp&&"number"!=typeof r.clockTimestamp)return T(new n("clockTimestamp must be a number"));if(void 0!==r.nonce&&("string"!=typeof r.nonce||""===r.nonce.trim()))return T(new n("nonce must be a non-empty string"));if(void 0!==r.allowInvalidAsymmetricKeyTypes&&"boolean"!=typeof r.allowInvalidAsymmetricKeyTypes)return T(new n("allowInvalidAsymmetricKeyTypes must be a boolean"));let A=r.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return T(new n("jwt must be provided"));if("string"!=typeof e)return T(new n("jwt must be a string"));let I=e.split(".");if(3!==I.length)return T(new n("jwt malformed"));try{E=s(e,{complete:!0})}catch(e){return T(e)}if(!E)return T(new n("invalid token"));let v=E.header;if("function"==typeof t){if(!l)return T(new n("verify must be called asynchronous if secret or public key is provided as a callback"));C=t}else C=function(e,r){return r(null,t)};return C(v,function(t,s){let l;if(t)return T(new n("error in secret or public key callback: "+t.message));let C=""!==I[2].trim();if(!C&&s)return T(new n("jwt signature is required"));if(C&&!s)return T(new n("secret or public key must be provided"));if(!C&&!r.algorithms)return T(new n('please specify "none" in "algorithms" to verify unsigned tokens'));if(null!=s&&!(s instanceof d))try{s=p(s)}catch(e){try{s=h("string"==typeof s?Buffer.from(s):s)}catch(e){return T(new n("secretOrPublicKey is not valid key material"))}}if(r.algorithms||("secret"===s.type?r.algorithms=y:["rsa","rsa-pss"].includes(s.asymmetricKeyType)?r.algorithms=m:"ec"===s.asymmetricKeyType?r.algorithms=g:r.algorithms=f),-1===r.algorithms.indexOf(E.header.alg))return T(new n("invalid algorithm"));if(v.alg.startsWith("HS")&&"secret"!==s.type)return T(new n(`secretOrPublicKey must be a symmetric key when using ${v.alg}`));if(/^(?:RS|PS|ES)/.test(v.alg)&&"public"!==s.type)return T(new n(`secretOrPublicKey must be an asymmetric key when using ${v.alg}`));if(!r.allowInvalidAsymmetricKeyTypes)try{c(v.alg,s)}catch(e){return T(e)}try{l=u.verify(e,E.header.alg,s)}catch(e){return T(e)}if(!l)return T(new n("invalid signature"));let S=E.payload;if(void 0!==S.nbf&&!r.ignoreNotBefore){if("number"!=typeof S.nbf)return T(new n("invalid nbf value"));if(S.nbf>A+(r.clockTolerance||0))return T(new i("jwt not active",new Date(1e3*S.nbf)))}if(void 0!==S.exp&&!r.ignoreExpiration){if("number"!=typeof S.exp)return T(new n("invalid exp value"));if(A>=S.exp+(r.clockTolerance||0))return T(new o("jwt expired",new Date(1e3*S.exp)))}if(r.audience){let e=Array.isArray(r.audience)?r.audience:[r.audience];if(!(Array.isArray(S.aud)?S.aud:[S.aud]).some(function(t){return e.some(function(e){return e instanceof RegExp?e.test(t):e===t})}))return T(new n("jwt audience invalid. expected: "+e.join(" or ")))}if(r.issuer&&("string"==typeof r.issuer&&S.iss!==r.issuer||Array.isArray(r.issuer)&&-1===r.issuer.indexOf(S.iss)))return T(new n("jwt issuer invalid. expected: "+r.issuer));if(r.subject&&S.sub!==r.subject)return T(new n("jwt subject invalid. expected: "+r.subject));if(r.jwtid&&S.jti!==r.jwtid)return T(new n("jwt jwtid invalid. expected: "+r.jwtid));if(r.nonce&&S.nonce!==r.nonce)return T(new n("jwt nonce invalid. expected: "+r.nonce));if(r.maxAge){if("number"!=typeof S.iat)return T(new n("iat required when maxAge is specified"));let e=a(r.maxAge,S.iat);if(void 0===e)return T(new n('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(A>=e+(r.clockTolerance||0))return T(new o("maxAge exceeded",new Date(1e3*e)))}return!0===r.complete?T(null,{header:v,payload:S,signature:E.signature}):T(null,S)})}},16196:(e,t,r)=>{var n,i=r(66437).Buffer,o=r(84770),s=r(79141),a=r(21764),c="secret must be a string or buffer",l="key must be a string or a buffer",u="function"==typeof o.createPublicKey;function d(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!u||"object"!=typeof e||"string"!=typeof e.type||"string"!=typeof e.asymmetricKeyType||"function"!=typeof e.export))throw g(l)}function h(e){if(!i.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw g("key must be a string, a buffer or an object")}function p(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function f(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var r=0;r<t;++r)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function g(e){var t=[].slice.call(arguments,1);return TypeError(a.format.bind(a,e).apply(null,t))}function m(e){var t;return t=e,i.isBuffer(t)||"string"==typeof t||(e=JSON.stringify(e)),e}function y(e){return function(t,r){(function(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!u||"object"!=typeof e||"secret"!==e.type||"function"!=typeof e.export))throw g(c)})(r),t=m(t);var n=o.createHmac("sha"+e,r);return p((n.update(t),n.digest("base64")))}}u&&(l+=" or a KeyObject",c+="or a KeyObject");var T="timingSafeEqual"in o?function(e,t){return e.byteLength===t.byteLength&&o.timingSafeEqual(e,t)}:function(e,t){return n||(n=r(21344)),n(e,t)};function E(e){return function(t,r,n){var o=y(e)(t,n);return T(i.from(r),i.from(o))}}function C(e){return function(t,r){h(r),t=m(t);var n=o.createSign("RSA-SHA"+e);return p((n.update(t),n.sign(r,"base64")))}}function A(e){return function(t,r,n){d(n),t=m(t),r=f(r);var i=o.createVerify("RSA-SHA"+e);return i.update(t),i.verify(n,r,"base64")}}function I(e){return function(t,r){h(r),t=m(t);var n=o.createSign("RSA-SHA"+e);return p((n.update(t),n.sign({key:r,padding:o.constants.RSA_PKCS1_PSS_PADDING,saltLength:o.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function v(e){return function(t,r,n){d(n),t=m(t),r=f(r);var i=o.createVerify("RSA-SHA"+e);return i.update(t),i.verify({key:n,padding:o.constants.RSA_PKCS1_PSS_PADDING,saltLength:o.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function S(e){var t=C(e);return function(){var r=t.apply(null,arguments);return s.derToJose(r,"ES"+e)}}function w(e){var t=A(e);return function(r,n,i){return t(r,n=s.joseToDer(n,"ES"+e).toString("base64"),i)}}function b(){return function(){return""}}function R(){return function(e,t){return""===t}}e.exports=function(e){var t=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/i);if(!t)throw g('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var r=(t[1]||t[3]).toLowerCase(),n=t[2];return{sign:({hs:y,rs:C,ps:I,es:S,none:b})[r](n),verify:({hs:E,rs:A,ps:v,es:w,none:R})[r](n)}}},32806:(e,t,r)=>{var n=r(37938),i=r(2551);t.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],t.sign=n.sign,t.verify=i.verify,t.decode=i.decode,t.isValid=i.isValid,t.createSign=function(e){return new n(e)},t.createVerify=function(e){return new i(e)}},97031:(e,t,r)=>{var n=r(66437).Buffer,i=r(76162);function o(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=n.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=n.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick((function(){this.emit("end",e),this.readable=!1,this.emit("close")}).bind(this)),this;throw TypeError("Unexpected data type ("+typeof e+")")}r(21764).inherits(o,i),o.prototype.write=function(e){this.buffer=n.concat([this.buffer,n.from(e)]),this.emit("data",e)},o.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1},e.exports=o},37938:(e,t,r)=>{var n=r(66437).Buffer,i=r(97031),o=r(16196),s=r(76162),a=r(69757),c=r(21764);function l(e,t){return n.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function u(e){var t,r,n,i=e.header,s=e.payload,u=e.secret||e.privateKey,d=e.encoding,h=o(i.alg),p=(t=(t=d)||"utf8",r=l(a(i),"binary"),n=l(a(s),t),c.format("%s.%s",r,n)),f=h.sign(p,u);return c.format("%s.%s",p,f)}function d(e){var t=new i(e.secret||e.privateKey||e.key);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new i(e.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}c.inherits(d,s),d.prototype.sign=function(){try{var e=u({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},d.sign=u,e.exports=d},69757:(e,t,r)=>{var n=r(78893).Buffer;e.exports=function(e){return"string"==typeof e?e:"number"==typeof e||n.isBuffer(e)?e.toString():JSON.stringify(e)}},2551:(e,t,r)=>{var n=r(66437).Buffer,i=r(97031),o=r(16196),s=r(76162),a=r(69757),c=r(21764),l=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function u(e){var t=e.split(".",1)[0];return function(e){if("[object Object]"===Object.prototype.toString.call(e))return e;try{return JSON.parse(e)}catch(e){return}}(n.from(t,"base64").toString("binary"))}function d(e){return e.split(".")[2]}function h(e){return l.test(e)&&!!u(e)}function p(e,t,r){if(!t){var n=Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}var i=d(e=a(e)),s=e.split(".",2).join(".");return o(t).verify(s,i,r)}function f(e,t){if(t=t||{},!h(e=a(e)))return null;var r,i,o=u(e);if(!o)return null;var s=(r=r||"utf8",i=e.split(".")[1],n.from(i,"base64").toString(r));return("JWT"===o.typ||t.json)&&(s=JSON.parse(s,t.encoding)),{header:o,payload:s,signature:d(e)}}function g(e){var t=new i((e=e||{}).secret||e.publicKey||e.key);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new i(e.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}c.inherits(g,s),g.prototype.verify=function(){try{var e=p(this.signature.buffer,this.algorithm,this.key.buffer),t=f(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},g.decode=f,g.isValid=h,g.verify=p,e.exports=g},62292:e=>{var t,r,n=1/0,i=0/0,o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=/^(?:0|[1-9]\d*)$/,u=parseInt;function d(e){return e!=e}var h=Object.prototype,p=h.hasOwnProperty,f=h.toString,g=h.propertyIsEnumerable,m=(t=Object.keys,r=Object,function(e){return t(r(e))}),y=Math.max,T=Array.isArray;function E(e){var t,r;return null!=e&&"number"==typeof(t=e.length)&&t>-1&&t%1==0&&t<=9007199254740991&&!("[object Function]"==(r=C(e)?f.call(e):"")||"[object GeneratorFunction]"==r)}function C(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function A(e){return!!e&&"object"==typeof e}e.exports=function(e,t,r,I){e=E(e)?e:(v=e)?function(e,t){for(var r=-1,n=e?e.length:0,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}(E(v)?function(e,t){var r,n=T(e)||A(e)&&E(e)&&p.call(e,"callee")&&(!g.call(e,"callee")||"[object Arguments]"==f.call(e))?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=n.length,o=!!i;for(var s in e)p.call(e,s)&&!(o&&("length"==s||(r=null==(r=i)?9007199254740991:r)&&("number"==typeof s||l.test(s))&&s>-1&&s%1==0&&s<r))&&n.push(s);return n}(v):function(e){if(t=e&&e.constructor,e!==("function"==typeof t&&t.prototype||h))return m(e);var t,r=[];for(var n in Object(e))p.call(e,n)&&"constructor"!=n&&r.push(n);return r}(v),function(e){return v[e]}):[],r=r&&!I?(b=(w=(S=r)?(S=function(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||A(t)&&"[object Symbol]"==f.call(t))return i;if(C(e)){var t,r="function"==typeof e.valueOf?e.valueOf():e;e=C(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var n=a.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):s.test(e)?i:+e}(S))===n||S===-n?(S<0?-1:1)*17976931348623157e292:S==S?S:0:0===S?S:0)%1,w==w?b?w-b:w:0):0;var v,S,w,b,R,_=e.length;return r<0&&(r=y(_+r,0)),"string"==typeof(R=e)||!T(R)&&A(R)&&"[object String]"==f.call(R)?r<=_&&e.indexOf(t,r)>-1:!!_&&function(e,t,r){if(t!=t)return function(e,t,r,n){for(var i=e.length,o=r+-1;++o<i;)if(t(e[o],o,e))return o;return -1}(e,d,r);for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return -1}(e,t,r)>-1}},14001:e=>{var t=Object.prototype.toString;e.exports=function(e){return!0===e||!1===e||!!e&&"object"==typeof e&&"[object Boolean]"==t.call(e)}},63560:e=>{var t=1/0,r=0/0,n=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,s=/^0o[0-7]+$/i,a=parseInt,c=Object.prototype.toString;function l(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){var u,d,h;return"number"==typeof e&&e==(h=(d=(u=e)?(u=function(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==c.call(t))return r;if(l(e)){var t,u="function"==typeof e.valueOf?e.valueOf():e;e=l(u)?u+"":u}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var d=o.test(e);return d||s.test(e)?a(e.slice(2),d?2:8):i.test(e)?r:+e}(u))===t||u===-t?(u<0?-1:1)*17976931348623157e292:u==u?u:0:0===u?u:0)%1,d==d?h?d-h:d:0)}},43666:e=>{var t=Object.prototype.toString;e.exports=function(e){return"number"==typeof e||!!e&&"object"==typeof e&&"[object Number]"==t.call(e)}},20960:e=>{var t,r,n=Object.prototype,i=Function.prototype.toString,o=n.hasOwnProperty,s=i.call(Object),a=n.toString,c=(t=Object.getPrototypeOf,r=Object,function(e){return t(r(e))});e.exports=function(e){if(!(e&&"object"==typeof e)||"[object Object]"!=a.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=c(e);if(null===t)return!0;var r=o.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&i.call(r)==s}},25895:e=>{var t=Object.prototype.toString,r=Array.isArray;e.exports=function(e){var n;return"string"==typeof e||!r(e)&&!!(n=e)&&"object"==typeof n&&"[object String]"==t.call(e)}},17806:e=>{var t=1/0,r=0/0,n=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,s=/^0o[0-7]+$/i,a=parseInt,c=Object.prototype.toString;function l(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){return function(e,u){var d,h,p,f;if("function"!=typeof u)throw TypeError("Expected a function");return f=(p=(h=e)?(h=function(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==c.call(t))return r;if(l(e)){var t,u="function"==typeof e.valueOf?e.valueOf():e;e=l(u)?u+"":u}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var d=o.test(e);return d||s.test(e)?a(e.slice(2),d?2:8):i.test(e)?r:+e}(h))===t||h===-t?(h<0?-1:1)*17976931348623157e292:h==h?h:0:0===h?h:0)%1,e=p==p?f?p-f:p:0,function(){return--e>0&&(d=u.apply(this,arguments)),e<=1&&(u=void 0),d}}(2,e)}},25424:e=>{function t(e,t,r,n){return Math.round(e/r)+" "+n+(t>=1.5*r?"s":"")}e.exports=function(e,r){r=r||{};var n,i,o=typeof e;if("string"===o&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===o&&isFinite(e))return r.long?(n=Math.abs(e))>=864e5?t(e,n,864e5,"day"):n>=36e5?t(e,n,36e5,"hour"):n>=6e4?t(e,n,6e4,"minute"):n>=1e3?t(e,n,1e3,"second"):e+" ms":(i=Math.abs(e))>=864e5?Math.round(e/864e5)+"d":i>=36e5?Math.round(e/36e5)+"h":i>=6e4?Math.round(e/6e4)+"m":i>=1e3?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},66437:(e,t,r)=>{var n=r(78893),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},48735:(e,t,r)=>{"use strict";let n=Symbol("SemVer ANY");class i{static get ANY(){return n}constructor(e,t){if(t=o(t),e instanceof i){if(!!t.loose===e.loose)return e;e=e.value}l("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===n?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}parse(e){let t=this.options.loose?s[a.COMPARATORLOOSE]:s[a.COMPARATOR],r=e.match(t);if(!r)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new u(r[2],this.options.loose):this.semver=n}toString(){return this.value}test(e){if(l("Comparator.test",e,this.options.loose),this.semver===n||e===n)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return c(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=o(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||c(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||c(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}e.exports=i;let o=r(55303),{safeRe:s,t:a}=r(7529),c=r(6474),l=r(8882),u=r(1424),d=r(5046)},5046:(e,t,r)=>{"use strict";let n=/\s+/g;class i{constructor(e,t){if(t=s(t),e instanceof i){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;return new i(e.raw,t)}if(e instanceof a)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(n," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let e=this.set[0];if(this.set=this.set.filter(e=>!y(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(let e of this.set)if(1===e.length&&T(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&g)|(this.options.loose&&m))+":"+e,r=o.get(t);if(r)return r;let n=this.options.loose,i=n?u[d.HYPHENRANGELOOSE]:u[d.HYPHENRANGE];c("hyphen replace",e=e.replace(i,O(this.options.includePrerelease))),c("comparator trim",e=e.replace(u[d.COMPARATORTRIM],h)),c("tilde trim",e=e.replace(u[d.TILDETRIM],p)),c("caret trim",e=e.replace(u[d.CARETTRIM],f));let s=e.split(" ").map(e=>C(e,this.options)).join(" ").split(/\s+/).map(e=>k(e,this.options));n&&(s=s.filter(e=>(c("loose invalid filter",e,this.options),!!e.match(u[d.COMPARATORLOOSE])))),c("range list",s);let l=new Map;for(let e of s.map(e=>new a(e,this.options))){if(y(e))return[e];l.set(e.value,e)}l.size>1&&l.has("")&&l.delete("");let T=[...l.values()];return o.set(t,T),T}intersects(e,t){if(!(e instanceof i))throw TypeError("a Range is required");return this.set.some(r=>E(r,t)&&e.set.some(e=>E(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new l(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(P(this.set[t],e,this.options))return!0;return!1}}e.exports=i;let o=new(r(78790)),s=r(55303),a=r(48735),c=r(8882),l=r(1424),{safeRe:u,t:d,comparatorTrimReplace:h,tildeTrimReplace:p,caretTrimReplace:f}=r(7529),{FLAG_INCLUDE_PRERELEASE:g,FLAG_LOOSE:m}=r(36045),y=e=>"<0.0.0-0"===e.value,T=e=>""===e.value,E=(e,t)=>{let r=!0,n=e.slice(),i=n.pop();for(;r&&n.length;)r=n.every(e=>i.intersects(e,t)),i=n.pop();return r},C=(e,t)=>(c("comp",e=e.replace(u[d.BUILD],""),t),c("caret",e=S(e,t)),c("tildes",e=I(e,t)),c("xrange",e=b(e,t)),c("stars",e=_(e,t)),e),A=e=>!e||"x"===e.toLowerCase()||"*"===e,I=(e,t)=>e.trim().split(/\s+/).map(e=>v(e,t)).join(" "),v=(e,t)=>{let r=t.loose?u[d.TILDELOOSE]:u[d.TILDE];return e.replace(r,(t,r,n,i,o)=>{let s;return c("tilde",e,t,r,n,i,o),A(r)?s="":A(n)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:A(i)?s=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:o?(c("replaceTilde pr",o),s=`>=${r}.${n}.${i}-${o} <${r}.${+n+1}.0-0`):s=`>=${r}.${n}.${i} <${r}.${+n+1}.0-0`,c("tilde return",s),s})},S=(e,t)=>e.trim().split(/\s+/).map(e=>w(e,t)).join(" "),w=(e,t)=>{c("caret",e,t);let r=t.loose?u[d.CARETLOOSE]:u[d.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,(t,r,i,o,s)=>{let a;return c("caret",e,t,r,i,o,s),A(r)?a="":A(i)?a=`>=${r}.0.0${n} <${+r+1}.0.0-0`:A(o)?a="0"===r?`>=${r}.${i}.0${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${n} <${+r+1}.0.0-0`:s?(c("replaceCaret pr",s),a="0"===r?"0"===i?`>=${r}.${i}.${o}-${s} <${r}.${i}.${+o+1}-0`:`>=${r}.${i}.${o}-${s} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${o}-${s} <${+r+1}.0.0-0`):(c("no pr"),a="0"===r?"0"===i?`>=${r}.${i}.${o}${n} <${r}.${i}.${+o+1}-0`:`>=${r}.${i}.${o}${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${o} <${+r+1}.0.0-0`),c("caret return",a),a})},b=(e,t)=>(c("replaceXRanges",e,t),e.split(/\s+/).map(e=>R(e,t)).join(" ")),R=(e,t)=>{e=e.trim();let r=t.loose?u[d.XRANGELOOSE]:u[d.XRANGE];return e.replace(r,(r,n,i,o,s,a)=>{c("xRange",e,r,n,i,o,s,a);let l=A(i),u=l||A(o),d=u||A(s);return"="===n&&d&&(n=""),a=t.includePrerelease?"-0":"",l?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&d?(u&&(o=0),s=0,">"===n?(n=">=",u?(i=+i+1,o=0):o=+o+1,s=0):"<="===n&&(n="<",u?i=+i+1:o=+o+1),"<"===n&&(a="-0"),r=`${n+i}.${o}.${s}${a}`):u?r=`>=${i}.0.0${a} <${+i+1}.0.0-0`:d&&(r=`>=${i}.${o}.0${a} <${i}.${+o+1}.0-0`),c("xRange return",r),r})},_=(e,t)=>(c("replaceStars",e,t),e.trim().replace(u[d.STAR],"")),k=(e,t)=>(c("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),O=e=>(t,r,n,i,o,s,a,c,l,u,d,h)=>(r=A(n)?"":A(i)?`>=${n}.0.0${e?"-0":""}`:A(o)?`>=${n}.${i}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`,c=A(l)?"":A(u)?`<${+l+1}.0.0-0`:A(d)?`<${l}.${+u+1}.0-0`:h?`<=${l}.${u}.${d}-${h}`:e?`<${l}.${u}.${+d+1}-0`:`<=${c}`,`${r} ${c}`.trim()),P=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(c(e[r].semver),e[r].semver!==a.ANY&&e[r].semver.prerelease.length>0){let n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}},1424:(e,t,r)=>{"use strict";let n=r(8882),{MAX_LENGTH:i,MAX_SAFE_INTEGER:o}=r(36045),{safeRe:s,t:a}=r(7529),c=r(55303),{compareIdentifiers:l}=r(28417);class u{constructor(e,t){if(t=c(t),e instanceof u){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>i)throw TypeError(`version is longer than ${i} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?s[a.LOOSE]:s[a.FULL]);if(!r)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>o||this.major<0)throw TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return(e instanceof u||(e=new u(e,this.options)),this.major<e.major)?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return -1;if(r===i)continue;else return l(r,i)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{let r=this.build[t],i=e.build[t];if(n("build compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return -1;if(r===i)continue;else return l(r,i)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw Error("invalid increment argument: identifier is empty");if(t){let e=`-${t}`.match(this.options.loose?s[a.PRERELEASELOOSE]:s[a.PRERELEASE]);if(!e||e[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=Number(r)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===r&&(n=[t]),0===l(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},37513:(e,t,r)=>{"use strict";let n=r(59048);e.exports=(e,t)=>{let r=n(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},6474:(e,t,r)=>{"use strict";let n=r(17336),i=r(78857),o=r(30928),s=r(90532),a=r(97898),c=r(52048);e.exports=(e,t,r,l)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return n(e,r,l);case"!=":return i(e,r,l);case">":return o(e,r,l);case">=":return s(e,r,l);case"<":return a(e,r,l);case"<=":return c(e,r,l);default:throw TypeError(`Invalid operator: ${t}`)}}},95457:(e,t,r)=>{"use strict";let n=r(1424),i=r(59048),{safeRe:o,t:s}=r(7529);e.exports=(e,t)=>{if(e instanceof n)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let n;let i=t.includePrerelease?o[s.COERCERTLFULL]:o[s.COERCERTL];for(;(n=i.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&n.index+n[0].length===r.index+r[0].length||(r=n),i.lastIndex=n.index+n[1].length+n[2].length;i.lastIndex=-1}else r=e.match(t.includePrerelease?o[s.COERCEFULL]:o[s.COERCE]);if(null===r)return null;let a=r[2],c=r[3]||"0",l=r[4]||"0",u=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return i(`${a}.${c}.${l}${u}${d}`,t)}},34179:(e,t,r)=>{"use strict";let n=r(1424);e.exports=(e,t,r)=>{let i=new n(e,r),o=new n(t,r);return i.compare(o)||i.compareBuild(o)}},90071:(e,t,r)=>{"use strict";let n=r(15787);e.exports=(e,t)=>n(e,t,!0)},15787:(e,t,r)=>{"use strict";let n=r(1424);e.exports=(e,t,r)=>new n(e,r).compare(new n(t,r))},323:(e,t,r)=>{"use strict";let n=r(59048);e.exports=(e,t)=>{let r=n(e,null,!0),i=n(t,null,!0),o=r.compare(i);if(0===o)return null;let s=o>0,a=s?r:i,c=s?i:r,l=!!a.prerelease.length;if(c.prerelease.length&&!l){if(!c.patch&&!c.minor)return"major";if(0===c.compareMain(a))return c.minor&&!c.patch?"minor":"patch"}let u=l?"pre":"";return r.major!==i.major?u+"major":r.minor!==i.minor?u+"minor":r.patch!==i.patch?u+"patch":"prerelease"}},17336:(e,t,r)=>{"use strict";let n=r(15787);e.exports=(e,t,r)=>0===n(e,t,r)},30928:(e,t,r)=>{"use strict";let n=r(15787);e.exports=(e,t,r)=>n(e,t,r)>0},90532:(e,t,r)=>{"use strict";let n=r(15787);e.exports=(e,t,r)=>n(e,t,r)>=0},57121:(e,t,r)=>{"use strict";let n=r(1424);e.exports=(e,t,r,i,o)=>{"string"==typeof r&&(o=i,i=r,r=void 0);try{return new n(e instanceof n?e.version:e,r).inc(t,i,o).version}catch(e){return null}}},97898:(e,t,r)=>{"use strict";let n=r(15787);e.exports=(e,t,r)=>0>n(e,t,r)},52048:(e,t,r)=>{"use strict";let n=r(15787);e.exports=(e,t,r)=>0>=n(e,t,r)},4053:(e,t,r)=>{"use strict";let n=r(1424);e.exports=(e,t)=>new n(e,t).major},27502:(e,t,r)=>{"use strict";let n=r(1424);e.exports=(e,t)=>new n(e,t).minor},78857:(e,t,r)=>{"use strict";let n=r(15787);e.exports=(e,t,r)=>0!==n(e,t,r)},59048:(e,t,r)=>{"use strict";let n=r(1424);e.exports=(e,t,r=!1)=>{if(e instanceof n)return e;try{return new n(e,t)}catch(e){if(!r)return null;throw e}}},46335:(e,t,r)=>{"use strict";let n=r(1424);e.exports=(e,t)=>new n(e,t).patch},53386:(e,t,r)=>{"use strict";let n=r(59048);e.exports=(e,t)=>{let r=n(e,t);return r&&r.prerelease.length?r.prerelease:null}},43827:(e,t,r)=>{"use strict";let n=r(15787);e.exports=(e,t,r)=>n(t,e,r)},82231:(e,t,r)=>{"use strict";let n=r(34179);e.exports=(e,t)=>e.sort((e,r)=>n(r,e,t))},37538:(e,t,r)=>{"use strict";let n=r(5046);e.exports=(e,t,r)=>{try{t=new n(t,r)}catch(e){return!1}return t.test(e)}},60699:(e,t,r)=>{"use strict";let n=r(34179);e.exports=(e,t)=>e.sort((e,r)=>n(e,r,t))},36369:(e,t,r)=>{"use strict";let n=r(59048);e.exports=(e,t)=>{let r=n(e,t);return r?r.version:null}},98819:(e,t,r)=>{"use strict";let n=r(7529),i=r(36045),o=r(1424),s=r(28417),a=r(59048),c=r(36369),l=r(37513),u=r(57121),d=r(323),h=r(4053),p=r(27502),f=r(46335),g=r(53386),m=r(15787),y=r(43827),T=r(90071),E=r(34179),C=r(60699),A=r(82231),I=r(30928),v=r(97898),S=r(17336),w=r(78857),b=r(90532),R=r(52048),_=r(6474),k=r(95457),O=r(48735),P=r(5046),N=r(37538),M=r(50835),D=r(655),U=r(66713),x=r(63309),$=r(1402),q=r(59181),L=r(55170),F=r(20734),H=r(33828),j=r(53807),B=r(87686);e.exports={parse:a,valid:c,clean:l,inc:u,diff:d,major:h,minor:p,patch:f,prerelease:g,compare:m,rcompare:y,compareLoose:T,compareBuild:E,sort:C,rsort:A,gt:I,lt:v,eq:S,neq:w,gte:b,lte:R,cmp:_,coerce:k,Comparator:O,Range:P,satisfies:N,toComparators:M,maxSatisfying:D,minSatisfying:U,minVersion:x,validRange:$,outside:q,gtr:L,ltr:F,intersects:H,simplifyRange:j,subset:B,SemVer:o,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:i.SEMVER_SPEC_VERSION,RELEASE_TYPES:i.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},36045:e=>{"use strict";let t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},8882:e=>{"use strict";let t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},28417:e=>{"use strict";let t=/^[0-9]+$/,r=(e,r)=>{if("number"==typeof e&&"number"==typeof r)return e===r?0:e<r?-1:1;let n=t.test(e),i=t.test(r);return n&&i&&(e=+e,r=+r),e===r?0:n&&!i?-1:i&&!n?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},78790:e=>{"use strict";class t{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}e.exports=t},55303:e=>{"use strict";let t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},7529:(e,t,r)=>{"use strict";let{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:o}=r(36045),s=r(8882),a=(t=e.exports={}).re=[],c=t.safeRe=[],l=t.src=[],u=t.safeSrc=[],d=t.t={},h=0,p="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",o],[p,i]],g=e=>{for(let[t,r]of f)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e},m=(e,t,r)=>{let n=g(t),i=h++;s(e,i,t),d[e]=i,l[i]=t,u[i]=n,a[i]=new RegExp(t,r?"g":void 0),c[i]=new RegExp(n,r?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),m("MAINVERSION",`(${l[d.NUMERICIDENTIFIER]})\\.(${l[d.NUMERICIDENTIFIER]})\\.(${l[d.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[d.NUMERICIDENTIFIERLOOSE]})\\.(${l[d.NUMERICIDENTIFIERLOOSE]})\\.(${l[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[d.NONNUMERICIDENTIFIER]}|${l[d.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[d.NONNUMERICIDENTIFIER]}|${l[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${l[d.PRERELEASEIDENTIFIER]}(?:\\.${l[d.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[d.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${p}+`),m("BUILD",`(?:\\+(${l[d.BUILDIDENTIFIER]}(?:\\.${l[d.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[d.MAINVERSION]}${l[d.PRERELEASE]}?${l[d.BUILD]}?`),m("FULL",`^${l[d.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[d.MAINVERSIONLOOSE]}${l[d.PRERELEASELOOSE]}?${l[d.BUILD]}?`),m("LOOSE",`^${l[d.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[d.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[d.XRANGEIDENTIFIER]})(?:\\.(${l[d.XRANGEIDENTIFIER]})(?:\\.(${l[d.XRANGEIDENTIFIER]})(?:${l[d.PRERELEASE]})?${l[d.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[d.XRANGEIDENTIFIERLOOSE]})(?:${l[d.PRERELEASELOOSE]})?${l[d.BUILD]}?)?)?`),m("XRANGE",`^${l[d.GTLT]}\\s*${l[d.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[d.GTLT]}\\s*${l[d.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${l[d.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[d.COERCEPLAIN]+`(?:${l[d.PRERELEASE]})?`+`(?:${l[d.BUILD]})?`+"(?:$|[^\\d])"),m("COERCERTL",l[d.COERCE],!0),m("COERCERTLFULL",l[d.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${l[d.LONETILDE]}${l[d.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[d.LONETILDE]}${l[d.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${l[d.LONECARET]}${l[d.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[d.LONECARET]}${l[d.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[d.GTLT]}\\s*(${l[d.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[d.GTLT]}\\s*(${l[d.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[d.GTLT]}\\s*(${l[d.LOOSEPLAIN]}|${l[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[d.XRANGEPLAIN]})\\s+-\\s+(${l[d.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[d.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},55170:(e,t,r)=>{"use strict";let n=r(59181);e.exports=(e,t,r)=>n(e,t,">",r)},33828:(e,t,r)=>{"use strict";let n=r(5046);e.exports=(e,t,r)=>(e=new n(e,r),t=new n(t,r),e.intersects(t,r))},20734:(e,t,r)=>{"use strict";let n=r(59181);e.exports=(e,t,r)=>n(e,t,"<",r)},655:(e,t,r)=>{"use strict";let n=r(1424),i=r(5046);e.exports=(e,t,r)=>{let o=null,s=null,a=null;try{a=new i(t,r)}catch(e){return null}return e.forEach(e=>{a.test(e)&&(!o||-1===s.compare(e))&&(s=new n(o=e,r))}),o}},66713:(e,t,r)=>{"use strict";let n=r(1424),i=r(5046);e.exports=(e,t,r)=>{let o=null,s=null,a=null;try{a=new i(t,r)}catch(e){return null}return e.forEach(e=>{a.test(e)&&(!o||1===s.compare(e))&&(s=new n(o=e,r))}),o}},63309:(e,t,r)=>{"use strict";let n=r(1424),i=r(5046),o=r(30928);e.exports=(e,t)=>{e=new i(e,t);let r=new n("0.0.0");if(e.test(r)||(r=new n("0.0.0-0"),e.test(r)))return r;r=null;for(let t=0;t<e.set.length;++t){let i=e.set[t],s=null;i.forEach(e=>{let t=new n(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!s||o(t,s))&&(s=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),s&&(!r||o(r,s))&&(r=s)}return r&&e.test(r)?r:null}},59181:(e,t,r)=>{"use strict";let n=r(1424),i=r(48735),{ANY:o}=i,s=r(5046),a=r(37538),c=r(30928),l=r(97898),u=r(52048),d=r(90532);e.exports=(e,t,r,h)=>{let p,f,g,m,y;switch(e=new n(e,h),t=new s(t,h),r){case">":p=c,f=u,g=l,m=">",y=">=";break;case"<":p=l,f=d,g=c,m="<",y="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(a(e,t,h))return!1;for(let r=0;r<t.set.length;++r){let n=t.set[r],s=null,a=null;if(n.forEach(e=>{e.semver===o&&(e=new i(">=0.0.0")),s=s||e,a=a||e,p(e.semver,s.semver,h)?s=e:g(e.semver,a.semver,h)&&(a=e)}),s.operator===m||s.operator===y||(!a.operator||a.operator===m)&&f(e,a.semver)||a.operator===y&&g(e,a.semver))return!1}return!0}},53807:(e,t,r)=>{"use strict";let n=r(37538),i=r(15787);e.exports=(e,t,r)=>{let o=[],s=null,a=null,c=e.sort((e,t)=>i(e,t,r));for(let e of c)n(e,t,r)?(a=e,s||(s=e)):(a&&o.push([s,a]),a=null,s=null);s&&o.push([s,null]);let l=[];for(let[e,t]of o)e===t?l.push(e):t||e!==c[0]?t?e===c[0]?l.push(`<=${t}`):l.push(`${e} - ${t}`):l.push(`>=${e}`):l.push("*");let u=l.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return u.length<d.length?u:t}},87686:(e,t,r)=>{"use strict";let n=r(5046),i=r(48735),{ANY:o}=i,s=r(37538),a=r(15787),c=[new i(">=0.0.0-0")],l=[new i(">=0.0.0")],u=(e,t,r)=>{let n,i,u,p,f,g,m;if(e===t)return!0;if(1===e.length&&e[0].semver===o){if(1===t.length&&t[0].semver===o)return!0;e=r.includePrerelease?c:l}if(1===t.length&&t[0].semver===o){if(r.includePrerelease)return!0;t=l}let y=new Set;for(let t of e)">"===t.operator||">="===t.operator?n=d(n,t,r):"<"===t.operator||"<="===t.operator?i=h(i,t,r):y.add(t.semver);if(y.size>1||n&&i&&((u=a(n.semver,i.semver,r))>0||0===u&&(">="!==n.operator||"<="!==i.operator)))return null;for(let e of y){if(n&&!s(e,String(n),r)||i&&!s(e,String(i),r))return null;for(let n of t)if(!s(e,String(n),r))return!1;return!0}let T=!!i&&!r.includePrerelease&&!!i.semver.prerelease.length&&i.semver,E=!!n&&!r.includePrerelease&&!!n.semver.prerelease.length&&n.semver;for(let e of(T&&1===T.prerelease.length&&"<"===i.operator&&0===T.prerelease[0]&&(T=!1),t)){if(m=m||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,n){if(E&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===E.major&&e.semver.minor===E.minor&&e.semver.patch===E.patch&&(E=!1),">"===e.operator||">="===e.operator){if((p=d(n,e,r))===e&&p!==n)return!1}else if(">="===n.operator&&!s(n.semver,String(e),r))return!1}if(i){if(T&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===T.major&&e.semver.minor===T.minor&&e.semver.patch===T.patch&&(T=!1),"<"===e.operator||"<="===e.operator){if((f=h(i,e,r))===e&&f!==i)return!1}else if("<="===i.operator&&!s(i.semver,String(e),r))return!1}if(!e.operator&&(i||n)&&0!==u)return!1}return(!n||!g||!!i||0===u)&&(!i||!m||!!n||0===u)&&!E&&!T},d=(e,t,r)=>{if(!e)return t;let n=a(e.semver,t.semver,r);return n>0?e:n<0?t:">"===t.operator&&">="===e.operator?t:e},h=(e,t,r)=>{if(!e)return t;let n=a(e.semver,t.semver,r);return n<0?e:n>0?t:"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new n(e,r),t=new n(t,r);let i=!1;e:for(let n of e.set){for(let e of t.set){let t=u(n,e,r);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},50835:(e,t,r)=>{"use strict";let n=r(5046);e.exports=(e,t)=>new n(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},1402:(e,t,r)=>{"use strict";let n=r(5046);e.exports=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}}},13336:(e,t,r)=>{"use strict";let n;let i=r(19801),o=r(74175),s=r(9674),{env:a}=process;function c(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function l(e,t){if(0===n)return 0;if(s("color=16m")||s("color=full")||s("color=truecolor"))return 3;if(s("color=256"))return 2;if(e&&!t&&void 0===n)return 0;let r=n||0;if("dumb"===a.TERM)return r;if("win32"===process.platform){let e=i.release().split(".");return Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in a)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(e=>e in a)||"codeship"===a.CI_NAME?1:r;if("TEAMCITY_VERSION"in a)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(a.TEAMCITY_VERSION)?1:0;if("truecolor"===a.COLORTERM)return 3;if("TERM_PROGRAM"in a){let e=parseInt((a.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(a.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(a.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(a.TERM)||"COLORTERM"in a?1:r}s("no-color")||s("no-colors")||s("color=false")||s("color=never")?n=0:(s("color")||s("colors")||s("color=true")||s("color=always"))&&(n=1),"FORCE_COLOR"in a&&(n="true"===a.FORCE_COLOR?1:"false"===a.FORCE_COLOR?0:0===a.FORCE_COLOR.length?1:Math.min(parseInt(a.FORCE_COLOR,10),3)),e.exports={supportsColor:function(e){return c(l(e,e&&e.isTTY))},stdout:c(l(!0,o.isatty(1))),stderr:c(l(!0,o.isatty(2)))}},83130:(e,t)=>{"use strict";t.S=void 0,t.S={operationRequestMap:new WeakMap}},31545:(e,t)=>{"use strict";t.S=void 0,t.S={instrumenterImplementation:void 0}},19664:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});class n extends Error{constructor(e){super(e),this.name="AbortError"}}},18084:(e,t,r)=>{"use strict";r.d(t,{oY:()=>R,vA:()=>B,VC:()=>q,tn:()=>P,dC:()=>N,WA:()=>O,kO:()=>M,bY:()=>U});var n=r(47390),i=r(73807);let o=(0,i.YR)("core-rest-pipeline");var s=r(65914),a=r(28455),c=r(77691);r(54757);var l=r(99287);r(36750);var u=r(45091),d=r(83110),h=r(63450),p=r(38073),f=r(11222),g=r(45796);r(21525);var m=r(70612),y=r(97742);async function T(e){if(y&&y.versions){let t=y.versions;t.bun?e.set("Bun",t.bun):t.deno?e.set("Deno",t.deno):t.node&&e.set("Node",t.node)}e.set("OS",`(${m.arch()}-${m.type()}-${m.release()})`)}let E="1.22.1";async function C(e){let t=new Map;t.set("core-rest-pipeline",E),await T(t);let r=function(e){let t=[];for(let[r,n]of e){let e=n?`${r}/${n}`:r;t.push(e)}return t.join(" ")}(t);return e?`${e} ${r}`:r}let A="User-Agent";var I=r(92356);let v=Symbol("rawContent");function S(e){return"function"==typeof e[v]}let w=h.m;var b=r(96665);let R=n.oY;var _=r(2010);function k(e){if(e instanceof AbortSignal)return{abortSignal:e};if(e.aborted)return{abortSignal:AbortSignal.abort(e.reason)};let t=new AbortController,r=!0;function n(){r&&(e.removeEventListener("abort",i),r=!1)}function i(){t.abort(e.reason),n()}return e.addEventListener("abort",i),{abortSignal:t.signal,cleanup:n}}function O(e){let t=(0,n.AL)();if(I.Lr){var r,i,l;e.agent&&t.addPolicy((r=e.agent,(0,s.d)(r))),e.tlsOptions&&t.addPolicy((i=e.tlsOptions,(0,g.X)(i))),t.addPolicy((l=e.proxyOptions,(0,p.Rc)(l,void 0))),t.addPolicy((0,a.$)())}return t.addPolicy({name:"wrapAbortSignalLikePolicy",sendRequest:async(e,t)=>{if(!e.abortSignal)return t(e);let{abortSignal:r,cleanup:n}=k(e.abortSignal);e.abortSignal=r;try{return await t(e)}finally{n?.()}}}),t.addPolicy((0,u.a)(),{beforePolicies:[w]}),t.addPolicy(function(e={}){let t=C(e.userAgentPrefix);return{name:"userAgentPolicy",sendRequest:async(e,r)=>(e.headers.has(A)||e.headers.set(A,await t),r(e))}}(e.userAgentOptions)),t.addPolicy(function(e="x-ms-client-request-id"){return{name:"setClientRequestIdPolicy",sendRequest:async(t,r)=>(t.headers.has(e)||t.headers.set(e,t.requestId),r(t))}}(e.telemetryOptions?.clientRequestIdHeaderName)),t.addPolicy(function(){let e=(0,h.I)();return{name:w,sendRequest:async(t,r)=>{if(t.multipartBody){for(let e of t.multipartBody.parts)if(S(e.body)){var n;e.body=S(n=e.body)?n[v]():n}}return e.sendRequest(t,r)}}}(),{afterPhase:"Deserialize"}),t.addPolicy(function(e={}){return(0,c.F)(e)}(e.retryOptions),{phase:"Retry"}),t.addPolicy(function(e={}){let t=C(e.userAgentPrefix),r=new _.Ti({additionalAllowedQueryParameters:e.additionalAllowedQueryParameters}),i=function(){try{return(0,b.U)({namespace:"",packageName:"@azure/core-rest-pipeline",packageVersion:E})}catch(e){o.warning(`Error when creating the TracingClient: ${(0,I.e$)(e)}`);return}}();return{name:"tracingPolicy",async sendRequest(e,s){if(!i)return s(e);let a=await t,c={"http.url":r.sanitizeUrl(e.url),"http.method":e.method,"http.user_agent":a,requestId:e.requestId};a&&(c["http.user_agent"]=a);let{span:l,tracingContext:u}=function(e,t,r){try{let{span:n,updatedOptions:i}=e.startSpan(`HTTP ${t.method}`,{tracingOptions:t.tracingOptions},{spanKind:"client",spanAttributes:r});if(!n.isRecording()){n.end();return}let o=e.createRequestHeaders(i.tracingOptions.tracingContext);for(let[e,r]of Object.entries(o))t.headers.set(e,r);return{span:n,tracingContext:i.tracingOptions.tracingContext}}catch(e){o.warning(`Skipping creating a tracing span due to an error: ${(0,I.e$)(e)}`);return}}(i,e,c)??{};if(!l||!u)return s(e);try{let t=await i.withContext(u,s,e);return function(e,t){try{e.setAttribute("http.status_code",t.status);let r=t.headers.get("x-ms-request-id");r&&e.setAttribute("serviceRequestId",r),t.status>=400&&e.setStatus({status:"error"}),e.end()}catch(e){o.warning(`Skipping tracing span processing due to an error: ${(0,I.e$)(e)}`)}}(l,t),t}catch(e){throw function(e,t){try{e.setStatus({status:"error",error:(0,I.VZ)(t)?t:void 0}),(0,n.h)(t)&&t.statusCode&&e.setAttribute("http.status_code",t.statusCode),e.end()}catch(e){o.warning(`Skipping tracing span processing due to an error: ${(0,I.e$)(e)}`)}}(l,e),e}}}}({...e.userAgentOptions,...e.loggingOptions}),{afterPhase:"Retry"}),I.Lr&&t.addPolicy(function(e={}){return(0,f.M)(e)}(e.redirectOptions),{afterPhase:"Retry"}),t.addPolicy(function(e={}){return(0,d._)({logger:o.info,...e})}(e.loggingOptions),{afterPhase:"Sign"}),t}function P(){let e=(0,n.tn)();return{async sendRequest(t){let{abortSignal:r,cleanup:n}=t.abortSignal?k(t.abortSignal):{};try{return t.abortSignal=r,await e.sendRequest(t)}finally{n?.()}}}}function N(e){return(0,n.dC)(e)}function M(e){return(0,n.kO)(e)}let D=(0,i.YR)("core-rest-pipeline retryPolicy");function U(e,t={maxRetries:3}){return(0,l.b)(e,{logger:D,...t})}let x={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:12e4};async function $(e,t,r){async function n(){if(Date.now()<r)try{return await e()}catch{return null}else{let t=await e();if(null===t)throw Error("Failed to refresh access token.");return t}}let i=await n();for(;null===i;)await (0,I.gw)(t),i=await n();return i}let q="bearerTokenAuthenticationPolicy";async function L(e,t){try{return[await t(e),void 0]}catch(e){if((0,n.h)(e)&&e.response)return[e.response,e];throw e}}async function F(e){let{scopes:t,getAccessToken:r,request:n}=e,i={abortSignal:n.abortSignal,tracingOptions:n.tracingOptions,enableCae:!0},o=await r(t,i);o&&e.request.headers.set("Authorization",`Bearer ${o.token}`)}function H(e){return 401===e.status&&e.headers.has("WWW-Authenticate")}async function j(e,t){let{scopes:r}=e,n=await e.getAccessToken(r,{enableCae:!0,claims:t});return!!n&&(e.request.headers.set("Authorization",`${n.tokenType??"Bearer"} ${n.token}`),!0)}function B(e){let{credential:t,scopes:r,challengeCallbacks:n}=e,i=e.logger||o,s={authorizeRequest:n?.authorizeRequest?.bind(n)??F,authorizeRequestOnChallenge:n?.authorizeRequestOnChallenge?.bind(n)},a=t?function(e,t){let r,n=null,i=null,o={...x},s={get isRefreshing(){return null!==n},get shouldRefresh(){if(s.isRefreshing)return!1;if(i?.refreshAfterTimestamp&&i.refreshAfterTimestamp<Date.now())return!0;return(i?.expiresOnTimestamp??0)-o.refreshWindowInMs<Date.now()},get mustRefresh(){return null===i||i.expiresOnTimestamp-o.forcedRefreshWindowInMs<Date.now()}};function a(t,a){return s.isRefreshing||(n=$(()=>e.getToken(t,a),o.retryIntervalInMs,i?.expiresOnTimestamp??Date.now()).then(e=>(n=null,i=e,r=a.tenantId,i)).catch(e=>{throw n=null,i=null,r=void 0,e})),n}return async(e,t)=>{let n=!!t.claims,o=r!==t.tenantId;return(n&&(i=null),o||n||s.mustRefresh)?a(e,t):(s.shouldRefresh&&a(e,t),i)}}(t):()=>Promise.resolve(null);return{name:q,async sendRequest(e,t){let n,o;if(!e.url.toLowerCase().startsWith("https://"))throw Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");if(await s.authorizeRequest({scopes:Array.isArray(r)?r:[r],request:e,getAccessToken:a,logger:i}),[n,o]=await L(e,t),H(n)){let c=z(n.headers.get("WWW-Authenticate"));if(c){let s;try{s=atob(c)}catch(e){return i.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${c}`),n}await j({scopes:Array.isArray(r)?r:[r],response:n,request:e,getAccessToken:a,logger:i},s)&&([n,o]=await L(e,t))}else if(s.authorizeRequestOnChallenge&&(await s.authorizeRequestOnChallenge({scopes:Array.isArray(r)?r:[r],request:e,response:n,getAccessToken:a,logger:i})&&([n,o]=await L(e,t)),H(n)&&(c=z(n.headers.get("WWW-Authenticate"))))){let s;try{s=atob(c)}catch(e){return i.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${c}`),n}await j({scopes:Array.isArray(r)?r:[r],response:n,request:e,getAccessToken:a,logger:i},s)&&([n,o]=await L(e,t))}}if(!o)return n;throw o}}}function z(e){if(!e)return;let t=function(e){let t;let r=/(\w+)\s+((?:\w+=(?:"[^"]*"|[^,]*),?\s*)+)/g,n=/(\w+)="([^"]*)"/g,i=[];for(;null!==(t=r.exec(e));){let e;let r=t[1],o=t[2],s={};for(;null!==(e=n.exec(o));)s[e[1]]=e[2];i.push({scheme:r,params:s})}return i}(e);return t.find(e=>"Bearer"===e.scheme&&e.params.claims&&"insufficient_claims"===e.params.error)?.params.claims}},96665:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});let n={span:Symbol.for("@azure/core-tracing span"),namespace:Symbol.for("@azure/core-tracing namespace")};class i{_contextMap;constructor(e){this._contextMap=e instanceof i?new Map(e._contextMap):new Map}setValue(e,t){let r=new i(this);return r._contextMap.set(e,t),r}getValue(e){return this._contextMap.get(e)}deleteValue(e){let t=new i(this);return t._contextMap.delete(e),t}}let o=r(31545).S;function s(){return o.instrumenterImplementation||(o.instrumenterImplementation={createRequestHeaders:()=>({}),parseTraceparentHeader:()=>{},startSpan:(e,t)=>({span:{end:()=>{},isRecording:()=>!1,recordException:()=>{},setAttribute:()=>{},setStatus:()=>{},addEvent:()=>{}},tracingContext:function(e={}){let t=new i(e.parentContext);return e.span&&(t=t.setValue(n.span,e.span)),e.namespace&&(t=t.setValue(n.namespace,e.namespace)),t}({parentContext:t.tracingContext})}),withContext:(e,t,...r)=>t(...r)}),o.instrumenterImplementation}function a(e){let{namespace:t,packageName:r,packageVersion:i}=e;function o(e,o,a){let c=s().startSpan(e,{...a,packageName:r,packageVersion:i,tracingContext:o?.tracingOptions?.tracingContext}),l=c.tracingContext,u=c.span;return l.getValue(n.namespace)||(l=l.setValue(n.namespace,t)),u.setAttribute("az.namespace",l.getValue(n.namespace)),{span:u,updatedOptions:Object.assign({},o,{tracingOptions:{...o?.tracingOptions,tracingContext:l}})}}async function a(e,t,r,n){let{span:i,updatedOptions:s}=o(e,t,n);try{let e=await c(s.tracingOptions.tracingContext,()=>Promise.resolve(r(s,i)));return i.setStatus({status:"success"}),e}catch(e){throw i.setStatus({status:"error",error:e}),e}finally{i.end()}}function c(e,t,...r){return s().withContext(e,t,...r)}return{startSpan:o,withSpan:a,withContext:c,parseTraceparentHeader:function(e){return s().parseTraceparentHeader(e)},createRequestHeaders:function(e){return s().createRequestHeaders(e)}}}},92356:(e,t,r)=>{"use strict";r.d(t,{b3:()=>c,gw:()=>o,e$:()=>s,VZ:()=>l,UG:()=>u,Lr:()=>d,LW:()=>a,sy:()=>p,DA:()=>h});var n=r(2010),i=r(19664);function o(e,t){let r;let{abortSignal:n,abortErrorMsg:o}=t??{};return function(e,t){let{cleanupBeforeAbort:r,abortSignal:n,abortErrorMsg:o}=t??{};return new Promise((t,s)=>{function a(){s(new i._(o??"The operation was aborted."))}function c(){n?.removeEventListener("abort",l)}function l(){r?.(),c(),a()}if(n?.aborted)return a();try{e(e=>{c(),t(e)},e=>{c(),s(e)})}catch(e){s(e)}n?.addEventListener("abort",l)})}(t=>{r=setTimeout(t,e)},{cleanupBeforeAbort:()=>clearTimeout(r),abortSignal:n,abortErrorMsg:o??"The delay was aborted."})}function s(e){if((0,n.VZ)(e))return e.message;{let t;try{t="object"==typeof e&&e?JSON.stringify(e):String(e)}catch(e){t="[unable to stringify input]"}return`Unknown error ${t}`}}function a(e,t){if(!(null!=e)||"object"!=typeof e)return!1;for(let i of t){var r,n;if(r=e,n=i,null==r||"object"!=typeof r||!(n in r))return!1}return!0}function c(e,t){return n.b3(e,t)}function l(e){return n.VZ(e)}n.jU,n.PW,n.co;let u=n.Lr,d=n.Lr;function h(e,t){return n.DA(e,t)}function p(e,t){return n.sy(e,t)}n.db,n.b$,n.n2},52075:(e,t,r)=>{"use strict";let n,i,o,s,a;r.d(t,{Rp:()=>oU,y0:()=>sO});let c="4.13.0",l="04b07795-8ddb-461a-bbee-02f9e1bf7b46";!function(e){e.AzureChina="https://login.chinacloudapi.cn",e.AzureGermany="https://login.microsoftonline.de",e.AzureGovernment="https://login.microsoftonline.us",e.AzurePublicCloud="https://login.microsoftonline.com"}(A||(A={}));let u=A.AzurePublicCloud,d=["*"],h={missing:(e,t,r)=>`${e} was requested, but no plugin was configured or no authentication record was found. You must install the ${t} plugin package (npm install --save ${t}) and enable it by importing \`useIdentityPlugin\` from \`@azure/identity\` and calling useIdentityPlugin(${r}) before using enableBroker.`,unavailable:(e,t)=>`${e} was requested, and the plugin is configured, but the broker is unavailable. Ensure the ${e} plugin is properly installed and configured. Check for missing native dependencies and ensure the package is properly installed. See the README for prerequisites on installing and using ${t}.`},p={vsCode:{credentialName:"Visual Studio Code Credential",packageName:"@azure/identity-vscode",pluginVar:"vsCodePlugin",get brokerInfo(){return a}},native:{credentialName:"Broker for WAM",packageName:"@azure/identity-broker",pluginVar:"nativeBrokerPlugin",get brokerInfo(){return o}}},f={generatePluginConfiguration:function(e){let t={cache:{},broker:{...e.brokerOptions,isEnabled:e.brokerOptions?.enabled??!1,enableMsaPassthrough:e.brokerOptions?.legacyEnableMsaPassthrough??!1}};if(e.tokenCachePersistenceOptions?.enabled){if(void 0===i)throw Error("Persistent token caching was requested, but no persistence provider was configured. You must install the identity-cache-persistence plugin package (`npm install --save @azure/identity-cache-persistence`) and enable it by importing `useIdentityPlugin` from `@azure/identity` and calling `useIdentityPlugin(cachePersistencePlugin)` before using `tokenCachePersistenceOptions`.");let r=e.tokenCachePersistenceOptions.name||"msal.cache";t.cache.cachePlugin=i({name:`${r}.nocae`,...e.tokenCachePersistenceOptions}),t.cache.cachePluginCae=i({name:`${r}.cae`,...e.tokenCachePersistenceOptions})}return e.brokerOptions?.enabled&&(t.broker.nativeBrokerPlugin=function(e){let{credentialName:t,packageName:r,pluginVar:n,brokerInfo:i}=p[e?"vsCode":"native"];if(void 0===i)throw Error(h.missing(t,r,n));if(!1===i.broker.isBrokerAvailable)throw Error(h.unavailable(t,r));return i.broker}(e.isVSCodeCredential||!1)),t}};class g extends Error{constructor(e,t){super(e,t),this.name="CredentialUnavailableError"}}let m="AuthenticationError";class y extends Error{statusCode;errorResponse;constructor(e,t,r){let n={error:"unknown",errorDescription:"An unknown error occurred and no additional details are available."};if(function(e){return e&&"string"==typeof e.error&&"string"==typeof e.error_description}(t))n=E(t);else if("string"==typeof t)try{let e=JSON.parse(t);n=E(e)}catch(r){n=400===e?{error:"invalid_request",errorDescription:`The service indicated that the request was invalid.

${t}`}:{error:"unknown_error",errorDescription:`An unknown error has occurred. Response body:

${t}`}}else n={error:"unknown_error",errorDescription:"An unknown error occurred and no additional details are available."};super(`${n.error} Status code: ${e}
More details:
${n.errorDescription},`,r),this.statusCode=e,this.errorResponse=n,this.name=m}}class T extends Error{errors;constructor(e,t){super(`${t}
${e.join("\n")}`),this.errors=e,this.name="AggregateAuthenticationError"}}function E(e){return{error:e.error,errorDescription:e.error_description,correlationId:e.correlation_id,errorCodes:e.error_codes,timestamp:e.timestamp,traceId:e.trace_id}}class C extends Error{scopes;getTokenOptions;constructor(e){super(e.message,e.cause?{cause:e.cause}:void 0),this.scopes=e.scopes,this.getTokenOptions=e.getTokenOptions,this.name="AuthenticationRequiredError"}}var A,I,v,S=r(73807);let w=(0,S.YR)("identity");function b(e){return e.reduce((e,t)=>(process.env[t]?e.assigned.push(t):e.missing.push(t),e),{missing:[],assigned:[]})}function R(e){return`SUCCESS. Scopes: ${Array.isArray(e)?e.join(", "):e}.`}function _(e,t){let r="ERROR.";return e?.length&&(r+=` Scopes: ${Array.isArray(e)?e.join(", "):e}.`),`${r} Error message: ${"string"==typeof t?t:t.message}.`}function k(e,t,r=w){let n=t?`${t.fullTitle} ${e}`:e;return{title:e,fullTitle:n,info:function(e){r.info(`${n} =>`,e)},warning:function(e){r.warning(`${n} =>`,e)},verbose:function(e){r.verbose(`${n} =>`,e)},error:function(e){r.error(`${n} =>`,e)}}}function O(e,t=w){let r=k(e,void 0,t);return{...r,parent:t,getToken:k("=> getToken()",r,t)}}let P=(0,r(96665).U)({namespace:"Microsoft.AAD",packageName:"@azure/identity",packageVersion:c}),N=O("ChainedTokenCredential");class M{_sources=[];constructor(...e){this._sources=e}async getToken(e,t={}){let{token:r}=await this.getTokenInternal(e,t);return r}async getTokenInternal(e,t={}){let r,n=null,i=[];return P.withSpan("ChainedTokenCredential.getToken",t,async t=>{for(let o=0;o<this._sources.length&&null===n;o++)try{n=await this._sources[o].getToken(e,t),r=this._sources[o]}catch(t){if("CredentialUnavailableError"===t.name||"AuthenticationRequiredError"===t.name)i.push(t);else throw N.getToken.info(_(e,t)),t}if(!n&&i.length>0){let t=new T(i,"ChainedTokenCredential authentication failed.");throw N.getToken.info(_(e,t)),t}if(N.getToken.info(`Result for ${r.constructor.name}: ${R(e)}`),null===n)throw new g("Failed to retrieve a valid token");return{token:n,successfulCredential:r}})}}let D={SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],INVALID_INSTANCE:"invalid_instance"},U={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,GONE:410,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599},x=[D.OPENID_SCOPE,D.PROFILE_SCOPE,D.OFFLINE_ACCESS_SCOPE],$=[...x,D.EMAIL_SCOPE],q={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},L={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},F={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},H={SELECT_ACCOUNT:"select_account",NONE:"none"},j={S256:"S256"},B={CODE:"code",IDTOKEN_TOKEN:"id_token token"},z={QUERY:"query"},G={AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},V={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",GENERIC_ACCOUNT_TYPE:"Generic"},K={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},Y={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},W="appmetadata",Q={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:86400},J={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},Z={SCHEMA_VERSION:5,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},X={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},ee={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},et={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},er={username:"username",password:"password"},en={FAILED_AUTO_DETECTION:"1",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},ei={CONFIGURED_NO_AUTO_DETECTION:"2",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},eo={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},es={BASE64:"base64",HEX:"hex",UTF8:"utf-8"},ea="https://login.microsoftonline.com/managed_identity/",ec={AUTHORIZATION_HEADER_NAME:"Authorization",METADATA_HEADER_NAME:"Metadata",APP_SERVICE_SECRET_HEADER_NAME:"X-IDENTITY-HEADER",ML_AND_SF_SECRET_HEADER_NAME:"secret"},el={API_VERSION:"api-version",RESOURCE:"resource",SHA256_TOKEN_TO_REFRESH:"token_sha256_to_refresh",XMS_CC:"xms_cc"},eu={AZURE_POD_IDENTITY_AUTHORITY_HOST:"AZURE_POD_IDENTITY_AUTHORITY_HOST",DEFAULT_IDENTITY_CLIENT_ID:"DEFAULT_IDENTITY_CLIENT_ID",IDENTITY_ENDPOINT:"IDENTITY_ENDPOINT",IDENTITY_HEADER:"IDENTITY_HEADER",IDENTITY_SERVER_THUMBPRINT:"IDENTITY_SERVER_THUMBPRINT",IMDS_ENDPOINT:"IMDS_ENDPOINT",MSI_ENDPOINT:"MSI_ENDPOINT",MSI_SECRET:"MSI_SECRET"},ed={APP_SERVICE:"AppService",AZURE_ARC:"AzureArc",CLOUD_SHELL:"CloudShell",DEFAULT_TO_IMDS:"DefaultToImds",IMDS:"Imds",MACHINE_LEARNING:"MachineLearning",SERVICE_FABRIC:"ServiceFabric"},eh={SYSTEM_ASSIGNED:"system-assigned",USER_ASSIGNED_CLIENT_ID:"user-assigned-client-id",USER_ASSIGNED_RESOURCE_ID:"user-assigned-resource-id",USER_ASSIGNED_OBJECT_ID:"user-assigned-object-id"},ep={GET:"get",POST:"post"},ef={SUCCESS_RANGE_START:U.SUCCESS_RANGE_START,SUCCESS_RANGE_END:U.SUCCESS_RANGE_END,SERVER_ERROR:U.SERVER_ERROR},eg={SHA256:"sha256"},em={CV_CHARSET:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~"},ey={KEY_SEPARATOR:"-"},eT={MSAL_SKU:"msal.js.node",JWT_BEARER_ASSERTION_TYPE:"urn:ietf:params:oauth:client-assertion-type:jwt-bearer",AUTHORIZATION_PENDING:"authorization_pending",HTTP_PROTOCOL:"http://",LOCALHOST:"localhost"},eE={acquireTokenSilent:62,acquireTokenByUsernamePassword:371,acquireTokenByDeviceCode:671,acquireTokenByClientCredential:771,acquireTokenByCode:871,acquireTokenByRefreshToken:872},eC={RSA_256:"RS256",PSS_256:"PS256",X5T_256:"x5t#S256",X5T:"x5t",X5C:"x5c",AUDIENCE:"aud",EXPIRATION_TIME:"exp",ISSUER:"iss",SUBJECT:"sub",NOT_BEFORE:"nbf",JWT_ID:"jti"},eA={INTERVAL_MS:100,TIMEOUT_MS:5e3},eI="unexpected_error",ev="post_request_failed",eS={[eI]:"Unexpected error in authentication.",[ev]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};eS[eI],eS[ev];class ew extends Error{constructor(e,t,r){super(t?`${e}: ${t}`:e),Object.setPrototypeOf(this,ew.prototype),this.errorCode=e||D.EMPTY_STRING,this.errorMessage=t||D.EMPTY_STRING,this.subError=r||D.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}class eb{constructor(e,t){this.cacheOutcome=eo.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||D.EMPTY_STRING,this.wrapperVer=e.wrapperVer||D.EMPTY_STRING,this.telemetryCacheKey=Z.CACHE_KEY+K.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){let e=`${this.apiId}${Z.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r?.length&&t.push(`broker_error=${r}`);let n=t.join(Z.VALUE_SEPARATOR),i=[e,this.getRegionDiscoveryFields()].join(Z.VALUE_SEPARATOR);return[Z.SCHEMA_VERSION,i,n].join(Z.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){let e=this.getLastRequests(),t=eb.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(Z.VALUE_SEPARATOR),n=e.errors.slice(0,t).join(Z.VALUE_SEPARATOR),i=e.errors.length,o=t<i?Z.OVERFLOW_TRUE:Z.OVERFLOW_FALSE,s=[i,o].join(Z.VALUE_SEPARATOR);return[Z.SCHEMA_VERSION,e.cacheHits,r,n,s].join(Z.CATEGORY_SEPARATOR)}cacheFailedRequest(e){let t=this.getLastRequests();t.errors.length>=Z.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof ew?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Z.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){let e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){let e=this.getLastRequests(),t=eb.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{let r={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r,this.correlationId)}}static maxErrorsToSend(e){let t;let r=0,n=0,i=e.errors.length;for(t=0;t<i;t++){let i=e.failedRequests[2*t]||D.EMPTY_STRING,o=e.failedRequests[2*t+1]||D.EMPTY_STRING,s=e.errors[t]||D.EMPTY_STRING;if((n+=i.toString().length+o.toString().length+s.length+3)<Z.MAX_LAST_HEADER_BYTES)r+=1;else break}return r}getRegionDiscoveryFields(){let e=[];return e.push(this.regionUsed||D.EMPTY_STRING),e.push(this.regionSource||D.EMPTY_STRING),e.push(this.regionOutcome||D.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){let t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){let e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return function(e){let{skus:t,libraryName:r,libraryVersion:n,extensionName:i,extensionVersion:o}=e,s=new Map([[0,[r,n]],[2,[i,o]]]),a=[];if(t?.length){if((a=t.split(",")).length<4)return t}else a=Array.from({length:4},()=>"|");return s.forEach((e,t)=>{2===e.length&&e[0]?.length&&e[1]?.length&&function(e){let{skuArr:t,index:r,skuName:n,skuVersion:i}=e;r>=t.length||(t[r]=[n,i].join("|"))}({skuArr:a,index:t,skuName:e[0],skuVersion:e[1]})}),a.join(",")}(e)}}let eR="client_id",e_="redirect_uri",ek="token_type",eO="req_cnf",eP="return_spa_code",eN="x-client-xtra-sku",eM="brk_client_id",eD="brk_redirect_uri",eU="instance_aware";class ex extends ew{constructor(e,t,r,n,i){super(e,t,r),this.name="ServerError",this.errorNo=n,this.status=i,Object.setPrototypeOf(this,ex.prototype)}}!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Trace=4]="Trace"}(I||(I={}));class e${constructor(e,t,r){this.level=I.Info;let n=e||e$.createDefaultLoggerOptions();this.localCallback=n.loggerCallback||(()=>{}),this.piiLoggingEnabled=n.piiLoggingEnabled||!1,this.level="number"==typeof n.logLevel?n.logLevel:I.Info,this.correlationId=n.correlationId||D.EMPTY_STRING,this.packageName=t||D.EMPTY_STRING,this.packageVersion=r||D.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:I.Info}}clone(e,t,r){return new e$({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;let r=new Date().toUTCString(),n=`[${r}] : [${t.correlationId||this.correlationId||""}]`,i=`${n} : ${this.packageName}@${this.packageVersion} : ${I[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,i,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:I.Error,containsPii:!1,correlationId:t||D.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:I.Error,containsPii:!0,correlationId:t||D.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:I.Warning,containsPii:!1,correlationId:t||D.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:I.Warning,containsPii:!0,correlationId:t||D.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:I.Info,containsPii:!1,correlationId:t||D.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:I.Info,containsPii:!0,correlationId:t||D.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:I.Verbose,containsPii:!1,correlationId:t||D.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:I.Verbose,containsPii:!0,correlationId:t||D.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:I.Trace,containsPii:!1,correlationId:t||D.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:I.Trace,containsPii:!0,correlationId:t||D.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}let eq={Default:0,Adfs:1,Dsts:2,Ciam:3},eL="redirect_uri_empty",eF="claims_request_parsing_error",eH="authority_uri_insecure",ej="url_parse_error",eB="empty_url_error",ez="empty_input_scopes_error",eG="invalid_claims",eV="token_request_empty",eK="logout_request_empty",eY="invalid_code_challenge_method",eW="pkce_params_missing",eQ="invalid_cloud_discovery_metadata",eJ="invalid_authority_metadata",eZ="untrusted_authority",eX="missing_ssh_jwk",e0="missing_ssh_kid",e1="missing_nonce_authentication_header",e2="invalid_authentication_header",e3="cannot_set_OIDCOptions",e6="cannot_allow_platform_broker",e5="authority_mismatch",e4="invalid_request_method_for_EAR",e8="invalid_authorize_post_body_parameters",e9={[eL]:"A redirect URI is required for all calls, and none has been set.",[eF]:"Could not parse the given claims request object.",[eH]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[ej]:"URL could not be parsed into appropriate segments.",[eB]:"URL was empty or null.",[ez]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[eG]:"Given claims parameter must be a stringified JSON object.",[eV]:"Token request was empty and not found in cache.",[eK]:"The logout request was null or undefined.",[eY]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[eW]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[eQ]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[eJ]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[eZ]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[eX]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[e0]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[e1]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[e2]:"Invalid authentication header provided",[e3]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[e6]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[e5]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority.",[e8]:"Invalid authorize post body parameters provided. If you are using authorizePostBodyParameters, the request method must be POST. Please check the request method and parameters.",[e4]:"Invalid request method for EAR protocol mode. The request method cannot be GET when using EAR protocol mode. Please change the request method to POST."};e9[eL],e9[eF],e9[eH],e9[ej],e9[eB],e9[ez],e9[eG],e9[eV],e9[eK],e9[eY],e9[eW],e9[eQ],e9[eJ],e9[eZ],e9[eX],e9[e0],e9[e1],e9[e2],e9[e3],e9[e6],e9[e5],e9[e8],e9[e4];class e7 extends ew{constructor(e){super(e,e9[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,e7.prototype)}}function te(e){return new e7(e)}class tt{static isEmptyObj(e){if(e)try{let t=JSON.parse(e);return 0===Object.keys(t).length}catch(e){}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){let t={},r=e.split("&"),n=e=>decodeURIComponent(e.replace(/\+/g," "));return r.forEach(e=>{if(e.trim()){let[r,i]=e.split(/=(.+)/g,2);r&&i&&(t[n(r)]=n(i))}}),t}static trimArrayEntries(e){return e.map(e=>e.trim())}static removeEmptyStringsFromArray(e){return e.filter(e=>!!e)}static jsonParseHelper(e){try{return JSON.parse(e)}catch(e){return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}let tr="client_info_decoding_error",tn="client_info_empty_error",ti="token_parsing_error",to="null_or_empty_token",ts="endpoints_resolution_error",ta="network_error",tc="openid_config_error",tl="hash_not_deserialized",tu="invalid_state",td="state_mismatch",th="state_not_found",tp="nonce_mismatch",tf="auth_time_not_found",tg="max_age_transpired",tm="multiple_matching_tokens",ty="multiple_matching_accounts",tT="multiple_matching_appMetadata",tE="request_cannot_be_made",tC="cannot_remove_empty_scope",tA="cannot_append_scopeset",tI="empty_input_scopeset",tv="device_code_polling_cancelled",tS="device_code_expired",tw="device_code_unknown_error",tb="no_account_in_silent_request",tR="invalid_cache_record",t_="invalid_cache_environment",tk="no_account_found",tO="no_crypto_object",tP="unexpected_credential_type",tN="invalid_assertion",tM="invalid_client_credential",tD="token_refresh_required",tU="user_timeout_reached",tx="token_claims_cnf_required_for_signedjwt",t$="authorization_code_missing_from_server_response",tq="binding_key_not_removed",tL="end_session_endpoint_not_supported",tF="key_id_missing",tH="no_network_connectivity",tj="user_canceled",tB="missing_tenant_id_error",tz="method_not_implemented",tG="nested_app_auth_bridge_disabled",tV={[tr]:"The client info could not be parsed/decoded correctly",[tn]:"The client info was empty",[ti]:"Token cannot be parsed",[to]:"The token is null or empty",[ts]:"Endpoints cannot be resolved",[ta]:"Network request failed",[tc]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[tl]:"The hash parameters could not be deserialized",[tu]:"State was not the expected format",[td]:"State mismatch error",[th]:"State not found",[tp]:"Nonce mismatch error",[tf]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[tg]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[tm]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[ty]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[tT]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[tE]:"Token request cannot be made without authorization code or refresh token.",[tC]:"Cannot remove null or empty scope from ScopeSet",[tA]:"Cannot append ScopeSet",[tI]:"Empty input ScopeSet cannot be processed",[tv]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[tS]:"Device code is expired.",[tw]:"Device code stopped polling for unknown reasons.",[tb]:"Please pass an account object, silent flow is not supported without account information",[tR]:"Cache record object was null or undefined.",[t_]:"Invalid environment when attempting to create cache entry",[tk]:"No account found in cache for given key.",[tO]:"No crypto object detected.",[tP]:"Unexpected credential type.",[tN]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[tM]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[tD]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[tU]:"User defined timeout for device code polling reached",[tx]:"Cannot generate a POP jwt if the token_claims are not populated",[t$]:"Server response does not contain an authorization code to proceed",[tq]:"Could not remove the credential's binding key from storage.",[tL]:"The provided authority does not support logout",[tF]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[tH]:"No network connectivity. Check your internet connection.",[tj]:"User cancelled the flow.",[tB]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[tz]:"This method has not been implemented",[tG]:"The nested app auth bridge is disabled"};tV[tr],tV[tn],tV[ti],tV[to],tV[ts],tV[ta],tV[tc],tV[tl],tV[tu],tV[td],tV[th],tV[tp],tV[tf],tV[tg],tV[tm],tV[ty],tV[tT],tV[tE],tV[tC],tV[tA],tV[tI],tV[tv],tV[tS],tV[tw],tV[tb],tV[tR],tV[t_],tV[tk],tV[tO],tV[tP],tV[tN],tV[tM],tV[tD],tV[tU],tV[tx],tV[t$],tV[tq],tV[tL],tV[tF],tV[tH],tV[tj],tV[tB],tV[tG];class tK extends ew{constructor(e,t){super(e,t?`${tV[e]}: ${t}`:tV[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,tK.prototype)}}function tY(e,t){return new tK(e,t)}function tW(e){if(!e||0>e.indexOf("="))return null;try{let t=e.startsWith("#/")?e.substring(2):e.startsWith("#")||e.startsWith("?")?e.substring(1):e,r=Object.fromEntries(new URLSearchParams(t));if(r.code||r.ear_jwe||r.error||r.error_description||r.state)return r}catch(e){throw tY(tl)}return null}function tQ(e,t=!0,r){let n=[];return e.forEach((e,i)=>{!t&&r&&i in r?n.push(`${i}=${e}`):n.push(`${i}=${encodeURIComponent(e)}`)}),n.join("&")}class tJ{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw te(eB);e.includes("#")||(this._urlString=tJ.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return tt.endsWith(t,"?")?t=t.slice(0,-1):tt.endsWith(t,"?/")&&(t=t.slice(0,-2)),tt.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch(e){throw te(ej)}if(!e.HostNameAndPort||!e.PathSegments)throw te(ej);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw te(eH)}static appendQueryString(e,t){return t?0>e.indexOf("?")?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return tJ.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){let t=this.getUrlComponents(),r=t.PathSegments;return e&&0!==r.length&&(r[0]===L.COMMON||r[0]===L.ORGANIZATIONS)&&(r[0]=e),tJ.constructAuthorityUriFromObject(t)}getUrlComponents(){let e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw te(ej);let r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},n=r.AbsolutePath.split("/");return n=n.filter(e=>e&&e.length>0),r.PathSegments=n,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){let t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw te(ej);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===D.FORWARD_SLASH){let r=new tJ(t).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new tJ(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!tW(e)}}let tZ={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},tX=tZ.endpointMetadata,t0=tZ.instanceDiscoveryMetadata,t1=new Set;function t2(e,t,r,n){if(n?.trace(`getAliasesFromMetadata called with source: ${r}`),e&&t){let i=t3(t,e);if(i)return n?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${r}, returning aliases`),i.aliases;n?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${r}`)}return null}function t3(e,t){for(let r=0;r<e.length;r++){let n=e[r];if(n.aliases.includes(t))return n}return null}t0.metadata.forEach(e=>{e.aliases.forEach(e=>{t1.add(e)})});let t6={AAD:"AAD",OIDC:"OIDC"},t5={None:"none"},t4={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",HandleResponseEar:"handleResponseEar",HandleResponsePlatformBroker:"handleResponsePlatformBroker",HandleResponseCode:"handleResponseCode",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt",GenerateEarKey:"generateEarKey",DecryptEarResponse:"decryptEarResponse"};t4.AcquireTokenByCode,t4.AcquireTokenByRefreshToken,t4.AcquireTokenSilent,t4.AcquireTokenSilentAsync,t4.AcquireTokenPopup,t4.AcquireTokenRedirect,t4.CryptoOptsGetPublicKeyThumbprint,t4.CryptoOptsSignJwt,t4.SilentCacheClientAcquireToken,t4.SilentIframeClientAcquireToken,t4.SilentRefreshClientAcquireToken,t4.SsoSilent,t4.StandardInteractionClientGetDiscoveredAuthority,t4.FetchAccountIdWithNativeBroker,t4.NativeInteractionClientAcquireToken,t4.BaseClientCreateTokenRequestHeaders,t4.NetworkClientSendPostRequestAsync,t4.RefreshTokenClientExecutePostToTokenEndpoint,t4.AuthorizationCodeClientExecutePostToTokenEndpoint,t4.BrokerHandhshake,t4.AcquireTokenByRefreshTokenInBroker,t4.AcquireTokenByBroker,t4.RefreshTokenClientExecuteTokenRequest,t4.RefreshTokenClientAcquireToken,t4.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t4.RefreshTokenClientAcquireTokenByRefreshToken,t4.RefreshTokenClientCreateTokenRequestBody,t4.AcquireTokenFromCache,t4.SilentFlowClientAcquireCachedToken,t4.SilentFlowClientGenerateResultFromCacheRecord,t4.AcquireTokenBySilentIframe,t4.InitializeBaseRequest,t4.InitializeSilentRequest,t4.InitializeClientApplication,t4.InitializeCache,t4.ImportExistingCache,t4.SetUserData,t4.LocalStorageUpdated,t4.SilentIframeClientTokenHelper,t4.SilentHandlerInitiateAuthRequest,t4.SilentHandlerMonitorIframeForHash,t4.SilentHandlerLoadFrame,t4.SilentHandlerLoadFrameSync,t4.StandardInteractionClientCreateAuthCodeClient,t4.StandardInteractionClientGetClientConfiguration,t4.StandardInteractionClientInitializeAuthorizationRequest,t4.GetAuthCodeUrl,t4.HandleCodeResponseFromServer,t4.HandleCodeResponse,t4.HandleResponseEar,t4.HandleResponseCode,t4.HandleResponsePlatformBroker,t4.UpdateTokenEndpointAuthority,t4.AuthClientAcquireToken,t4.AuthClientExecuteTokenRequest,t4.AuthClientCreateTokenRequestBody,t4.PopTokenGenerateCnf,t4.PopTokenGenerateKid,t4.HandleServerTokenResponse,t4.DeserializeResponse,t4.AuthorityFactoryCreateDiscoveredInstance,t4.AuthorityResolveEndpointsAsync,t4.AuthorityResolveEndpointsFromLocalSources,t4.AuthorityGetCloudDiscoveryMetadataFromNetwork,t4.AuthorityUpdateCloudDiscoveryMetadata,t4.AuthorityGetEndpointMetadataFromNetwork,t4.AuthorityUpdateEndpointMetadata,t4.AuthorityUpdateMetadataWithRegionalInformation,t4.RegionDiscoveryDetectRegion,t4.RegionDiscoveryGetRegionFromIMDS,t4.RegionDiscoveryGetCurrentVersion,t4.AcquireTokenByCodeAsync,t4.GetEndpointMetadataFromNetwork,t4.GetCloudDiscoveryMetadataFromNetworkMeasurement,t4.HandleRedirectPromiseMeasurement,t4.HandleNativeRedirectPromiseMeasurement,t4.UpdateCloudDiscoveryMetadataMeasurement,t4.UsernamePasswordClientAcquireToken,t4.NativeMessageHandlerHandshake,t4.NativeGenerateAuthResult,t4.RemoveHiddenIframe,t4.ClearTokensAndKeysWithClaims,t4.CacheManagerGetRefreshToken,t4.GeneratePkceCodes,t4.GenerateCodeVerifier,t4.GenerateCodeChallengeFromVerifier,t4.Sha256Digest,t4.GetRandomValues,t4.GenerateHKDF,t4.GenerateBaseKey,t4.Base64Decode,t4.UrlEncodeArr,t4.Encrypt,t4.Decrypt,t4.GenerateEarKey,t4.DecryptEarResponse;let t8={InProgress:1},t9=(e,t,r,n,i)=>(...o)=>{r.trace(`Executing function ${t}`);let s=n?.startMeasurement(t,i);i&&n?.incrementFields({[t+"CallCount"]:1},i);try{let n=e(...o);return s?.end({success:!0}),r.trace(`Returning result from ${t}`),n}catch(e){r.trace(`Error occurred in ${t}`);try{r.trace(JSON.stringify(e))}catch(e){r.trace("Unable to print error message.")}throw s?.end({success:!1},e),e}},t7=(e,t,r,n,i)=>(...o)=>{r.trace(`Executing function ${t}`);let s=n?.startMeasurement(t,i);return i&&n?.incrementFields({[t+"CallCount"]:1},i),n?.setPreQueueTime(t,i),e(...o).then(e=>(r.trace(`Returning result from ${t}`),s?.end({success:!0}),e)).catch(e=>{r.trace(`Error occurred in ${t}`);try{r.trace(JSON.stringify(e))}catch(e){r.trace("Unable to print error message.")}throw s?.end({success:!1},e),e})};class re{constructor(e,t,r,n){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=n}async detectRegion(e,t){this.performanceClient?.addQueueMeasurement(t4.RegionDiscoveryDetectRegion,this.correlationId);let r=e;if(r)t.region_source=en.ENVIRONMENT_VARIABLE;else{let e=re.IMDS_OPTIONS;try{let n=await t7(this.getRegionFromIMDS.bind(this),t4.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(D.IMDS_VERSION,e);if(n.status===U.SUCCESS&&(r=n.body,t.region_source=en.IMDS),n.status===U.BAD_REQUEST){let n=await t7(this.getCurrentVersion.bind(this),t4.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(e);if(!n)return t.region_source=en.FAILED_AUTO_DETECTION,null;let i=await t7(this.getRegionFromIMDS.bind(this),t4.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(n,e);i.status===U.SUCCESS&&(r=i.body,t.region_source=en.IMDS)}}catch(e){return t.region_source=en.FAILED_AUTO_DETECTION,null}}return r||(t.region_source=en.FAILED_AUTO_DETECTION),r||null}async getRegionFromIMDS(e,t){return this.performanceClient?.addQueueMeasurement(t4.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${D.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,D.IMDS_TIMEOUT)}async getCurrentVersion(e){this.performanceClient?.addQueueMeasurement(t4.RegionDiscoveryGetCurrentVersion,this.correlationId);try{let t=await this.networkInterface.sendGetRequestAsync(`${D.IMDS_ENDPOINT}?format=json`,e);if(t.status===U.BAD_REQUEST&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0)return t.body["newest-versions"][0];return null}catch(e){return null}}}function rt(e,t){let r=function(e){if(!e)throw tY(to);let t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw tY(ti);return t[2]}(e);try{let e=t(r);return JSON.parse(e)}catch(e){throw tY(ti)}}function rr(e,t){if(0===t||Date.now()-3e5>e+t)throw tY(tg)}function rn(){return Math.round(new Date().getTime()/1e3)}function ri(e){return e?new Date(1e3*Number(e)):new Date}function ro(e,t){let r=Number(e)||0;return rn()+t>r}function rs(e){return e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")}function ra(e){return!!e&&rs(e)&&e.hasOwnProperty("realm")&&e.hasOwnProperty("target")&&(e.credentialType===Y.ACCESS_TOKEN||e.credentialType===Y.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function rc(e){return!!e&&rs(e)&&e.hasOwnProperty("realm")&&e.credentialType===Y.ID_TOKEN}function rl(e){return!!e&&rs(e)&&e.credentialType===Y.REFRESH_TOKEN}function ru(e,t){return!!t&&0===e.indexOf(W)&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("environment")}function rd(){return rn()+Q.REFRESH_TIME_SECONDS}function rh(e,t,r){e.authorization_endpoint=t.authorization_endpoint,e.token_endpoint=t.token_endpoint,e.end_session_endpoint=t.end_session_endpoint,e.issuer=t.issuer,e.endpointsFromNetwork=r,e.jwks_uri=t.jwks_uri}function rp(e,t,r){e.aliases=t.aliases,e.preferred_cache=t.preferred_cache,e.preferred_network=t.preferred_network,e.aliasesFromNetwork=r}function rf(e){return e.expiresAt<=rn()}re.IMDS_OPTIONS={headers:{Metadata:"true"}};class rg{constructor(e,t,r,n,i,o,s,a){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=n,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=i,this.performanceClient=s,this.correlationId=o,this.managedIdentity=a||!1,this.regionDiscovery=new re(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(D.CIAM_AUTH_URL))return eq.Ciam;let t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case D.ADFS:return eq.Adfs;case D.DSTS:return eq.Dsts}return eq.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new tJ(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw tY(ts)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw tY(ts)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw tY(ts)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw tY(tL);return this.replacePath(this.metadata.end_session_endpoint)}throw tY(ts)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw tY(ts)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw tY(ts)}canReplaceTenant(e){return 1===e.PathSegments.length&&!rg.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===eq.Default&&this.protocolMode!==t6.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e,r=new tJ(this.metadata.canonical_authority).getUrlComponents(),n=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((e,i)=>{let o=n[i];if(0===i&&this.canReplaceTenant(r)){let e=new tJ(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];o!==e&&(this.logger.verbose(`Replacing tenant domain name ${o} with id ${e}`),o=e)}e!==o&&(t=t.replace(`/${o}/`,`/${e}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){let e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===eq.Adfs||this.protocolMode===t6.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){this.performanceClient?.addQueueMeasurement(t4.AuthorityResolveEndpointsAsync,this.correlationId);let e=this.getCurrentMetadataEntity(),t=await t7(this.updateCloudDiscoveryMetadata.bind(this),t4.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);let r=await t7(this.updateEndpointMetadata.bind(this),t4.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:rd(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==J.CACHE&&r?.source!==J.CACHE&&(e.expiresAt=rd(),e.canonical_authority=this.canonicalAuthority);let n=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(n,e),this.metadata=e}async updateEndpointMetadata(e){this.performanceClient?.addQueueMeasurement(t4.AuthorityUpdateEndpointMetadata,this.correlationId);let t=this.updateEndpointMetadataFromLocalSources(e);if(t)return t.source===J.HARDCODED_VALUES&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata&&(rh(e,await t7(this.updateMetadataWithRegionalInformation.bind(this),t4.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata),!1),e.canonical_authority=this.canonicalAuthority),t.source;let r=await t7(this.getEndpointMetadataFromNetwork.bind(this),t4.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(r=await t7(this.updateMetadataWithRegionalInformation.bind(this),t4.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(r)),rh(e,r,!0),J.NETWORK;throw tY(tc,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");let t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),rh(e,t,!1),{source:J.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{let t=this.getEndpointMetadataFromHardcodedValues();if(t)return rh(e,t,!1),{source:J.HARDCODED_VALUES,metadata:t};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}let r=rf(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("Found endpoint metadata in the cache."),{source:J.CACHE}):(r&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new tJ(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw te(eJ)}return null}async getEndpointMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(t4.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);let e=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${e}`);try{var t;let r=await this.networkInterface.sendGetRequestAsync(e,{});if((t=r.body).hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("jwks_uri"))return r.body;return this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null}catch(e){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${e}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in tX?tX[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){this.performanceClient?.addQueueMeasurement(t4.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);let t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==D.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=ei.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,rg.replaceWithRegionalInformation(e,t);let r=await t7(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),t4.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(r)return this.regionDiscoveryMetadata.region_outcome=ei.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=r,rg.replaceWithRegionalInformation(e,r);this.regionDiscoveryMetadata.region_outcome=ei.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){this.performanceClient?.addQueueMeasurement(t4.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);let t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;let r=await t7(this.getCloudDiscoveryMetadataFromNetwork.bind(this),t4.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return rp(e,r,!0),J.NETWORK;throw te(eZ)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||D.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||D.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||D.NOT_APPLICABLE}`);let t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),rp(e,t,!1),J.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{var r;let t=(r=this.hostnameAndPort,t3(t0.metadata,r));if(t)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),rp(e,t,!1),J.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}let n=rf(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),J.CACHE):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===eq.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),rg.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");let e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=t3(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch(e){throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),te(eQ)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),rg.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(t4.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);let e=`${D.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t=null;try{var r,n;let i,o;let s=await this.networkInterface.sendGetRequestAsync(e,{});if((r=s.body).hasOwnProperty("tenant_discovery_endpoint")&&r.hasOwnProperty("metadata"))o=(i=s.body).metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${i.tenant_discovery_endpoint}`);else{if(!((n=s.body).hasOwnProperty("error")&&n.hasOwnProperty("error_description")))return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${s.status}`),(i=s.body).error===D.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${i.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${i.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),o=[]}this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),t=t3(o,this.hostnameAndPort)}catch(e){return e instanceof ew?this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${e.errorCode}
Error Description: ${e.errorMessage}`):this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${e.name}
Error Description: ${e.message}`),null}return t||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),t=rg.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),t}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(e=>e&&tJ.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==t5.None){let e=t.tenant?t.tenant:D.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${e}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return D.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw tY(ts)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return t1.has(e)}static isPublicCloudAuthority(e){return D.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){let n=new tJ(e);n.validateAsUri();let i=n.getUrlComponents(),o=`${t}.${i.HostNameAndPort}`;this.isPublicCloudAuthority(i.HostNameAndPort)&&(o=`${t}.${D.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);let s=tJ.constructAuthorityUriFromObject({...n.getUrlComponents(),HostNameAndPort:o}).urlString;return r?`${s}?${r}`:s}static replaceWithRegionalInformation(e,t){let r={...e};return r.authorization_endpoint=rg.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=rg.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=rg.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e,r=new tJ(e).getUrlComponents();if(0===r.PathSegments.length&&r.HostNameAndPort.endsWith(D.CIAM_AUTH_URL)){let e=r.HostNameAndPort.split(".")[0];t=`${t}${e}${D.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}function rm(e){return e.endsWith(D.FORWARD_SLASH)?e:`${e}${D.FORWARD_SLASH}`}rg.reservedTenantDomains=new Set(["{tenant}","{tenantid}",L.COMMON,L.CONSUMERS,L.ORGANIZATIONS]);let ry={createNewGuid:()=>{throw tY(tz)},base64Decode:()=>{throw tY(tz)},base64Encode:()=>{throw tY(tz)},base64UrlEncode:()=>{throw tY(tz)},encodeKid:()=>{throw tY(tz)},async getPublicKeyThumbprint(){throw tY(tz)},async removeTokenBindingKey(){throw tY(tz)},async clearKeystore(){throw tY(tz)},async signJwt(){throw tY(tz)},async hashString(){throw tY(tz)}},rT="@azure/msal-common",rE="15.13.1";class rC{constructor(e){let t=e?tt.trimArrayEntries([...e]):[],r=t?tt.removeEmptyStringsFromArray(t):[];if(!r||!r.length)throw te(ez);this.scopes=new Set,r.forEach(e=>this.scopes.add(e))}static fromString(e){return new rC((e||D.EMPTY_STRING).split(" "))}static createSearchScopes(e){let t=new rC(e&&e.length>0?e:[...x]);return t.containsOnlyOIDCScopes()?t.removeScope(D.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}containsScope(e){let t=new rC(this.printScopesLowerCase().split(" "));return!!e&&t.scopes.has(e.toLowerCase())}containsScopeSet(e){return!!e&&!(e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(e=>this.containsScope(e))}containsOnlyOIDCScopes(){let e=0;return $.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(e=>this.appendScope(e))}catch(e){throw tY(tA)}}removeScope(e){if(!e)throw tY(tC);this.scopes.delete(e.trim())}removeOIDCScopes(){$.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw tY(tI);let t=new Set;return e.scopes.forEach(e=>t.add(e.toLowerCase())),this.scopes.forEach(e=>t.add(e.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw tY(tI);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();let t=this.unionScopeSets(e),r=e.getScopeCount(),n=this.getScopeCount();return t.size<n+r}getScopeCount(){return this.scopes.size}asArray(){let e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):D.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}function rA(e,t){if(!e)throw tY(tn);try{let r=t(e);return JSON.parse(r)}catch(e){throw tY(tr)}}function rI(e){if(!e)throw tY(tr);let t=e.split(K.CLIENT_INFO_SEPARATOR,2);return{uid:t[0],utid:t.length<2?D.EMPTY_STRING:t[1]}}function rv(e,t){return!!e&&!!t&&e===t.split(".")[1]}function rS(e,t,r,n){if(!n)return{tenantId:r,localAccountId:t,username:"",isHomeTenant:rv(r,e)};{let{oid:t,sub:r,tid:i,name:o,tfp:s,acr:a,preferred_username:c,upn:l,login_hint:u}=n,d=i||s||a||"";return{tenantId:d,localAccountId:t||r||"",name:o,username:c||l||"",loginHint:u,isHomeTenant:rv(d,e)}}}function rw(e,t,r,n){let i=e;if(t){let{isHomeTenant:r,...n}=t;i={...e,...n}}if(r){let{isHomeTenant:t,...o}=rS(e.homeAccountId,e.localAccountId,e.tenantId,r);i={...i,...o,idTokenClaims:r,idToken:n}}return i}function rb(e){return e&&(e.tid||e.tfp||e.acr)||null}class rR{static getAccountInfo(e){return{homeAccountId:e.homeAccountId,environment:e.environment,tenantId:e.realm,username:e.username,localAccountId:e.localAccountId,loginHint:e.loginHint,name:e.name,nativeAccountId:e.nativeAccountId,authorityType:e.authorityType,tenantProfiles:new Map((e.tenantProfiles||[]).map(e=>[e.tenantId,e])),dataBoundary:e.dataBoundary}}isSingleTenant(){return!this.tenantProfiles}static createAccount(e,t,r){let n;let i=new rR;t.authorityType===eq.Adfs?i.authorityType=V.ADFS_ACCOUNT_TYPE:t.protocolMode===t6.OIDC?i.authorityType=V.GENERIC_ACCOUNT_TYPE:i.authorityType=V.MSSTS_ACCOUNT_TYPE,e.clientInfo&&r&&(n=rA(e.clientInfo,r)).xms_tdbr&&(i.dataBoundary="EU"===n.xms_tdbr?"EU":"None"),i.clientInfo=e.clientInfo,i.homeAccountId=e.homeAccountId,i.nativeAccountId=e.nativeAccountId;let o=e.environment||t&&t.getPreferredCache();if(!o)throw tY(t_);i.environment=o,i.realm=n?.utid||rb(e.idTokenClaims)||"",i.localAccountId=n?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"";let s=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn,a=e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null;if(i.username=s||a||"",i.loginHint=e.idTokenClaims?.login_hint,i.name=e.idTokenClaims?.name||"",i.cloudGraphHostName=e.cloudGraphHostName,i.msGraphHost=e.msGraphHost,e.tenantProfiles)i.tenantProfiles=e.tenantProfiles;else{let t=rS(e.homeAccountId,i.localAccountId,i.realm,e.idTokenClaims);i.tenantProfiles=[t]}return i}static createFromAccountInfo(e,t,r){let n=new rR;return n.authorityType=e.authorityType||V.GENERIC_ACCOUNT_TYPE,n.homeAccountId=e.homeAccountId,n.localAccountId=e.localAccountId,n.nativeAccountId=e.nativeAccountId,n.realm=e.tenantId,n.environment=e.environment,n.username=e.username,n.name=e.name,n.loginHint=e.loginHint,n.cloudGraphHostName=t,n.msGraphHost=r,n.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),n.dataBoundary=e.dataBoundary,n}static generateHomeAccountId(e,t,r,n,i){if(!(t===eq.Adfs||t===eq.Dsts)){if(e)try{let t=rA(e,n.base64Decode);if(t.uid&&t.utid)return`${t.uid}.${t.utid}`}catch(e){}r.warning("No client info in response")}return i?.sub||""}static isAccountEntity(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;let n=!0;if(r){let r=e.idTokenClaims||{},i=t.idTokenClaims||{};n=r.iat===i.iat&&r.nonce===i.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.loginHint===t.loginHint&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&n}}let r_="cache_quota_exceeded",rk="cache_error_unknown",rO={[r_]:"Exceeded cache storage capacity.",[rk]:"Unexpected error occurred when using cache storage."};class rP extends ew{constructor(e,t){let r=t||(rO[e]?rO[e]:rO[rk]);super(`${e}: ${r}`),Object.setPrototypeOf(this,rP.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}class rN{constructor(e,t,r,n,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(rT,rE),this.staticAuthorityOptions=i,this.performanceClient=n}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){if(0===Object.keys(e).length||Object.values(e).every(e=>!e))return this.commonLogger.warning("getAccountInfoFilteredBy: Account filter is empty or invalid, returning null"),null;let r=this.getAllAccounts(e,t);return r.length>1?r.sort(e=>e.idTokenClaims?-1:1)[0]:1===r.length?r[0]:null}getBaseAccountInfo(e,t){let r=this.getAccountsFilteredBy(e,t);return r.length>0?rR.getAccountInfo(r[0]):null}buildTenantProfiles(e,t,r){return e.flatMap(e=>this.getTenantProfilesFromAccountEntity(e,t,r?.tenantId,r))}getTenantedAccountInfoByFilter(e,t,r,n,i){let o;if(i&&!this.tenantProfileMatchesFilter(r,i))return null;let s=this.getIdToken(e,n,t,r.tenantId);return s&&(o=rt(s.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(o,i))?null:rw(e,r,o,s?.secret)}getTenantProfilesFromAccountEntity(e,t,r,n){let i=rR.getAccountInfo(e),o=i.tenantProfiles||new Map,s=this.getTokenKeys();if(r){let e=o.get(r);if(!e)return[];o=new Map([[r,e]])}let a=[];return o.forEach(e=>{let r=this.getTenantedAccountInfoByFilter(i,s,e,t,n);r&&a.push(r)}),a}tenantProfileMatchesFilter(e,t){return(!t.localAccountId||!!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId))&&(!t.name||e.name===t.name)&&(void 0===t.isHomeTenant||e.isHomeTenant===t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!t||(!t.localAccountId||!!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId))&&(!t.loginHint||!!this.matchLoginHintFromTokenClaims(e,t.loginHint))&&(!t.username||!!this.matchUsername(e.preferred_username,t.username))&&(!t.name||!!this.matchName(e,t.name))&&(!t.sid||!!this.matchSid(e,t.sid))}async saveCacheRecord(e,t,r,n){if(!e)throw tY(tR);try{e.account&&await this.setAccount(e.account,t,r),e.idToken&&n?.idToken!==!1&&await this.setIdTokenCredential(e.idToken,t,r),e.accessToken&&n?.accessToken!==!1&&await this.saveAccessToken(e.accessToken,t,r),e.refreshToken&&n?.refreshToken!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t,r),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(e){if(this.commonLogger?.error("CacheManager.saveCacheRecord: failed"),e instanceof ew)throw e;throw e instanceof Error?"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||e.message.includes("exceeded the quota")?new rP(r_):new rP(e.name,e.message):new rP(rk)}}async saveAccessToken(e,t,r){let n={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},i=this.getTokenKeys(),o=rC.fromString(e.target);i.accessToken.forEach(e=>{if(!this.accessTokenKeyMatchesFilter(e,n,!1))return;let r=this.getAccessTokenCredential(e,t);r&&this.credentialMatchesFilter(r,n)&&rC.fromString(r.target).intersectingScopeSets(o)&&this.removeAccessToken(e,t)}),await this.setAccessTokenCredential(e,t,r)}getAccountsFilteredBy(e,t){let r=this.getAccountKeys(),n=[];return r.forEach(r=>{let i=this.getAccount(r,t);if(!i||e.homeAccountId&&!this.matchHomeAccountId(i,e.homeAccountId)||e.username&&!this.matchUsername(i.username,e.username)||e.environment&&!this.matchEnvironment(i,e.environment)||e.realm&&!this.matchRealm(i,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(i,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(i,e.authorityType))return;let o={localAccountId:e?.localAccountId,name:e?.name},s=i.tenantProfiles?.filter(e=>this.tenantProfileMatchesFilter(e,o));s&&0===s.length||n.push(i)}),n}credentialMatchesFilter(e,t){return(!t.clientId||!!this.matchClientId(e,t.clientId))&&(!t.userAssertionHash||!!this.matchUserAssertionHash(e,t.userAssertionHash))&&("string"!=typeof t.homeAccountId||!!this.matchHomeAccountId(e,t.homeAccountId))&&(!t.environment||!!this.matchEnvironment(e,t.environment))&&(!t.realm||!!this.matchRealm(e,t.realm))&&(!t.credentialType||!!this.matchCredentialType(e,t.credentialType))&&(!t.familyId||!!this.matchFamilyId(e,t.familyId))&&(!t.target||!!this.matchTarget(e,t.target))&&(!t.requestedClaimsHash&&!e.requestedClaimsHash||e.requestedClaimsHash===t.requestedClaimsHash)&&(e.credentialType!==Y.ACCESS_TOKEN_WITH_AUTH_SCHEME||(!t.tokenType||!!this.matchTokenType(e,t.tokenType))&&(t.tokenType!==X.SSH||!t.keyId||!!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){let t=this.getKeys(),r={};return t.forEach(t=>{if(!this.isAppMetadata(t))return;let n=this.getAppMetadata(t);n&&(!e.environment||this.matchEnvironment(n,e.environment))&&(!e.clientId||this.matchClientId(n,e.clientId))&&(r[t]=n)}),r}getAuthorityMetadataByAlias(e){let t=this.getAuthorityMetadataKeys(),r=null;return t.forEach(t=>{if(!this.isAuthorityMetadata(t)||-1===t.indexOf(this.clientId))return;let n=this.getAuthorityMetadata(t);n&&-1!==n.aliases.indexOf(e)&&(r=n)}),r}removeAllAccounts(e){this.getAllAccounts({},e).forEach(t=>{this.removeAccount(t,e)})}removeAccount(e,t){this.removeAccountContext(e,t),this.getAccountKeys().filter(t=>t.includes(e.homeAccountId)&&t.includes(e.environment)).forEach(e=>{this.removeItem(e,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){let r=this.getTokenKeys(),n=t=>t.includes(e.homeAccountId)&&t.includes(e.environment);r.idToken.filter(n).forEach(e=>{this.removeIdToken(e,t)}),r.accessToken.filter(n).forEach(e=>{this.removeAccessToken(e,t)}),r.refreshToken.filter(n).forEach(e=>{this.removeRefreshToken(e,t)})}removeAccessToken(e,t){let r=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),!r||r.credentialType.toLowerCase()!==Y.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()||r.tokenType!==X.POP)return;let n=r.keyId;n&&this.cryptoImpl.removeTokenBindingKey(n).catch(()=>{this.commonLogger.error(`Failed to remove token binding key ${n}`,t),this.performanceClient?.incrementFields({removeTokenBindingKeyFailure:1},t)})}removeAppMetadata(e){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t,e)}),!0}getIdToken(e,t,r,n,i){this.commonLogger.trace("CacheManager - getIdToken called");let o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Y.ID_TOKEN,clientId:this.clientId,realm:n},s=this.getIdTokensByFilter(o,t,r),a=s.size;if(a<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(a>1){let r=s;if(!n){let t=new Map;s.forEach((r,n)=>{r.realm===e.tenantId&&t.set(n,r)});let n=t.size;if(n<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),s.values().next().value;if(1===n)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),t.values().next().value;r=t}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),r.forEach((e,r)=>{this.removeIdToken(r,t)}),i&&t&&i.addFields({multiMatchedID:s.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),s.values().next().value}getIdTokensByFilter(e,t,r){let n=r&&r.idToken||this.getTokenKeys().idToken,i=new Map;return n.forEach(r=>{if(!this.idTokenKeyMatchesFilter(r,{clientId:this.clientId,...e}))return;let n=this.getIdTokenCredential(r,t);n&&this.credentialMatchesFilter(n,e)&&i.set(r,n)}),i}idTokenKeyMatchesFilter(e,t){let r=e.toLowerCase();return(!t.clientId||-1!==r.indexOf(t.clientId.toLowerCase()))&&(!t.homeAccountId||-1!==r.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,r,n){let i=t.correlationId;this.commonLogger.trace("CacheManager - getAccessToken called",i);let o=rC.createSearchScopes(t.scopes),s=t.authenticationScheme||X.BEARER,a=s&&s.toLowerCase()!==X.BEARER.toLowerCase()?Y.ACCESS_TOKEN_WITH_AUTH_SCHEME:Y.ACCESS_TOKEN,c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:a,clientId:this.clientId,realm:n||e.tenantId,target:o,tokenType:s,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},l=r&&r.accessToken||this.getTokenKeys().accessToken,u=[];l.forEach(e=>{if(this.accessTokenKeyMatchesFilter(e,c,!0)){let t=this.getAccessTokenCredential(e,i);t&&this.credentialMatchesFilter(t,c)&&u.push(t)}});let d=u.length;return d<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found",i),null):d>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them",i),u.forEach(e=>{this.removeAccessToken(this.generateCredentialKey(e),i)}),this.performanceClient.addFields({multiMatchedAT:u.length},i),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token",i),u[0])}accessTokenKeyMatchesFilter(e,t,r){let n=e.toLowerCase();if(t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase())||t.realm&&-1===n.indexOf(t.realm.toLowerCase())||t.requestedClaimsHash&&-1===n.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target){let e=t.target.asArray();for(let t=0;t<e.length;t++){if(r&&!n.includes(e[t].toLowerCase()))return!1;if(!r&&n.includes(e[t].toLowerCase()))break}}return!0}getAccessTokensByFilter(e,t){let r=this.getTokenKeys(),n=[];return r.accessToken.forEach(r=>{if(!this.accessTokenKeyMatchesFilter(r,e,!0))return;let i=this.getAccessTokenCredential(r,t);i&&this.credentialMatchesFilter(i,e)&&n.push(i)}),n}getRefreshToken(e,t,r,n,i){this.commonLogger.trace("CacheManager - getRefreshToken called");let o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Y.REFRESH_TOKEN,clientId:this.clientId,familyId:t?"1":void 0},s=n&&n.refreshToken||this.getTokenKeys().refreshToken,a=[];s.forEach(e=>{if(this.refreshTokenKeyMatchesFilter(e,o)){let t=this.getRefreshTokenCredential(e,r);t&&this.credentialMatchesFilter(t,o)&&a.push(t)}});let c=a.length;return c<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(c>1&&i&&r&&i.addFields({multiMatchedRT:c},r),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),a[0])}refreshTokenKeyMatchesFilter(e,t){let r=e.toLowerCase();return(!t.familyId||-1!==r.indexOf(t.familyId.toLowerCase()))&&(!!t.familyId||!t.clientId||-1!==r.indexOf(t.clientId.toLowerCase()))&&(!t.homeAccountId||-1!==r.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e){let t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),n=Object.keys(r).map(e=>r[e]),i=n.length;if(i<1)return null;if(i>1)throw tY(tT);return n[0]}isAppMetadataFOCI(e){let t=this.readAppMetadataFromCache(e);return!!(t&&"1"===t.familyId)}matchHomeAccountId(e,t){return!!("string"==typeof e.homeAccountId&&t===e.homeAccountId)}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return!(t.toLowerCase()!==e.name?.toLowerCase())}matchUsername(e,t){return!!(e&&"string"==typeof e&&t?.toLowerCase()===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){let r=function(e,t){let r;let n=e.canonicalAuthority;if(n){let i=new tJ(n).getUrlComponents().HostNameAndPort;r=t2(i,e.cloudDiscoveryMetadata?.metadata,J.CONFIG,t)||t2(i,t0.metadata,J.HARDCODED_VALUES,t)||e.knownAuthorities}return r||[]}(this.staticAuthorityOptions,this.commonLogger);if(r.includes(t)&&r.includes(e.environment))return!0}let r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){return!(e.realm?.toLowerCase()!==t.toLowerCase())}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return(e.credentialType===Y.ACCESS_TOKEN||e.credentialType===Y.ACCESS_TOKEN_WITH_AUTH_SCHEME)&&!!e.target&&rC.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return -1!==e.indexOf(W)}isAuthorityMetadata(e){return -1!==e.indexOf(Q.CACHE_KEY)}generateAuthorityMetadataCacheKey(e){return`${Q.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(let r in t)e[r]=t[r];return e}}class rM extends rN{async setAccount(){throw tY(tz)}getAccount(){throw tY(tz)}async setIdTokenCredential(){throw tY(tz)}getIdTokenCredential(){throw tY(tz)}async setAccessTokenCredential(){throw tY(tz)}getAccessTokenCredential(){throw tY(tz)}async setRefreshTokenCredential(){throw tY(tz)}getRefreshTokenCredential(){throw tY(tz)}setAppMetadata(){throw tY(tz)}getAppMetadata(){throw tY(tz)}setServerTelemetry(){throw tY(tz)}getServerTelemetry(){throw tY(tz)}setAuthorityMetadata(){throw tY(tz)}getAuthorityMetadata(){throw tY(tz)}getAuthorityMetadataKeys(){throw tY(tz)}setThrottlingCache(){throw tY(tz)}getThrottlingCache(){throw tY(tz)}removeItem(){throw tY(tz)}getKeys(){throw tY(tz)}getAccountKeys(){throw tY(tz)}getTokenKeys(){throw tY(tz)}generateCredentialKey(){throw tY(tz)}generateAccountKey(){throw tY(tz)}}class rD{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class rU{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:t8.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new rD}}startPerformanceMeasurement(){return new rD}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}let rx={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},r$={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:I.Info,correlationId:D.EMPTY_STRING},rq={claimsBasedCachingEnabled:!1},rL={async sendGetRequestAsync(){throw tY(tz)},async sendPostRequestAsync(){throw tY(tz)}},rF={sku:D.SKU,version:rE,cpu:D.EMPTY_STRING,os:D.EMPTY_STRING},rH={clientSecret:D.EMPTY_STRING,clientAssertion:void 0},rj={azureCloudInstance:t5.None,tenant:`${D.DEFAULT_COMMON_TENANT}`},rB={application:{appName:"",appVersion:""}};function rz(e){return e.authOptions.authority.options.protocolMode===t6.OIDC}let rG={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};function rV(e,t,r){if(!t)return;let n=e.get(eR);n&&e.has(eM)&&r?.addFields({embeddedClientId:n,embeddedRedirectUri:e.get(e_)},t)}function rK(e,t){e.set("response_type",t)}function rY(e,t,r=!0,n=x){!r||n.includes("openid")||t.includes("openid")||n.push("openid");let i=new rC(r?[...t||[],...n]:t||[]);e.set("scope",i.printScopes())}function rW(e,t){e.set(eR,t)}function rQ(e,t){e.set("login_hint",t)}function rJ(e,t){e.set(q.CCS_HEADER,`UPN:${t}`)}function rZ(e,t){e.set(q.CCS_HEADER,`Oid:${t.uid}@${t.utid}`)}function rX(e,t){e.set("sid",t)}function r0(e,t,r){let n=function(e,t){let r;if(e)try{r=JSON.parse(e)}catch(e){throw te(eG)}else r={};return t&&t.length>0&&(r.hasOwnProperty(F.ACCESS_TOKEN)||(r[F.ACCESS_TOKEN]={}),r[F.ACCESS_TOKEN][F.XMS_CC]={values:t}),JSON.stringify(r)}(t,r);try{JSON.parse(n)}catch(e){throw te(eG)}e.set("claims",n)}function r1(e,t){e.set("client-request-id",t)}function r2(e,t){e.set("x-client-SKU",t.sku),e.set("x-client-VER",t.version),t.os&&e.set("x-client-OS",t.os),t.cpu&&e.set("x-client-CPU",t.cpu)}function r3(e,t){t?.appName&&e.set("x-app-name",t.appName),t?.appVersion&&e.set("x-app-ver",t.appVersion)}function r6(e,t){t&&e.set("state",t)}function r5(e,t){e.set("client_secret",t)}function r4(e,t){t&&e.set("client_assertion",t)}function r8(e,t){t&&e.set("client_assertion_type",t)}function r9(e,t){e.set("grant_type",t)}function r7(e){e.set("client_info","1")}function ne(e){e.has(eU)||e.set(eU,"true")}function nt(e,t){Object.entries(t).forEach(([t,r])=>{!e.has(t)&&r&&e.set(t,r)})}function nr(e,t){t&&(e.set(ek,X.POP),e.set(eO,t))}function nn(e,t){t&&(e.set(ek,X.SSH),e.set(eO,t))}function ni(e,t){e.set("x-client-current-telemetry",t.generateCurrentRequestHeaderValue()),e.set("x-client-last-telemetry",t.generateLastRequestHeaderValue())}function no(e){e.set("x-ms-lib-capability",ee.X_MS_LIB_CAPABILITY_VALUE)}function ns(e,t,r){e.has(eM)||e.set(eM,t),e.has(eD)||e.set(eD,r)}async function na(e,t,r,n,i,o,s){s?.addQueueMeasurement(t4.AuthorityFactoryCreateDiscoveredInstance,o);let a=rg.transformCIAMAuthority(rm(e)),c=new rg(a,t,r,n,i,o,s);try{return await t7(c.resolveEndpointsAsync.bind(c),t4.AuthorityResolveEndpointsAsync,i,s,o)(),c}catch(e){throw tY(ts)}}function nc(e,t,r){return{clientId:e,authority:t.authority,scopes:t.scopes,homeAccountIdentifier:r,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid,embeddedClientId:t.embeddedClientId||t.tokenBodyParameters?.clientId}}class nl{static generateThrottlingStorageKey(e){return`${ee.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t,r){let n=nl.generateThrottlingStorageKey(t),i=e.getThrottlingCache(n);if(i){if(i.throttleTime<Date.now()){e.removeItem(n,r);return}throw new ex(i.errorCodes?.join(" ")||D.EMPTY_STRING,i.errorMessage,i.subError)}}static postProcess(e,t,r,n){if(nl.checkResponseStatus(r)||nl.checkResponseForRetryAfter(r)){let i={throttleTime:nl.calculateThrottleTime(parseInt(r.headers[q.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(nl.generateThrottlingStorageKey(t),i,n)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(q.RETRY_AFTER)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){let t=Date.now()/1e3;return Math.floor(1e3*Math.min(t+((e<=0?0:e)||ee.DEFAULT_THROTTLE_TIME_SECONDS),t+ee.DEFAULT_MAX_THROTTLE_TIME_SECONDS))}static removeThrottle(e,t,r,n){let i=nc(t,r,n),o=this.generateThrottlingStorageKey(i);e.removeItem(o,r.correlationId)}}class nu extends ew{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,nu.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}class nd{constructor(e,t){this.config=function({authOptions:e,systemOptions:t,loggerOptions:r,cacheOptions:n,storageInterface:i,networkInterface:o,cryptoInterface:s,clientCredentials:a,libraryInfo:c,telemetry:l,serverTelemetryManager:u,persistencePlugin:d,serializableCache:h}){let p={...r$,...r};return{authOptions:{clientCapabilities:[],azureCloudOptions:rj,skipAuthorityMetadataCache:!1,instanceAware:!1,encodeExtraQueryParams:!1,...e},systemOptions:{...rx,...t},loggerOptions:p,cacheOptions:{...rq,...n},storageInterface:i||new rM(e.clientId,ry,new e$(p),new rU),networkInterface:o||rL,cryptoInterface:s||ry,clientCredentials:a||rH,libraryInfo:{...rF,...c},telemetry:{...rB,...l},serverTelemetryManager:u||null,persistencePlugin:d||null,serializableCache:h||null}}(e),this.logger=new e$(this.config.loggerOptions,rT,rE),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){let t={};if(t[q.CONTENT_TYPE]=D.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case rG.HOME_ACCOUNT_ID:try{let r=rI(e.credential);t[q.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case rG.UPN:t[q.CCS_HEADER]=`UPN: ${e.credential}`}return t}async executePostToTokenEndpoint(e,t,r,n,i,o){o&&this.performanceClient?.addQueueMeasurement(o,i);let s=await this.sendPostRequest(n,e,{body:t,headers:r},i);return this.config.serverTelemetryManager&&s.status<500&&429!==s.status&&this.config.serverTelemetryManager.clearTelemetryCache(),s}async sendPostRequest(e,t,r,n){let i;nl.preProcess(this.cacheManager,e,n);try{let e=(i=await t7(this.networkClient.sendPostRequestAsync.bind(this.networkClient),t4.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,n)(t,r)).headers||{};this.performanceClient?.addFields({refreshTokenSize:i.body.refresh_token?.length||0,httpVerToken:e[q.X_MS_HTTP_VERSION]||"",requestId:e[q.X_MS_REQUEST_ID]||""},n)}catch(e){if(e instanceof nu){let t=e.responseHeaders;throw t&&this.performanceClient?.addFields({httpVerToken:t[q.X_MS_HTTP_VERSION]||"",requestId:t[q.X_MS_REQUEST_ID]||"",contentTypeHeader:t[q.CONTENT_TYPE]||void 0,contentLengthHeader:t[q.CONTENT_LENGTH]||void 0,httpStatus:e.httpStatus},n),e.error}if(e instanceof ew)throw e;throw tY(ta)}return nl.postProcess(this.cacheManager,e,i,n),i}async updateAuthority(e,t){this.performanceClient?.addQueueMeasurement(t4.UpdateTokenEndpointAuthority,t);let r=`https://${e}/${this.authority.tenant}/`,n=await na(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=n}createTokenQueryParameters(e){let t=new Map;return e.embeddedClientId&&ns(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenQueryParameters&&nt(t,e.tokenQueryParameters),r1(t,e.correlationId),rV(t,e.correlationId,this.performanceClient),tQ(t)}}let nh="no_tokens_found",np="native_account_unavailable",nf="refresh_token_expired",ng="ux_not_allowed",nm="bad_token",ny=["interaction_required","consent_required","login_required",nm,ng],nT=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],nE={[nh]:"No refresh token found in the cache. Please sign-in.",[np]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[nf]:"Refresh token has expired.",[nm]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve.",[ng]:"`canShowUI` flag in Edge was set to false. User interaction required on web page. Please invoke an interactive API to resolve."};nE[nh],nE[np],nE[nm];class nC extends ew{constructor(e,t,r,n,i,o,s,a){super(e,t,r),Object.setPrototypeOf(this,nC.prototype),this.timestamp=n||D.EMPTY_STRING,this.traceId=i||D.EMPTY_STRING,this.correlationId=o||D.EMPTY_STRING,this.claims=s||D.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=a}}function nA(e){return new nC(e,nE[e])}class nI{static setRequestState(e,t,r){let n=nI.generateLibraryState(e,r);return t?`${n}${D.RESOURCE_DELIM}${t}`:n}static generateLibraryState(e,t){if(!e)throw tY(tO);let r={id:e.createNewGuid()};t&&(r.meta=t);let n=JSON.stringify(r);return e.base64Encode(n)}static parseRequestState(e,t){if(!e)throw tY(tO);if(!t)throw tY(tu);try{let r=t.split(D.RESOURCE_DELIM),n=r[0],i=r.length>1?r.slice(1).join(D.RESOURCE_DELIM):D.EMPTY_STRING,o=e.base64Decode(n),s=JSON.parse(o);return{userRequestState:i||D.EMPTY_STRING,libraryState:s}}catch(e){throw tY(tu)}}}let nv={SW:"sw"};class nS{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){this.performanceClient?.addQueueMeasurement(t4.PopTokenGenerateCnf,e.correlationId);let r=await t7(this.generateKid.bind(this),t4.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),n=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:n}}async generateKid(e){return this.performanceClient?.addQueueMeasurement(t4.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:nv.SW}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,n){let{resourceRequestMethod:i,resourceRequestUri:o,shrClaims:s,shrNonce:a,shrOptions:c}=r,l=o?new tJ(o):void 0,u=l?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:rn(),m:i?.toUpperCase(),u:u?.HostNameAndPort,nonce:a||this.cryptoUtils.createNewGuid(),p:u?.AbsolutePath,q:u?.QueryString?[[],u.QueryString]:void 0,client_claims:s||void 0,...n},t,c,r.correlationId)}}class nw{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}class nb{constructor(e,t,r,n,i,o,s){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=n,this.serializableCache=i,this.persistencePlugin=o,this.performanceClient=s}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){let r=`Error(s): ${e.error_codes||D.NOT_AVAILABLE} - Timestamp: ${e.timestamp||D.NOT_AVAILABLE} - Description: ${e.error_description||D.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||D.NOT_AVAILABLE} - Trace ID: ${e.trace_id||D.NOT_AVAILABLE}`,n=e.error_codes?.length?e.error_codes[0]:void 0,i=new ex(e.error,r,e.suberror,n,e.status);if(t&&e.status&&e.status>=U.SERVER_ERROR_RANGE_START&&e.status<=U.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${i}`);return}if(t&&e.status&&e.status>=U.CLIENT_ERROR_RANGE_START&&e.status<=U.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${i}`);return}if(function(e,t,r){let n=!!e&&ny.indexOf(e)>-1,i=!!r&&nT.indexOf(r)>-1,o=!!t&&ny.some(e=>t.indexOf(e)>-1);return n||o||i}(e.error,e.error_description,e.suberror))throw new nC(e.error,e.error_description,e.suberror,e.timestamp||D.EMPTY_STRING,e.trace_id||D.EMPTY_STRING,e.correlation_id||D.EMPTY_STRING,e.claims||D.EMPTY_STRING,n);throw i}}async handleServerTokenResponse(e,t,r,n,i,o,s,a,c){let l,u,d;if(this.performanceClient?.addQueueMeasurement(t4.HandleServerTokenResponse,e.correlation_id),e.id_token){if(l=rt(e.id_token||D.EMPTY_STRING,this.cryptoObj.base64Decode),i&&i.nonce&&l.nonce!==i.nonce)throw tY(tp);if(n.maxAge||0===n.maxAge){let e=l.auth_time;if(!e)throw tY(tf);rr(e,n.maxAge)}}this.homeAccountIdentifier=rR.generateHomeAccountId(e.client_info||D.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,l),i&&i.state&&(u=nI.parseRequestState(this.cryptoObj,i.state)),e.key_id=e.key_id||n.sshKid||void 0;let h=this.generateCacheRecord(e,t,r,n,l,o,i);try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),d=new nw(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(d)),s&&!a&&h.account){let e=this.cacheStorage.generateAccountKey(rR.getAccountInfo(h.account));if(!this.cacheStorage.getAccount(e,n.correlationId))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await nb.generateAuthenticationResult(this.cryptoObj,t,h,!1,n,l,u,void 0,c)}await this.cacheStorage.saveCacheRecord(h,n.correlationId,function(e){if(!e.signin_state)return!1;let t=["kmsi","dvc_dmjd"];return e.signin_state.some(e=>t.includes(e.trim().toLowerCase()))}(l||{}),n.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&d&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(d))}return nb.generateAuthenticationResult(this.cryptoObj,t,h,!1,n,l,u,e,c)}generateCacheRecord(e,t,r,n,i,o,s){let a,c;let l=t.getPreferredCache();if(!l)throw tY(t_);let u=rb(i);if(e.id_token&&i){var d,h,p,f;d=this.homeAccountIdentifier,h=e.id_token,p=this.clientId,f=u||"",a={credentialType:Y.ID_TOKEN,homeAccountId:d,environment:l,clientId:p,secret:h,realm:f,lastUpdatedAt:Date.now().toString()},c=function(e,t,r,n,i,o,s,a,c,l,u,d){d?.verbose("setCachedAccount called");let h=e.getAccountKeys().find(e=>e.startsWith(r)),p=null;h&&(p=e.getAccount(h,i));let f=p||rR.createAccount({homeAccountId:r,idTokenClaims:o,clientInfo:s,environment:a,cloudGraphHostName:l?.cloud_graph_host_name,msGraphHost:l?.msgraph_host,nativeAccountId:u},t,n),g=f.tenantProfiles||[],m=c||f.realm;if(m&&!g.find(e=>e.tenantId===m)){let e=rS(r,f.localAccountId,m,o);g.push(e)}return f.tenantProfiles=g,f}(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,n.correlationId,i,e.client_info,l,u,s,void 0,this.logger)}let g=null;if(e.access_token){let i=e.scope?rC.fromString(e.scope):new rC(n.scopes||[]),s=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,a=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,c=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,d=r+s;g=function(e,t,r,n,i,o,s,a,c,l,u,d,h,p,f){let g={homeAccountId:e,credentialType:Y.ACCESS_TOKEN,secret:r,cachedAt:rn().toString(),expiresOn:s.toString(),extendedExpiresOn:a.toString(),environment:t,clientId:n,realm:i,target:o,tokenType:u||X.BEARER,lastUpdatedAt:Date.now().toString()};if(d&&(g.userAssertionHash=d),l&&(g.refreshOn=l.toString()),p&&(g.requestedClaims=p,g.requestedClaimsHash=f),g.tokenType?.toLowerCase()!==X.BEARER.toLowerCase())switch(g.credentialType=Y.ACCESS_TOKEN_WITH_AUTH_SCHEME,g.tokenType){case X.POP:let m=rt(r,c);if(!m?.cnf?.kid)throw tY(tx);g.keyId=m.cnf.kid;break;case X.SSH:g.keyId=h}return g}(this.homeAccountIdentifier,l,e.access_token,this.clientId,u||t.tenant||"",i.printScopes(),d,d+a,this.cryptoObj.base64Decode,c&&c>0?r+c:void 0,e.token_type,o,e.key_id,n.claims,n.requestedClaimsHash)}let m=null;if(e.refresh_token){let t;e.refresh_token_expires_in&&(t=r+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)),m=function(e,t,r,n,i,o,s){let a={credentialType:Y.REFRESH_TOKEN,homeAccountId:e,environment:t,clientId:n,secret:r,lastUpdatedAt:Date.now().toString()};return o&&(a.userAssertionHash=o),i&&(a.familyId=i),s&&(a.expiresOn=s.toString()),a}(this.homeAccountIdentifier,l,e.refresh_token,this.clientId,e.foci,o,t)}let y=null;return e.foci&&(y={clientId:this.clientId,environment:l,familyId:e.foci}),{account:c,idToken:a,accessToken:g,refreshToken:m,appMetadata:y}}static async generateAuthenticationResult(e,t,r,n,i,o,s,a,c){let l,u,d=D.EMPTY_STRING,h=[],p=null,f=D.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType!==X.POP||i.popKid)d=r.accessToken.secret;else{let t=new nS(e),{secret:n,keyId:o}=r.accessToken;if(!o)throw tY(tF);d=await t.signPopToken(n,o,i)}h=rC.fromString(r.accessToken.target).asArray(),p=ri(r.accessToken.expiresOn),l=ri(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(u=ri(r.accessToken.refreshOn))}r.appMetadata&&(f="1"===r.appMetadata.familyId?"1":"");let g=o?.oid||o?.sub||"",m=o?.tid||"";a?.spa_accountid&&r.account&&(r.account.nativeAccountId=a?.spa_accountid);let y=r.account?rw(rR.getAccountInfo(r.account),void 0,o,r.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:g,tenantId:m,scopes:h,account:y,idToken:r?.idToken?.secret||"",idTokenClaims:o||{},accessToken:d,fromCache:n,expiresOn:p,extExpiresOn:l,refreshOn:u,correlationId:i.correlationId,requestId:c||D.EMPTY_STRING,familyId:f,tokenType:r.accessToken?.tokenType||D.EMPTY_STRING,state:s?s.userRequestState:D.EMPTY_STRING,cloudGraphHostName:r.account?.cloudGraphHostName||D.EMPTY_STRING,msGraphHost:r.account?.msGraphHost||D.EMPTY_STRING,code:a?.spa_code,fromNativeBroker:!1}}}async function nR(e,t,r){return"string"==typeof e?e:e({clientId:t,tokenEndpoint:r})}class n_ extends nd{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(e,t){if(this.performanceClient?.addQueueMeasurement(t4.AuthClientAcquireToken,e.correlationId),!e.code)throw tY(tE);let r=rn(),n=await t7(this.executeTokenRequest.bind(this),t4.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),i=n.headers?.[q.X_MS_REQUEST_ID],o=new nb(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return o.validateTokenResponse(n.body),t7(o.handleServerTokenResponse.bind(o),t4.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,r,e,t,void 0,void 0,void 0,i)}getLogoutUri(e){if(!e)throw te(eK);let t=this.createLogoutUrlQueryString(e);return tJ.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){let r;this.performanceClient?.addQueueMeasurement(t4.AuthClientExecuteTokenRequest,t.correlationId);let n=this.createTokenQueryParameters(t),i=tJ.appendQueryString(e.tokenEndpoint,n),o=await t7(this.createTokenRequestBody.bind(this),t4.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);if(t.clientInfo)try{let e=rA(t.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${e.uid}${K.CLIENT_INFO_SEPARATOR}${e.utid}`,type:rG.HOME_ACCOUNT_ID}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}let s=this.createTokenRequestHeaders(r||t.ccsCredential),a=nc(this.config.authOptions.clientId,t);return t7(this.executePostToTokenEndpoint.bind(this),t4.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(i,o,s,a,t.correlationId,t4.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){let t;this.performanceClient?.addQueueMeasurement(t4.AuthClientCreateTokenRequestBody,e.correlationId);let r=new Map;if(rW(r,e.embeddedClientId||e.tokenBodyParameters?.[eR]||this.config.authOptions.clientId),this.includeRedirectUri)!function(e,t){e.set(e_,t)}(r,e.redirectUri);else if(!e.redirectUri)throw te(eL);if(rY(r,e.scopes,!0,this.oidcDefaultScopes),function(e,t){e.set("code",t)}(r,e.code),r2(r,this.config.libraryInfo),r3(r,this.config.telemetry.application),no(r),this.serverTelemetryManager&&!rz(this.config)&&ni(r,this.serverTelemetryManager),e.codeVerifier&&function(e,t){e.set("code_verifier",t)}(r,e.codeVerifier),this.config.clientCredentials.clientSecret&&r5(r,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let t=this.config.clientCredentials.clientAssertion;r4(r,await nR(t.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),r8(r,t.assertionType)}if(r9(r,G.AUTHORIZATION_CODE_GRANT),r7(r),e.authenticationScheme===X.POP){let t=new nS(this.cryptoUtils,this.performanceClient);nr(r,e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await t7(t.generateCnf.bind(t),t4.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString)}else if(e.authenticationScheme===X.SSH){if(e.sshJwk)nn(r,e.sshJwk);else throw te(eX)}if((!tt.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r0(r,e.claims,this.config.authOptions.clientCapabilities),e.clientInfo)try{let r=rA(e.clientInfo,this.cryptoUtils.base64Decode);t={credential:`${r.uid}${K.CLIENT_INFO_SEPARATOR}${r.utid}`,type:rG.HOME_ACCOUNT_ID}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}else t=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&t)switch(t.type){case rG.HOME_ACCOUNT_ID:try{let e=rI(t.credential);rZ(r,e)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case rG.UPN:rJ(r,t.credential)}return e.embeddedClientId&&ns(r,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&nt(r,e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[eP]||nt(r,{[eP]:"1"}),rV(r,e.correlationId,this.performanceClient),tQ(r)}createLogoutUrlQueryString(e){let t=new Map;return e.postLogoutRedirectUri&&function(e,t){e.set("post_logout_redirect_uri",t)}(t,e.postLogoutRedirectUri),e.correlationId&&r1(t,e.correlationId),e.idTokenHint&&function(e,t){e.set("id_token_hint",t)}(t,e.idTokenHint),e.state&&r6(t,e.state),e.logoutHint&&function(e,t){e.set("logout_hint",t)}(t,e.logoutHint),e.extraQueryParameters&&nt(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&ne(t),tQ(t,this.config.authOptions.encodeExtraQueryParams,e.extraQueryParameters)}}class nk extends nd{constructor(e,t){super(e,t)}async acquireToken(e){this.performanceClient?.addQueueMeasurement(t4.RefreshTokenClientAcquireToken,e.correlationId);let t=rn(),r=await t7(this.executeTokenRequest.bind(this),t4.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),n=r.headers?.[q.X_MS_REQUEST_ID],i=new nb(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(r.body),t7(i.handleServerTokenResponse.bind(i),t4.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,n)}async acquireTokenByRefreshToken(e){if(!e)throw te(eV);if(this.performanceClient?.addQueueMeasurement(t4.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw tY(tb);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await t7(this.acquireTokenWithCachedRefreshToken.bind(this),t4.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(r){let e=r instanceof nC&&r.errorCode===nh,t=r instanceof ex&&r.errorCode===et.INVALID_GRANT_ERROR&&r.subError===et.CLIENT_MISMATCH_ERROR;if(e||t);else throw r}return t7(this.acquireTokenWithCachedRefreshToken.bind(this),t4.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){this.performanceClient?.addQueueMeasurement(t4.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);let r=t9(this.cacheManager.getRefreshToken.bind(this.cacheManager),t4.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,this.performanceClient);if(!r)throw nA(nh);if(r.expiresOn&&ro(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw this.performanceClient?.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),nA(nf);let n={...e,refreshToken:r.secret,authenticationScheme:e.authenticationScheme||X.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:rG.HOME_ACCOUNT_ID}};try{return await t7(this.acquireToken.bind(this),t4.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(n)}catch(t){if(t instanceof nC&&(this.performanceClient?.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),t.subError===nm)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");let t=this.cacheManager.generateCredentialKey(r);this.cacheManager.removeRefreshToken(t,e.correlationId)}throw t}}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(t4.RefreshTokenClientExecuteTokenRequest,e.correlationId);let r=this.createTokenQueryParameters(e),n=tJ.appendQueryString(t.tokenEndpoint,r),i=await t7(this.createTokenRequestBody.bind(this),t4.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),o=this.createTokenRequestHeaders(e.ccsCredential),s=nc(this.config.authOptions.clientId,e);return t7(this.executePostToTokenEndpoint.bind(this),t4.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(n,i,o,s,e.correlationId,t4.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(t4.RefreshTokenClientCreateTokenRequestBody,e.correlationId);let t=new Map;if(rW(t,e.embeddedClientId||e.tokenBodyParameters?.[eR]||this.config.authOptions.clientId),e.redirectUri&&function(e,t){e.set(e_,t)}(t,e.redirectUri),rY(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),r9(t,G.REFRESH_TOKEN_GRANT),r7(t),r2(t,this.config.libraryInfo),r3(t,this.config.telemetry.application),no(t),this.serverTelemetryManager&&!rz(this.config)&&ni(t,this.serverTelemetryManager),function(e,t){e.set("refresh_token",t)}(t,e.refreshToken),this.config.clientCredentials.clientSecret&&r5(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let r=this.config.clientCredentials.clientAssertion;r4(t,await nR(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),r8(t,r.assertionType)}if(e.authenticationScheme===X.POP){let r=new nS(this.cryptoUtils,this.performanceClient);nr(t,e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await t7(r.generateCnf.bind(r),t4.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString)}else if(e.authenticationScheme===X.SSH){if(e.sshJwk)nn(t,e.sshJwk);else throw te(eX)}if((!tt.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r0(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case rG.HOME_ACCOUNT_ID:try{let r=rI(e.ccsCredential.credential);rZ(t,r)}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case rG.UPN:rJ(t,e.ccsCredential.credential)}return e.embeddedClientId&&ns(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&nt(t,e.tokenBodyParameters),rV(t,e.correlationId,this.performanceClient),tQ(t)}}class nO extends nd{constructor(e,t){super(e,t)}async acquireCachedToken(e){this.performanceClient?.addQueueMeasurement(t4.SilentFlowClientAcquireCachedToken,e.correlationId);let t=eo.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!tt.isEmptyObj(e.claims))throw this.setCacheOutcome(eo.FORCE_REFRESH_OR_CLAIMS,e.correlationId),tY(tD);if(!e.account)throw tY(tb);let r=e.account.tenantId||function(e){let t=new tJ(e).getUrlComponents(),r=t.PathSegments.slice(-1)[0]?.toLowerCase();switch(r){case L.COMMON:case L.ORGANIZATIONS:case L.CONSUMERS:return;default:return r}}(e.authority),n=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,n,r);if(i){if(Number(i.cachedAt)>rn()||ro(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(eo.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),tY(tD);i.refreshOn&&ro(i.refreshOn,0)&&(t=eo.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(eo.NO_CACHED_ACCESS_TOKEN,e.correlationId),tY(tD);let o=e.authority||this.authority.getPreferredCache(),s={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,n,r,this.performanceClient),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(o)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await t7(this.generateResultFromCacheRecord.bind(this),t4.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(s,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==eo.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){let r;if(this.performanceClient?.addQueueMeasurement(t4.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId),e.idToken&&(r=rt(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){let e=r?.auth_time;if(!e)throw tY(tf);rr(e,t.maxAge)}return nb.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)}}class nP{static getNetworkResponse(e,t,r){return{headers:e,body:t,status:r}}static urlToHttpOptions(e){let t={protocol:e.protocol,hostname:e.hostname&&e.hostname.startsWith("[")?e.hostname.slice(1,-1):e.hostname,hash:e.hash,search:e.search,pathname:e.pathname,path:`${e.pathname||""}${e.search||""}`,href:e.href};return""!==e.port&&(t.port=Number(e.port)),(e.username||e.password)&&(t.auth=`${decodeURIComponent(e.username)}:${decodeURIComponent(e.password)}`),t}}var nN=r(32615),nM=r(35240);class nD{constructor(e,t){this.proxyUrl=e||"",this.customAgentOptions=t||{}}async sendGetRequestAsync(e,t,r){return this.proxyUrl?nU(e,this.proxyUrl,ep.GET,t,this.customAgentOptions,r):nx(e,ep.GET,t,this.customAgentOptions,r)}async sendPostRequestAsync(e,t){return this.proxyUrl?nU(e,this.proxyUrl,ep.POST,t,this.customAgentOptions):nx(e,ep.POST,t,this.customAgentOptions)}}let nU=(e,t,r,n,i,o)=>{let s=new URL(e),a=new URL(t),c=n?.headers||{},l={host:a.hostname,port:a.port,method:"CONNECT",path:s.hostname,headers:c};i&&Object.keys(i).length&&(l.agent=new nN.Agent(i));let u="";if(r===ep.POST){let e=n?.body||"";u=`Content-Type: application/x-www-form-urlencoded\r
Content-Length: ${e.length}\r
\r
${e}`}else o&&(l.timeout=o);let d=`${r.toUpperCase()} ${s.href} HTTP/1.1\r
Host: ${s.host}\r
Connection: close\r
`+u+"\r\n";return new Promise((e,t)=>{let r=nN.request(l);o&&r.on("timeout",()=>{r.destroy(),t(Error("Request time out"))}),r.end(),r.on("connect",(n,i)=>{let o=n?.statusCode||ef.SERVER_ERROR;(o<ef.SUCCESS_RANGE_START||o>ef.SUCCESS_RANGE_END)&&(r.destroy(),i.destroy(),t(Error(`Error connecting to proxy. Http status code: ${n.statusCode}. Http status message: ${n?.statusMessage||"Unknown"}`))),i.write(d);let s=[];i.on("data",e=>{s.push(e)}),i.on("end",()=>{let t=Buffer.concat([...s]).toString().split("\r\n"),n=parseInt(t[0].split(" ")[1]),i=t[0].split(" ").slice(2).join(" "),o=t[t.length-1],a=t.slice(1,t.length-2),c=new Map;a.forEach(e=>{let t=e.split(new RegExp(/:\s(.*)/s)),r=t[0],n=t[1];try{let e=JSON.parse(n);e&&"object"==typeof e&&(n=e)}catch(e){}c.set(r,n)});let l=Object.fromEntries(c),u=nP.getNetworkResponse(l,n$(n,i,l,o),n);(n<U.SUCCESS_RANGE_START||n>U.SUCCESS_RANGE_END)&&u.body.error!==eT.AUTHORIZATION_PENDING&&r.destroy(),e(u)}),i.on("error",e=>{r.destroy(),i.destroy(),t(Error(e.toString()))})}),r.on("error",e=>{r.destroy(),t(Error(e.toString()))})})},nx=(e,t,r,n,i)=>{let o=t===ep.POST,s=r?.body||"",a=new URL(e),c={method:t,headers:r?.headers||{},...nP.urlToHttpOptions(a)};return n&&Object.keys(n).length&&(c.agent=new nM.Agent(n)),o?c.headers={...c.headers,"Content-Length":s.length}:i&&(c.timeout=i),new Promise((e,t)=>{let r;r="http:"===c.protocol?nN.request(c):nM.request(c),o&&r.write(s),i&&r.on("timeout",()=>{r.destroy(),t(Error("Request time out"))}),r.end(),r.on("response",t=>{let n=t.headers,i=t.statusCode,o=t.statusMessage,s=[];t.on("data",e=>{s.push(e)}),t.on("end",()=>{let t=Buffer.concat([...s]).toString(),a=nP.getNetworkResponse(n,n$(i,o,n,t),i);(i<U.SUCCESS_RANGE_START||i>U.SUCCESS_RANGE_END)&&a.body.error!==eT.AUTHORIZATION_PENDING&&r.destroy(),e(a)})}),r.on("error",e=>{r.destroy(),t(Error(e.toString()))})})},n$=(e,t,r,n)=>{let i;try{i=JSON.parse(n)}catch(s){let n,o;e>=U.CLIENT_ERROR_RANGE_START&&e<=U.CLIENT_ERROR_RANGE_END?(n="client_error",o="A client"):e>=U.SERVER_ERROR_RANGE_START&&e<=U.SERVER_ERROR_RANGE_END?(n="server_error",o="A server"):(n="unknown_error",o="An unknown"),i={error:n,error_description:`${o} error occured.
Http status code: ${e}
Http status message: ${t||"Unknown"}
Headers: ${JSON.stringify(r)}`}}return i},nq="invalid_file_extension",nL="invalid_file_path",nF="invalid_managed_identity_id_type",nH="invalid_secret",nj="platform_not_supported",nB="unable_to_create_azure_arc",nz="unable_to_create_cloud_shell",nG="unable_to_create_source",nV="unable_to_read_secret_file",nK="www_authenticate_header_missing",nY="www_authenticate_header_unsupported_format",nW={[eu.AZURE_POD_IDENTITY_AUTHORITY_HOST]:"azure_pod_identity_authority_host_url_malformed",[eu.IDENTITY_ENDPOINT]:"identity_endpoint_url_malformed",[eu.IMDS_ENDPOINT]:"imds_endpoint_url_malformed",[eu.MSI_ENDPOINT]:"msi_endpoint_url_malformed"},nQ={[nq]:"The file path in the WWW-Authenticate header does not contain a .key file.",[nL]:"The file path in the WWW-Authenticate header is not in a valid Windows or Linux Format.",[nF]:"More than one ManagedIdentityIdType was provided.",[nH]:"The secret in the file on the file path in the WWW-Authenticate header is greater than 4096 bytes.",[nj]:"The platform is not supported by Azure Arc. Azure Arc only supports Windows and Linux.",missing_client_id:"A ManagedIdentityId id was not provided.",[nW.AZURE_POD_IDENTITY_AUTHORITY_HOST]:`The Managed Identity's '${eu.AZURE_POD_IDENTITY_AUTHORITY_HOST}' environment variable is malformed.`,[nW.IDENTITY_ENDPOINT]:`The Managed Identity's '${eu.IDENTITY_ENDPOINT}' environment variable is malformed.`,[nW.IMDS_ENDPOINT]:`The Managed Identity's '${eu.IMDS_ENDPOINT}' environment variable is malformed.`,[nW.MSI_ENDPOINT]:`The Managed Identity's '${eu.MSI_ENDPOINT}' environment variable is malformed.`,network_unavailable:"Authentication unavailable. The request to the managed identity endpoint timed out.",[nB]:"Azure Arc Managed Identities can only be system assigned.",[nz]:"Cloud Shell Managed Identities can only be system assigned.",[nG]:"Unable to create a Managed Identity source based on environment variables.",[nV]:"Unable to read the secret file.",user_assigned_not_available_at_runtime:"Service Fabric user assigned managed identity ClientId or ResourceId is not configurable at runtime.",[nK]:"A 401 response was received form the Azure Arc Managed Identity, but the www-authenticate header is missing.",[nY]:"A 401 response was received form the Azure Arc Managed Identity, but the www-authenticate header is in an unsupported format."};class nJ extends ew{constructor(e){super(e,nQ[e]),this.name="ManagedIdentityError",Object.setPrototypeOf(this,nJ.prototype)}}function nZ(e){return new nJ(e)}class nX{get id(){return this._id}set id(e){this._id=e}get idType(){return this._idType}set idType(e){this._idType=e}constructor(e){let t=e?.userAssignedClientId,r=e?.userAssignedResourceId,n=e?.userAssignedObjectId;if(t){if(r||n)throw nZ(nF);this.id=t,this.idType=eh.USER_ASSIGNED_CLIENT_ID}else if(r){if(t||n)throw nZ(nF);this.id=r,this.idType=eh.USER_ASSIGNED_RESOURCE_ID}else if(n){if(t||r)throw nZ(nF);this.id=n,this.idType=eh.USER_ASSIGNED_OBJECT_ID}else this.id="system_assigned_managed_identity",this.idType=eh.SYSTEM_ASSIGNED}}let n0={invalidLoopbackAddressType:{code:"invalid_loopback_server_address_type",desc:"Loopback server address is not type string. This is unexpected."},unableToLoadRedirectUri:{code:"unable_to_load_redirectUrl",desc:"Loopback server callback was invoked without a url. This is unexpected."},noAuthCodeInResponse:{code:"no_auth_code_in_response",desc:"No auth code found in the server response. Please check your network trace to determine what happened."},noLoopbackServerExists:{code:"no_loopback_server_exists",desc:"No loopback server exists yet."},loopbackServerAlreadyExists:{code:"loopback_server_already_exists",desc:"Loopback server already exists. Cannot create another."},loopbackServerTimeout:{code:"loopback_server_timeout",desc:"Timed out waiting for auth code listener to be registered."},stateNotFoundError:{code:"state_not_found",desc:"State not found. Please verify that the request originated from msal."},thumbprintMissing:{code:"thumbprint_missing_from_client_certificate",desc:"Client certificate does not contain a SHA-1 or SHA-256 thumbprint."},redirectUriNotSupported:{code:"redirect_uri_not_supported",desc:"RedirectUri is not supported in this scenario. Please remove redirectUri from the request."}};class n1 extends ew{constructor(e,t){super(e,t),this.name="NodeAuthError"}static createInvalidLoopbackAddressTypeError(){return new n1(n0.invalidLoopbackAddressType.code,`${n0.invalidLoopbackAddressType.desc}`)}static createUnableToLoadRedirectUrlError(){return new n1(n0.unableToLoadRedirectUri.code,`${n0.unableToLoadRedirectUri.desc}`)}static createNoAuthCodeInResponseError(){return new n1(n0.noAuthCodeInResponse.code,`${n0.noAuthCodeInResponse.desc}`)}static createNoLoopbackServerExistsError(){return new n1(n0.noLoopbackServerExists.code,`${n0.noLoopbackServerExists.desc}`)}static createLoopbackServerAlreadyExistsError(){return new n1(n0.loopbackServerAlreadyExists.code,`${n0.loopbackServerAlreadyExists.desc}`)}static createLoopbackServerTimeoutError(){return new n1(n0.loopbackServerTimeout.code,`${n0.loopbackServerTimeout.desc}`)}static createStateNotFoundError(){return new n1(n0.stateNotFoundError.code,n0.stateNotFoundError.desc)}static createThumbprintMissingError(){return new n1(n0.thumbprintMissing.code,n0.thumbprintMissing.desc)}static createRedirectUriNotSupportedError(){return new n1(n0.redirectUriNotSupported.code,n0.redirectUriNotSupported.desc)}}let n2={clientId:D.EMPTY_STRING,authority:D.DEFAULT_AUTHORITY,clientSecret:D.EMPTY_STRING,clientAssertion:D.EMPTY_STRING,clientCertificate:{thumbprint:D.EMPTY_STRING,thumbprintSha256:D.EMPTY_STRING,privateKey:D.EMPTY_STRING,x5c:D.EMPTY_STRING},knownAuthorities:[],cloudDiscoveryMetadata:D.EMPTY_STRING,authorityMetadata:D.EMPTY_STRING,clientCapabilities:[],protocolMode:t6.AAD,azureCloudOptions:{azureCloudInstance:t5.None,tenant:D.EMPTY_STRING},skipAuthorityMetadataCache:!1,encodeExtraQueryParams:!1},n3={claimsBasedCachingEnabled:!1},n6={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:I.Info},n5={loggerOptions:n6,networkClient:new nD,proxyUrl:D.EMPTY_STRING,customAgentOptions:{},disableInternalRetries:!1},n4={application:{appName:D.EMPTY_STRING,appVersion:D.EMPTY_STRING}};var n8=r(73376);class n9{generateGuid(){return(0,n8.Z)()}isGuid(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}}class n7{static base64Encode(e,t){return Buffer.from(e,t).toString(es.BASE64)}static base64EncodeUrl(e,t){return n7.base64Encode(e,t).replace(/=/g,D.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_")}static base64Decode(e){return Buffer.from(e,es.BASE64).toString("utf8")}static base64DecodeUrl(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";return n7.base64Decode(t)}}var ie=r(84770);class it{sha256(e){return ie.createHash(eg.SHA256).update(e).digest()}}class ir{constructor(){this.hashUtils=new it}async generatePkceCodes(){let e=this.generateCodeVerifier(),t=this.generateCodeChallengeFromVerifier(e);return{verifier:e,challenge:t}}generateCodeVerifier(){let e=[],t=256-256%em.CV_CHARSET.length;for(;e.length<=32;){let r=ie.randomBytes(1)[0];if(r>=t)continue;let n=r%em.CV_CHARSET.length;e.push(em.CV_CHARSET[n])}let r=e.join(D.EMPTY_STRING);return n7.base64EncodeUrl(r)}generateCodeChallengeFromVerifier(e){return n7.base64EncodeUrl(this.hashUtils.sha256(e).toString(es.BASE64),es.BASE64)}}class ii{constructor(){this.pkceGenerator=new ir,this.guidGenerator=new n9,this.hashUtils=new it}base64UrlEncode(){throw Error("Method not implemented.")}encodeKid(){throw Error("Method not implemented.")}createNewGuid(){return this.guidGenerator.generateGuid()}base64Encode(e){return n7.base64Encode(e)}base64Decode(e){return n7.base64Decode(e)}generatePkceCodes(){return this.pkceGenerator.generatePkceCodes()}getPublicKeyThumbprint(){throw Error("Method not implemented.")}removeTokenBindingKey(){throw Error("Method not implemented.")}clearKeystore(){throw Error("Method not implemented.")}signJwt(){throw Error("Method not implemented.")}async hashString(e){return n7.base64EncodeUrl(this.hashUtils.sha256(e).toString(es.BASE64),es.BASE64)}}class io{static deserializeJSONBlob(e){return e?JSON.parse(e):{}}static deserializeAccounts(e){let t={};return e&&Object.keys(e).map(function(r){let n=e[r],i={homeAccountId:n.home_account_id,environment:n.environment,realm:n.realm,localAccountId:n.local_account_id,username:n.username,authorityType:n.authority_type,name:n.name,clientInfo:n.client_info,lastModificationTime:n.last_modification_time,lastModificationApp:n.last_modification_app,tenantProfiles:n.tenantProfiles?.map(e=>JSON.parse(e)),lastUpdatedAt:Date.now().toString()},o=new rR;rN.toObject(o,i),t[r]=o}),t}static deserializeIdTokens(e){let t={};return e&&Object.keys(e).map(function(r){let n=e[r],i={homeAccountId:n.home_account_id,environment:n.environment,credentialType:n.credential_type,clientId:n.client_id,secret:n.secret,realm:n.realm,lastUpdatedAt:Date.now().toString()};t[r]=i}),t}static deserializeAccessTokens(e){let t={};return e&&Object.keys(e).map(function(r){let n=e[r],i={homeAccountId:n.home_account_id,environment:n.environment,credentialType:n.credential_type,clientId:n.client_id,secret:n.secret,realm:n.realm,target:n.target,cachedAt:n.cached_at,expiresOn:n.expires_on,extendedExpiresOn:n.extended_expires_on,refreshOn:n.refresh_on,keyId:n.key_id,tokenType:n.token_type,requestedClaims:n.requestedClaims,requestedClaimsHash:n.requestedClaimsHash,userAssertionHash:n.userAssertionHash,lastUpdatedAt:Date.now().toString()};t[r]=i}),t}static deserializeRefreshTokens(e){let t={};return e&&Object.keys(e).map(function(r){let n=e[r],i={homeAccountId:n.home_account_id,environment:n.environment,credentialType:n.credential_type,clientId:n.client_id,secret:n.secret,familyId:n.family_id,target:n.target,realm:n.realm,lastUpdatedAt:Date.now().toString()};t[r]=i}),t}static deserializeAppMetadata(e){let t={};return e&&Object.keys(e).map(function(r){let n=e[r];t[r]={clientId:n.client_id,environment:n.environment,familyId:n.family_id}}),t}static deserializeAllCache(e){return{accounts:e.Account?this.deserializeAccounts(e.Account):{},idTokens:e.IdToken?this.deserializeIdTokens(e.IdToken):{},accessTokens:e.AccessToken?this.deserializeAccessTokens(e.AccessToken):{},refreshTokens:e.RefreshToken?this.deserializeRefreshTokens(e.RefreshToken):{},appMetadata:e.AppMetadata?this.deserializeAppMetadata(e.AppMetadata):{}}}}class is{static serializeJSONBlob(e){return JSON.stringify(e)}static serializeAccounts(e){let t={};return Object.keys(e).map(function(r){let n=e[r];t[r]={home_account_id:n.homeAccountId,environment:n.environment,realm:n.realm,local_account_id:n.localAccountId,username:n.username,authority_type:n.authorityType,name:n.name,client_info:n.clientInfo,last_modification_time:n.lastModificationTime,last_modification_app:n.lastModificationApp,tenantProfiles:n.tenantProfiles?.map(e=>JSON.stringify(e))}}),t}static serializeIdTokens(e){let t={};return Object.keys(e).map(function(r){let n=e[r];t[r]={home_account_id:n.homeAccountId,environment:n.environment,credential_type:n.credentialType,client_id:n.clientId,secret:n.secret,realm:n.realm}}),t}static serializeAccessTokens(e){let t={};return Object.keys(e).map(function(r){let n=e[r];t[r]={home_account_id:n.homeAccountId,environment:n.environment,credential_type:n.credentialType,client_id:n.clientId,secret:n.secret,realm:n.realm,target:n.target,cached_at:n.cachedAt,expires_on:n.expiresOn,extended_expires_on:n.extendedExpiresOn,refresh_on:n.refreshOn,key_id:n.keyId,token_type:n.tokenType,requestedClaims:n.requestedClaims,requestedClaimsHash:n.requestedClaimsHash,userAssertionHash:n.userAssertionHash}}),t}static serializeRefreshTokens(e){let t={};return Object.keys(e).map(function(r){let n=e[r];t[r]={home_account_id:n.homeAccountId,environment:n.environment,credential_type:n.credentialType,client_id:n.clientId,secret:n.secret,family_id:n.familyId,target:n.target,realm:n.realm}}),t}static serializeAppMetadata(e){let t={};return Object.keys(e).map(function(r){let n=e[r];t[r]={client_id:n.clientId,environment:n.environment,family_id:n.familyId}}),t}static serializeAllCache(e){return{Account:this.serializeAccounts(e.accounts),IdToken:this.serializeIdTokens(e.idTokens),AccessToken:this.serializeAccessTokens(e.accessTokens),RefreshToken:this.serializeRefreshTokens(e.refreshTokens),AppMetadata:this.serializeAppMetadata(e.appMetadata)}}}class ia extends rN{constructor(e,t,r,n){super(t,r,e,new rU,n),this.cache={},this.changeEmitters=[],this.logger=e}registerChangeEmitter(e){this.changeEmitters.push(e)}emitChange(){this.changeEmitters.forEach(e=>e.call(null))}cacheToInMemoryCache(e){let t={accounts:{},idTokens:{},accessTokens:{},refreshTokens:{},appMetadata:{}};for(let r in e){let n=e[r];if("object"==typeof n){if(n instanceof rR)t.accounts[r]=n;else if(rc(n))t.idTokens[r]=n;else if(ra(n))t.accessTokens[r]=n;else if(rl(n))t.refreshTokens[r]=n;else{if(!ru(r,n))continue;t.appMetadata[r]=n}}}return t}inMemoryCacheToCache(e){return{...this.getCache(),...e.accounts,...e.idTokens,...e.accessTokens,...e.refreshTokens,...e.appMetadata}}getInMemoryCache(){return this.logger.trace("Getting in-memory cache"),this.cacheToInMemoryCache(this.getCache())}setInMemoryCache(e){this.logger.trace("Setting in-memory cache");let t=this.inMemoryCacheToCache(e);this.setCache(t),this.emitChange()}getCache(){return this.logger.trace("Getting cache key-value store"),this.cache}setCache(e){this.logger.trace("Setting cache key value store"),this.cache=e,this.emitChange()}getItem(e){return this.logger.tracePii(`Item key: ${e}`),this.getCache()[e]}setItem(e,t){this.logger.tracePii(`Item key: ${e}`);let r=this.getCache();r[e]=t,this.setCache(r)}generateCredentialKey(e){return function(e){let t=e.credentialType===Y.REFRESH_TOKEN&&e.familyId||e.clientId,r=e.tokenType&&e.tokenType.toLowerCase()!==X.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",e.requestedClaimsHash||"",r].join(ey.KEY_SEPARATOR).toLowerCase()}(e)}generateAccountKey(e){return function(e){let t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment,t||e.tenantId||""].join(ey.KEY_SEPARATOR).toLowerCase()}(e)}getAccountKeys(){return Object.keys(this.getInMemoryCache().accounts)}getTokenKeys(){let e=this.getInMemoryCache();return{idToken:Object.keys(e.idTokens),accessToken:Object.keys(e.accessTokens),refreshToken:Object.keys(e.refreshTokens)}}getAccount(e){return this.getItem(e)?Object.assign(new rR,this.getItem(e)):null}async setAccount(e){let t=this.generateAccountKey(rR.getAccountInfo(e));this.setItem(t,e)}getIdTokenCredential(e){let t=this.getItem(e);return rc(t)?t:null}async setIdTokenCredential(e){let t=this.generateCredentialKey(e);this.setItem(t,e)}getAccessTokenCredential(e){let t=this.getItem(e);return ra(t)?t:null}async setAccessTokenCredential(e){let t=this.generateCredentialKey(e);this.setItem(t,e)}getRefreshTokenCredential(e){let t=this.getItem(e);return rl(t)?t:null}async setRefreshTokenCredential(e){let t=this.generateCredentialKey(e);this.setItem(t,e)}getAppMetadata(e){let t=this.getItem(e);return ru(e,t)?t:null}setAppMetadata(e){let t=function({environment:e,clientId:t}){return[W,e,t].join(K.CACHE_KEY_SEPARATOR).toLowerCase()}(e);this.setItem(t,e)}getServerTelemetry(e){let t=this.getItem(e);return t&&function(e,t){let r=0===e.indexOf(Z.CACHE_KEY),n=!0;return t&&(n=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),r&&n}(e,t)?t:null}setServerTelemetry(e,t){this.setItem(e,t)}getAuthorityMetadata(e){let t=this.getItem(e);return t&&t&&0===e.indexOf(Q.CACHE_KEY)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")?t:null}getAuthorityMetadataKeys(){return this.getKeys().filter(e=>this.isAuthorityMetadata(e))}setAuthorityMetadata(e,t){this.setItem(e,t)}getThrottlingCache(e){let t,r;let n=this.getItem(e);return n&&(t=!1,e&&(t=0===e.indexOf(ee.THROTTLING_PREFIX)),r=!0,n&&(r=n.hasOwnProperty("throttleTime")),t&&r)?n:null}setThrottlingCache(e,t){this.setItem(e,t)}removeItem(e){this.logger.tracePii(`Item key: ${e}`);let t=!1,r=this.getCache();return r[e]&&(delete r[e],t=!0),t&&(this.setCache(r),this.emitChange()),t}removeOutdatedAccount(e){this.removeItem(e)}containsKey(e){return this.getKeys().includes(e)}getKeys(){return this.logger.trace("Retrieving all cache keys"),[...Object.keys(this.getCache())]}clear(){this.logger.trace("Clearing cache entries created by MSAL"),this.getKeys().forEach(e=>{this.removeItem(e)}),this.emitChange()}static generateInMemoryCache(e){return io.deserializeAllCache(io.deserializeJSONBlob(e))}static generateJsonCache(e){return is.serializeAllCache(e)}updateCredentialCacheKey(e,t){let r=this.generateCredentialKey(t);if(e!==r){let n=this.getItem(e);if(n)return this.removeItem(e),this.setItem(r,n),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),r;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}}let ic={Account:{},IdToken:{},AccessToken:{},RefreshToken:{},AppMetadata:{}};class il{constructor(e,t,r){this.cacheHasChanged=!1,this.storage=e,this.storage.registerChangeEmitter(this.handleChangeEvent.bind(this)),r&&(this.persistence=r),this.logger=t}hasChanged(){return this.cacheHasChanged}serialize(){this.logger.trace("Serializing in-memory cache");let e=is.serializeAllCache(this.storage.getInMemoryCache());return this.cacheSnapshot?(this.logger.trace("Reading cache snapshot from disk"),e=this.mergeState(JSON.parse(this.cacheSnapshot),e)):this.logger.trace("No cache snapshot to merge"),this.cacheHasChanged=!1,JSON.stringify(e)}deserialize(e){if(this.logger.trace("Deserializing JSON to in-memory cache"),this.cacheSnapshot=e,this.cacheSnapshot){this.logger.trace("Reading cache snapshot from disk");let e=io.deserializeAllCache(this.overlayDefaults(JSON.parse(this.cacheSnapshot)));this.storage.setInMemoryCache(e)}else this.logger.trace("No cache snapshot to deserialize")}getKVStore(){return this.storage.getCache()}getCacheSnapshot(){let e=ia.generateInMemoryCache(this.cacheSnapshot);return this.storage.inMemoryCacheToCache(e)}async getAllAccounts(e=new ii().createNewGuid()){let t;this.logger.trace("getAllAccounts called");try{return this.persistence&&(t=new nw(this,!1),await this.persistence.beforeCacheAccess(t)),this.storage.getAllAccounts({},e)}finally{this.persistence&&t&&await this.persistence.afterCacheAccess(t)}}async getAccountByHomeId(e){let t=await this.getAllAccounts();return e&&t&&t.length&&t.filter(t=>t.homeAccountId===e)[0]||null}async getAccountByLocalId(e){let t=await this.getAllAccounts();return e&&t&&t.length&&t.filter(t=>t.localAccountId===e)[0]||null}async removeAccount(e,t){let r;this.logger.trace("removeAccount called");try{this.persistence&&(r=new nw(this,!0),await this.persistence.beforeCacheAccess(r)),this.storage.removeAccount(e,t||new n9().generateGuid())}finally{this.persistence&&r&&await this.persistence.afterCacheAccess(r)}}async overwriteCache(){if(!this.persistence){this.logger.info("No persistence layer specified, cache cannot be overwritten");return}this.logger.info("Overwriting in-memory cache with persistent cache"),this.storage.clear();let e=new nw(this,!1);await this.persistence.beforeCacheAccess(e);let t=this.getCacheSnapshot();this.storage.setCache(t),await this.persistence.afterCacheAccess(e)}handleChangeEvent(){this.cacheHasChanged=!0}mergeState(e,t){this.logger.trace("Merging in-memory cache with cache snapshot");let r=this.mergeRemovals(e,t);return this.mergeUpdates(r,t)}mergeUpdates(e,t){return Object.keys(t).forEach(r=>{let n=t[r];if(e.hasOwnProperty(r)){let t=null!==n,i="object"==typeof n,o=!Array.isArray(n),s=void 0!==e[r]&&null!==e[r];t&&i&&o&&s?this.mergeUpdates(e[r],n):e[r]=n}else null!==n&&(e[r]=n)}),e}mergeRemovals(e,t){this.logger.trace("Remove updated entries in cache");let r=e.Account?this.mergeRemovalsDict(e.Account,t.Account):e.Account,n=e.AccessToken?this.mergeRemovalsDict(e.AccessToken,t.AccessToken):e.AccessToken,i=e.RefreshToken?this.mergeRemovalsDict(e.RefreshToken,t.RefreshToken):e.RefreshToken,o=e.IdToken?this.mergeRemovalsDict(e.IdToken,t.IdToken):e.IdToken,s=e.AppMetadata?this.mergeRemovalsDict(e.AppMetadata,t.AppMetadata):e.AppMetadata;return{...e,Account:r,AccessToken:n,RefreshToken:i,IdToken:o,AppMetadata:s}}mergeRemovalsDict(e,t){let r={...e};return Object.keys(e).forEach(e=>{t&&t.hasOwnProperty(e)||delete r[e]}),r}overlayDefaults(e){return this.logger.trace("Overlaying input cache with the default cache"),{Account:{...ic.Account,...e.Account},IdToken:{...ic.IdToken,...e.IdToken},AccessToken:{...ic.AccessToken,...e.AccessToken},RefreshToken:{...ic.RefreshToken,...e.RefreshToken},AppMetadata:{...ic.AppMetadata,...e.AppMetadata}}}}var iu=r(49165);class id{static fromAssertion(e){let t=new id;return t.jwt=e,t}static fromCertificate(e,t,r){let n=new id;return n.privateKey=t,n.thumbprint=e,n.useSha256=!1,r&&(n.publicCertificate=this.parseCertificate(r)),n}static fromCertificateWithSha256Thumbprint(e,t,r){let n=new id;return n.privateKey=t,n.thumbprint=e,n.useSha256=!0,r&&(n.publicCertificate=this.parseCertificate(r)),n}getJwt(e,t,r){if(this.privateKey&&this.thumbprint)return this.jwt&&!this.isExpired()&&t===this.issuer&&r===this.jwtAudience?this.jwt:this.createJwt(e,t,r);if(this.jwt)return this.jwt;throw tY(tN)}createJwt(e,t,r){this.issuer=t,this.jwtAudience=r;let n=rn();this.expirationTime=n+600;let i={alg:this.useSha256?eC.PSS_256:eC.RSA_256};Object.assign(i,{[this.useSha256?eC.X5T_256:eC.X5T]:n7.base64EncodeUrl(this.thumbprint,es.HEX)}),this.publicCertificate&&Object.assign(i,{[eC.X5C]:this.publicCertificate});let o={[eC.AUDIENCE]:this.jwtAudience,[eC.EXPIRATION_TIME]:this.expirationTime,[eC.ISSUER]:this.issuer,[eC.SUBJECT]:this.issuer,[eC.NOT_BEFORE]:n,[eC.JWT_ID]:e.createNewGuid()};return this.jwt=iu.sign(o,this.privateKey,{header:i}),this.jwt}isExpired(){return this.expirationTime<rn()}static parseCertificate(e){let t;let r=/-----BEGIN CERTIFICATE-----\r*\n(.+?)\r*\n-----END CERTIFICATE-----/gs,n=[];for(;null!==(t=r.exec(e));)n.push(t[1].replace(/\r*\n/g,D.EMPTY_STRING));return n}}let ih="@azure/msal-node",ip="3.8.1";class ig extends nd{constructor(e){super(e)}async acquireToken(e){this.logger.info("in acquireToken call in username-password client");let t=rn(),r=await this.executeTokenRequest(this.authority,e),n=new nb(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return n.validateTokenResponse(r.body),n.handleServerTokenResponse(r.body,this.authority,t,e)}async executeTokenRequest(e,t){let r=this.createTokenQueryParameters(t),n=tJ.appendQueryString(e.tokenEndpoint,r),i=await this.createTokenRequestBody(t),o=this.createTokenRequestHeaders({credential:t.username,type:rG.UPN}),s={clientId:this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return this.executePostToTokenEndpoint(n,i,o,s,t.correlationId)}async createTokenRequestBody(e){let t=new Map;rW(t,this.config.authOptions.clientId),function(e,t){e.set(er.username,t)}(t,e.username),function(e,t){e.set(er.password,t)}(t,e.password),rY(t,e.scopes),rK(t,B.IDTOKEN_TOKEN),r9(t,G.RESOURCE_OWNER_PASSWORD_GRANT),r7(t),r2(t,this.config.libraryInfo),r3(t,this.config.telemetry.application),no(t),this.serverTelemetryManager&&ni(t,this.serverTelemetryManager),r1(t,e.correlationId||this.config.cryptoInterface.createNewGuid()),this.config.clientCredentials.clientSecret&&r5(t,this.config.clientCredentials.clientSecret);let r=this.config.clientCredentials.clientAssertion;return r&&(r4(t,await nR(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),r8(t,r.assertionType)),(!tt.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r0(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.username&&rJ(t,e.username),tQ(t)}}class im{constructor(e){this.config=function({auth:e,broker:t,cache:r,system:n,telemetry:i}){let o={...n5,networkClient:new nD(n?.proxyUrl,n?.customAgentOptions),loggerOptions:n?.loggerOptions||n6,disableInternalRetries:n?.disableInternalRetries||!1};if(e.clientCertificate&&!e.clientCertificate.thumbprint&&!e.clientCertificate.thumbprintSha256)throw n1.createStateNotFoundError();return{auth:{...n2,...e},broker:{...t},cache:{...n3,...r},system:{...o,...n},telemetry:{...n4,...i}}}(e),this.cryptoProvider=new ii,this.logger=new e$(this.config.system.loggerOptions,ih,ip),this.storage=new ia(this.logger,this.config.auth.clientId,this.cryptoProvider,function(e){let t;let r=e.cloudDiscoveryMetadata;if(r)try{t=JSON.parse(r)}catch(e){throw te(eQ)}return{canonicalAuthority:e.authority?rm(e.authority):void 0,knownAuthorities:e.knownAuthorities,cloudDiscoveryMetadata:t}}(this.config.auth)),this.tokenCache=new il(this.storage,this.logger,this.config.cache.cachePlugin)}async getAuthCodeUrl(e){this.logger.info("getAuthCodeUrl called",e.correlationId);let t={...e,...await this.initializeBaseRequest(e),responseMode:e.responseMode||z.QUERY,authenticationScheme:X.BEARER,state:e.state||"",nonce:e.nonce||""},r=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions);return function(e,t,r,n){let i=function(e,t,r,n){let i=t.correlationId,o=new Map;if(rW(o,t.embeddedClientId||t.extraQueryParameters?.[eR]||e.clientId),rY(o,[...t.scopes||[],...t.extraScopesToConsent||[]],!0,e.authority.options.OIDCOptions?.defaultScopes),function(e,t){e.set(e_,t)}(o,t.redirectUri),r1(o,i),function(e,t){e.set("response_mode",t||z.QUERY)}(o,t.responseMode),r7(o),t.prompt&&function(e,t){e.set("prompt",t)}(o,t.prompt),t.domainHint&&function(e,t){e.set("domain_hint",t)}(o,t.domainHint),t.prompt!==H.SELECT_ACCOUNT){if(t.sid&&t.prompt===H.NONE)r.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),rX(o,t.sid);else if(t.account){var s,a;let e=(s=t.account,s.idTokenClaims?.sid||null),c=(a=t.account).loginHint||a.idTokenClaims?.login_hint||null;if(c&&t.domainHint&&(r.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),c=null),c){r.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),rQ(o,c),n?.addFields({loginHintFromClaim:!0},i);try{let e=rI(t.account.homeAccountId);rZ(o,e)}catch(e){r.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e&&t.prompt===H.NONE){r.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),rX(o,e),n?.addFields({sidFromClaim:!0},i);try{let e=rI(t.account.homeAccountId);rZ(o,e)}catch(e){r.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(t.loginHint)r.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),rQ(o,t.loginHint),rJ(o,t.loginHint),n?.addFields({loginHintFromRequest:!0},i);else if(t.account.username){r.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),rQ(o,t.account.username),n?.addFields({loginHintFromUpn:!0},i);try{let e=rI(t.account.homeAccountId);rZ(o,e)}catch(e){r.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else t.loginHint&&(r.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),rQ(o,t.loginHint),rJ(o,t.loginHint),n?.addFields({loginHintFromRequest:!0},i))}else r.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return t.nonce&&function(e,t){e.set("nonce",t)}(o,t.nonce),t.state&&r6(o,t.state),(t.claims||e.clientCapabilities&&e.clientCapabilities.length>0)&&r0(o,t.claims,e.clientCapabilities),t.embeddedClientId&&ns(o,e.clientId,e.redirectUri),!e.instanceAware||t.extraQueryParameters&&Object.keys(t.extraQueryParameters).includes(eU)||ne(o),o}({...e.auth,authority:t,redirectUri:r.redirectUri||""},r,n);return r2(i,{sku:eT.MSAL_SKU,version:ip,cpu:process.arch||"",os:process.platform||""}),e.auth.protocolMode!==t6.OIDC&&r3(i,e.telemetry.application),rK(i,B.CODE),r.codeChallenge&&r.codeChallengeMethod&&function(e,t,r){if(t&&r)e.set("code_challenge",t),e.set("code_challenge_method",r);else throw te(eW)}(i,r.codeChallenge,r.codeChallengeMethod),nt(i,r.extraQueryParameters||{}),function(e,t,r,n){let i=tQ(t,r,n);return tJ.appendQueryString(e.authorizationEndpoint,i)}(t,i,e.auth.encodeExtraQueryParams,r.extraQueryParameters)}(this.config,r,t,this.logger)}async acquireTokenByCode(e,t){this.logger.info("acquireTokenByCode called"),e.state&&t&&(this.logger.info("acquireTokenByCode - validating state"),this.validateState(e.state,t.state||""),t={...t,state:""});let r={...e,...await this.initializeBaseRequest(e),authenticationScheme:X.BEARER},n=this.initializeServerTelemetryManager(eE.acquireTokenByCode,r.correlationId);try{let i=await this.createAuthority(r.authority,r.correlationId,void 0,e.azureCloudOptions),o=await this.buildOauthClientConfiguration(i,r.correlationId,r.redirectUri,n),s=new n_(o);return this.logger.verbose("Auth code client created",r.correlationId),await s.acquireToken(r,t)}catch(e){throw e instanceof ew&&e.setCorrelationId(r.correlationId),n.cacheFailedRequest(e),e}}async acquireTokenByRefreshToken(e){this.logger.info("acquireTokenByRefreshToken called",e.correlationId);let t={...e,...await this.initializeBaseRequest(e),authenticationScheme:X.BEARER},r=this.initializeServerTelemetryManager(eE.acquireTokenByRefreshToken,t.correlationId);try{let n=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions),i=await this.buildOauthClientConfiguration(n,t.correlationId,t.redirectUri||"",r),o=new nk(i);return this.logger.verbose("Refresh token client created",t.correlationId),await o.acquireToken(t)}catch(e){throw e instanceof ew&&e.setCorrelationId(t.correlationId),r.cacheFailedRequest(e),e}}async acquireTokenSilent(e){let t={...e,...await this.initializeBaseRequest(e),forceRefresh:e.forceRefresh||!1},r=this.initializeServerTelemetryManager(eE.acquireTokenSilent,t.correlationId,t.forceRefresh);try{let n=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions),i=await this.buildOauthClientConfiguration(n,t.correlationId,t.redirectUri||"",r),o=new nO(i);this.logger.verbose("Silent flow client created",t.correlationId);try{return await this.tokenCache.overwriteCache(),await this.acquireCachedTokenSilent(t,o,i)}catch(e){if(e instanceof tK&&e.errorCode===tD)return new nk(i).acquireTokenByRefreshToken(t);throw e}}catch(e){throw e instanceof ew&&e.setCorrelationId(t.correlationId),r.cacheFailedRequest(e),e}}async acquireCachedTokenSilent(e,t,r){let[n,i]=await t.acquireCachedToken({...e,scopes:e.scopes?.length?e.scopes:[...x]});if(i===eo.PROACTIVELY_REFRESHED){this.logger.info("ClientApplication:acquireCachedTokenSilent - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed.");let t=new nk(r);try{await t.acquireTokenByRefreshToken(e)}catch{}}return n}async acquireTokenByUsernamePassword(e){this.logger.info("acquireTokenByUsernamePassword called",e.correlationId);let t={...e,...await this.initializeBaseRequest(e)},r=this.initializeServerTelemetryManager(eE.acquireTokenByUsernamePassword,t.correlationId);try{let n=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions),i=await this.buildOauthClientConfiguration(n,t.correlationId,"",r),o=new ig(i);return this.logger.verbose("Username password client created",t.correlationId),await o.acquireToken(t)}catch(e){throw e instanceof ew&&e.setCorrelationId(t.correlationId),r.cacheFailedRequest(e),e}}getTokenCache(){return this.logger.info("getTokenCache called"),this.tokenCache}validateState(e,t){if(!e)throw n1.createStateNotFoundError();if(e!==t)throw tY(td)}getLogger(){return this.logger}setLogger(e){this.logger=e}async buildOauthClientConfiguration(e,t,r,n){return this.logger.verbose("buildOauthClientConfiguration called",t),this.logger.info(`Building oauth client configuration with the following authority: ${e.tokenEndpoint}.`,t),n?.updateRegionDiscoveryMetadata(e.regionDiscoveryMetadata),{authOptions:{clientId:this.config.auth.clientId,authority:e,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:r},loggerOptions:{logLevel:this.config.system.loggerOptions.logLevel,loggerCallback:this.config.system.loggerOptions.loggerCallback,piiLoggingEnabled:this.config.system.loggerOptions.piiLoggingEnabled,correlationId:t},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.cryptoProvider,networkInterface:this.config.system.networkClient,storageInterface:this.storage,serverTelemetryManager:n,clientCredentials:{clientSecret:this.clientSecret,clientAssertion:await this.getClientAssertion(e)},libraryInfo:{sku:eT.MSAL_SKU,version:ip,cpu:process.arch||D.EMPTY_STRING,os:process.platform||D.EMPTY_STRING},telemetry:this.config.telemetry,persistencePlugin:this.config.cache.cachePlugin,serializableCache:this.tokenCache}}async getClientAssertion(e){return this.developerProvidedClientAssertion&&(this.clientAssertion=id.fromAssertion(await nR(this.developerProvidedClientAssertion,this.config.auth.clientId,e.tokenEndpoint))),this.clientAssertion&&{assertion:this.clientAssertion.getJwt(this.cryptoProvider,this.config.auth.clientId,e.tokenEndpoint),assertionType:eT.JWT_BEARER_ASSERTION_TYPE}}async initializeBaseRequest(e){return this.logger.verbose("initializeRequestScopes called",e.correlationId),e.authenticationScheme&&e.authenticationScheme===X.POP&&this.logger.verbose("Authentication Scheme 'pop' is not supported yet, setting Authentication Scheme to 'Bearer' for request",e.correlationId),e.authenticationScheme=X.BEARER,this.config.cache.claimsBasedCachingEnabled&&e.claims&&!tt.isEmptyObj(e.claims)&&(e.requestedClaimsHash=await this.cryptoProvider.hashString(e.claims)),{...e,scopes:[...e&&e.scopes||[],...x],correlationId:e&&e.correlationId||this.cryptoProvider.createNewGuid(),authority:e.authority||this.config.auth.authority}}initializeServerTelemetryManager(e,t,r){return new eb({clientId:this.config.auth.clientId,correlationId:t,apiId:e,forceRefresh:r||!1},this.storage)}async createAuthority(e,t,r,n){this.logger.verbose("createAuthority called",t);let i=rg.generateAuthority(e,n||this.config.auth.azureCloudOptions),o={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,azureRegionConfiguration:r,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache};return na(i,this.config.system.networkClient,this.storage,o,this.logger,t)}clearCache(){this.storage.clear()}}class iy{async listenForAuthCode(e,t){if(this.server)throw n1.createLoopbackServerAlreadyExistsError();return new Promise((r,n)=>{this.server=nN.createServer((i,o)=>{let s=i.url;if(s){if(s===D.FORWARD_SLASH){o.end(e||"Auth code was successfully acquired. You can close this window now.");return}}else{o.end(t||"Error occurred loading redirectUrl"),n(n1.createUnableToLoadRedirectUrlError());return}let a=this.getRedirectUri(),c=tW(new URL(s,a).search)||{};c.code&&(o.writeHead(U.REDIRECT,{location:a}),o.end()),c.error&&o.end(t||`Error occurred: ${c.error}`),r(c)}),this.server.listen(0,"127.0.0.1")})}getRedirectUri(){if(!this.server||!this.server.listening)throw n1.createNoLoopbackServerExistsError();let e=this.server.address();if(!e||"string"==typeof e||!e.port)throw this.closeServer(),n1.createInvalidLoopbackAddressTypeError();let t=e&&e.port;return`${eT.HTTP_PROTOCOL}${eT.LOCALHOST}:${t}`}closeServer(){this.server&&(this.server.close(),"function"==typeof this.server.closeAllConnections&&this.server.closeAllConnections(),this.server.unref(),this.server=void 0)}}class iT extends nd{constructor(e){super(e)}async acquireToken(e){let t=await this.getDeviceCode(e);e.deviceCodeCallback(t);let r=rn(),n=await this.acquireTokenWithDeviceCode(e,t),i=new nb(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(n),i.handleServerTokenResponse(n,this.authority,r,e)}async getDeviceCode(e){let t=this.createExtraQueryParameters(e),r=tJ.appendQueryString(this.authority.deviceCodeEndpoint,t),n=this.createQueryString(e),i=this.createTokenRequestHeaders(),o={clientId:this.config.authOptions.clientId,authority:e.authority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return this.executePostRequestToDeviceCodeEndpoint(r,n,i,o,e.correlationId)}createExtraQueryParameters(e){let t=new Map;return e.extraQueryParameters&&nt(t,e.extraQueryParameters),tQ(t)}async executePostRequestToDeviceCodeEndpoint(e,t,r,n,i){let{body:{user_code:o,device_code:s,verification_uri:a,expires_in:c,interval:l,message:u}}=await this.sendPostRequest(n,e,{body:t,headers:r},i);return{userCode:o,deviceCode:s,verificationUri:a,expiresIn:c,interval:l,message:u}}createQueryString(e){let t=new Map;return rY(t,e.scopes),rW(t,this.config.authOptions.clientId),e.extraQueryParameters&&nt(t,e.extraQueryParameters),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r0(t,e.claims,this.config.authOptions.clientCapabilities),tQ(t)}continuePolling(e,t,r){if(r)throw this.logger.error("Token request cancelled by setting DeviceCodeRequest.cancel = true"),tY(tv);if(t&&t<e&&rn()>t)throw this.logger.error(`User defined timeout for device code polling reached. The timeout was set for ${t}`),tY(tU);if(rn()>e)throw t&&this.logger.verbose(`User specified timeout ignored as the device code has expired before the timeout elapsed. The user specified timeout was set for ${t}`),this.logger.error(`Device code expired. Expiration time of device code was ${e}`),tY(tS);return!0}async acquireTokenWithDeviceCode(e,t){let r=this.createTokenQueryParameters(e),n=tJ.appendQueryString(this.authority.tokenEndpoint,r),i=this.createTokenRequestBody(e,t),o=this.createTokenRequestHeaders(),s=e.timeout?rn()+e.timeout:void 0,a=rn()+t.expiresIn,c=1e3*t.interval;for(;this.continuePolling(a,s,e.cancel);){let t={clientId:this.config.authOptions.clientId,authority:e.authority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid},r=await this.executePostToTokenEndpoint(n,i,o,t,e.correlationId);if(!r.body||!r.body.error)return this.logger.verbose("Authorization completed successfully. Polling stopped."),r.body;if(r.body.error===D.AUTHORIZATION_PENDING)this.logger.info("Authorization pending. Continue polling."),await function(e,t){return new Promise(t=>setTimeout(()=>t(void 0),e))}(c);else{var l;throw this.logger.info("Unexpected error in polling from the server"),new ew(ev,(l=r.body.error)?`${eS[ev]} ${l}`:eS[ev])}}throw this.logger.error("Polling stopped for unknown reasons."),tY(tw)}createTokenRequestBody(e,t){let r=new Map;return rY(r,e.scopes),rW(r,this.config.authOptions.clientId),r9(r,G.DEVICE_CODE_GRANT),function(e,t){e.set("device_code",t)}(r,t.deviceCode),r1(r,e.correlationId||this.config.cryptoInterface.createNewGuid()),r7(r),r2(r,this.config.libraryInfo),r3(r,this.config.telemetry.application),no(r),this.serverTelemetryManager&&ni(r,this.serverTelemetryManager),(!tt.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r0(r,e.claims,this.config.authOptions.clientCapabilities),tQ(r)}}class iE extends im{constructor(e){super(e),this.config.broker.nativeBrokerPlugin&&(this.config.broker.nativeBrokerPlugin.isBrokerAvailable?(this.nativeBrokerPlugin=this.config.broker.nativeBrokerPlugin,this.nativeBrokerPlugin.setLogger(this.config.system.loggerOptions)):this.logger.warning("NativeBroker implementation was provided but the broker is unavailable.")),this.skus=eb.makeExtraSkuString({libraryName:eT.MSAL_SKU,libraryVersion:ip})}async acquireTokenByDeviceCode(e){this.logger.info("acquireTokenByDeviceCode called",e.correlationId);let t=Object.assign(e,await this.initializeBaseRequest(e)),r=this.initializeServerTelemetryManager(eE.acquireTokenByDeviceCode,t.correlationId);try{let n=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions),i=await this.buildOauthClientConfiguration(n,t.correlationId,"",r),o=new iT(i);return this.logger.verbose("Device code client created",t.correlationId),await o.acquireToken(t)}catch(e){throw e instanceof ew&&e.setCorrelationId(t.correlationId),r.cacheFailedRequest(e),e}}async acquireTokenInteractive(e){let t=e.correlationId||this.cryptoProvider.createNewGuid();this.logger.trace("acquireTokenInteractive called",t);let{openBrowser:r,successTemplate:n,errorTemplate:i,windowHandle:o,loopbackClient:s,...a}=e;if(this.nativeBrokerPlugin){let r={...a,clientId:this.config.auth.clientId,scopes:e.scopes||x,redirectUri:e.redirectUri||"",authority:e.authority||this.config.auth.authority,correlationId:t,extraParameters:{...a.extraQueryParameters,...a.tokenQueryParameters,[eN]:this.skus},accountId:a.account?.nativeAccountId};return this.nativeBrokerPlugin.acquireTokenInteractive(r,o)}if(e.redirectUri){if(!this.config.broker.nativeBrokerPlugin)throw n1.createRedirectUriNotSupportedError();e.redirectUri=""}let{verifier:c,challenge:l}=await this.cryptoProvider.generatePkceCodes(),u=s||new iy,d={},h=null;try{let o=u.listenForAuthCode(n,i).then(e=>{d=e}).catch(e=>{h=e}),s=await this.waitForRedirectUri(u),p={...a,correlationId:t,scopes:e.scopes||x,redirectUri:s,responseMode:z.QUERY,codeChallenge:l,codeChallengeMethod:j.S256},f=await this.getAuthCodeUrl(p);if(await r(f),await o,h)throw h;if(d.error)throw new ex(d.error,d.error_description,d.suberror);if(!d.code)throw n1.createNoAuthCodeInResponseError();let g=d.client_info,m={code:d.code,codeVerifier:c,clientInfo:g||D.EMPTY_STRING,...p};return await this.acquireTokenByCode(m)}finally{u.closeServer()}}async acquireTokenSilent(e){let t=e.correlationId||this.cryptoProvider.createNewGuid();if(this.logger.trace("acquireTokenSilent called",t),this.nativeBrokerPlugin){let r={...e,clientId:this.config.auth.clientId,scopes:e.scopes||x,redirectUri:e.redirectUri||"",authority:e.authority||this.config.auth.authority,correlationId:t,extraParameters:{...e.tokenQueryParameters,[eN]:this.skus},accountId:e.account.nativeAccountId,forceRefresh:e.forceRefresh||!1};return this.nativeBrokerPlugin.acquireTokenSilent(r)}if(e.redirectUri){if(!this.config.broker.nativeBrokerPlugin)throw n1.createRedirectUriNotSupportedError();e.redirectUri=""}return super.acquireTokenSilent(e)}async signOut(e){if(this.nativeBrokerPlugin&&e.account.nativeAccountId){let t={clientId:this.config.auth.clientId,accountId:e.account.nativeAccountId,correlationId:e.correlationId||this.cryptoProvider.createNewGuid()};await this.nativeBrokerPlugin.signOut(t)}await this.getTokenCache().removeAccount(e.account,e.correlationId)}async getAllAccounts(){if(this.nativeBrokerPlugin){let e=this.cryptoProvider.createNewGuid();return this.nativeBrokerPlugin.getAllAccounts(this.config.auth.clientId,e)}return this.getTokenCache().getAllAccounts()}async waitForRedirectUri(e){return new Promise((t,r)=>{let n=0,i=setInterval(()=>{if(eA.TIMEOUT_MS/eA.INTERVAL_MS<n){clearInterval(i),r(n1.createLoopbackServerTimeoutError());return}try{let r=e.getRedirectUri();clearInterval(i),t(r);return}catch(e){if(e instanceof ew&&e.errorCode===n0.noLoopbackServerExists.code){n++;return}clearInterval(i),r(e);return}},eA.INTERVAL_MS)})}}class iC extends nd{constructor(e,t){super(e),this.appTokenProvider=t}async acquireToken(e){if(e.skipCache||e.claims)return this.executeTokenRequest(e,this.authority);let[t,r]=await this.getCachedAuthenticationResult(e,this.config,this.cryptoUtils,this.authority,this.cacheManager,this.serverTelemetryManager);return t?(r===eo.PROACTIVELY_REFRESHED&&(this.logger.info("ClientCredentialClient:getCachedAuthenticationResult - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),await this.executeTokenRequest(e,this.authority,!0)),t):this.executeTokenRequest(e,this.authority)}async getCachedAuthenticationResult(e,t,r,n,i,o){let s;let a=eo.NOT_APPLICABLE;t.serializableCache&&t.persistencePlugin&&(s=new nw(t.serializableCache,!1),await t.persistencePlugin.beforeCacheAccess(s));let c=this.readAccessTokenFromCache(n,t.managedIdentityId?.id||t.authOptions.clientId,new rC(e.scopes||[]),i,e.correlationId);return(t.serializableCache&&t.persistencePlugin&&s&&await t.persistencePlugin.afterCacheAccess(s),c)?ro(c.expiresOn,t.systemOptions?.tokenRenewalOffsetSeconds||300)?(o?.setCacheOutcome(eo.CACHED_ACCESS_TOKEN_EXPIRED),[null,eo.CACHED_ACCESS_TOKEN_EXPIRED]):(c.refreshOn&&ro(c.refreshOn.toString(),0)&&(a=eo.PROACTIVELY_REFRESHED,o?.setCacheOutcome(eo.PROACTIVELY_REFRESHED)),[await nb.generateAuthenticationResult(r,n,{account:null,idToken:null,accessToken:c,refreshToken:null,appMetadata:null},!0,e),a]):(o?.setCacheOutcome(eo.NO_CACHED_ACCESS_TOKEN),[null,eo.NO_CACHED_ACCESS_TOKEN])}readAccessTokenFromCache(e,t,r,n,i){let o={homeAccountId:D.EMPTY_STRING,environment:e.canonicalAuthorityUrlComponents.HostNameAndPort,credentialType:Y.ACCESS_TOKEN,clientId:t,realm:e.tenant,target:rC.createSearchScopes(r.asArray())},s=n.getAccessTokensByFilter(o,i);if(s.length<1)return null;if(s.length>1)throw tY(tm);return s[0]}async executeTokenRequest(e,t,r){let n,i;if(this.appTokenProvider){this.logger.info("Using appTokenProvider extensibility.");let t={correlationId:e.correlationId,tenantId:this.config.authOptions.authority.tenant,scopes:e.scopes,claims:e.claims};i=rn();let r=await this.appTokenProvider(t);n={access_token:r.accessToken,expires_in:r.expiresInSeconds,refresh_in:r.refreshInSeconds,token_type:X.BEARER}}else{let r=this.createTokenQueryParameters(e),o=tJ.appendQueryString(t.tokenEndpoint,r),s=await this.createTokenRequestBody(e),a=this.createTokenRequestHeaders(),c={clientId:this.config.authOptions.clientId,authority:e.authority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};this.logger.info("Sending token request to endpoint: "+t.tokenEndpoint),i=rn();let l=await this.executePostToTokenEndpoint(o,s,a,c,e.correlationId);(n=l.body).status=l.status}let o=new nb(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return o.validateTokenResponse(n,r),await o.handleServerTokenResponse(n,this.authority,i,e)}async createTokenRequestBody(e){let t=new Map;rW(t,this.config.authOptions.clientId),rY(t,e.scopes,!1),r9(t,G.CLIENT_CREDENTIALS_GRANT),r2(t,this.config.libraryInfo),r3(t,this.config.telemetry.application),no(t),this.serverTelemetryManager&&ni(t,this.serverTelemetryManager),r1(t,e.correlationId||this.config.cryptoInterface.createNewGuid()),this.config.clientCredentials.clientSecret&&r5(t,this.config.clientCredentials.clientSecret);let r=e.clientAssertion||this.config.clientCredentials.clientAssertion;return r&&(r4(t,await nR(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),r8(t,r.assertionType)),(!tt.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r0(t,e.claims,this.config.authOptions.clientCapabilities),tQ(t)}}class iA extends nd{constructor(e){super(e)}async acquireToken(e){if(this.scopeSet=new rC(e.scopes||[]),this.userAssertionHash=await this.cryptoUtils.hashString(e.oboAssertion),e.skipCache||e.claims)return this.executeTokenRequest(e,this.authority,this.userAssertionHash);try{return await this.getCachedAuthenticationResult(e)}catch(t){return await this.executeTokenRequest(e,this.authority,this.userAssertionHash)}}async getCachedAuthenticationResult(e){let t;let r=this.readAccessTokenFromCacheForOBO(this.config.authOptions.clientId,e);if(r){if(ro(r.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.serverTelemetryManager?.setCacheOutcome(eo.CACHED_ACCESS_TOKEN_EXPIRED),this.logger.info(`OnbehalfofFlow:getCachedAuthenticationResult - Cached access token is expired or will expire within ${this.config.systemOptions.tokenRenewalOffsetSeconds} seconds.`),tY(tD)}else throw this.serverTelemetryManager?.setCacheOutcome(eo.NO_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - No access token found in cache for the given properties."),tY(tD);let n=this.readIdTokenFromCacheForOBO(r.homeAccountId,e.correlationId),i=null;if(n){let r=(t=rt(n.secret,n7.base64Decode)).oid||t.sub,o={homeAccountId:n.homeAccountId,environment:n.environment,tenantId:n.realm,username:D.EMPTY_STRING,localAccountId:r||D.EMPTY_STRING};i=this.cacheManager.getAccount(this.cacheManager.generateAccountKey(o),e.correlationId)}return this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),nb.generateAuthenticationResult(this.cryptoUtils,this.authority,{account:i,accessToken:r,idToken:n,refreshToken:null,appMetadata:null},!0,e,t)}readIdTokenFromCacheForOBO(e,t){let r={homeAccountId:e,environment:this.authority.canonicalAuthorityUrlComponents.HostNameAndPort,credentialType:Y.ID_TOKEN,clientId:this.config.authOptions.clientId,realm:this.authority.tenant},n=this.cacheManager.getIdTokensByFilter(r,t);return Object.values(n).length<1?null:Object.values(n)[0]}readAccessTokenFromCacheForOBO(e,t){let r=t.authenticationScheme||X.BEARER,n={credentialType:r&&r.toLowerCase()!==X.BEARER.toLowerCase()?Y.ACCESS_TOKEN_WITH_AUTH_SCHEME:Y.ACCESS_TOKEN,clientId:e,target:rC.createSearchScopes(this.scopeSet.asArray()),tokenType:r,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash,userAssertionHash:this.userAssertionHash},i=this.cacheManager.getAccessTokensByFilter(n,t.correlationId),o=i.length;if(o<1)return null;if(o>1)throw tY(tm);return i[0]}async executeTokenRequest(e,t,r){let n=this.createTokenQueryParameters(e),i=tJ.appendQueryString(t.tokenEndpoint,n),o=await this.createTokenRequestBody(e),s=this.createTokenRequestHeaders(),a={clientId:this.config.authOptions.clientId,authority:e.authority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid},c=rn(),l=await this.executePostToTokenEndpoint(i,o,s,a,e.correlationId),u=new nb(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return u.validateTokenResponse(l.body),await u.handleServerTokenResponse(l.body,this.authority,c,e,void 0,r)}async createTokenRequestBody(e){let t=new Map;rW(t,this.config.authOptions.clientId),rY(t,e.scopes),r9(t,G.JWT_BEARER),r7(t),r2(t,this.config.libraryInfo),r3(t,this.config.telemetry.application),no(t),this.serverTelemetryManager&&ni(t,this.serverTelemetryManager),r1(t,e.correlationId||this.config.cryptoInterface.createNewGuid()),function(e,t){e.set("requested_token_use",t)}(t,"on_behalf_of"),function(e,t){e.set("assertion",t)}(t,e.oboAssertion),this.config.clientCredentials.clientSecret&&r5(t,this.config.clientCredentials.clientSecret);let r=this.config.clientCredentials.clientAssertion;return r&&(r4(t,await nR(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),r8(t,r.assertionType)),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r0(t,e.claims,this.config.authOptions.clientCapabilities),tQ(t)}}class iI extends im{constructor(e){super(e);let t=!!this.config.auth.clientSecret,r=!!this.config.auth.clientAssertion,n=(!!this.config.auth.clientCertificate?.thumbprint||!!this.config.auth.clientCertificate?.thumbprintSha256)&&!!this.config.auth.clientCertificate?.privateKey;if(this.appTokenProvider)return;if(t&&r||r&&n||t&&n)throw tY(tM);if(this.config.auth.clientSecret){this.clientSecret=this.config.auth.clientSecret;return}if(this.config.auth.clientAssertion){this.developerProvidedClientAssertion=this.config.auth.clientAssertion;return}if(n)this.clientAssertion=this.config.auth.clientCertificate.thumbprintSha256?id.fromCertificateWithSha256Thumbprint(this.config.auth.clientCertificate.thumbprintSha256,this.config.auth.clientCertificate.privateKey,this.config.auth.clientCertificate.x5c):id.fromCertificate(this.config.auth.clientCertificate.thumbprint,this.config.auth.clientCertificate.privateKey,this.config.auth.clientCertificate.x5c);else throw tY(tM);this.appTokenProvider=void 0}SetAppTokenProvider(e){this.appTokenProvider=e}async acquireTokenByClientCredential(e){let t,r;this.logger.info("acquireTokenByClientCredential called",e.correlationId),e.clientAssertion&&(t={assertion:await nR(e.clientAssertion,this.config.auth.clientId),assertionType:eT.JWT_BEARER_ASSERTION_TYPE});let n=await this.initializeBaseRequest(e),i={...n,scopes:n.scopes.filter(e=>!x.includes(e))},o={...e,...i,clientAssertion:t},s=new tJ(o.authority).getUrlComponents().PathSegments[0];if(Object.values(L).includes(s))throw tY(tB);let a=process.env.MSAL_FORCE_REGION;"DisableMsalForceRegion"!==o.azureRegion&&(r=!o.azureRegion&&a?a:o.azureRegion);let c={azureRegion:r,environmentRegion:process.env.REGION_NAME},l=this.initializeServerTelemetryManager(eE.acquireTokenByClientCredential,o.correlationId,o.skipCache);try{let t=await this.createAuthority(o.authority,o.correlationId,c,e.azureCloudOptions),r=await this.buildOauthClientConfiguration(t,o.correlationId,"",l),n=new iC(r,this.appTokenProvider);return this.logger.verbose("Client credential client created",o.correlationId),await n.acquireToken(o)}catch(e){throw e instanceof ew&&e.setCorrelationId(o.correlationId),l.cacheFailedRequest(e),e}}async acquireTokenOnBehalfOf(e){this.logger.info("acquireTokenOnBehalfOf called",e.correlationId);let t={...e,...await this.initializeBaseRequest(e)};try{let r=await this.createAuthority(t.authority,t.correlationId,void 0,e.azureCloudOptions),n=await this.buildOauthClientConfiguration(r,t.correlationId,"",void 0),i=new iA(n);return this.logger.verbose("On behalf of client created",t.correlationId),await i.acquireToken(t)}catch(e){throw e instanceof ew&&e.setCorrelationId(t.correlationId),e}}}class iv{constructor(e,t,r){this.httpClientNoRetries=e,this.retryPolicy=t,this.logger=r}async sendNetworkRequestAsyncHelper(e,t,r){return e===ep.GET?this.httpClientNoRetries.sendGetRequestAsync(t,r):this.httpClientNoRetries.sendPostRequestAsync(t,r)}async sendNetworkRequestAsync(e,t,r){let n=await this.sendNetworkRequestAsyncHelper(e,t,r);"isNewRequest"in this.retryPolicy&&(this.retryPolicy.isNewRequest=!0);let i=0;for(;await this.retryPolicy.pauseForRetry(n.status,i,this.logger,n.headers[q.RETRY_AFTER]);)n=await this.sendNetworkRequestAsyncHelper(e,t,r),i++;return n}async sendGetRequestAsync(e,t){return this.sendNetworkRequestAsync(ep.GET,e,t)}async sendPostRequestAsync(e,t){return this.sendNetworkRequestAsync(ep.POST,e,t)}}let iS={MANAGED_IDENTITY_CLIENT_ID_2017:"clientid",MANAGED_IDENTITY_CLIENT_ID:"client_id",MANAGED_IDENTITY_OBJECT_ID:"object_id",MANAGED_IDENTITY_RESOURCE_ID_IMDS:"msi_res_id",MANAGED_IDENTITY_RESOURCE_ID_NON_IMDS:"mi_res_id"};class iw{constructor(e,t,r,n,i){this.logger=e,this.nodeStorage=t,this.networkClient=r,this.cryptoProvider=n,this.disableInternalRetries=i}async getServerTokenResponseAsync(e,t,r,n){return this.getServerTokenResponse(e)}getServerTokenResponse(e){let t,r;return e.body.expires_on&&(function(e){if("string"!=typeof e)return!1;let t=new Date(e);return!isNaN(t.getTime())&&t.toISOString()===e}(e.body.expires_on)&&(e.body.expires_on=new Date(e.body.expires_on).getTime()/1e3),(r=e.body.expires_on-rn())>7200&&(t=r/2)),{status:e.status,access_token:e.body.access_token,expires_in:r,scope:e.body.resource,token_type:e.body.token_type,refresh_in:t,correlation_id:e.body.correlation_id||e.body.correlationId,error:"string"==typeof e.body.error?e.body.error:e.body.error?.code,error_description:e.body.message||("string"==typeof e.body.error?e.body.error_description:e.body.error?.message),error_codes:e.body.error_codes,timestamp:e.body.timestamp,trace_id:e.body.trace_id}}async acquireTokenWithManagedIdentity(e,t,r,n){let i;let o=this.createRequest(e.resource,t);if(e.revokedTokenSha256Hash&&(this.logger.info(`[Managed Identity] The following claims are present in the request: ${e.claims}`),o.queryParameters[el.SHA256_TOKEN_TO_REFRESH]=e.revokedTokenSha256Hash),e.clientCapabilities?.length){let t=e.clientCapabilities.toString();this.logger.info(`[Managed Identity] The following client capabilities are present in the request: ${t}`),o.queryParameters[el.XMS_CC]=t}let s=o.headers;s[q.CONTENT_TYPE]=D.URL_FORM_CONTENT_TYPE;let a={headers:s};Object.keys(o.bodyParameters).length&&(a.body=o.computeParametersBodyString());let c=this.disableInternalRetries?this.networkClient:new iv(this.networkClient,o.retryPolicy,this.logger),l=rn();try{i=o.httpMethod===ep.POST?await c.sendPostRequestAsync(o.computeUri(),a):await c.sendGetRequestAsync(o.computeUri(),a)}catch(e){if(e instanceof ew)throw e;throw tY(ta)}let u=new nb(t.id,this.nodeStorage,this.cryptoProvider,this.logger,null,null),d=await this.getServerTokenResponseAsync(i,c,o,a);return u.validateTokenResponse(d,n),u.handleServerTokenResponse(d,r,l,e)}getManagedIdentityUserAssignedIdQueryParameterKey(e,t,r){switch(e){case eh.USER_ASSIGNED_CLIENT_ID:return this.logger.info(`[Managed Identity] [API version ${r?"2017+":"2019+"}] Adding user assigned client id to the request.`),r?iS.MANAGED_IDENTITY_CLIENT_ID_2017:iS.MANAGED_IDENTITY_CLIENT_ID;case eh.USER_ASSIGNED_RESOURCE_ID:return this.logger.info("[Managed Identity] Adding user assigned resource id to the request."),t?iS.MANAGED_IDENTITY_RESOURCE_ID_IMDS:iS.MANAGED_IDENTITY_RESOURCE_ID_NON_IMDS;case eh.USER_ASSIGNED_OBJECT_ID:return this.logger.info("[Managed Identity] Adding user assigned object id to the request."),iS.MANAGED_IDENTITY_OBJECT_ID;default:throw nZ(nF)}}}iw.getValidatedEnvVariableUrlString=(e,t,r,n)=>{try{return new tJ(t).urlString}catch(t){throw n.info(`[Managed Identity] ${r} managed identity is unavailable because the '${e}' environment variable is malformed.`),nZ(nW[e])}};class ib{calculateDelay(e,t){if(!e)return t;let r=Math.round(1e3*parseFloat(e));return isNaN(r)&&(r=new Date(e).valueOf()-new Date().valueOf()),Math.max(t,r)}}let iR=[U.NOT_FOUND,U.REQUEST_TIMEOUT,U.TOO_MANY_REQUESTS,U.SERVER_ERROR,U.SERVICE_UNAVAILABLE,U.GATEWAY_TIMEOUT];class i_{constructor(){this.linearRetryStrategy=new ib}static get DEFAULT_MANAGED_IDENTITY_RETRY_DELAY_MS(){return 1e3}async pauseForRetry(e,t,r,n){if(iR.includes(e)&&t<3){let e=this.linearRetryStrategy.calculateDelay(n,i_.DEFAULT_MANAGED_IDENTITY_RETRY_DELAY_MS);return r.verbose(`Retrying request in ${e}ms (retry attempt: ${t+1})`),await new Promise(t=>setTimeout(t,e)),!0}return!1}}class ik{constructor(e,t,r){this.httpMethod=e,this._baseEndpoint=t,this.headers={},this.bodyParameters={},this.queryParameters={},this.retryPolicy=r||new i_}computeUri(){let e=new Map;this.queryParameters&&nt(e,this.queryParameters);let t=tQ(e);return tJ.appendQueryString(this._baseEndpoint,t)}computeParametersBodyString(){let e=new Map;return this.bodyParameters&&nt(e,this.bodyParameters),tQ(e)}}class iO extends iw{constructor(e,t,r,n,i,o,s){super(e,t,r,n,i),this.identityEndpoint=o,this.identityHeader=s}static getEnvironmentVariables(){return[process.env[eu.IDENTITY_ENDPOINT],process.env[eu.IDENTITY_HEADER]]}static tryCreate(e,t,r,n,i){let[o,s]=iO.getEnvironmentVariables();if(!o||!s)return e.info(`[Managed Identity] ${ed.APP_SERVICE} managed identity is unavailable because one or both of the '${eu.IDENTITY_HEADER}' and '${eu.IDENTITY_ENDPOINT}' environment variables are not defined.`),null;let a=iO.getValidatedEnvVariableUrlString(eu.IDENTITY_ENDPOINT,o,ed.APP_SERVICE,e);return e.info(`[Managed Identity] Environment variables validation passed for ${ed.APP_SERVICE} managed identity. Endpoint URI: ${a}. Creating ${ed.APP_SERVICE} managed identity.`),new iO(e,t,r,n,i,o,s)}createRequest(e,t){let r=new ik(ep.GET,this.identityEndpoint);return r.headers[ec.APP_SERVICE_SECRET_HEADER_NAME]=this.identityHeader,r.queryParameters[el.API_VERSION]="2019-08-01",r.queryParameters[el.RESOURCE]=e,t.idType!==eh.SYSTEM_ASSIGNED&&(r.queryParameters[this.getManagedIdentityUserAssignedIdQueryParameterKey(t.idType)]=t.id),r}}var iP=r(92048),iN=r(55315);let iM="http://127.0.0.1:40342/metadata/identity/oauth2/token",iD="N/A: himds executable exists",iU={win32:`${process.env.ProgramData}\\AzureConnectedMachineAgent\\Tokens\\`,linux:"/var/opt/azcmagent/tokens/"},ix={win32:`${process.env.ProgramFiles}\\AzureConnectedMachineAgent\\himds.exe`,linux:"/opt/azcmagent/bin/himds"};class i$ extends iw{constructor(e,t,r,n,i,o){super(e,t,r,n,i),this.identityEndpoint=o}static getEnvironmentVariables(){let e=process.env[eu.IDENTITY_ENDPOINT],t=process.env[eu.IMDS_ENDPOINT];if(!e||!t){let r=ix[process.platform];try{(0,iP.accessSync)(r,iP.constants.F_OK|iP.constants.R_OK),e=iM,t=iD}catch(e){}}return[e,t]}static tryCreate(e,t,r,n,i,o){let[s,a]=i$.getEnvironmentVariables();if(!s||!a)return e.info(`[Managed Identity] ${ed.AZURE_ARC} managed identity is unavailable through environment variables because one or both of '${eu.IDENTITY_ENDPOINT}' and '${eu.IMDS_ENDPOINT}' are not defined. ${ed.AZURE_ARC} managed identity is also unavailable through file detection.`),null;if(a===iD)e.info(`[Managed Identity] ${ed.AZURE_ARC} managed identity is available through file detection. Defaulting to known ${ed.AZURE_ARC} endpoint: ${iM}. Creating ${ed.AZURE_ARC} managed identity.`);else{let t=i$.getValidatedEnvVariableUrlString(eu.IDENTITY_ENDPOINT,s,ed.AZURE_ARC,e);t.endsWith("/")&&t.slice(0,-1),i$.getValidatedEnvVariableUrlString(eu.IMDS_ENDPOINT,a,ed.AZURE_ARC,e),e.info(`[Managed Identity] Environment variables validation passed for ${ed.AZURE_ARC} managed identity. Endpoint URI: ${t}. Creating ${ed.AZURE_ARC} managed identity.`)}if(o.idType!==eh.SYSTEM_ASSIGNED)throw nZ(nB);return new i$(e,t,r,n,i,s)}createRequest(e){let t=new ik(ep.GET,this.identityEndpoint.replace("localhost","127.0.0.1"));return t.headers[ec.METADATA_HEADER_NAME]="true",t.queryParameters[el.API_VERSION]="2019-11-01",t.queryParameters[el.RESOURCE]=e,t}async getServerTokenResponseAsync(e,t,r,n){let i;if(e.status===U.UNAUTHORIZED){let o,s;let a=e.headers["www-authenticate"];if(!a)throw nZ(nK);if(!a.includes("Basic realm="))throw nZ(nY);let c=a.split("Basic realm=")[1];if(!iU.hasOwnProperty(process.platform))throw nZ(nj);let l=iU[process.platform],u=iN.basename(c);if(!u.endsWith(".key"))throw nZ(nq);if(l+u!==c)throw nZ(nL);try{o=await (0,iP.statSync)(c).size}catch(e){throw nZ(nV)}if(o>4096)throw nZ(nH);try{s=(0,iP.readFileSync)(c,es.UTF8)}catch(e){throw nZ(nV)}let d=`Basic ${s}`;this.logger.info("[Managed Identity] Adding authorization header to the request."),r.headers[ec.AUTHORIZATION_HEADER_NAME]=d;try{i=await t.sendGetRequestAsync(r.computeUri(),n)}catch(e){if(e instanceof ew)throw e;throw tY(ta)}}return this.getServerTokenResponse(i||e)}}class iq extends iw{constructor(e,t,r,n,i,o){super(e,t,r,n,i),this.msiEndpoint=o}static getEnvironmentVariables(){return[process.env[eu.MSI_ENDPOINT]]}static tryCreate(e,t,r,n,i,o){let[s]=iq.getEnvironmentVariables();if(!s)return e.info(`[Managed Identity] ${ed.CLOUD_SHELL} managed identity is unavailable because the '${eu.MSI_ENDPOINT} environment variable is not defined.`),null;let a=iq.getValidatedEnvVariableUrlString(eu.MSI_ENDPOINT,s,ed.CLOUD_SHELL,e);if(e.info(`[Managed Identity] Environment variable validation passed for ${ed.CLOUD_SHELL} managed identity. Endpoint URI: ${a}. Creating ${ed.CLOUD_SHELL} managed identity.`),o.idType!==eh.SYSTEM_ASSIGNED)throw nZ(nz);return new iq(e,t,r,n,i,s)}createRequest(e){let t=new ik(ep.POST,this.msiEndpoint);return t.headers[ec.METADATA_HEADER_NAME]="true",t.bodyParameters[el.RESOURCE]=e,t}}class iL{constructor(e,t,r){this.minExponentialBackoff=e,this.maxExponentialBackoff=t,this.exponentialDeltaBackoff=r}calculateDelay(e){return 0===e?this.minExponentialBackoff:Math.min(Math.pow(2,e-1)*this.exponentialDeltaBackoff,this.maxExponentialBackoff)}}let iF=[U.NOT_FOUND,U.REQUEST_TIMEOUT,U.GONE,U.TOO_MANY_REQUESTS];class iH{constructor(){this.exponentialRetryStrategy=new iL(iH.MIN_EXPONENTIAL_BACKOFF_MS,iH.MAX_EXPONENTIAL_BACKOFF_MS,iH.EXPONENTIAL_DELTA_BACKOFF_MS)}static get MIN_EXPONENTIAL_BACKOFF_MS(){return 1e3}static get MAX_EXPONENTIAL_BACKOFF_MS(){return 4e3}static get EXPONENTIAL_DELTA_BACKOFF_MS(){return 2e3}static get HTTP_STATUS_GONE_RETRY_AFTER_MS(){return 1e4}set isNewRequest(e){this._isNewRequest=e}async pauseForRetry(e,t,r){if(this._isNewRequest&&(this._isNewRequest=!1,this.maxRetries=e===U.GONE?7:3),(iF.includes(e)||e>=U.SERVER_ERROR_RANGE_START&&e<=U.SERVER_ERROR_RANGE_END&&t<this.maxRetries)&&t<this.maxRetries){let n=e===U.GONE?iH.HTTP_STATUS_GONE_RETRY_AFTER_MS:this.exponentialRetryStrategy.calculateDelay(t);return r.verbose(`Retrying request in ${n}ms (retry attempt: ${t+1})`),await new Promise(e=>setTimeout(e,n)),!0}return!1}}let ij="/metadata/identity/oauth2/token",iB=`http://169.254.169.254${ij}`;class iz extends iw{constructor(e,t,r,n,i,o){super(e,t,r,n,i),this.identityEndpoint=o}static tryCreate(e,t,r,n,i){let o;return process.env[eu.AZURE_POD_IDENTITY_AUTHORITY_HOST]?(e.info(`[Managed Identity] Environment variable ${eu.AZURE_POD_IDENTITY_AUTHORITY_HOST} for ${ed.IMDS} returned endpoint: ${process.env[eu.AZURE_POD_IDENTITY_AUTHORITY_HOST]}`),o=iz.getValidatedEnvVariableUrlString(eu.AZURE_POD_IDENTITY_AUTHORITY_HOST,`${process.env[eu.AZURE_POD_IDENTITY_AUTHORITY_HOST]}${ij}`,ed.IMDS,e)):(e.info(`[Managed Identity] Unable to find ${eu.AZURE_POD_IDENTITY_AUTHORITY_HOST} environment variable for ${ed.IMDS}, using the default endpoint.`),o=iB),new iz(e,t,r,n,i,o)}createRequest(e,t){let r=new ik(ep.GET,this.identityEndpoint);return r.headers[ec.METADATA_HEADER_NAME]="true",r.queryParameters[el.API_VERSION]="2018-02-01",r.queryParameters[el.RESOURCE]=e,t.idType!==eh.SYSTEM_ASSIGNED&&(r.queryParameters[this.getManagedIdentityUserAssignedIdQueryParameterKey(t.idType,!0)]=t.id),r.retryPolicy=new iH,r}}class iG extends iw{constructor(e,t,r,n,i,o,s){super(e,t,r,n,i),this.identityEndpoint=o,this.identityHeader=s}static getEnvironmentVariables(){return[process.env[eu.IDENTITY_ENDPOINT],process.env[eu.IDENTITY_HEADER],process.env[eu.IDENTITY_SERVER_THUMBPRINT]]}static tryCreate(e,t,r,n,i,o){let[s,a,c]=iG.getEnvironmentVariables();if(!s||!a||!c)return e.info(`[Managed Identity] ${ed.SERVICE_FABRIC} managed identity is unavailable because one or all of the '${eu.IDENTITY_HEADER}', '${eu.IDENTITY_ENDPOINT}' or '${eu.IDENTITY_SERVER_THUMBPRINT}' environment variables are not defined.`),null;let l=iG.getValidatedEnvVariableUrlString(eu.IDENTITY_ENDPOINT,s,ed.SERVICE_FABRIC,e);return e.info(`[Managed Identity] Environment variables validation passed for ${ed.SERVICE_FABRIC} managed identity. Endpoint URI: ${l}. Creating ${ed.SERVICE_FABRIC} managed identity.`),o.idType!==eh.SYSTEM_ASSIGNED&&e.warning(`[Managed Identity] ${ed.SERVICE_FABRIC} user assigned managed identity is configured in the cluster, not during runtime. See also: https://learn.microsoft.com/en-us/azure/service-fabric/configure-existing-cluster-enable-managed-identity-token-service.`),new iG(e,t,r,n,i,s,a)}createRequest(e,t){let r=new ik(ep.GET,this.identityEndpoint);return r.headers[ec.ML_AND_SF_SECRET_HEADER_NAME]=this.identityHeader,r.queryParameters[el.API_VERSION]="2019-07-01-preview",r.queryParameters[el.RESOURCE]=e,t.idType!==eh.SYSTEM_ASSIGNED&&(r.queryParameters[this.getManagedIdentityUserAssignedIdQueryParameterKey(t.idType)]=t.id),r}}let iV=`Only client id is supported for user-assigned managed identity in ${ed.MACHINE_LEARNING}.`;class iK extends iw{constructor(e,t,r,n,i,o,s){super(e,t,r,n,i),this.msiEndpoint=o,this.secret=s}static getEnvironmentVariables(){return[process.env[eu.MSI_ENDPOINT],process.env[eu.MSI_SECRET]]}static tryCreate(e,t,r,n,i){let[o,s]=iK.getEnvironmentVariables();if(!o||!s)return e.info(`[Managed Identity] ${ed.MACHINE_LEARNING} managed identity is unavailable because one or both of the '${eu.MSI_ENDPOINT}' and '${eu.MSI_SECRET}' environment variables are not defined.`),null;let a=iK.getValidatedEnvVariableUrlString(eu.MSI_ENDPOINT,o,ed.MACHINE_LEARNING,e);return e.info(`[Managed Identity] Environment variables validation passed for ${ed.MACHINE_LEARNING} managed identity. Endpoint URI: ${a}. Creating ${ed.MACHINE_LEARNING} managed identity.`),new iK(e,t,r,n,i,o,s)}createRequest(e,t){let r=new ik(ep.GET,this.msiEndpoint);if(r.headers[ec.METADATA_HEADER_NAME]="true",r.headers[ec.ML_AND_SF_SECRET_HEADER_NAME]=this.secret,r.queryParameters[el.API_VERSION]="2017-09-01",r.queryParameters[el.RESOURCE]=e,t.idType===eh.SYSTEM_ASSIGNED)r.queryParameters[iS.MANAGED_IDENTITY_CLIENT_ID_2017]=process.env[eu.DEFAULT_IDENTITY_CLIENT_ID];else if(t.idType===eh.USER_ASSIGNED_CLIENT_ID)r.queryParameters[this.getManagedIdentityUserAssignedIdQueryParameterKey(t.idType,!1,!0)]=t.id;else throw Error(iV);return r}}class iY{constructor(e,t,r,n,i){this.logger=e,this.nodeStorage=t,this.networkClient=r,this.cryptoProvider=n,this.disableInternalRetries=i}async sendManagedIdentityTokenRequest(e,t,r,n){return iY.identitySource||(iY.identitySource=this.selectManagedIdentitySource(this.logger,this.nodeStorage,this.networkClient,this.cryptoProvider,this.disableInternalRetries,t)),iY.identitySource.acquireTokenWithManagedIdentity(e,t,r,n)}allEnvironmentVariablesAreDefined(e){return Object.values(e).every(e=>void 0!==e)}getManagedIdentitySource(){return iY.sourceName=this.allEnvironmentVariablesAreDefined(iG.getEnvironmentVariables())?ed.SERVICE_FABRIC:this.allEnvironmentVariablesAreDefined(iO.getEnvironmentVariables())?ed.APP_SERVICE:this.allEnvironmentVariablesAreDefined(iK.getEnvironmentVariables())?ed.MACHINE_LEARNING:this.allEnvironmentVariablesAreDefined(iq.getEnvironmentVariables())?ed.CLOUD_SHELL:this.allEnvironmentVariablesAreDefined(i$.getEnvironmentVariables())?ed.AZURE_ARC:ed.DEFAULT_TO_IMDS,iY.sourceName}selectManagedIdentitySource(e,t,r,n,i,o){let s=iG.tryCreate(e,t,r,n,i,o)||iO.tryCreate(e,t,r,n,i)||iK.tryCreate(e,t,r,n,i)||iq.tryCreate(e,t,r,n,i,o)||i$.tryCreate(e,t,r,n,i,o)||iz.tryCreate(e,t,r,n,i);if(!s)throw nZ(nG);return s}}let iW=[ed.SERVICE_FABRIC];class iQ{constructor(e){this.config=function({clientCapabilities:e,managedIdentityIdParams:t,system:r}){return{clientCapabilities:e||[],managedIdentityId:new nX(t),system:{loggerOptions:r?.loggerOptions||n6,networkClient:r?.networkClient?r.networkClient:new nD(r?.proxyUrl,r?.customAgentOptions)},disableInternalRetries:r?.disableInternalRetries||!1}}(e||{}),this.logger=new e$(this.config.system.loggerOptions,ih,ip);let t={canonicalAuthority:D.DEFAULT_AUTHORITY};iQ.nodeStorage||(iQ.nodeStorage=new ia(this.logger,this.config.managedIdentityId.id,ry,t)),this.networkClient=this.config.system.networkClient,this.cryptoProvider=new ii;let r={protocolMode:t6.AAD,knownAuthorities:[ea],cloudDiscoveryMetadata:"",authorityMetadata:""};this.fakeAuthority=new rg(ea,this.networkClient,iQ.nodeStorage,r,this.logger,this.cryptoProvider.createNewGuid(),void 0,!0),this.fakeClientCredentialClient=new iC({authOptions:{clientId:this.config.managedIdentityId.id,authority:this.fakeAuthority}}),this.managedIdentityClient=new iY(this.logger,iQ.nodeStorage,this.networkClient,this.cryptoProvider,this.config.disableInternalRetries),this.hashUtils=new it}async acquireToken(e){if(!e.resource)throw te(eB);let t={forceRefresh:e.forceRefresh,resource:e.resource.replace("/.default",""),scopes:[e.resource.replace("/.default","")],authority:this.fakeAuthority.canonicalAuthority,correlationId:this.cryptoProvider.createNewGuid(),claims:e.claims,clientCapabilities:this.config.clientCapabilities};if(t.forceRefresh)return this.acquireTokenFromManagedIdentity(t,this.config.managedIdentityId,this.fakeAuthority);let[r,n]=await this.fakeClientCredentialClient.getCachedAuthenticationResult(t,this.config,this.cryptoProvider,this.fakeAuthority,iQ.nodeStorage);if(t.claims){let e=this.managedIdentityClient.getManagedIdentitySource();if(r&&iW.includes(e)){let e=this.hashUtils.sha256(r.accessToken).toString(es.HEX);t.revokedTokenSha256Hash=e}return this.acquireTokenFromManagedIdentity(t,this.config.managedIdentityId,this.fakeAuthority)}return r?(n===eo.PROACTIVELY_REFRESHED&&(this.logger.info("ClientCredentialClient:getCachedAuthenticationResult - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),await this.acquireTokenFromManagedIdentity(t,this.config.managedIdentityId,this.fakeAuthority,!0)),r):this.acquireTokenFromManagedIdentity(t,this.config.managedIdentityId,this.fakeAuthority)}async acquireTokenFromManagedIdentity(e,t,r,n){return this.managedIdentityClient.sendManagedIdentityTokenRequest(e,t,r,n)}getManagedIdentitySource(){return iY.sourceName||this.managedIdentityClient.getManagedIdentitySource()}}var iJ=r(92356),iZ=r(19664);let iX=O("IdentityUtils");function i0(e,t,r){let n=t=>(iX.getToken.info(t),new C({scopes:Array.isArray(e)?e:[e],getTokenOptions:r,message:t}));if(!t)throw n("No response");if(!t.expiresOn)throw n('Response had no "expiresOn" property.');if(!t.accessToken)throw n('Response had no "accessToken" property.')}function i1(e){let t=e?.authorityHost;return!t&&iJ.Lr&&(t=process.env.AZURE_AUTHORITY_HOST),t??u}function i2(e,t){return(t||(t=u),RegExp(`${e}/?$`).test(t))?t:t.endsWith("/")?t+e:`${t}/${e}`}let i3=(e,t=iJ.UG?"Node":"Browser")=>(r,n,i)=>{if(!i)switch(r){case I.Error:e.info(`MSAL ${t} V2 error: ${n}`);return;case I.Info:e.info(`MSAL ${t} V2 info message: ${n}`);return;case I.Verbose:e.info(`MSAL ${t} V2 verbose message: ${n}`);return;case I.Warning:e.info(`MSAL ${t} V2 warning: ${n}`);return}};function i6(e){switch(e){case"error":return I.Error;case"info":default:return I.Info;case"verbose":return I.Verbose;case"warning":return I.Warning}}function i5(e,t,r){if("AuthError"===t.name||"ClientAuthError"===t.name||"BrowserAuthError"===t.name)switch(t.errorCode){case"endpoints_resolution_error":return iX.info(_(e,t.message)),new g(t.message);case"device_code_polling_cancelled":return new iZ._("The authentication has been aborted by the caller.");case"consent_required":case"interaction_required":case"login_required":iX.info(_(e,`Authentication returned errorCode ${t.errorCode}`));break;default:iX.info(_(e,`Failed to acquire token: ${t.message}`))}return"ClientConfigurationError"===t.name||"BrowserConfigurationAuthError"===t.name||"AbortError"===t.name||"AuthenticationError"===t.name?t:"NativeAuthError"===t.name?(iX.info(_(e,`Error from the native broker: ${t.message} with status code: ${t.statusCode}`)),t):new C({scopes:e,getTokenOptions:r,message:t.message})}function i4(e,t){return t&&e.modelMappers[t]&&e.modelMappers[t].type.polymorphicDiscriminator}let i8={Sequence:"Sequence",String:"String",Stream:"Stream"};var i9=r(18084);let i7=r(83130).S;function oe(e,t,r){let n,i=t.parameterPath,o=t.mapper;if("string"==typeof i&&(i=[i]),Array.isArray(i)){if(i.length>0){if(o.isConstant)n=o.defaultValue;else{let t=ot(e,i);!t.propertyFound&&r&&(t=ot(r,i));let s=!1;t.propertyFound||(s=o.required||"options"===i[0]&&2===i.length),n=s?o.defaultValue:t.propertyValue}}}else for(let t in o.required&&(n={}),i){let s=o.type.modelProperties[t],a=oe(e,{parameterPath:i[t],mapper:s},r);void 0!==a&&(n||(n={}),n[t]=a)}return n}function ot(e,t){let r={propertyFound:!1},n=0;for(;n<t.length;++n){let r=t[n];if(e&&r in e)e=e[r];else break}return n===t.length&&(r.propertyValue=e,r.propertyFound=!0),r}let or=Symbol.for("@azure/core-client original request");function on(e){if(or in e)return on(e[or]);let t=i7.operationRequestMap.get(e);return t||(t={},i7.operationRequestMap.set(e,t)),t}let oi=["application/json","text/json"],oo=["application/xml","application/atom+xml"];async function os(e,t,r,n,i){let o=await oa(e,t,r,n,i);if(!function(e){let t=on(e.request),r=t?.shouldDeserialize;return void 0===r||("boolean"==typeof r?r:r(e))}(o))return o;let s=on(o.request),a=s?.operationSpec;if(!a||!a.responses)return o;let c=function(e){let t;let r=on(e.request),n=r?.operationSpec;return n&&(t=r?.operationResponseGetter?r?.operationResponseGetter(n,e):n.responses[e.status]),t}(o),{error:l,shouldReturnResponse:u}=function(e,t,r,n){let i=200<=e.status&&e.status<300;if((!function(e){let t=Object.keys(e.responses);return 0===t.length||1===t.length&&"default"===t[0]}(t)?!!r:i)&&(!r||!r.isError))return{error:null,shouldReturnResponse:!1};let o=r??t.responses.default,s=e.request.streamResponseStatusCodes?.has(e.status)?`Unexpected status code: ${e.status}`:e.bodyAsText,a=new i9.oY(s,{statusCode:e.status,request:e.request,response:e});if(!o&&!(e.parsedBody?.error?.code&&e.parsedBody?.error?.message))throw a;let c=o?.bodyMapper,l=o?.headersMapper;try{if(e.parsedBody){let r;let i=e.parsedBody;if(c){let e=i;if(t.isXML&&c.type.name===i8.Sequence){e=[];let t=c.xmlElementName;"object"==typeof i&&t&&(e=i[t])}r=t.serializer.deserialize(c,e,"error.response.parsedBody",n)}let o=i.error||r||i;a.code=o.code,o.message&&(a.message=o.message),c&&(a.response.parsedBody=r)}e.headers&&l&&(a.response.parsedHeaders=t.serializer.deserialize(l,e.headers.toJSON(),"operationRes.parsedHeaders"))}catch(t){a.message=`Error "${t.message}" occurred in deserializing the responseBody - "${e.bodyAsText}" for the default response.`}return{error:a,shouldReturnResponse:!1}}(o,a,c,n);if(l)throw l;if(u)return o;if(c){if(c.bodyMapper){let e=o.parsedBody;a.isXML&&c.bodyMapper.type.name===i8.Sequence&&(e="object"==typeof e?e[c.bodyMapper.xmlElementName]:[]);try{o.parsedBody=a.serializer.deserialize(c.bodyMapper,e,"operationRes.parsedBody",n)}catch(e){throw new i9.oY(`Error ${e} occurred in deserializing the responseBody - ${o.bodyAsText}`,{statusCode:o.status,request:o.request,response:o})}}else"HEAD"===a.httpMethod&&(o.parsedBody=r.status>=200&&r.status<300);c.headersMapper&&(o.parsedHeaders=a.serializer.deserialize(c.headersMapper,o.headers.toJSON(),"operationRes.parsedHeaders",{xml:{},ignoreUnknownProperties:!0}))}return o}async function oa(e,t,r,n,i){if(!r.request.streamResponseStatusCodes?.has(r.status)&&r.bodyAsText){let o=r.bodyAsText,s=r.headers.get("Content-Type")||"",a=s?s.split(";").map(e=>e.toLowerCase()):[];try{if(0===a.length||a.some(t=>-1!==e.indexOf(t)))r.parsedBody=JSON.parse(o);else if(a.some(e=>-1!==t.indexOf(e))){if(!i)throw Error("Parsing XML not supported.");let e=await i(o,n.xml);r.parsedBody=e}}catch(n){let e=`Error "${n}" occurred while parsing the response body - ${r.bodyAsText}.`,t=n.code||i9.oY.PARSE_ERROR;throw new i9.oY(e,{code:t,statusCode:r.status,request:r.request,response:r})}}return r}function oc(e){let{parameterPath:t,mapper:r}=e;return"string"==typeof t?t:Array.isArray(t)?t.join("."):r.serializedName}function ol(e,t){var r;let n=e.parsedHeaders;if("HEAD"===e.request.method)return{...n,body:e.parsedBody};let i=t&&t.bodyMapper,o=!!i?.nullable,s=i?.type.name;if("Stream"===s)return{...n,blobBody:e.blobBody,readableStreamBody:e.readableStreamBody};let a="Composite"===s&&i.type.modelProperties||{},c=Object.keys(a).some(e=>""===a[e].serializedName);if("Sequence"===s||c){let t=e.parsedBody??[];for(let r of Object.keys(a))a[r].serializedName&&(t[r]=e.parsedBody?.[r]);if(n)for(let e of Object.keys(n))t[e]=n[e];return!o||e.parsedBody||n||0!==Object.getOwnPropertyNames(a).length?t:null}return function(e){let t={...e.headers,...e.body};return e.hasNullableType&&0===Object.getOwnPropertyNames(t).length?e.shouldWrapBody?{body:null}:null:e.shouldWrapBody?{...e.headers,body:e.body}:t}({body:e.parsedBody,headers:n,hasNullableType:o,shouldWrapBody:(r=e.parsedBody,"Composite"!==s&&"Dictionary"!==s&&("string"==typeof r||"number"==typeof r||"boolean"==typeof r||s?.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i)!==null||null==r))})}let ou={CSV:",",SSV:" ",Multi:"Multi",TSV:"	",Pipes:"|"};function od(e,t){let r=e;for(let[e,n]of t)r=r.split(e).join(n);return r}let oh=(0,S.YR)("core-client");class op{_endpoint;_requestContentType;_allowInsecureConnection;_httpClient;pipeline;constructor(e={}){if(this._requestContentType=e.requestContentType,this._endpoint=e.endpoint??e.baseUri,e.baseUri&&oh.warning("The baseUri option for SDK Clients has been deprecated, please use endpoint instead."),this._allowInsecureConnection=e.allowInsecureConnection,this._httpClient=e.httpClient||(n||(n=(0,i9.tn)()),n),this.pipeline=e.pipeline||function(e){let t=function(e){if(e.credentialScopes)return e.credentialScopes;if(e.endpoint)return`${e.endpoint}/.default`;if(e.baseUri)return`${e.baseUri}/.default`;if(e.credential&&!e.credentialScopes)throw Error("When using credentials, the ServiceClientOptions must contain either a endpoint or a credentialScopes. Unable to create a bearerTokenAuthenticationPolicy")}(e),r=e.credential&&t?{credentialScopes:t,credential:e.credential}:void 0;return function(e={}){let t=(0,i9.WA)(e??{});return e.credentialOptions&&t.addPolicy((0,i9.vA)({credential:e.credentialOptions.credential,scopes:e.credentialOptions.credentialScopes})),t.addPolicy(function(e={}){let t=e.stringifyXML;return{name:"serializationPolicy",async sendRequest(e,r){let n=on(e),i=n?.operationSpec,o=n?.operationArguments;return i&&o&&(function(e,t,r){if(r.headerParameters)for(let n of r.headerParameters){let i=oe(t,n);if(null!=i||n.mapper.required){i=r.serializer.serialize(n.mapper,i,oc(n));let t=n.mapper.headerCollectionPrefix;if(t)for(let r of Object.keys(i))e.headers.set(t+r,i[r]);else e.headers.set(n.mapper.serializedName||oc(n),i)}}let n=t.options?.requestOptions?.customHeaders;if(n)for(let t of Object.keys(n))e.headers.set(t,n[t])}(e,o,i),function(e,t,r,n=function(){throw Error("XML serialization unsupported!")}){let i=t.options?.serializerOptions,o={xml:{rootName:i?.xml.rootName??"",includeRoot:i?.xml.includeRoot??!1,xmlCharKey:i?.xml.xmlCharKey??"_"}},s=o.xml.xmlCharKey;if(r.requestBody&&r.requestBody.mapper){e.body=oe(t,r.requestBody);let i=r.requestBody.mapper,{required:a,serializedName:c,xmlName:l,xmlElementName:u,xmlNamespace:d,xmlNamespacePrefix:h,nullable:p}=i,f=i.type.name;try{if(void 0!==e.body&&null!==e.body||p&&null===e.body||a){let t=oc(r.requestBody);e.body=r.serializer.serialize(i,e.body,t,o);let a=f===i8.Stream;if(r.isXML){let t=h?`xmlns:${h}`:"xmlns",r=function(e,t,r,n,i){if(e&&!["Composite","Sequence","Dictionary"].includes(r)){let r={};return r[i.xml.xmlCharKey]=n,r.$={[t]:e},r}return n}(d,t,f,e.body,o);f===i8.Sequence?e.body=n(function(e,t,r,n){if(Array.isArray(e)||(e=[e]),!r||!n)return{[t]:e};let i={[t]:e};return i.$={[r]:n},i}(r,u||l||c,t,d),{rootName:l||c,xmlCharKey:s}):a||(e.body=n(r,{rootName:l||c,xmlCharKey:s}))}else{if(f===i8.String&&(r.contentType?.match("text/plain")||"text"===r.mediaType))return;a||(e.body=JSON.stringify(e.body))}}}catch(e){throw Error(`Error "${e.message}" occurred in serializing the payload - ${JSON.stringify(c,void 0,"  ")}.`)}}else if(r.formDataParameters&&r.formDataParameters.length>0)for(let n of(e.formData={},r.formDataParameters)){let i=oe(t,n);if(null!=i){let t=n.mapper.serializedName||oc(n);e.formData[t]=r.serializer.serialize(n.mapper,i,oc(n),o)}}}(e,o,i,t)),r(e)}}}(e.serializationOptions),{phase:"Serialize"}),t.addPolicy(function(e={}){let t=e.expectedContentTypes?.json??oi,r=e.expectedContentTypes?.xml??oo,n=e.parseXML,i=e.serializerOptions,o={xml:{rootName:i?.xml.rootName??"",includeRoot:i?.xml.includeRoot??!1,xmlCharKey:i?.xml.xmlCharKey??"_"}};return{name:"deserializationPolicy",sendRequest:async(e,i)=>os(t,r,await i(e),o,n)}}(e.deserializationOptions),{phase:"Deserialize"}),t}({...e,credentialOptions:r})}(e),e.additionalPolicies?.length)for(let{policy:t,position:r}of e.additionalPolicies){let e="perRetry"===r?"Sign":void 0;this.pipeline.addPolicy(t,{afterPhase:e})}}async sendRequest(e){return this.pipeline.sendRequest(this._httpClient,e)}async sendOperationRequest(e,t){let r=t.baseUrl||this._endpoint;if(!r)throw Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a endpoint string property that contains the base URL to use.");let n=function(e,t,r,n){let i=function(e,t,r){let n=new Map;if(e.urlParameters?.length)for(let i of e.urlParameters){let o=oe(t,i,r),s=oc(i);o=e.serializer.serialize(i.mapper,o,s),i.skipEncoding||(o=encodeURIComponent(o)),n.set(`{${i.mapper.serializedName||s}}`,o)}return n}(t,r,n),o=!1,s=od(e,i);if(t.path){let e=od(t.path,i);"/{nextLink}"===t.path&&e.startsWith("/")&&(e=e.substring(1)),e.includes("://")?(s=e,o=!0):s=function(e,t){if(!t)return e;let r=new URL(e),n=r.pathname;n.endsWith("/")||(n=`${n}/`),t.startsWith("/")&&(t=t.substring(1));let i=t.indexOf("?");if(-1!==i){let e=t.substring(0,i),o=t.substring(i+1);n+=e,o&&(r.search=r.search?`${r.search}&${o}`:o)}else n+=t;return r.pathname=n,r.toString()}(s,e)}let{queryParams:a,sequenceParams:c}=function(e,t,r){let n=new Map,i=new Set;if(e.queryParameters?.length)for(let o of e.queryParameters){"Sequence"===o.mapper.type.name&&o.mapper.serializedName&&i.add(o.mapper.serializedName);let s=oe(t,o,r);if(null!=s||o.mapper.required){s=e.serializer.serialize(o.mapper,s,oc(o));let t=o.collectionFormat?ou[o.collectionFormat]:"";if(Array.isArray(s)&&(s=s.map(e=>null==e?"":e)),"Multi"===o.collectionFormat&&0===s.length)continue;Array.isArray(s)&&("SSV"===o.collectionFormat||"TSV"===o.collectionFormat)&&(s=s.join(t)),o.skipEncoding||(s=Array.isArray(s)?s.map(e=>encodeURIComponent(e)):encodeURIComponent(s)),Array.isArray(s)&&("CSV"===o.collectionFormat||"Pipes"===o.collectionFormat)&&(s=s.join(t)),n.set(o.mapper.serializedName||oc(o),s)}}return{queryParams:n,sequenceParams:i}}(t,r,n);return function(e,t,r,n=!1){if(0===t.size)return e;let i=new URL(e),o=function(e){let t=new Map;if(!e||"?"!==e[0])return t;for(let r of(e=e.slice(1)).split("&")){let[e,n]=r.split("=",2),i=t.get(e);i?Array.isArray(i)?i.push(n):t.set(e,[i,n]):t.set(e,n)}return t}(i.search);for(let[e,i]of t){let t=o.get(e);if(Array.isArray(t)){if(Array.isArray(i)){t.push(...i);let r=new Set(t);o.set(e,Array.from(r))}else t.push(i)}else t?(Array.isArray(i)?i.unshift(t):r.has(e)&&o.set(e,[t,i]),n||o.set(e,i)):o.set(e,i)}let s=[];for(let[e,t]of o)if("string"==typeof t)s.push(`${e}=${t}`);else if(Array.isArray(t))for(let r of t)s.push(`${e}=${r}`);else s.push(`${e}=${t}`);return i.search=s.length?`?${s.join("&")}`:"",i.toString()}(s,a,c,o)}(r,t,e,this),i=(0,i9.kO)({url:n});i.method=t.httpMethod;let o=on(i);o.operationSpec=t,o.operationArguments=e;let s=t.contentType||this._requestContentType;s&&t.requestBody&&i.headers.set("Content-Type",s);let a=e.options;if(a){let e=a.requestOptions;e&&(e.timeout&&(i.timeout=e.timeout),e.onUploadProgress&&(i.onUploadProgress=e.onUploadProgress),e.onDownloadProgress&&(i.onDownloadProgress=e.onDownloadProgress),void 0!==e.shouldDeserialize&&(o.shouldDeserialize=e.shouldDeserialize),e.allowInsecureConnection&&(i.allowInsecureConnection=!0)),a.abortSignal&&(i.abortSignal=a.abortSignal),a.tracingOptions&&(i.tracingOptions=a.tracingOptions)}this._allowInsecureConnection&&(i.allowInsecureConnection=!0),void 0===i.streamResponseStatusCodes&&(i.streamResponseStatusCodes=function(e){let t=new Set;for(let r in e.responses){let n=e.responses[r];n.bodyMapper&&n.bodyMapper.type.name===i8.Stream&&t.add(Number(r))}return t}(t));try{let e=await this.sendRequest(i),r=ol(e,t.responses[e.status]);return a?.onResponse&&a.onResponse(e,r),r}catch(e){if("object"==typeof e&&e?.response){let r=e.response,n=ol(r,t.responses[e.statusCode]||t.responses.default);e.details=n,a?.onResponse&&a.onResponse(r,n,e)}throw e}}}let of="/.default";function og(e){let t="";if(Array.isArray(e)){if(1!==e.length)return;t=e[0]}else"string"==typeof e&&(t=e);return t.endsWith(of)?t.substr(0,t.lastIndexOf(of)):t}let om="noCorrelationId";class oy extends op{authorityHost;allowLoggingAccountIdentifiers;abortControllers;allowInsecureConnection=!1;tokenCredentialOptions;constructor(e){let t=`azsdk-js-identity/${c}`,r=e?.userAgentOptions?.userAgentPrefix?`${e.userAgentOptions.userAgentPrefix} ${t}`:`${t}`,n=function(e){let t=e?.authorityHost;return iJ.UG&&(t=t??process.env.AZURE_AUTHORITY_HOST),t??u}(e);if(!n.startsWith("https:"))throw Error("The authorityHost address must use the 'https' protocol.");super({requestContentType:"application/json; charset=utf-8",retryOptions:{maxRetries:3},...e,userAgentOptions:{userAgentPrefix:r},baseUri:n}),this.authorityHost=n,this.abortControllers=new Map,this.allowLoggingAccountIdentifiers=e?.loggingOptions?.allowLoggingAccountIdentifiers,this.tokenCredentialOptions={...e},e?.allowInsecureConnection&&(this.allowInsecureConnection=e.allowInsecureConnection)}async sendTokenRequest(e){w.info(`IdentityClient: sending token request to [${e.url}]`);let t=await this.sendRequest(e);if(t.bodyAsText&&(200===t.status||201===t.status)){let r=JSON.parse(t.bodyAsText);if(!r.access_token)return null;this.logIdentifiers(t);let n={accessToken:{token:r.access_token,expiresOnTimestamp:function(e){if("number"==typeof e.expires_on)return 1e3*e.expires_on;if("string"==typeof e.expires_on){let t=+e.expires_on;if(!isNaN(t))return 1e3*t;let r=Date.parse(e.expires_on);if(!isNaN(r))return r}if("number"==typeof e.expires_in)return Date.now()+1e3*e.expires_in;throw Error(`Failed to parse token expiration from body. expires_in="${e.expires_in}", expires_on="${e.expires_on}"`)}(r),refreshAfterTimestamp:function(e){if(e.refresh_on){if("number"==typeof e.refresh_on)return 1e3*e.refresh_on;if("string"==typeof e.refresh_on){let t=+e.refresh_on;if(!isNaN(t))return 1e3*t;let r=Date.parse(e.refresh_on);if(!isNaN(r))return r}throw Error(`Failed to parse refresh_on from body. refresh_on="${e.refresh_on}"`)}}(r),tokenType:"Bearer"},refreshToken:r.refresh_token};return w.info(`IdentityClient: [${e.url}] token acquired, expires on ${n.accessToken.expiresOnTimestamp}`),n}{let e=new y(t.status,t.bodyAsText);throw w.warning(`IdentityClient: authentication error. HTTP status: ${t.status}, ${e.errorResponse.errorDescription}`),e}}async refreshAccessToken(e,t,r,n,i,o={}){if(void 0===n)return null;w.info(`IdentityClient: refreshing access token with client ID: ${t}, scopes: ${r} started`);let s={grant_type:"refresh_token",client_id:t,refresh_token:n,scope:r};void 0!==i&&(s.client_secret=i);let a=new URLSearchParams(s);return P.withSpan("IdentityClient.refreshAccessToken",o,async r=>{try{let n=(0,i9.kO)({url:`${this.authorityHost}/${e}/${"adfs"===e?"oauth2/token":"oauth2/v2.0/token"}`,method:"POST",body:a.toString(),abortSignal:o.abortSignal,headers:(0,i9.dC)({Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}),tracingOptions:r.tracingOptions}),i=await this.sendTokenRequest(n);return w.info(`IdentityClient: refreshed token for client ID: ${t}`),i}catch(e){if(e.name===m&&"interaction_required"===e.errorResponse.error)return w.info(`IdentityClient: interaction required for client ID: ${t}`),null;throw w.warning(`IdentityClient: failed refreshing token for client ID: ${t}: ${e}`),e}})}generateAbortSignal(e){let t=new AbortController,r=this.abortControllers.get(e)||[];r.push(t),this.abortControllers.set(e,r);let n=t.signal.onabort;return t.signal.onabort=(...r)=>{this.abortControllers.set(e,void 0),n&&n.apply(t.signal,r)},t.signal}abortRequests(e){let t=e||om,r=[...this.abortControllers.get(t)||[],...this.abortControllers.get(om)||[]];if(r.length){for(let e of r)e.abort();this.abortControllers.set(t,void 0)}}getCorrelationId(e){let t=e?.body?.split("&").map(e=>e.split("=")).find(([e])=>"client-request-id"===e);return t&&t.length&&t[1]||om}async sendGetRequestAsync(e,t){let r=(0,i9.kO)({url:e,method:"GET",body:t?.body,allowInsecureConnection:this.allowInsecureConnection,headers:(0,i9.dC)(t?.headers),abortSignal:this.generateAbortSignal(om)}),n=await this.sendRequest(r);return this.logIdentifiers(n),{body:n.bodyAsText?JSON.parse(n.bodyAsText):void 0,headers:n.headers.toJSON(),status:n.status}}async sendPostRequestAsync(e,t){let r=(0,i9.kO)({url:e,method:"POST",body:t?.body,headers:(0,i9.dC)(t?.headers),allowInsecureConnection:this.allowInsecureConnection,abortSignal:this.generateAbortSignal(this.getCorrelationId(t))}),n=await this.sendRequest(r);return this.logIdentifiers(n),{body:n.bodyAsText?JSON.parse(n.bodyAsText):void 0,headers:n.headers.toJSON(),status:n.status}}getTokenCredentialOptions(){return this.tokenCredentialOptions}logIdentifiers(e){if(this.allowLoggingAccountIdentifiers&&e.bodyAsText)try{let t=(e.parsedBody||JSON.parse(e.bodyAsText)).access_token;if(!t)return;let r=t.split(".")[1],{appid:n,upn:i,tid:o,oid:s}=JSON.parse(Buffer.from(r,"base64").toString("utf8"));w.info(`[Authenticated account] Client ID: ${n}. Tenant ID: ${o}. User Principal Name: ${i||"No User Principal Name available"}. Object ID (user): ${s}`)}catch(e){w.warning("allowLoggingAccountIdentifiers was set, but we couldn't log the account information. Error:",e.message)}}}function oT(e){let t=e;return(void 0===t&&globalThis.process?.env?.AZURE_REGIONAL_AUTHORITY_NAME!==void 0&&(t=process.env.AZURE_REGIONAL_AUTHORITY_NAME),t===v.AutoDiscoverRegion)?"AUTO_DISCOVER":t}function oE(e,t,r=[],n){let i;if(process.env.AZURE_IDENTITY_DISABLE_MULTITENANTAUTH?i=e:i="adfs"===e?e:t?.tenantId??e,e&&i!==e&&!r.includes("*")&&!r.some(e=>0===e.localeCompare(i))){var o;let e=(o=i,`The current credential is not configured to acquire tokens for tenant ${o}. To enable acquiring tokens for this tenant add it to the AdditionallyAllowedTenants on the credential options, or add "*" to AdditionallyAllowedTenants to allow acquiring tokens for any tenant.`);throw n?.info(e),new g(e)}return i}function oC(e,t){if(!t.match(/^[0-9a-zA-Z-.]+$/)){let t=Error("Invalid tenant id provided. You can locate your tenant id by following the instructions listed here: https://learn.microsoft.com/partner-center/find-ids-and-domain-names.");throw e.info(_("",t)),t}}function oA(e,t,r){return t?(oC(e,t),t):(r||(r=l),r!==l)?"common":"organizations"}function oI(e){return e&&0!==e.length?e.includes("*")?d:e:[]}!function(e){e.AutoDiscoverRegion="AutoDiscoverRegion",e.USWest="westus",e.USWest2="westus2",e.USCentral="centralus",e.USEast="eastus",e.USEast2="eastus2",e.USNorthCentral="northcentralus",e.USSouthCentral="southcentralus",e.USWestCentral="westcentralus",e.CanadaCentral="canadacentral",e.CanadaEast="canadaeast",e.BrazilSouth="brazilsouth",e.EuropeNorth="northeurope",e.EuropeWest="westeurope",e.UKSouth="uksouth",e.UKWest="ukwest",e.FranceCentral="francecentral",e.FranceSouth="francesouth",e.SwitzerlandNorth="switzerlandnorth",e.SwitzerlandWest="switzerlandwest",e.GermanyNorth="germanynorth",e.GermanyWestCentral="germanywestcentral",e.NorwayWest="norwaywest",e.NorwayEast="norwayeast",e.AsiaEast="eastasia",e.AsiaSouthEast="southeastasia",e.JapanEast="japaneast",e.JapanWest="japanwest",e.AustraliaEast="australiaeast",e.AustraliaSouthEast="australiasoutheast",e.AustraliaCentral="australiacentral",e.AustraliaCentral2="australiacentral2",e.IndiaCentral="centralindia",e.IndiaSouth="southindia",e.IndiaWest="westindia",e.KoreaSouth="koreasouth",e.KoreaCentral="koreacentral",e.UAECentral="uaecentral",e.UAENorth="uaenorth",e.SouthAfricaNorth="southafricanorth",e.SouthAfricaWest="southafricawest",e.ChinaNorth="chinanorth",e.ChinaEast="chinaeast",e.ChinaNorth2="chinanorth2",e.ChinaEast2="chinaeast2",e.GermanyCentral="germanycentral",e.GermanyNorthEast="germanynortheast",e.GovernmentUSVirginia="usgovvirginia",e.GovernmentUSIowa="usgoviowa",e.GovernmentUSArizona="usgovarizona",e.GovernmentUSTexas="usgovtexas",e.GovernmentUSDodEast="usdodeast",e.GovernmentUSDodCentral="usdodcentral"}(v||(v={}));let ov=O("MsalClient");function oS(e,t,n={}){var i;let o={msalConfig:function(e,t,r={}){var n;let i=oA(r.logger??ov,t,e),o=i2(i,i1(r)),s=new oy({...r.tokenCredentialOptions,authorityHost:o,loggingOptions:r.loggingOptions});return{auth:{clientId:e,authority:o,knownAuthorities:(n=r.disableInstanceDiscovery,"adfs"===i&&o||n?[o]:[])},system:{networkClient:s,loggerOptions:{loggerCallback:i3(r.logger??ov),logLevel:i6((0,S.ZO)()),piiLoggingEnabled:r.loggingOptions?.enableUnsafeSupportLogging}}}}(e,t,n),cachedAccount:n.authenticationRecord?{localAccountId:(i=n.authenticationRecord).homeAccountId,environment:i.authority,username:i.username,homeAccountId:i.homeAccountId,tenantId:i.tenantId}:null,pluginConfiguration:f.generatePluginConfiguration(n),logger:n.logger??ov},s=new Map;async function a(e={}){let t=e.enableCae?"CAE":"default",r=s.get(t);if(r)return o.logger.getToken.info("Existing PublicClientApplication found in cache, returning it."),r;o.logger.getToken.info(`Creating new PublicClientApplication with CAE ${e.enableCae?"enabled":"disabled"}.`);let n=e.enableCae?o.pluginConfiguration.cache.cachePluginCae:o.pluginConfiguration.cache.cachePlugin;return o.msalConfig.auth.clientCapabilities=e.enableCae?["cp1"]:void 0,r=new iE({...o.msalConfig,broker:{nativeBrokerPlugin:o.pluginConfiguration.broker.nativeBrokerPlugin},cache:{cachePlugin:await n}}),s.set(t,r),r}let c=new Map;async function l(e={}){let t=e.enableCae?"CAE":"default",r=c.get(t);if(r)return o.logger.getToken.info("Existing ConfidentialClientApplication found in cache, returning it."),r;o.logger.getToken.info(`Creating new ConfidentialClientApplication with CAE ${e.enableCae?"enabled":"disabled"}.`);let n=e.enableCae?o.pluginConfiguration.cache.cachePluginCae:o.pluginConfiguration.cache.cachePlugin;return o.msalConfig.auth.clientCapabilities=e.enableCae?["cp1"]:void 0,r=new iI({...o.msalConfig,broker:{nativeBrokerPlugin:o.pluginConfiguration.broker.nativeBrokerPlugin},cache:{cachePlugin:await n}}),c.set(t,r),r}async function u(e,t,r={}){if(null===o.cachedAccount)throw o.logger.getToken.info("No cached account found in local state."),new C({scopes:t});r.claims&&(o.cachedClaims=r.claims);let n={account:o.cachedAccount,scopes:t,claims:o.cachedClaims};o.pluginConfiguration.broker.isEnabled&&(n.tokenQueryParameters||={},o.pluginConfiguration.broker.enableMsaPassthrough&&(n.tokenQueryParameters.msal_request_type="consumer_passthrough")),r.proofOfPossessionOptions&&(n.shrNonce=r.proofOfPossessionOptions.nonce,n.authenticationScheme="pop",n.resourceRequestMethod=r.proofOfPossessionOptions.resourceRequestMethod,n.resourceRequestUri=r.proofOfPossessionOptions.resourceRequestUrl),o.logger.getToken.info("Attempting to acquire token silently");try{return await e.acquireTokenSilent(n)}catch(e){throw i5(t,e,r)}}function d(e){return e?.tenantId?i2(e.tenantId,i1(n)):o.msalConfig.auth.authority}async function h(e,t,r,n){let i=null;try{i=await u(e,t,r)}catch(e){if("AuthenticationRequiredError"!==e.name)throw e;if(r.disableAutomaticAuthentication)throw new C({scopes:t,getTokenOptions:r,message:"Automatic authentication has been disabled. You may call the authentication() method."})}if(null===i)try{i=await n()}catch(e){throw i5(t,e,r)}return i0(t,i,r),o.cachedAccount=i?.account??null,o.logger.getToken.info(R(t)),{token:i.accessToken,expiresOnTimestamp:i.expiresOn.getTime(),refreshAfterTimestamp:i.refreshOn?.getTime(),tokenType:i.tokenType}}function p(e,t){return{openBrowser:async e=>{let t=await r.e(4311).then(r.bind(r,44311));await t.default(e,{newInstance:!0})},scopes:e,authority:d(t),claims:t?.claims,loginHint:t?.loginHint,errorTemplate:t?.browserCustomizationOptions?.errorMessage,successTemplate:t?.browserCustomizationOptions?.successMessage,prompt:t?.loginHint?"login":"select_account"}}async function g(e,t,r={}){ov.verbose("Authentication will resume through the broker");let n=await a(r),i=p(e,r);o.pluginConfiguration.broker.parentWindowHandle?i.windowHandle=Buffer.from(o.pluginConfiguration.broker.parentWindowHandle):ov.warning("Parent window handle is not specified for the broker. This may cause unexpected behavior. Please provide the parentWindowHandle."),o.pluginConfiguration.broker.enableMsaPassthrough&&((i.tokenQueryParameters??={}).msal_request_type="consumer_passthrough"),t?(i.prompt="none",ov.verbose("Attempting broker authentication using the default broker account")):ov.verbose("Attempting broker authentication without the default broker account"),r.proofOfPossessionOptions&&(i.shrNonce=r.proofOfPossessionOptions.nonce,i.authenticationScheme="pop",i.resourceRequestMethod=r.proofOfPossessionOptions.resourceRequestMethod,i.resourceRequestUri=r.proofOfPossessionOptions.resourceRequestUrl);try{return await n.acquireTokenInteractive(i)}catch(n){if(ov.verbose(`Failed to authenticate through the broker: ${n.message}`),r.disableAutomaticAuthentication)throw new C({scopes:e,getTokenOptions:r,message:"Cannot silently authenticate with default broker account."});if(t)return g(e,!1,r);throw n}}return{getActiveAccount:function(){var t;if(o.cachedAccount)return{authority:(t=o.cachedAccount).environment??"login.microsoftonline.com",homeAccountId:t.homeAccountId,tenantId:t.tenantId||"common",username:t.username,clientId:e,version:"1.0"}},getBrokeredToken:async function(e,t,r={}){ov.getToken.info(`Attempting to acquire token using brokered authentication with useDefaultBrokerAccount: ${t}`);let n=await g(e,t,r);return i0(e,n,r),o.cachedAccount=n?.account??null,o.logger.getToken.info(R(e)),{token:n.accessToken,expiresOnTimestamp:n.expiresOn.getTime(),refreshAfterTimestamp:n.refreshOn?.getTime(),tokenType:n.tokenType}},getTokenByClientSecret:async function(e,t,r={}){o.logger.getToken.info("Attempting to acquire token using client secret"),o.msalConfig.auth.clientSecret=t;let n=await l(r);try{let t=await n.acquireTokenByClientCredential({scopes:e,authority:d(r),azureRegion:oT(),claims:r?.claims});return i0(e,t,r),o.logger.getToken.info(R(e)),{token:t.accessToken,expiresOnTimestamp:t.expiresOn.getTime(),refreshAfterTimestamp:t.refreshOn?.getTime(),tokenType:t.tokenType}}catch(t){throw i5(e,t,r)}},getTokenByClientAssertion:async function(e,t,r={}){o.logger.getToken.info("Attempting to acquire token using client assertion"),o.msalConfig.auth.clientAssertion=t;let n=await l(r);try{let i=await n.acquireTokenByClientCredential({scopes:e,authority:d(r),azureRegion:oT(),claims:r?.claims,clientAssertion:t});return i0(e,i,r),o.logger.getToken.info(R(e)),{token:i.accessToken,expiresOnTimestamp:i.expiresOn.getTime(),refreshAfterTimestamp:i.refreshOn?.getTime(),tokenType:i.tokenType}}catch(t){throw i5(e,t,r)}},getTokenByClientCertificate:async function(e,t,r={}){o.logger.getToken.info("Attempting to acquire token using client certificate"),o.msalConfig.auth.clientCertificate=t;let n=await l(r);try{let t=await n.acquireTokenByClientCredential({scopes:e,authority:d(r),azureRegion:oT(),claims:r?.claims});return i0(e,t,r),o.logger.getToken.info(R(e)),{token:t.accessToken,expiresOnTimestamp:t.expiresOn.getTime(),refreshAfterTimestamp:t.refreshOn?.getTime(),tokenType:t.tokenType}}catch(t){throw i5(e,t,r)}},getTokenByDeviceCode:async function(e,t,r={}){o.logger.getToken.info("Attempting to acquire token using device code");let n=await a(r);return h(n,e,r,()=>{let i={scopes:e,cancel:r?.abortSignal?.aborted??!1,deviceCodeCallback:t,authority:d(r),claims:r?.claims},o=n.acquireTokenByDeviceCode(i);return r.abortSignal&&r.abortSignal.addEventListener("abort",()=>{i.cancel=!0}),o})},getTokenByUsernamePassword:async function(e,t,r,n={}){o.logger.getToken.info("Attempting to acquire token using username and password");let i=await a(n);return h(i,e,n,()=>{let o={scopes:e,username:t,password:r,authority:d(n),claims:n?.claims};return i.acquireTokenByUsernamePassword(o)})},getTokenByAuthorizationCode:async function(e,t,r,n,i={}){let s;return o.logger.getToken.info("Attempting to acquire token using authorization code"),n?(o.msalConfig.auth.clientSecret=n,s=await l(i)):s=await a(i),h(s,e,i,()=>s.acquireTokenByCode({scopes:e,redirectUri:t,code:r,authority:d(i),claims:i?.claims}))},getTokenOnBehalfOf:async function(e,t,r,n={}){ov.getToken.info("Attempting to acquire token on behalf of another user"),"string"==typeof r?(ov.getToken.info("Using client secret for on behalf of flow"),o.msalConfig.auth.clientSecret=r):"function"==typeof r?(ov.getToken.info("Using client assertion callback for on behalf of flow"),o.msalConfig.auth.clientAssertion=r):(ov.getToken.info("Using client certificate for on behalf of flow"),o.msalConfig.auth.clientCertificate=r);let i=await l(n);try{let r=await i.acquireTokenOnBehalfOf({scopes:e,authority:d(n),claims:n.claims,oboAssertion:t});return i0(e,r,n),ov.getToken.info(R(e)),{token:r.accessToken,expiresOnTimestamp:r.expiresOn.getTime(),refreshAfterTimestamp:r.refreshOn?.getTime(),tokenType:r.tokenType}}catch(t){throw i5(e,t,n)}},getTokenByInteractiveRequest:async function(e,t={}){ov.getToken.info("Attempting to acquire token interactively");let r=await a(t);return h(r,e,t,async()=>{let n=p(e,t);return o.pluginConfiguration.broker.isEnabled?g(e,o.pluginConfiguration.broker.useDefaultBrokerAccount??!1,t):(t.proofOfPossessionOptions&&(n.shrNonce=t.proofOfPossessionOptions.nonce,n.authenticationScheme="pop",n.resourceRequestMethod=t.proofOfPossessionOptions.resourceRequestMethod,n.resourceRequestUri=t.proofOfPossessionOptions.resourceRequestUrl),r.acquireTokenInteractive(n))})}}}var ow=r(6005),ob=r(93977);let oR="ClientCertificateCredential",o_=O(oR);class ok{tenantId;additionallyAllowedTenantIds;certificateConfiguration;sendCertificateChain;msalClient;constructor(e,t,r,n={}){if(!e||!t)throw Error(`${oR}: tenantId and clientId are required parameters.`);this.tenantId=e,this.additionallyAllowedTenantIds=oI(n?.additionallyAllowedTenants),this.sendCertificateChain=n.sendCertificateChain,this.certificateConfiguration={..."string"==typeof r?{certificatePath:r}:r};let i=this.certificateConfiguration.certificate,o=this.certificateConfiguration.certificatePath;if(!this.certificateConfiguration||!(i||o))throw Error(`${oR}: Provide either a PEM certificate in string form, or the path to that certificate in the filesystem. To troubleshoot, visit https://aka.ms/azsdk/js/identity/serviceprincipalauthentication/troubleshoot.`);if(i&&o)throw Error(`${oR}: To avoid unexpected behaviors, providing both the contents of a PEM certificate and the path to a PEM certificate is forbidden. To troubleshoot, visit https://aka.ms/azsdk/js/identity/serviceprincipalauthentication/troubleshoot.`);this.msalClient=oS(t,e,{...n,logger:o_,tokenCredentialOptions:n})}async getToken(e,t={}){return P.withSpan(`${oR}.getToken`,t,async t=>{t.tenantId=oE(this.tenantId,t,this.additionallyAllowedTenantIds,o_);let r=Array.isArray(e)?e:[e],n=await this.buildClientCertificate();return this.msalClient.getTokenByClientCertificate(r,n,t)})}async buildClientCertificate(){let e;let t=await oO(this.certificateConfiguration,this.sendCertificateChain??!1);return e=void 0!==this.certificateConfiguration.certificatePassword?(0,ow.createPrivateKey)({key:t.certificateContents,passphrase:this.certificateConfiguration.certificatePassword,format:"pem"}).export({format:"pem",type:"pkcs8"}).toString():t.certificateContents,{thumbprint:t.thumbprint,thumbprintSha256:t.thumbprintSha256,privateKey:e,x5c:t.x5c}}}async function oO(e,t){let r;let n=e.certificate,i=e.certificatePath,o=n||await (0,ob.readFile)(i,"utf8"),s=t?o:void 0,a=/(-+BEGIN CERTIFICATE-+)(\n\r?|\r\n?)([A-Za-z0-9+/\n\r]+=*)(\n\r?|\r\n?)(-+END CERTIFICATE-+)/g,c=[];do(r=a.exec(o))&&c.push(r[3]);while(r);if(0===c.length)throw Error("The file at the specified path does not contain a PEM-encoded certificate.");let l=(0,ow.createHash)("sha1").update(Buffer.from(c[0],"base64")).digest("hex").toUpperCase();return{certificateContents:o,thumbprintSha256:(0,ow.createHash)("sha256").update(Buffer.from(c[0],"base64")).digest("hex").toUpperCase(),thumbprint:l,x5c:s}}function oP(e){return Array.isArray(e)?e:[e]}function oN(e,t){if(!e.match(/^[0-9a-zA-Z-_.:/]+$/)){let r=Error("Invalid scope was specified by the user or calling client");throw t.getToken.info(_(e,r)),r}}function oM(e){return e.replace(/\/.default$/,"")}let oD=O("ClientSecretCredential");class oU{tenantId;additionallyAllowedTenantIds;msalClient;clientSecret;constructor(e,t,r,n={}){if(!e)throw new g("ClientSecretCredential: tenantId is a required parameter. To troubleshoot, visit https://aka.ms/azsdk/js/identity/serviceprincipalauthentication/troubleshoot.");if(!t)throw new g("ClientSecretCredential: clientId is a required parameter. To troubleshoot, visit https://aka.ms/azsdk/js/identity/serviceprincipalauthentication/troubleshoot.");if(!r)throw new g("ClientSecretCredential: clientSecret is a required parameter. To troubleshoot, visit https://aka.ms/azsdk/js/identity/serviceprincipalauthentication/troubleshoot.");this.clientSecret=r,this.tenantId=e,this.additionallyAllowedTenantIds=oI(n?.additionallyAllowedTenants),this.msalClient=oS(t,e,{...n,logger:oD,tokenCredentialOptions:n})}async getToken(e,t={}){return P.withSpan(`${this.constructor.name}.getToken`,t,async t=>{t.tenantId=oE(this.tenantId,t,this.additionallyAllowedTenantIds,oD);let r=oP(e);return this.msalClient.getTokenByClientSecret(r,this.clientSecret,t)})}}let ox=O("UsernamePasswordCredential");class o${tenantId;additionallyAllowedTenantIds;msalClient;username;password;constructor(e,t,r,n,i={}){if(!e)throw new g("UsernamePasswordCredential: tenantId is a required parameter. To troubleshoot, visit https://aka.ms/azsdk/js/identity/usernamepasswordcredential/troubleshoot.");if(!t)throw new g("UsernamePasswordCredential: clientId is a required parameter. To troubleshoot, visit https://aka.ms/azsdk/js/identity/usernamepasswordcredential/troubleshoot.");if(!r)throw new g("UsernamePasswordCredential: username is a required parameter. To troubleshoot, visit https://aka.ms/azsdk/js/identity/usernamepasswordcredential/troubleshoot.");if(!n)throw new g("UsernamePasswordCredential: password is a required parameter. To troubleshoot, visit https://aka.ms/azsdk/js/identity/usernamepasswordcredential/troubleshoot.");this.tenantId=e,this.additionallyAllowedTenantIds=oI(i?.additionallyAllowedTenants),this.username=r,this.password=n,this.msalClient=oS(t,this.tenantId,{...i,tokenCredentialOptions:i??{}})}async getToken(e,t={}){return P.withSpan(`${this.constructor.name}.getToken`,t,async t=>{t.tenantId=oE(this.tenantId,t,this.additionallyAllowedTenantIds,ox);let r=oP(e);return this.msalClient.getTokenByUsernamePassword(r,this.username,this.password,t)})}}let oq=["AZURE_TENANT_ID","AZURE_CLIENT_ID","AZURE_CLIENT_SECRET","AZURE_CLIENT_CERTIFICATE_PATH","AZURE_CLIENT_CERTIFICATE_PASSWORD","AZURE_USERNAME","AZURE_PASSWORD","AZURE_ADDITIONALLY_ALLOWED_TENANTS","AZURE_CLIENT_SEND_CERTIFICATE_CHAIN"],oL="EnvironmentCredential",oF=O(oL);class oH{_credential=void 0;constructor(e){let t=b(oq).assigned.join(", ");oF.info(`Found the following environment variables: ${t}`);let r=process.env.AZURE_TENANT_ID,n=process.env.AZURE_CLIENT_ID,i=process.env.AZURE_CLIENT_SECRET,o=(process.env.AZURE_ADDITIONALLY_ALLOWED_TENANTS??"").split(";"),s=function(){let e=(process.env.AZURE_CLIENT_SEND_CERTIFICATE_CHAIN??"").toLowerCase(),t="true"===e||"1"===e;return oF.verbose(`AZURE_CLIENT_SEND_CERTIFICATE_CHAIN: ${process.env.AZURE_CLIENT_SEND_CERTIFICATE_CHAIN}; sendCertificateChain: ${t}`),t}(),a={...e,additionallyAllowedTenantIds:o,sendCertificateChain:s};if(r&&oC(oF,r),r&&n&&i){oF.info(`Invoking ClientSecretCredential with tenant ID: ${r}, clientId: ${n} and clientSecret: [REDACTED]`),this._credential=new oU(r,n,i,a);return}let c=process.env.AZURE_CLIENT_CERTIFICATE_PATH,l=process.env.AZURE_CLIENT_CERTIFICATE_PASSWORD;if(r&&n&&c){oF.info(`Invoking ClientCertificateCredential with tenant ID: ${r}, clientId: ${n} and certificatePath: ${c}`),this._credential=new ok(r,n,{certificatePath:c,certificatePassword:l},a);return}let u=process.env.AZURE_USERNAME,d=process.env.AZURE_PASSWORD;r&&n&&u&&d&&(oF.info(`Invoking UsernamePasswordCredential with tenant ID: ${r}, clientId: ${n} and username: ${u}`),oF.warning("Environment is configured to use username and password authentication. This authentication method is deprecated, as it doesn't support multifactor authentication (MFA). Use a more secure credential. For more details, see https://aka.ms/azsdk/identity/mfa."),this._credential=new o$(r,n,u,d,a))}async getToken(e,t={}){return P.withSpan(`${oL}.getToken`,t,async t=>{if(this._credential)try{let r=await this._credential.getToken(e,t);return oF.getToken.info(R(e)),r}catch(r){let t=new y(400,{error:`${oL} authentication failed. To troubleshoot, visit https://aka.ms/azsdk/js/identity/environmentcredential/troubleshoot.`,error_description:r.message.toString().split("More details:").join("")});throw oF.getToken.info(_(e,t)),t}throw new g(`${oL} is unavailable. No underlying credential could be used. To troubleshoot, visit https://aka.ms/azsdk/js/identity/environmentcredential/troubleshoot.`)})}}let oj="ManagedIdentityCredential - IMDS",oB=O(oj),oz={name:"imdsMsi",async isAvailable(e){let{scopes:t,identityClient:r,getTokenOptions:n}=e,i=og(t);if(!i)return oB.info(`${oj}: Unavailable. Multiple scopes are not supported.`),!1;if(process.env.AZURE_POD_IDENTITY_AUTHORITY_HOST)return!0;if(!r)throw Error("Missing IdentityClient");let o=function(e){if(!og(e))throw Error(`${oj}: Multiple scopes are not supported.`);let t=new URL("/metadata/identity/oauth2/token",process.env.AZURE_POD_IDENTITY_AUTHORITY_HOST??"http://169.254.169.254");return{url:`${t}`,method:"GET",headers:(0,i9.dC)({Accept:"application/json"})}}(i);return P.withSpan("ManagedIdentityCredential-pingImdsEndpoint",n??{},async e=>{let t;o.tracingOptions=e.tracingOptions;let n=(0,i9.kO)(o);n.timeout=e.requestOptions?.timeout||1e3,n.allowInsecureConnection=!0;try{oB.info(`${oj}: Pinging the Azure IMDS endpoint`),t=await r.sendRequest(n)}catch(e){return(0,iJ.VZ)(e)&&oB.verbose(`${oj}: Caught error ${e.name}: ${e.message}`),oB.info(`${oj}: The Azure IMDS endpoint is unavailable`),!1}return 403===t.status&&t.bodyAsText?.includes("unreachable")?(oB.info(`${oj}: The Azure IMDS endpoint is unavailable`),oB.info(`${oj}: ${t.bodyAsText}`),!1):(oB.info(`${oj}: The Azure IMDS endpoint is available`),!0)})}},oG=O("ClientAssertionCredential");class oV{msalClient;tenantId;additionallyAllowedTenantIds;getAssertion;options;constructor(e,t,r,n={}){if(!e)throw new g("ClientAssertionCredential: tenantId is a required parameter.");if(!t)throw new g("ClientAssertionCredential: clientId is a required parameter.");if(!r)throw new g("ClientAssertionCredential: clientAssertion is a required parameter.");this.tenantId=e,this.additionallyAllowedTenantIds=oI(n?.additionallyAllowedTenants),this.options=n,this.getAssertion=r,this.msalClient=oS(t,e,{...n,logger:oG,tokenCredentialOptions:this.options})}async getToken(e,t={}){return P.withSpan(`${this.constructor.name}.getToken`,t,async t=>{t.tenantId=oE(this.tenantId,t,this.additionallyAllowedTenantIds,oG);let r=Array.isArray(e)?e:[e];return this.msalClient.getTokenByClientAssertion(r,this.getAssertion,t)})}}let oK="WorkloadIdentityCredential",oY=["AZURE_TENANT_ID","AZURE_CLIENT_ID","AZURE_FEDERATED_TOKEN_FILE"],oW=O(oK);class oQ{client;azureFederatedTokenFileContent=void 0;cacheDate=void 0;federatedTokenFilePath;constructor(e){let t=b(oY).assigned.join(", ");oW.info(`Found the following environment variables: ${t}`);let r=e??{},n=r.tenantId||process.env.AZURE_TENANT_ID,i=r.clientId||process.env.AZURE_CLIENT_ID;if(this.federatedTokenFilePath=r.tokenFilePath||process.env.AZURE_FEDERATED_TOKEN_FILE,n&&oC(oW,n),!i)throw new g(`${oK}: is unavailable. clientId is a required parameter. In DefaultAzureCredential and ManagedIdentityCredential, this can be provided as an environment variable - "AZURE_CLIENT_ID".
        See the troubleshooting guide for more information: https://aka.ms/azsdk/js/identity/workloadidentitycredential/troubleshoot`);if(!n)throw new g(`${oK}: is unavailable. tenantId is a required parameter. In DefaultAzureCredential and ManagedIdentityCredential, this can be provided as an environment variable - "AZURE_TENANT_ID".
        See the troubleshooting guide for more information: https://aka.ms/azsdk/js/identity/workloadidentitycredential/troubleshoot`);if(!this.federatedTokenFilePath)throw new g(`${oK}: is unavailable. federatedTokenFilePath is a required parameter. In DefaultAzureCredential and ManagedIdentityCredential, this can be provided as an environment variable - "AZURE_FEDERATED_TOKEN_FILE".
        See the troubleshooting guide for more information: https://aka.ms/azsdk/js/identity/workloadidentitycredential/troubleshoot`);oW.info(`Invoking ClientAssertionCredential with tenant ID: ${n}, clientId: ${r.clientId} and federated token path: [REDACTED]`),this.client=new oV(n,i,this.readFileContents.bind(this),e)}async getToken(e,t){if(!this.client){let e=`${oK}: is unavailable. tenantId, clientId, and federatedTokenFilePath are required parameters. 
      In DefaultAzureCredential and ManagedIdentityCredential, these can be provided as environment variables - 
      "AZURE_TENANT_ID",
      "AZURE_CLIENT_ID",
      "AZURE_FEDERATED_TOKEN_FILE". See the troubleshooting guide for more information: https://aka.ms/azsdk/js/identity/workloadidentitycredential/troubleshoot`;throw oW.info(e),new g(e)}return oW.info("Invoking getToken() of Client Assertion Credential"),this.client.getToken(e,t)}async readFileContents(){if(void 0!==this.cacheDate&&Date.now()-this.cacheDate>=3e5&&(this.azureFederatedTokenFileContent=void 0),!this.federatedTokenFilePath)throw new g(`${oK}: is unavailable. Invalid file path provided ${this.federatedTokenFilePath}.`);if(!this.azureFederatedTokenFileContent){let e=(await (0,ob.readFile)(this.federatedTokenFilePath,"utf8")).trim();if(e)this.azureFederatedTokenFileContent=e,this.cacheDate=Date.now();else throw new g(`${oK}: is unavailable. No content on the file ${this.federatedTokenFilePath}.`)}return this.azureFederatedTokenFileContent}}let oJ="ManagedIdentityCredential - Token Exchange",oZ=O(oJ),oX={name:"tokenExchangeMsi",async isAvailable(e){let t=process.env,r=!!((e||t.AZURE_CLIENT_ID)&&t.AZURE_TENANT_ID&&process.env.AZURE_FEDERATED_TOKEN_FILE);return r||oZ.info(`${oJ}: Unavailable. The environment variables needed are: AZURE_CLIENT_ID (or the client ID sent through the parameters), AZURE_TENANT_ID and AZURE_FEDERATED_TOKEN_FILE`),r},async getToken(e,t={}){let{scopes:r,clientId:n}=e;return new oQ({clientId:n,tenantId:process.env.AZURE_TENANT_ID,tokenFilePath:process.env.AZURE_FEDERATED_TOKEN_FILE,disableInstanceDiscovery:!0}).getToken(r,t)}},o0=O("ManagedIdentityCredential");class o1{managedIdentityApp;identityClient;clientId;resourceId;objectId;msiRetryConfig={maxRetries:5,startDelayInMs:800,intervalIncrement:2};isAvailableIdentityClient;sendProbeRequest;constructor(e,t){let r;"string"==typeof e?(this.clientId=e,r=t??{}):(this.clientId=e?.clientId,r=e??{}),this.resourceId=r?.resourceId,this.objectId=r?.objectId,this.sendProbeRequest=r?.sendProbeRequest??!1;let n=[{key:"clientId",value:this.clientId},{key:"resourceId",value:this.resourceId},{key:"objectId",value:this.objectId}].filter(e=>e.value);if(n.length>1)throw Error(`ManagedIdentityCredential: only one of 'clientId', 'resourceId', or 'objectId' can be provided. Received values: ${JSON.stringify({clientId:this.clientId,resourceId:this.resourceId,objectId:this.objectId})}`);r.allowInsecureConnection=!0,r.retryOptions?.maxRetries!==void 0&&(this.msiRetryConfig.maxRetries=r.retryOptions.maxRetries),this.identityClient=new oy({...r,additionalPolicies:[{policy:function(e){return(0,i9.bY)([{name:"imdsRetryPolicy",retry:({retryCount:t,response:r})=>{if(r?.status!==404&&r?.status!==410)return{skipStrategy:!0};let n=r?.status===410?Math.max(3e3,e.startDelayInMs):e.startDelayInMs;return(0,iJ.b3)(t,{retryDelayInMs:n,maxRetryDelayInMs:64e3})}}],{maxRetries:e.maxRetries})}(this.msiRetryConfig),position:"perCall"}]}),this.managedIdentityApp=new iQ({managedIdentityIdParams:{userAssignedClientId:this.clientId,userAssignedResourceId:this.resourceId,userAssignedObjectId:this.objectId},system:{disableInternalRetries:!0,networkClient:this.identityClient,loggerOptions:{logLevel:i6((0,S.ZO)()),piiLoggingEnabled:r.loggingOptions?.enableUnsafeSupportLogging,loggerCallback:i3(o0)}}}),this.isAvailableIdentityClient=new oy({...r,retryOptions:{maxRetries:0}});let i=this.managedIdentityApp.getManagedIdentitySource();if("CloudShell"===i&&(this.clientId||this.resourceId||this.objectId))throw o0.warning(`CloudShell MSI detected with user-provided IDs - throwing. Received values: ${JSON.stringify({clientId:this.clientId,resourceId:this.resourceId,objectId:this.objectId})}.`),new g("ManagedIdentityCredential: Specifying a user-assigned managed identity is not supported for CloudShell at runtime. When using Managed Identity in CloudShell, omit the clientId, resourceId, and objectId parameters.");if("ServiceFabric"===i&&(this.clientId||this.resourceId||this.objectId))throw o0.warning(`Service Fabric detected with user-provided IDs - throwing. Received values: ${JSON.stringify({clientId:this.clientId,resourceId:this.resourceId,objectId:this.objectId})}.`),new g("ManagedIdentityCredential: Specifying a `clientId` or `resourceId` is not supported by the Service Fabric managed identity environment. The managed identity configuration is determined by the Service Fabric cluster resource configuration. See https://aka.ms/servicefabricmi for more information");if(o0.info(`Using ${i} managed identity.`),1===n.length){let{key:e,value:t}=n[0];o0.info(`${i} with ${e}: ${t}`)}}async getToken(e,t={}){o0.getToken.info("Using the MSAL provider for Managed Identity.");let r=og(e);if(!r)throw new g(`ManagedIdentityCredential: Multiple scopes are not supported. Scopes: ${JSON.stringify(e)}`);return P.withSpan("ManagedIdentityCredential.getToken",t,async()=>{try{let n=await oX.isAvailable(this.clientId),i=this.managedIdentityApp.getManagedIdentitySource();if(o0.getToken.info(`MSAL Identity source: ${i}`),n){o0.getToken.info("Using the token exchange managed identity.");let t=await oX.getToken({scopes:e,clientId:this.clientId,identityClient:this.identityClient,retryConfig:this.msiRetryConfig,resourceId:this.resourceId});if(null===t)throw new g("Attempted to use the token exchange managed identity, but received a null response.");return t}if(("DefaultToImds"===i||"Imds"===i)&&this.sendProbeRequest&&(o0.getToken.info("Using the IMDS endpoint to probe for availability."),!await oz.isAvailable({scopes:e,clientId:this.clientId,getTokenOptions:t,identityClient:this.isAvailableIdentityClient,resourceId:this.resourceId})))throw new g("Attempted to use the IMDS endpoint, but it is not available.");o0.getToken.info("Calling into MSAL for managed identity token.");let o=await this.managedIdentityApp.acquireToken({resource:r});return this.ensureValidMsalToken(e,o,t),o0.getToken.info(R(e)),{expiresOnTimestamp:o.expiresOn.getTime(),token:o.accessToken,refreshAfterTimestamp:o.refreshOn?.getTime(),tokenType:"Bearer"}}catch(t){if(o0.getToken.error(_(e,t)),"AuthenticationRequiredError"===t.name)throw t;if("network_error"===t.errorCode||"ENETUNREACH"===t.code||"EHOSTUNREACH"===t.code||(403===t.statusCode||403===t.code)&&t.message.includes("unreachable"))throw new g(`ManagedIdentityCredential: Network unreachable. Message: ${t.message}`,{cause:t});throw new g(`ManagedIdentityCredential: Authentication failed. Message ${t.message}`,{cause:t})}})}ensureValidMsalToken(e,t,r){let n=t=>(o0.getToken.info(t),new C({scopes:Array.isArray(e)?e:[e],getTokenOptions:r,message:t}));if(!t)throw n("No response.");if(!t.expiresOn)throw n('Response had no "expiresOn" property.');if(!t.accessToken)throw n('Response had no "accessToken" property.')}}var o2=r(61282);let o3=O("AzureDeveloperCliCredential"),o6={notInstalled:"Azure Developer CLI couldn't be found. To mitigate this issue, see the troubleshooting guidelines at https://aka.ms/azsdk/js/identity/azdevclicredential/troubleshoot.",login:"Please run 'azd auth login' from a command prompt to authenticate before using this credential. For more information, see the troubleshooting guidelines at https://aka.ms/azsdk/js/identity/azdevclicredential/troubleshoot.",unknown:"Unknown error while trying to retrieve the access token",claim:"This credential doesn't support claims challenges. To authenticate with the required claims, please run the following command:"},o5={getSafeWorkingDir(){if("win32"!==process.platform)return"/bin";{let e=process.env.SystemRoot||process.env.SYSTEMROOT;return e||(o3.getToken.warning("The SystemRoot environment variable is not set. This may cause issues when using the Azure Developer CLI credential."),e="C:\\Windows"),e}},async getAzdAccessToken(e,t,r,n){let i=[];t&&(i=["--tenant-id",t]);let o=[];return n&&(o=["--claims",btoa(n)]),new Promise((t,n)=>{try{let n=["auth","token","--output","json","--no-prompt",...e.reduce((e,t)=>e.concat("--scope",t),[]),...i,...o],s=["azd",...n].join(" ");o2.exec(s,{cwd:o5.getSafeWorkingDir(),timeout:r},(e,r,n)=>{t({stdout:r,stderr:n,error:e})})}catch(e){n(e)}})}};class o4{tenantId;additionallyAllowedTenantIds;timeout;constructor(e){e?.tenantId&&(oC(o3,e?.tenantId),this.tenantId=e?.tenantId),this.additionallyAllowedTenantIds=oI(e?.additionallyAllowedTenants),this.timeout=e?.processTimeoutInMs}async getToken(e,t={}){let r;let n=oE(this.tenantId,t,this.additionallyAllowedTenantIds);return n&&oC(o3,n),r="string"==typeof e?[e]:e,o3.getToken.info(`Using the scopes ${e}`),P.withSpan(`${this.constructor.name}.getToken`,t,async()=>{try{r.forEach(e=>{oN(e,o3)});let i=await o5.getAzdAccessToken(r,n,this.timeout,t.claims),o=i.stderr?.match("must use multi-factor authentication")||i.stderr?.match("reauthentication required"),s=i.stderr?.match("not logged in, run `azd login` to login")||i.stderr?.match("not logged in, run `azd auth login` to login");if(i.stderr?.match("azd:(.*)not found")||i.stderr?.startsWith("'azd' is not recognized")||i.error&&"ENOENT"===i.error.code){let t=new g(o6.notInstalled);throw o3.getToken.info(_(e,t)),t}if(s){let t=new g(o6.login);throw o3.getToken.info(_(e,t)),t}if(o){let t=r.reduce((e,t)=>e.concat("--scope",t),[]).join(" "),n=`azd auth login ${t}`,i=new g(`${o6.claim} ${n}`);throw o3.getToken.info(_(e,i)),i}try{let t=JSON.parse(i.stdout);return o3.getToken.info(R(e)),{token:t.token,expiresOnTimestamp:new Date(t.expiresOn).getTime(),tokenType:"Bearer"}}catch(e){if(i.stderr)throw new g(i.stderr);throw e}}catch(r){let t="CredentialUnavailableError"===r.name?r:new g(r.message||o6.unknown);throw o3.getToken.info(_(e,t)),t}})}}function o8(e,t){if(!t.match(/^[0-9a-zA-Z-._ ]+$/)){let r=Error(`Subscription '${t}' contains invalid characters. If this is the name of a subscription, use its ID instead. You can locate your subscription by following the instructions listed here: https://learn.microsoft.com/azure/azure-portal/get-subscription-tenant-id`);throw e.info(_("",r)),r}}let o9=O("AzureCliCredential"),o7={claim:"This credential doesn't support claims challenges. To authenticate with the required claims, please run the following command:",notInstalled:"Azure CLI could not be found. Please visit https://aka.ms/azure-cli for installation instructions and then, once installed, authenticate to your Azure account using 'az login'.",login:"Please run 'az login' from a command prompt to authenticate before using this credential.",unknown:"Unknown error while trying to retrieve the access token",unexpectedResponse:'Unexpected response from Azure CLI when getting token. Expected "expiresOn" to be a RFC3339 date string. Got:'},se={getSafeWorkingDir(){if("win32"!==process.platform)return"/bin";{let e=process.env.SystemRoot||process.env.SYSTEMROOT;return e||(o9.getToken.warning("The SystemRoot environment variable is not set. This may cause issues when using the Azure CLI credential."),e="C:\\Windows"),e}},async getAzureCliAccessToken(e,t,r,n){let i=[],o=[];return t&&(i=["--tenant",t]),r&&(o=["--subscription",`"${r}"`]),new Promise((t,r)=>{try{let r=["account","get-access-token","--output","json","--resource",e,...i,...o],s=["az",...r].join(" ");o2.exec(s,{cwd:se.getSafeWorkingDir(),timeout:n},(e,r,n)=>{t({stdout:r,stderr:n,error:e})})}catch(e){r(e)}})}};class st{tenantId;additionallyAllowedTenantIds;timeout;subscription;constructor(e){e?.tenantId&&(oC(o9,e?.tenantId),this.tenantId=e?.tenantId),e?.subscription&&(o8(o9,e?.subscription),this.subscription=e?.subscription),this.additionallyAllowedTenantIds=oI(e?.additionallyAllowedTenants),this.timeout=e?.processTimeoutInMs}async getToken(e,t={}){let r="string"==typeof e?e:e[0],n=t.claims;if(n&&n.trim()){let e=btoa(n),i=`az login --claims-challenge ${e} --scope ${r}`,o=t.tenantId;o&&(i+=` --tenant ${o}`);let s=new g(`${o7.claim} ${i}`);throw o9.getToken.info(_(r,s)),s}let i=oE(this.tenantId,t,this.additionallyAllowedTenantIds);return i&&oC(o9,i),this.subscription&&o8(o9,this.subscription),o9.getToken.info(`Using the scope ${r}`),P.withSpan(`${this.constructor.name}.getToken`,t,async()=>{try{oN(r,o9);let t=oM(r),n=await se.getAzureCliAccessToken(t,i,this.subscription,this.timeout),o=n.stderr?.match("(.*)az login --scope(.*)"),s=n.stderr?.match("(.*)az login(.*)")&&!o;if(n.stderr?.match("az:(.*)not found")||n.stderr?.startsWith("'az' is not recognized")){let t=new g(o7.notInstalled);throw o9.getToken.info(_(e,t)),t}if(s){let t=new g(o7.login);throw o9.getToken.info(_(e,t)),t}try{let t=n.stdout,r=this.parseRawResponse(t);return o9.getToken.info(R(e)),r}catch(e){if(n.stderr)throw new g(n.stderr);throw e}}catch(r){let t="CredentialUnavailableError"===r.name?r:new g(r.message||o7.unknown);throw o9.getToken.info(_(e,t)),t}})}parseRawResponse(e){let t=JSON.parse(e),r=t.accessToken,n=1e3*Number.parseInt(t.expires_on,10);if(!isNaN(n))return o9.getToken.info("expires_on is available and is valid, using it"),{token:r,expiresOnTimestamp:n,tokenType:"Bearer"};if(isNaN(n=new Date(t.expiresOn).getTime()))throw new g(`${o7.unexpectedResponse} "${t.expiresOn}"`);return{token:r,expiresOnTimestamp:n,tokenType:"Bearer"}}}var sr=r(17718);let sn={execFile:(e,t,r)=>new Promise((n,i)=>{sr.execFile(e,t,r,(e,t,r)=>{Buffer.isBuffer(t)&&(t=t.toString("utf8")),Buffer.isBuffer(r)&&(r=r.toString("utf8")),r||e?i(r?Error(r):e):n(t)})})},si=O("AzurePowerShellCredential"),so="win32"===process.platform;function ss(e){return so?`${e}.exe`:e}async function sa(e,t){let r=[];for(let n of e){let[e,...i]=n,o=await sn.execFile(e,i,{encoding:"utf8",timeout:t});r.push(o)}return r}let sc={login:"Run Connect-AzAccount to login",installed:"The specified module 'Az.Accounts' with version '2.2.0' was not loaded because no valid module file was found in any module directory"},sl={login:"Please run 'Connect-AzAccount' from PowerShell to authenticate before using this credential.",installed:"The 'Az.Account' module >= 2.2.0 is not installed. Install the Azure Az PowerShell module with: \"Install-Module -Name Az -Scope CurrentUser -Repository PSGallery -Force\".",claim:"This credential doesn't support claims challenges. To authenticate with the required claims, please run the following command:",troubleshoot:"To troubleshoot, visit https://aka.ms/azsdk/js/identity/powershellcredential/troubleshoot."},su=e=>e.message.match(`(.*)${sc.login}(.*)`),sd=e=>e.message.match(sc.installed),sh=[ss("pwsh")];so&&sh.push(ss("powershell"));class sp{tenantId;additionallyAllowedTenantIds;timeout;constructor(e){e?.tenantId&&(oC(si,e?.tenantId),this.tenantId=e?.tenantId),this.additionallyAllowedTenantIds=oI(e?.additionallyAllowedTenants),this.timeout=e?.processTimeoutInMs}async getAzurePowerShellAccessToken(e,t,r){for(let n of[...sh]){try{await sa([[n,"/?"]],r)}catch(e){sh.shift();continue}return sf((await sa([[n,"-NoProfile","-NonInteractive","-Command",`
          $tenantId = "${t??""}"
          $m = Import-Module Az.Accounts -MinimumVersion 2.2.0 -PassThru
          $useSecureString = $m.Version -ge [version]'2.17.0' -and $m.Version -lt [version]'5.0.0'

          $params = @{
            ResourceUrl = "${e}"
          }

          if ($tenantId.Length -gt 0) {
            $params["TenantId"] = $tenantId
          }

          if ($useSecureString) {
            $params["AsSecureString"] = $true
          }

          $token = Get-AzAccessToken @params

          $result = New-Object -TypeName PSObject
          $result | Add-Member -MemberType NoteProperty -Name ExpiresOn -Value $token.ExpiresOn

          if ($token.Token -is [System.Security.SecureString]) {
            if ($PSVersionTable.PSVersion.Major -lt 7) {
              $ssPtr = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($token.Token)
              try {
                $result | Add-Member -MemberType NoteProperty -Name Token -Value ([System.Runtime.InteropServices.Marshal]::PtrToStringBSTR($ssPtr))
              }
              finally {
                [System.Runtime.InteropServices.Marshal]::ZeroFreeBSTR($ssPtr)
              }
            }
            else {
              $result | Add-Member -MemberType NoteProperty -Name Token -Value ($token.Token | ConvertFrom-SecureString -AsPlainText)
            }
          }
          else {
            $result | Add-Member -MemberType NoteProperty -Name Token -Value $token.Token
          }

          Write-Output (ConvertTo-Json $result)
          `]]))[0])}throw Error("Unable to execute PowerShell. Ensure that it is installed in your system")}async getToken(e,t={}){return P.withSpan(`${this.constructor.name}.getToken`,t,async()=>{let r="string"==typeof e?e:e[0],n=t.claims;if(n&&n.trim()){let e=btoa(n),i=`Connect-AzAccount -ClaimsChallenge ${e}`,o=t.tenantId;o&&(i+=` -Tenant ${o}`);let s=new g(`${sl.claim} ${i}`);throw si.getToken.info(_(r,s)),s}let i=oE(this.tenantId,t,this.additionallyAllowedTenantIds);i&&oC(si,i);try{oN(r,si),si.getToken.info(`Using the scope ${r}`);let t=oM(r),n=await this.getAzurePowerShellAccessToken(t,i,this.timeout);return si.getToken.info(R(e)),{token:n.Token,expiresOnTimestamp:new Date(n.ExpiresOn).getTime(),tokenType:"Bearer"}}catch(t){if(sd(t)){let e=new g(sl.installed);throw si.getToken.info(_(r,e)),e}if(su(t)){let e=new g(sl.login);throw si.getToken.info(_(r,e)),e}let e=new g(`${t}. ${sl.troubleshoot}`);throw si.getToken.info(_(r,e)),e}})}}async function sf(e){let t=e.match(/{[^{}]*}/g),r=e;if(t)try{for(let e of t)try{let t=JSON.parse(e);if(t?.Token)return(r=r.replace(e,""))&&si.getToken.warning(r),t}catch(e){continue}}catch(t){throw Error(`Unable to parse the output of PowerShell. Received output: ${e}`)}throw Error(`No access token found in the output. Received output: ${e}`)}let sg=O("VisualStudioCodeCredential"),sm={adfs:"The VisualStudioCodeCredential does not support authentication with ADFS tenants."};class sy{tenantId;additionallyAllowedTenantIds;msalClient;options;constructor(e){this.options=e||{},e&&e.tenantId?(oC(sg,e.tenantId),this.tenantId=e.tenantId):this.tenantId="common",this.additionallyAllowedTenantIds=oI(e?.additionallyAllowedTenants),function(e){let t=sm[e];if(t)throw new g(t)}(this.tenantId)}async prepare(e){let t=oE(this.tenantId,this.options,this.additionallyAllowedTenantIds,sg)||this.tenantId;if(!(void 0!==s&&void 0!==a)||!s)throw new g("Visual Studio Code Authentication is not available. Ensure you have have Azure Resources Extension installed in VS Code, signed into Azure via VS Code, installed the @azure/identity-vscode package, and properly configured the extension.");let r=await this.loadAuthRecord(s,e);this.msalClient=oS("aebc6443-996d-45c2-90f0-388ff96faa56",t,{...this.options,isVSCodeCredential:!0,brokerOptions:{enabled:!0,parentWindowHandle:new Uint8Array(0),useDefaultBrokerAccount:!0},authenticationRecord:r})}preparePromise;prepareOnce(e){return this.preparePromise||(this.preparePromise=this.prepare(e)),this.preparePromise}async getToken(e,t){let r=oP(e);if(await this.prepareOnce(r),!this.msalClient)throw new g("Visual Studio Code Authentication failed to initialize. Ensure you have have Azure Resources Extension installed in VS Code, signed into Azure via VS Code, installed the @azure/identity-vscode package, and properly configured the extension.");return this.msalClient.getTokenByInteractiveRequest(r,{...t,disableAutomaticAuthentication:!0})}async loadAuthRecord(e,t){try{let t=await (0,ob.readFile)(e,{encoding:"utf8"});return function(e){let t=JSON.parse(e);if(t.version&&"1.0"!==t.version)throw Error("Unsupported AuthenticationRecord version");return t}(t)}catch(e){throw sg.getToken.info(_(t,e)),new g("Cannot load authentication record in Visual Studio Code. Ensure you have have Azure Resources Extension installed in VS Code, signed into Azure via VS Code, installed the @azure/identity-vscode package, and properly configured the extension.")}}}let sT=O("BrokerCredential");class sE{brokerMsalClient;brokerTenantId;brokerAdditionallyAllowedTenantIds;constructor(e){this.brokerTenantId=oA(sT,e.tenantId),this.brokerAdditionallyAllowedTenantIds=oI(e?.additionallyAllowedTenants);let t={...e,tokenCredentialOptions:e,logger:sT,brokerOptions:{enabled:!0,parentWindowHandle:new Uint8Array(0),useDefaultBrokerAccount:!0}};this.brokerMsalClient=oS(l,this.brokerTenantId,t)}async getToken(e,t={}){return P.withSpan(`${this.constructor.name}.getToken`,t,async t=>{t.tenantId=oE(this.brokerTenantId,t,this.brokerAdditionallyAllowedTenantIds,sT);let r=oP(e);try{return this.brokerMsalClient.getBrokeredToken(r,!0,{...t,disableAutomaticAuthentication:!0})}catch(e){throw sT.getToken.info(_(r,e)),new g("Failed to acquire token using broker authentication",{cause:e})}})}}function sC(e={}){return new sE(e)}function sA(e={}){return new sy(e)}function sI(e={}){e.retryOptions??={maxRetries:5,retryDelayInMs:800},e.sendProbeRequest??=!0;let t=e?.managedIdentityClientId??process.env.AZURE_CLIENT_ID,r=e?.workloadIdentityClientId??t,n=e?.managedIdentityResourceId,i=process.env.AZURE_FEDERATED_TOKEN_FILE,o=e?.tenantId??process.env.AZURE_TENANT_ID;return n?new o1({...e,resourceId:n}):i&&r?new o1(r,{...e,tenantId:o}):new o1(t?{...e,clientId:t}:e)}function sv(e){let t=e?.managedIdentityClientId??process.env.AZURE_CLIENT_ID,r=e?.workloadIdentityClientId??t,n=process.env.AZURE_FEDERATED_TOKEN_FILE,i=e?.tenantId??process.env.AZURE_TENANT_ID;return new oQ(n&&r?{...e,tenantId:i,clientId:r,tokenFilePath:n}:i?{...e,tenantId:i}:e)}function sS(e={}){return new o4(e)}function sw(e={}){return new st(e)}function sb(e={}){return new sp(e)}function sR(e={}){return new oH(e)}let s_=O("DefaultAzureCredential");class sk{credentialUnavailableErrorMessage;credentialName;constructor(e,t){this.credentialName=e,this.credentialUnavailableErrorMessage=t}getToken(){return s_.getToken.info(`Skipping ${this.credentialName}, reason: ${this.credentialUnavailableErrorMessage}`),Promise.resolve(null)}}class sO extends M{constructor(e){(function(e){if(e?.requiredEnvVars){let t=(Array.isArray(e.requiredEnvVars)?e.requiredEnvVars:[e.requiredEnvVars]).filter(e=>!process.env[e]);if(t.length>0){let e=`Required environment ${1===t.length?"variable":"variables"} '${t.join(", ")}' for DefaultAzureCredential ${1===t.length?"is":"are"} not set or empty.`;throw s_.warning(e),Error(e)}}})(e);let t=process.env.AZURE_TOKEN_CREDENTIALS?process.env.AZURE_TOKEN_CREDENTIALS.trim().toLowerCase():void 0,r=[sA,sw,sb,sS,sC],n=[sR,sv,sI],i=[];if(t)switch(t){case"dev":i=r;break;case"prod":i=n;break;case"environmentcredential":i=[sR];break;case"workloadidentitycredential":i=[sv];break;case"managedidentitycredential":i=[()=>sI({sendProbeRequest:!1})];break;case"visualstudiocodecredential":i=[sA];break;case"azureclicredential":i=[sw];break;case"azurepowershellcredential":i=[sb];break;case"azuredeveloperclicredential":i=[sS];break;default:{let e=`Invalid value for AZURE_TOKEN_CREDENTIALS = ${process.env.AZURE_TOKEN_CREDENTIALS}. Valid values are 'prod' or 'dev' or any of these credentials - EnvironmentCredential, WorkloadIdentityCredential, ManagedIdentityCredential, VisualStudioCodeCredential, AzureCliCredential, AzurePowerShellCredential, AzureDeveloperCliCredential.`;throw s_.warning(e),Error(e)}}else i=[...n,...r];super(...i.map(t=>{try{return t(e??{})}catch(e){return s_.warning(`Skipped ${t.name} because of an error creating the credential: ${e}`),new sk(t.name,e.message)}}))}}O("InteractiveBrowserCredential"),O("DeviceCodeCredential"),O("AzurePipelinesCredential"),O("AuthorizationCodeCredential"),O("OnBehalfOfCredential")},29061:(e,t,r)=>{"use strict";function n(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function i(e){return this instanceof i?(this.v=e,this):new i(e)}function o(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),s=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),n[Symbol.asyncIterator]=function(){return this},n;function a(e,t){o[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||c(e,t)})},t&&(n[e]=t(n[e])))}function c(e,t){try{var r;(r=o[e](t)).value instanceof i?Promise.resolve(r.value.v).then(l,u):d(s[0][2],r)}catch(e){d(s[0][3],e)}}function l(e){c("next",e)}function u(e){c("throw",e)}function d(e,t){e(t),s.shift(),s.length&&c(s[0][0],s[0][1])}}function s(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,i,(t=e[r](t)).done,t.value)})}}}r.d(t,{rx:()=>eS}),Object.create,Object.create;var a,c,l=("function"==typeof SuppressedError&&SuppressedError,r(73807));let u=(0,l.YR)("keyvault-secrets"),d=(0,l.YR)("keyvault-secrets");var h=r(47390);function p(e,t){return"string"==typeof e?(0,h.r$)(e,t):(0,h.r$)(e)}var f=r(18084),g=r(92356);function m(e){return e&&"function"==typeof e.getToken&&(void 0===e.signRequest||e.getToken.length>0)}function y(e){return(0,h.dj)(e)}function T(e){return e.onResponse?{...e,onResponse(t,r){e.onResponse?.(t,r,r)}}:e}function E(e){return{enabled:e.enabled,nbf:e.notBefore?e.notBefore.getTime()/1e3|0:e.notBefore,exp:e.expires?e.expires.getTime()/1e3|0:e.expires}}function C(e){return{enabled:e.enabled,notBefore:e.nbf?new Date(1e3*e.nbf):e.nbf,expires:e.exp?new Date(1e3*e.exp):e.exp,created:e.created?new Date(1e3*e.created):e.created,updated:e.updated?new Date(1e3*e.updated):e.updated,recoverableDays:e.recoverableDays,recoveryLevel:e.recoveryLevel}}function A(e){return{value:e.value,id:e.id,contentType:e.contentType,attributes:e.attributes?C(e.attributes):e.attributes,tags:e.tags,kid:e.kid,managed:e.managed}}function I(e){return{error:e.error?function e(t){return{code:t.code,message:t.message,innerError:t.innererror?e(t.innererror):t.innererror}}(e.error):e.error}}function v(e){return{value:e.value,id:e.id,contentType:e.contentType,attributes:e.attributes?C(e.attributes):e.attributes,tags:e.tags,kid:e.kid,managed:e.managed,recoveryId:e.recoveryId,scheduledPurgeDate:e.scheduledPurgeDate?new Date(1e3*e.scheduledPurgeDate):e.scheduledPurgeDate,deletedDate:e.deletedDate?new Date(1e3*e.deletedDate):e.deletedDate}}function S(e){return{value:e.value?e.value.map(e=>({id:e.id,attributes:e.attributes?C(e.attributes):e.attributes,tags:e.tags,contentType:e.contentType,managed:e.managed})):e.value,nextLink:e.nextLink}}function w(e,t,r,n,a={}){var c,l;let u=null!==(c=a.itemName)&&void 0!==c?c:"value",d=null!==(l=a.nextLinkName)&&void 0!==l?l:"nextLink",h={getPage:async i=>{let o=void 0===i?await t():await e.pathUnchecked(i).get();(function(e,t){if(!t.includes(e.status))throw p(`Pagination failed with unexpected statusCode ${e.status}`,e)})(o,n);let s=await r(o),a=function(e,t){if(!t)return;let r=e[t];if("string"!=typeof r&&null!=r)throw new f.oY(`Body Property ${t} should be a string or undefined or null but got ${typeof r}`);if(null!==r)return r}(s,d);return{page:function(e,t){let r=e[t];if(!Array.isArray(r))throw new f.oY(`Couldn't paginate response
 Body doesn't contain an array property with name: ${t}`);return null!=r?r:[]}(s,u),nextPageLink:a}},byPage:e=>{let{continuationToken:t}=null!=e?e:{};return b(h,{pageLink:t})}};return function(e){var t;let r=function(e){return o(this,arguments,function*(){var t,r,n,o;let a=b(e);try{for(var c,l=!0,u=s(a);!(t=(c=yield i(u.next())).done);l=!0)o=c.value,l=!1,yield i((yield*function(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,o){t[n]=e[n]?function(t){return(r=!r)?{value:i(e[n](t)),done:!1}:o?o(t):t}:o}}(s(o))))}catch(e){r={error:e}}finally{try{!l&&!t&&(n=u.return)&&(yield i(n.call(u)))}finally{if(r)throw r.error}}})}(e);return{next:()=>r.next(),[Symbol.asyncIterator](){return this},byPage:null!==(t=null==e?void 0:e.byPage)&&void 0!==t?t:t=>{let{continuationToken:r}=null!=t?t:{};return b(e,{pageLink:r})}}}(h)}function b(e){return o(this,arguments,function*(e,t={}){let{pageLink:r}=t,n=yield i(e.getPage(null!=r?r:e.firstPageLink));if(!n)return yield i(void 0);let o=n.page;for(o.continuationToken=n.nextPageLink,yield yield i(o);n.nextPageLink;){if(!(n=yield i(e.getPage(n.nextPageLink))))return yield i(void 0);(o=n.page).continuationToken=n.nextPageLink,yield yield i(o)}})}function R(e,t,r){return(null!=t?t:"+"===r)||"#"===r?_(e):k(e)}function _(e){return e.split(/(%[0-9A-Fa-f]{2})/g).map(e=>/%[0-9A-Fa-f]/.test(e)?e:encodeURI(e)).join("")}function k(e){return encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)}function O(e){return null!=e}function P(e){return[!!e&&[";","?","&"].includes(e),e&&["?","&"].includes(e)?"=":""]}function N(e,t=!1){return t?e&&"+"!==e?e:"":e&&"+"!==e&&"#"!==e?"?"===e?"&":e:","}function M(e,t,r){return e.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,(e,n,i)=>{let o;if(!n)return _(i);["+","#",".","/",";","?","&"].includes(n[0])&&(o=n[0],n=n.slice(1));let s=n.split(/,/g),a=[];for(let e of s){let n=/([^:\*]*)(?::(\d+)|(\*))?/.exec(e);if(!n||!n[1])continue;let i=function(e){let{op:t,varName:r,modifier:n,isFirst:i,reserved:o,varValue:s}=e;if(O(s)){if(["string","number","boolean"].includes(typeof s)){let e=s.toString(),[a,c]=P(t),l=[N(t,i)];return a&&r&&(l.push(r),""===e?l.push(c):l.push("=")),n&&"*"!==n&&(e=e.substring(0,parseInt(n,10))),l.push(R(e,o,t)),l.join("")}return"*"===n?function(e){let t=e.isFirst,{op:r,varName:n,varValue:i,reserved:o}=e,s=[],[a,c]=P(r);if(Array.isArray(i))for(let e of i.filter(O))s.push(`${N(r,t)}`),a&&n&&(s.push(`${encodeURIComponent(n)}`),""===e?s.push(c):s.push("=")),s.push(R(e,o,r)),t=!1;else if("object"==typeof i)for(let e of Object.keys(i)){let n=i[e];O(n)&&(s.push(`${N(r,t)}`),e&&(s.push(`${encodeURIComponent(e)}`),a&&""===n?s.push(c):s.push("=")),s.push(R(n,o,r)),t=!1)}return s.join("")}(e):function(e){let{op:t,varName:r,varValue:n,isFirst:i,reserved:o}=e,s=[],a=N(t,i),[c,l]=P(t);if(c&&r){if(s.push(R(r,o,t)),""===n)return l||s.push(l),s.join("")?`${a}${s.join("")}`:void 0;s.push("=")}let u=[];if(Array.isArray(n))for(let e of n.filter(O))u.push(R(e,o,t));else if("object"==typeof n)for(let e of Object.keys(n))O(n[e])&&(u.push(k(e)),u.push(R(n[e],o,t)));return s.push(u.join(",")),s.join(",")?`${a}${s.join("")}`:void 0}(e)}}({isFirst:0===a.length,op:o,varValue:t[n[1]],varName:n[1],modifier:n[2]||n[3],reserved:null==r?void 0:r.allowReserved});i&&a.push(i)}return a.join("")})}async function D(e){if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return A(e.body)}async function U(e,t,r={requestOptions:{}}){return D(await function(e,t,r={requestOptions:{}}){var n,i;let o=M("/secrets/restore{?api%2Dversion}",{"api%2Dversion":e.apiVersion},{allowReserved:null===(n=null==r?void 0:r.requestOptions)||void 0===n?void 0:n.skipUrlEncoding});return e.path(o).post(Object.assign(Object.assign({},y(r)),{contentType:"application/json",headers:Object.assign({accept:"application/json"},null===(i=r.requestOptions)||void 0===i?void 0:i.headers),body:{value:(0,g.DA)(t.secretBundleBackup,"base64url")}}))}(e,t,r))}async function x(e){var t;if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return{value:(t=e.body).value&&"string"==typeof t.value?(0,g.sy)(t.value,"base64url"):t.value}}async function $(e,t,r={requestOptions:{}}){return x(await function(e,t,r={requestOptions:{}}){var n,i;let o=M("/secrets/{secret-name}/backup{?api%2Dversion}",{"secret-name":t,"api%2Dversion":e.apiVersion},{allowReserved:null===(n=null==r?void 0:r.requestOptions)||void 0===n?void 0:n.skipUrlEncoding});return e.path(o).post(Object.assign(Object.assign({},y(r)),{headers:Object.assign({accept:"application/json"},null===(i=r.requestOptions)||void 0===i?void 0:i.headers)}))}(e,t,r))}async function q(e){if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return A(e.body)}async function L(e,t,r={requestOptions:{}}){return q(await function(e,t,r={requestOptions:{}}){var n,i;let o=M("/deletedsecrets/{secret-name}/recover{?api%2Dversion}",{"secret-name":t,"api%2Dversion":e.apiVersion},{allowReserved:null===(n=null==r?void 0:r.requestOptions)||void 0===n?void 0:n.skipUrlEncoding});return e.path(o).post(Object.assign(Object.assign({},y(r)),{headers:Object.assign({accept:"application/json"},null===(i=r.requestOptions)||void 0===i?void 0:i.headers)}))}(e,t,r))}async function F(e){if(!["204"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}}async function H(e,t,r={requestOptions:{}}){return F(await function(e,t,r={requestOptions:{}}){var n,i;let o=M("/deletedsecrets/{secret-name}{?api%2Dversion}",{"secret-name":t,"api%2Dversion":e.apiVersion},{allowReserved:null===(n=null==r?void 0:r.requestOptions)||void 0===n?void 0:n.skipUrlEncoding});return e.path(o).delete(Object.assign(Object.assign({},y(r)),{headers:Object.assign({accept:"application/json"},null===(i=r.requestOptions)||void 0===i?void 0:i.headers)}))}(e,t,r))}async function j(e){if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return v(e.body)}async function B(e,t,r={requestOptions:{}}){return j(await function(e,t,r={requestOptions:{}}){var n,i;let o=M("/deletedsecrets/{secret-name}{?api%2Dversion}",{"secret-name":t,"api%2Dversion":e.apiVersion},{allowReserved:null===(n=null==r?void 0:r.requestOptions)||void 0===n?void 0:n.skipUrlEncoding});return e.path(o).get(Object.assign(Object.assign({},y(r)),{headers:Object.assign({accept:"application/json"},null===(i=r.requestOptions)||void 0===i?void 0:i.headers)}))}(e,t,r))}async function z(e){var t;if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return{value:(t=e.body).value?t.value.map(e=>({id:e.id,attributes:e.attributes?C(e.attributes):e.attributes,tags:e.tags,contentType:e.contentType,managed:e.managed,recoveryId:e.recoveryId,scheduledPurgeDate:e.scheduledPurgeDate?new Date(1e3*e.scheduledPurgeDate):e.scheduledPurgeDate,deletedDate:e.deletedDate?new Date(1e3*e.deletedDate):e.deletedDate})):t.value,nextLink:t.nextLink}}async function G(e){if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return S(e.body)}async function V(e){if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return S(e.body)}async function K(e){if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return A(e.body)}async function Y(e,t,r,n={requestOptions:{}}){return K(await function(e,t,r,n={requestOptions:{}}){var i,o;let s=M("/secrets/{secret-name}/{secret-version}{?api%2Dversion}",{"secret-name":t,"secret-version":r,"api%2Dversion":e.apiVersion},{allowReserved:null===(i=null==n?void 0:n.requestOptions)||void 0===i?void 0:i.skipUrlEncoding});return e.path(s).get(Object.assign(Object.assign({},y(n)),{headers:Object.assign({accept:"application/json"},null===(o=n.requestOptions)||void 0===o?void 0:o.headers)}))}(e,t,r,n))}async function W(e){if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return A(e.body)}async function Q(e,t,r,n,i={requestOptions:{}}){return W(await function(e,t,r,n,i={requestOptions:{}}){var o,s;let a=M("/secrets/{secret-name}/{secret-version}{?api%2Dversion}",{"secret-name":t,"secret-version":r,"api%2Dversion":e.apiVersion},{allowReserved:null===(o=null==i?void 0:i.requestOptions)||void 0===o?void 0:o.skipUrlEncoding});return e.path(a).patch(Object.assign(Object.assign({},y(i)),{contentType:"application/json",headers:Object.assign({accept:"application/json"},null===(s=i.requestOptions)||void 0===s?void 0:s.headers),body:{contentType:n.contentType,attributes:n.secretAttributes?E(n.secretAttributes):n.secretAttributes,tags:n.tags}}))}(e,t,r,n,i))}async function J(e){if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return v(e.body)}async function Z(e,t,r={requestOptions:{}}){return J(await function(e,t,r={requestOptions:{}}){var n,i;let o=M("/secrets/{secret-name}{?api%2Dversion}",{"secret-name":t,"api%2Dversion":e.apiVersion},{allowReserved:null===(n=null==r?void 0:r.requestOptions)||void 0===n?void 0:n.skipUrlEncoding});return e.path(o).delete(Object.assign(Object.assign({},y(r)),{headers:Object.assign({accept:"application/json"},null===(i=r.requestOptions)||void 0===i?void 0:i.headers)}))}(e,t,r))}async function X(e){if(!["200"].includes(e.status)){let t=p(e);throw t.details=I(e.body),t}return A(e.body)}async function ee(e,t,r,n={requestOptions:{}}){return X(await function(e,t,r,n={requestOptions:{}}){var i,o;let s=M("/secrets/{secret-name}{?api%2Dversion}",{"secret-name":t,"api%2Dversion":e.apiVersion},{allowReserved:null===(i=null==n?void 0:n.requestOptions)||void 0===i?void 0:i.skipUrlEncoding});return e.path(s).put(Object.assign(Object.assign({},y(n)),{contentType:"application/json",headers:Object.assign({accept:"application/json"},null===(o=n.requestOptions)||void 0===o?void 0:o.headers),body:{value:r.value,tags:r.tags,contentType:r.contentType,attributes:r.secretAttributes?E(r.secretAttributes):r.secretAttributes}}))}(e,t,r,n))}(function(e){e.Purgeable="Purgeable",e.RecoverablePurgeable="Recoverable+Purgeable",e.Recoverable="Recoverable",e.RecoverableProtectedSubscription="Recoverable+ProtectedSubscription",e.CustomizedRecoverablePurgeable="CustomizedRecoverable+Purgeable",e.CustomizedRecoverable="CustomizedRecoverable",e.CustomizedRecoverableProtectedSubscription="CustomizedRecoverable+ProtectedSubscription"})(a||(a={})),function(e){e.V75="7.5",e.V76Preview2="7.6-preview.2",e.V76="7.6"}(c||(c={}));class et{constructor(e,t,r={}){var i;let o=null===(i=null==r?void 0:r.userAgentOptions)||void 0===i?void 0:i.userAgentPrefix,s=o?`${o} azsdk-js-client`:"azsdk-js-client";this._client=function(e,t,r={}){var i,o,s,a,c,l,u,p;let y=null!==(o=null!==(i=r.endpoint)&&void 0!==i?i:r.baseUrl)&&void 0!==o?o:String(e),E=null===(s=null==r?void 0:r.userAgentOptions)||void 0===s?void 0:s.userAgentPrefix,C="azsdk-js-keyvault-secrets/1.0.0-beta.1",A=E?`${E} azsdk-js-api ${C}`:`azsdk-js-api ${C}`,I=Object.assign(Object.assign({},r),{userAgentOptions:{userAgentPrefix:A},loggingOptions:{logger:null!==(c=null===(a=r.loggingOptions)||void 0===a?void 0:a.logger)&&void 0!==c?c:d.info},credentials:{scopes:null!==(u=null===(l=r.credentials)||void 0===l?void 0:l.scopes)&&void 0!==u?u:["https://vault.azure.net/.default"]}}),{apiVersion:v}=I,S=function(e,t,r={}){var n;let i;t&&((n=t,(0,g.LW)(n,["key"])&&"string"==typeof n.key||m(n))?i=t:r=t??{});let o=function(e,t,r={}){let n=(0,f.WA)(r);return n.addPolicy({name:"ApiVersionPolicy",sendRequest:(e,t)=>{let n=new URL(e.url);return!n.searchParams.get("api-version")&&r.apiVersion&&(e.url=`${e.url}${Array.from(n.searchParams.keys()).length>0?"&":"?"}api-version=${r.apiVersion}`),t(e)}}),function(e,t,r={}){let{credential:n,clientOptions:i}=r;if(n){if(m(n)){let r=(0,f.vA)({credential:n,scopes:i?.credentials?.scopes??`${t}/.default`});e.addPolicy(r)}else if(void 0!==n.key){var o;if(!i?.credentials?.apiKeyHeaderName)throw Error("Missing API Key Header Name");let t=(o=i?.credentials?.apiKeyHeaderName,{name:"keyCredentialAuthenticationPolicy",sendRequest:async(e,t)=>(e.headers.set(o,n.key),t(e))});e.addPolicy(t)}}}(n,e,{credential:t,clientOptions:r}),n}(e,i,r),s=(0,h.s3)(e,{...r,pipeline:o}),a=(e,...t)=>({get:(r={})=>s.path(e,...t).get(T(r)),post:(r={})=>s.path(e,...t).post(T(r)),put:(r={})=>s.path(e,...t).put(T(r)),patch:(r={})=>s.path(e,...t).patch(T(r)),delete:(r={})=>s.path(e,...t).delete(T(r)),head:(r={})=>s.path(e,...t).head(T(r)),options:(r={})=>s.path(e,...t).options(T(r)),trace:(r={})=>s.path(e,...t).trace(T(r))});return{path:a,pathUnchecked:a,pipeline:s.pipeline}}(y,t,n(I,["apiVersion"]));S.pipeline.removePolicy({name:"ApiVersionPolicy"});let w=null!==(p=r.apiVersion)&&void 0!==p?p:"7.6";return S.pipeline.addPolicy({name:"ClientApiVersionPolicy",sendRequest:(e,t)=>{let r=new URL(e.url);return r.searchParams.get("api-version")||(e.url=`${e.url}${Array.from(r.searchParams.keys()).length>0?"&":"?"}api-version=${w}`),t(e)}}),Object.assign(Object.assign({},S),{apiVersion:w})}(e,t,Object.assign(Object.assign({},r),{userAgentOptions:{userAgentPrefix:s}})),this.pipeline=this._client.pipeline}restoreSecret(e,t={requestOptions:{}}){return U(this._client,e,t)}backupSecret(e,t={requestOptions:{}}){return $(this._client,e,t)}recoverDeletedSecret(e,t={requestOptions:{}}){return L(this._client,e,t)}purgeDeletedSecret(e,t={requestOptions:{}}){return H(this._client,e,t)}getDeletedSecret(e,t={requestOptions:{}}){return B(this._client,e,t)}getDeletedSecrets(e={requestOptions:{}}){return function(e,t={requestOptions:{}}){return w(e,()=>(function(e,t={requestOptions:{}}){var r,n;let i=M("/deletedsecrets{?api%2Dversion,maxresults}",{"api%2Dversion":e.apiVersion,maxresults:null==t?void 0:t.maxresults},{allowReserved:null===(r=null==t?void 0:t.requestOptions)||void 0===r?void 0:r.skipUrlEncoding});return e.path(i).get(Object.assign(Object.assign({},y(t)),{headers:Object.assign({accept:"application/json"},null===(n=t.requestOptions)||void 0===n?void 0:n.headers)}))})(e,t),z,["200"],{itemName:"value",nextLinkName:"nextLink"})}(this._client,e)}getSecretVersions(e,t={requestOptions:{}}){return function(e,t,r={requestOptions:{}}){return w(e,()=>(function(e,t,r={requestOptions:{}}){var n,i;let o=M("/secrets/{secret-name}/versions{?api%2Dversion,maxresults}",{"secret-name":t,"api%2Dversion":e.apiVersion,maxresults:null==r?void 0:r.maxresults},{allowReserved:null===(n=null==r?void 0:r.requestOptions)||void 0===n?void 0:n.skipUrlEncoding});return e.path(o).get(Object.assign(Object.assign({},y(r)),{headers:Object.assign({accept:"application/json"},null===(i=r.requestOptions)||void 0===i?void 0:i.headers)}))})(e,t,r),G,["200"],{itemName:"value",nextLinkName:"nextLink"})}(this._client,e,t)}getSecrets(e={requestOptions:{}}){return function(e,t={requestOptions:{}}){return w(e,()=>(function(e,t={requestOptions:{}}){var r,n;let i=M("/secrets{?api%2Dversion,maxresults}",{"api%2Dversion":e.apiVersion,maxresults:null==t?void 0:t.maxresults},{allowReserved:null===(r=null==t?void 0:t.requestOptions)||void 0===r?void 0:r.skipUrlEncoding});return e.path(i).get(Object.assign(Object.assign({},y(t)),{headers:Object.assign({accept:"application/json"},null===(n=t.requestOptions)||void 0===n?void 0:n.headers)}))})(e,t),V,["200"],{itemName:"value",nextLinkName:"nextLink"})}(this._client,e)}getSecret(e,t,r={requestOptions:{}}){return Y(this._client,e,t,r)}updateSecret(e,t,r,n={requestOptions:{}}){return Q(this._client,e,t,r,n)}deleteSecret(e,t={requestOptions:{}}){return Z(this._client,e,t)}setSecret(e,t,r={requestOptions:{}}){return ee(this._client,e,t,r)}}let er=["authorization","authorization_url","resource","scope","tenantId","claims","error"];function en(e){let t=e.split(/,? +/).reduce((e,t)=>{if(t.match(/\w="/)){let[r,...n]=t.split("=");if(er.includes(r))return Object.assign(Object.assign({},e),{[r]:n.join("=").slice(1,-1)})}return e},{});if(t.authorization)try{let e=new URL(t.authorization).pathname.substring(1);e&&(t.tenantId=e)}catch(e){throw Error(`The challenge authorization URI '${t.authorization}' is invalid.`)}return t}let ei={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:12e4};async function eo(e,t,r){async function n(){if(Date.now()<r)try{return await e()}catch(e){return null}else{let t=await e();if(null===t)throw Error("Failed to refresh access token.");return t}}let i=await n();for(;null===i;)await (0,g.gw)(t),i=await n();return i}let es=(0,l.YR)("keyvault-common");function ea(e){let t=function(e){let t=e.split("/")[3];return Object.assign({sourceId:e},function(e,t){let r;if("string"!=typeof e||!(e=e.trim()))throw Error("Invalid collection argument");if("string"!=typeof t||!(t=t.trim()))throw Error("Invalid identifier argument");try{r=new URL(t)}catch(r){throw Error(`Invalid ${e} identifier: ${t}. Not a valid URI`)}let n=(r.pathname||"").split("/");if(3!==n.length&&4!==n.length)throw Error(`Invalid ${e} identifier: ${t}. Bad number of segments: ${n.length}`);if(e!==n[1])throw Error(`Invalid ${e} identifier: ${t}. segment [1] should be "${e}", found "${n[1]}"`);return{vaultUrl:`${r.protocol}//${r.host}`,name:n[2],version:4===n.length?n[3]:void 0}}(t,e))}(e.id),r=e.attributes;delete e.attributes;let n={value:e.value,name:t.name,properties:{expiresOn:null==r?void 0:r.expires,createdOn:null==r?void 0:r.created,updatedOn:null==r?void 0:r.updated,enabled:null==r?void 0:r.enabled,notBefore:null==r?void 0:r.notBefore,recoverableDays:null==r?void 0:r.recoverableDays,recoveryLevel:null==r?void 0:r.recoveryLevel,id:e.id,contentType:e.contentType,tags:e.tags,managed:e.managed,vaultUrl:t.vaultUrl,version:t.version,name:t.name,certificateKeyId:e.kid}};return e.recoveryId&&(n.properties.recoveryId=e.recoveryId,n.properties.scheduledPurgeDate=e.scheduledPurgeDate,n.properties.deletedOn=e.deletedDate,n.recoveryId=e.recoveryId,n.scheduledPurgeDate=e.scheduledPurgeDate,n.deletedOn=e.deletedDate),r&&(r.vaultUrl&&delete n.properties.vaultUrl,r.expires&&delete n.properties.expires,r.created&&delete n.properties.created,r.updated&&delete n.properties.updated),n}function ec(e,t,r){let n;return{async next(){null!=n||(n=e(Object.assign(Object.assign({},t),{maxresults:void 0})));let i=await n.next();return Object.assign(Object.assign({},i),{value:i.value&&r(i.value)})},[Symbol.asyncIterator](){return this},byPage(n){return o(this,arguments,function*(){var o,a,c,l;let u=e(Object.assign(Object.assign({},t),{maxresults:null==n?void 0:n.maxPageSize})).byPage(n);try{for(var d,h=!0,p=s(u);!(o=(d=yield i(p.next())).done);h=!0)l=d.value,h=!1,yield yield i(l.map(r))}catch(e){a={error:e}}finally{try{!h&&!o&&(c=p.return)&&(yield i(c.call(p)))}finally{if(a)throw a.error}}})}}}var el=r(96665);let eu="4.10.0",ed=(0,el.U)({namespace:"Microsoft.KeyVault",packageName:"@azure/keyvault-secrets",packageVersion:eu}),eh=(0,l.YR)("core-lro"),ep=["succeeded","canceled","failed"];function ef(e){let{state:t,stateProxy:r,isOperationError:n}=e;return e=>{throw n(e)&&(r.setError(t,e),r.setFailed(t)),e}}class eg extends Error{constructor(e){super(e),this.name="PollerStoppedError",Object.setPrototypeOf(this,eg.prototype)}}class em extends Error{constructor(e){super(e),this.name="PollerCancelledError",Object.setPrototypeOf(this,em.prototype)}}class ey{constructor(e){this.resolveOnUnsuccessful=!1,this.stopped=!0,this.pollProgressCallbacks=[],this.operation=e,this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t}),this.promise.catch(()=>{})}async startPolling(e={}){for(this.stopped&&(this.stopped=!1);!this.isStopped()&&!this.isDone();)await this.poll(e),await this.delay()}async pollOnce(e={}){this.isDone()||(this.operation=await this.operation.update({abortSignal:e.abortSignal,fireProgress:this.fireProgress.bind(this)})),this.processUpdatedState()}fireProgress(e){for(let t of this.pollProgressCallbacks)t(e)}async cancelOnce(e={}){this.operation=await this.operation.cancel(e)}poll(e={}){if(!this.pollOncePromise){this.pollOncePromise=this.pollOnce(e);let t=()=>{this.pollOncePromise=void 0};this.pollOncePromise.then(t,t).catch(this.reject)}return this.pollOncePromise}processUpdatedState(){if(this.operation.state.error&&(this.stopped=!0,!this.resolveOnUnsuccessful))throw this.reject(this.operation.state.error),this.operation.state.error;if(this.operation.state.isCancelled&&(this.stopped=!0,!this.resolveOnUnsuccessful)){let e=new em("Operation was canceled");throw this.reject(e),e}this.isDone()&&this.resolve&&this.resolve(this.getResult())}async pollUntilDone(e={}){return this.stopped&&this.startPolling(e).catch(this.reject),this.processUpdatedState(),this.promise}onProgress(e){return this.pollProgressCallbacks.push(e),()=>{this.pollProgressCallbacks=this.pollProgressCallbacks.filter(t=>t!==e)}}isDone(){let e=this.operation.state;return!!(e.isCompleted||e.isCancelled||e.error)}stopPolling(){!this.stopped&&(this.stopped=!0,this.reject&&this.reject(new eg("This poller is already stopped")))}isStopped(){return this.stopped}cancelOperation(e={}){if(this.cancelPromise){if(e.abortSignal)throw Error("A cancel request is currently pending")}else this.cancelPromise=this.cancelOnce(e);return this.cancelPromise}getOperationState(){return this.operation.state}getResult(){return this.operation.state.result}toString(){return this.operation.toString()}}class eT extends ey{constructor(){super(...arguments),this.intervalInMs=2e3}async delay(){return(0,g.gw)(this.intervalInMs)}}class eE{constructor(e,t={}){this.state=e,this.cancelMessage="",t.cancelMessage&&(this.cancelMessage=t.cancelMessage)}async update(){throw Error("Operation not supported.")}async cancel(){throw Error(this.cancelMessage)}toString(){return JSON.stringify({state:this.state})}}class eC extends eE{constructor(e,t,r={}){super(e,{cancelMessage:"Canceling the deletion of a secret is not supported."}),this.state=e,this.client=t,this.operationOptions=r}deleteSecret(e,t={}){return ed.withSpan("DeleteSecretPoller.deleteSecret",t,async t=>ea(await this.client.deleteSecret(e,t)))}getDeletedSecret(e,t={}){return ed.withSpan("DeleteSecretPoller.getDeletedSecret",t,async t=>ea(await this.client.getDeletedSecret(e,t)))}async update(e={}){let t=this.state,{name:r}=t;if(e.abortSignal&&(this.operationOptions.abortSignal=e.abortSignal),!t.isStarted){let e=await this.deleteSecret(r,this.operationOptions);t.isStarted=!0,t.result=e,e.properties.recoveryId||(t.isCompleted=!0)}if(!t.isCompleted)try{t.result=await this.getDeletedSecret(r,this.operationOptions),t.isCompleted=!0}catch(e){if(403===e.statusCode)t.isCompleted=!0;else if(404!==e.statusCode)throw t.error=e,t.isCompleted=!0,e}return this}}class eA extends eT{constructor(e){let t;let{client:r,name:n,operationOptions:i,intervalInMs:o=2e3,resumeFrom:s}=e;s&&(t=JSON.parse(s).state),super(new eC(Object.assign(Object.assign({},t),{name:n}),r,i)),this.intervalInMs=o}}class eI extends eE{constructor(e,t,r={}){super(e,{cancelMessage:"Canceling the recovery of a deleted secret is not supported."}),this.state=e,this.client=t,this.options=r}getSecret(e,t={}){return ed.withSpan("RecoverDeletedSecretPoller.getSecret",t,async r=>ea(await this.client.getSecret(e,t&&t.version?t.version:"",r)))}recoverDeletedSecret(e,t={}){return ed.withSpan("RecoverDeletedSecretPoller.recoverDeletedSecret",t,async t=>ea(await this.client.recoverDeletedSecret(e,t)))}async update(e={}){let t=this.state,{name:r}=t;if(e.abortSignal&&(this.options.abortSignal=e.abortSignal),!t.isStarted){try{t.result=(await this.getSecret(r,this.options)).properties,t.isCompleted=!0}catch(e){}t.isCompleted||(t.result=(await this.recoverDeletedSecret(r,this.options)).properties,t.isStarted=!0)}if(!t.isCompleted)try{t.result=(await this.getSecret(r,this.options)).properties,t.isCompleted=!0}catch(e){if(403===e.statusCode)t.isCompleted=!0;else if(404!==e.statusCode)throw t.error=e,t.isCompleted=!0,e}return this}}class ev extends eT{constructor(e){let t;let{client:r,name:n,operationOptions:i,intervalInMs:o=2e3,resumeFrom:s}=e;s&&(t=JSON.parse(s).state),super(new eI(Object.assign(Object.assign({},t),{name:n}),r,i)),this.intervalInMs=o}}class eS{constructor(e,t,r={}){var n,i;this.vaultUrl=e;let o=Object.assign(Object.assign({},r),{userAgentOptions:{userAgentPrefix:`${null!==(i=null===(n=r.userAgentOptions)||void 0===n?void 0:n.userAgentPrefix)&&void 0!==i?i:""} azsdk-js-keyvault-secrets/${eu}`},apiVersion:r.serviceVersion||"7.6",loggingOptions:{logger:u.info,additionalAllowedHeaderNames:["x-ms-keyvault-region","x-ms-keyvault-network-info","x-ms-keyvault-service-version"]}});this.client=new et(this.vaultUrl,t,o),this.client.pipeline.removePolicy({name:f.VC}),this.client.pipeline.addPolicy(function(e,t={}){let{disableChallengeResourceVerification:r}=t,n={status:"none"},i=function(e,t){let r,n=null,i=null,o=Object.assign(Object.assign({},ei),void 0),s={get isRefreshing(){return null!==n},get shouldRefresh(){var a;if(s.isRefreshing)return!1;if((null==i?void 0:i.refreshAfterTimestamp)&&i.refreshAfterTimestamp<Date.now())return!0;return(null!==(a=null==i?void 0:i.expiresOnTimestamp)&&void 0!==a?a:0)-o.refreshWindowInMs<Date.now()},get mustRefresh(){return null===i||i.expiresOnTimestamp-o.forcedRefreshWindowInMs<Date.now()}};function c(t,a){var c;return s.isRefreshing||(n=eo(()=>e.getToken(t,a),o.retryIntervalInMs,null!==(c=null==i?void 0:i.expiresOnTimestamp)&&void 0!==c?c:Date.now()).then(e=>(n=null,i=e,r=a.tenantId,i)).catch(e=>{throw n=null,i=null,r=void 0,e})),n}return async(e,t)=>{let n=!!t.claims,o=r!==t.tenantId;return(n&&(i=null),o||n||s.mustRefresh)?c(e,t):(s.shouldRefresh&&c(e,t),i)}}(e);function o(e){return{abortSignal:e.abortSignal,requestOptions:{timeout:e.timeout>0?e.timeout:void 0},tracingOptions:e.tracingOptions}}async function s(e){let t=o(e);switch(n.status){case"none":n={status:"started",originalBody:e.body},e.body=null;break;case"started":break;case"complete":{let r=await i(n.scopes,Object.assign(Object.assign({},t),{enableCae:!0,tenantId:n.tenantId}));r&&e.headers.set("authorization",`Bearer ${r.token}`)}}}async function a(e,t,s){if(401!==t.status)return t;null===e.body&&"started"===n.status&&(e.body=n.originalBody);let a=o(e),c=t.headers.get("WWW-Authenticate");if(!c)return es.warning("keyVaultAuthentication policy encountered a 401 response without a corresponding WWW-Authenticate header. This is unexpected. Not handling the 401 response."),t;let l=en(c),u=l.resource?l.resource+"/.default":l.scope;if(!u)return t;r||function(e,t){let r;try{r=new URL(e)}catch(t){throw Error(`The challenge contains invalid scope '${e}'`)}if(!new URL(t.url).hostname.endsWith(`.${r.hostname}`))throw Error(`The challenge resource '${r.hostname}' does not match the requested domain. Set disableChallengeResourceVerification to true in your client options to disable. See https://aka.ms/azsdk/blog/vault-uri for more information.`)}(u,e);let d=await i([u],Object.assign(Object.assign({},a),{enableCae:!0,tenantId:l.tenantId}));return d?(e.headers.set("Authorization",`Bearer ${d.token}`),n={status:"complete",scopes:[u],tenantId:l.tenantId},s(e)):t}async function c(e,t,r){if("complete"!==n.status||401!==t.status)return t;let s=o(e),a=t.headers.get("WWW-Authenticate");if(!a)return t;let{claims:c,error:l}=en(a);if("insufficient_claims"!==l||void 0===c)return t;let u=atob(c),d=await i(n.scopes,Object.assign(Object.assign({},s),{enableCae:!0,tenantId:n.tenantId,claims:u}));return e.headers.set("Authorization",`Bearer ${d.token}`),r(e)}return{name:"keyVaultAuthenticationPolicy",sendRequest:async function(e,t){await s(e);let r=await t(e);return r=await a(e,r,t),r=await c(e,r,t)}}}(t,r),{}),this.client.pipeline.addPolicy({name:"ContentTypePolicy",sendRequest(e,t){var r;return(null!==(r=e.headers.get("Content-Type"))&&void 0!==r?r:"").startsWith("application/json")&&e.headers.set("Content-Type","application/json"),t(e)}})}setSecret(e,t,r={}){let{enabled:i,notBefore:o,expiresOn:s,tags:a}=r,c=n(r,["enabled","notBefore","expiresOn","tags"]);return ed.withSpan("SecretClient.setSecret",c,async r=>ea(await this.client.setSecret(e,{value:t,secretAttributes:{enabled:i,notBefore:o,expires:s},tags:a},r)))}async beginDeleteSecret(e,t={}){let r=new eA(Object.assign(Object.assign({name:e,client:this.client},t),{operationOptions:t}));return await r.poll(),r}async updateSecretProperties(e,t,r={}){let{enabled:i,notBefore:o,expiresOn:s,tags:a}=r,c=n(r,["enabled","notBefore","expiresOn","tags"]);return ed.withSpan("SecretClient.updateSecretProperties",c,async r=>ea(await this.client.updateSecret(e,t,{secretAttributes:{enabled:i,notBefore:o,expires:s},tags:a},r)).properties)}getSecret(e,t={}){return ed.withSpan("SecretClient.getSecret",t,async r=>ea(await this.client.getSecret(e,t&&t.version?t.version:"",r)))}getDeletedSecret(e,t={}){return ed.withSpan("SecretClient.getDeletedSecret",t,async t=>ea(await this.client.getDeletedSecret(e,t)))}purgeDeletedSecret(e,t={}){return ed.withSpan("SecretClient.purgeDeletedSecret",t,async t=>{await this.client.purgeDeletedSecret(e,t)})}async beginRecoverDeletedSecret(e,t={}){let r=new ev(Object.assign(Object.assign({name:e,client:this.client},t),{operationOptions:t}));return await r.poll(),r}backupSecret(e,t={}){return ed.withSpan("SecretClient.backupSecret",t,async t=>(await this.client.backupSecret(e,t)).value)}restoreSecretBackup(e,t={}){return ed.withSpan("SecretClient.restoreSecretBackup",t,async t=>ea(await this.client.restoreSecret({secretBundleBackup:e},t)).properties)}listPropertiesOfSecretVersions(e,t={}){return ec(t=>this.client.getSecretVersions(e,t),t,e=>ea(e).properties)}listPropertiesOfSecrets(e={}){return ec(this.client.getSecrets.bind(this.client),e,e=>ea(e).properties)}listDeletedSecrets(e={}){return ec(this.client.getDeletedSecrets.bind(this.client),e,ea)}}},73807:(e,t,r)=>{"use strict";r.d(t,{YR:()=>o,ZO:()=>i});let n=(0,r(2518).oc)({logLevelEnvVarName:"AZURE_LOG_LEVEL",namespace:"azure"});function i(){return n.getLogLevel()}function o(e){return n.createClientLogger(e)}n.logger},18193:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});class n extends Error{constructor(e){super(e),this.name="AbortError"}}},26840:(e,t,r)=>{"use strict";r.d(t,{I:()=>i,J:()=>n});let n="0.3.1",i=3},72119:(e,t,r)=>{"use strict";function n(e){return e.toLowerCase()}r.d(t,{d:()=>o});class i{_headersMap;constructor(e){if(this._headersMap=new Map,e)for(let t of Object.keys(e))this.set(t,e[t])}set(e,t){this._headersMap.set(n(e),{name:e,value:String(t).trim()})}get(e){return this._headersMap.get(n(e))?.value}has(e){return this._headersMap.has(n(e))}delete(e){this._headersMap.delete(n(e))}toJSON(e={}){let t={};if(e.preserveCase)for(let e of this._headersMap.values())t[e.name]=e.value;else for(let[e,r]of this._headersMap)t[e]=r.value;return t}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return function*(e){for(let t of e.values())yield[t.name,t.value]}(this._headersMap)}}function o(e){return new i(e)}},47390:(e,t,r)=>{"use strict";let n;r.d(t,{oY:()=>m,tn:()=>k,AL:()=>d,dC:()=>o.d,kO:()=>c,r$:()=>X,s3:()=>Q,h:()=>y,dj:()=>Z});var i=r(18193);r(2518);var o=r(72119),s=r(68117);class a{url;method;headers;timeout;withCredentials;body;multipartBody;formData;streamResponseStatusCodes;enableBrowserStreams;proxySettings;disableKeepAlive;abortSignal;requestId;allowInsecureConnection;onUploadProgress;onDownloadProgress;requestOverrides;authSchemes;constructor(e){this.url=e.url,this.body=e.body,this.headers=e.headers??(0,o.d)(),this.method=e.method??"GET",this.timeout=e.timeout??0,this.multipartBody=e.multipartBody,this.formData=e.formData,this.disableKeepAlive=e.disableKeepAlive??!1,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=e.withCredentials??!1,this.abortSignal=e.abortSignal,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||(0,s.H)(),this.allowInsecureConnection=e.allowInsecureConnection??!1,this.enableBrowserStreams=e.enableBrowserStreams??!1,this.requestOverrides=e.requestOverrides,this.authSchemes=e.authSchemes}}function c(e){return new a(e)}let l=new Set(["Deserialize","Serialize","Retry","Sign"]);class u{_policies=[];_orderedPolicies;constructor(e){this._policies=e?.slice(0)??[],this._orderedPolicies=void 0}addPolicy(e,t={}){if(t.phase&&t.afterPhase)throw Error("Policies inside a phase cannot specify afterPhase.");if(t.phase&&!l.has(t.phase))throw Error(`Invalid phase name: ${t.phase}`);if(t.afterPhase&&!l.has(t.afterPhase))throw Error(`Invalid afterPhase name: ${t.afterPhase}`);this._policies.push({policy:e,options:t}),this._orderedPolicies=void 0}removePolicy(e){let t=[];return this._policies=this._policies.filter(r=>(!e.name||r.policy.name!==e.name)&&(!e.phase||r.options.phase!==e.phase)||(t.push(r.policy),!1)),this._orderedPolicies=void 0,t}sendRequest(e,t){return this.getOrderedPolicies().reduceRight((e,t)=>r=>t.sendRequest(r,e),t=>e.sendRequest(t))(t)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new u(this._policies)}static create(){return new u}orderPolicies(){let e=[],t=new Map;function r(e){return{name:e,policies:new Set,hasRun:!1,hasAfterPolicies:!1}}let n=r("Serialize"),i=r("None"),o=r("Deserialize"),s=r("Retry"),a=r("Sign"),c=[n,i,o,s,a];function l(e){return"Retry"===e?s:"Serialize"===e?n:"Deserialize"===e?o:"Sign"===e?a:i}for(let e of this._policies){let r=e.policy,n=e.options,i=r.name;if(t.has(i))throw Error("Duplicate policy names not allowed in pipeline");let o={policy:r,dependsOn:new Set,dependants:new Set};n.afterPhase&&(o.afterPhase=l(n.afterPhase),o.afterPhase.hasAfterPolicies=!0),t.set(i,o),l(n.phase).policies.add(o)}for(let e of this._policies){let{policy:r,options:n}=e,i=r.name,o=t.get(i);if(!o)throw Error(`Missing node for policy ${i}`);if(n.afterPolicies)for(let e of n.afterPolicies){let r=t.get(e);r&&(o.dependsOn.add(r),r.dependants.add(o))}if(n.beforePolicies)for(let e of n.beforePolicies){let r=t.get(e);r&&(r.dependsOn.add(o),o.dependants.add(r))}}function u(r){for(let n of(r.hasRun=!0,r.policies))if((!n.afterPhase||n.afterPhase.hasRun&&!n.afterPhase.policies.size)&&0===n.dependsOn.size){for(let t of(e.push(n.policy),n.dependants))t.dependsOn.delete(n);t.delete(n.policy.name),r.policies.delete(n)}}let d=0;for(;t.size>0;){d++;let t=e.length;if(function(){for(let e of c){if(u(e),e.policies.size>0&&e!==i){i.hasRun||u(i);return}e.hasAfterPolicies&&u(i)}}(),e.length<=t&&d>1)throw Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}}function d(){return u.create()}var h=r(14091);let p=r(47261).inspect.custom;var f=r(9002);let g=new f.T;class m extends Error{static REQUEST_SEND_ERROR="REQUEST_SEND_ERROR";static PARSE_ERROR="PARSE_ERROR";code;statusCode;request;response;details;constructor(e,t={}){super(e),this.name="RestError",this.code=t.code,this.statusCode=t.statusCode,Object.defineProperty(this,"request",{value:t.request,enumerable:!1}),Object.defineProperty(this,"response",{value:t.response,enumerable:!1});let r=this.request?.agent?{maxFreeSockets:this.request.agent.maxFreeSockets,maxSockets:this.request.agent.maxSockets}:void 0;Object.defineProperty(this,p,{value:()=>`RestError: ${this.message} 
 ${g.sanitize({...this,request:{...this.request,agent:r},response:this.response})}`,enumerable:!1}),Object.setPrototypeOf(this,m.prototype)}}function y(e){return e instanceof m||(0,h.V)(e)&&"RestError"===e.name}var T=r(88849),E=r(22286),C=r(65628),A=r(84492),I=r(3070);let v={};function S(e){return e&&"function"==typeof e.pipe}function w(e){return!1===e.readable?Promise.resolve():new Promise(t=>{let r=()=>{t(),e.removeListener("close",r),e.removeListener("end",r),e.removeListener("error",r)};e.on("close",r),e.on("end",r),e.on("error",r)})}function b(e){return e&&"number"==typeof e.byteLength}class R extends A.Transform{loadedBytes=0;progressCallback;_transform(e,t,r){this.push(e),this.loadedBytes+=e.length;try{this.progressCallback({loadedBytes:this.loadedBytes}),r()}catch(e){r(e)}}constructor(e){super(),this.progressCallback=e}}class _{cachedHttpAgent;cachedHttpsAgents=new WeakMap;async sendRequest(e){var t,r;let n,s,a;let c=new AbortController;if(e.abortSignal){if(e.abortSignal.aborted)throw new i._("The operation was aborted. Request has already been canceled.");n=e=>{"abort"===e.type&&c.abort()},e.abortSignal.addEventListener("abort",n)}e.timeout>0&&(s=setTimeout(()=>{let t=new f.T;I.k.info(`request to '${t.sanitizeUrl(e.url)}' timed out. canceling...`),c.abort()},e.timeout));let l=e.headers.get("Accept-Encoding"),u=l?.includes("gzip")||l?.includes("deflate"),d="function"==typeof e.body?e.body():e.body;if(d&&!e.headers.has("Content-Length")){let r=(t=d)?Buffer.isBuffer(t)?t.length:S(t)?null:b(t)?t.byteLength:"string"==typeof t?Buffer.from(t).length:null:0;null!==r&&e.headers.set("Content-Length",r)}try{if(d&&e.onUploadProgress){let t=e.onUploadProgress,r=new R(t);r.on("error",e=>{I.k.error("Error in upload progress",e)}),S(d)?d.pipe(r):r.end(d),d=r}let t=await this.makeRequest(e,c,d);void 0!==s&&clearTimeout(s);let n=function(e){let t=(0,o.d)();for(let r of Object.keys(e.headers)){let n=e.headers[r];Array.isArray(n)?n.length>0&&t.set(r,n[0]):n&&t.set(r,n)}return t}(t),i={status:t.statusCode??0,headers:n,request:e};if("HEAD"===e.method)return t.resume(),i;a=u?function(e,t){let r=t.get("Content-Encoding");if("gzip"===r){let t=C.createGunzip();return e.pipe(t),t}if("deflate"===r){let t=C.createInflate();return e.pipe(t),t}return e}(t,n):t;let l=e.onDownloadProgress;if(l){let e=new R(l);e.on("error",e=>{I.k.error("Error in download progress",e)}),a.pipe(e),a=e}return e.streamResponseStatusCodes?.has(Number.POSITIVE_INFINITY)||e.streamResponseStatusCodes?.has(i.status)?i.readableStreamBody=a:i.bodyAsText=await (r=a,new Promise((e,t)=>{let n=[];r.on("data",e=>{Buffer.isBuffer(e)?n.push(e):n.push(Buffer.from(e))}),r.on("end",()=>{e(Buffer.concat(n).toString("utf8"))}),r.on("error",e=>{e&&e?.name==="AbortError"?t(e):t(new m(`Error reading response as text: ${e.message}`,{code:m.PARSE_ERROR}))})})),i}finally{if(e.abortSignal&&n){let t=Promise.resolve();S(d)&&(t=w(d));let r=Promise.resolve();S(a)&&(r=w(a)),Promise.all([t,r]).then(()=>{n&&e.abortSignal?.removeEventListener("abort",n)}).catch(e=>{I.k.warning("Error when cleaning up abortListener on httpRequest",e)})}}}makeRequest(e,t,r){let n=new URL(e.url),o="https:"!==n.protocol;if(o&&!e.allowInsecureConnection)throw Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);let s={agent:e.agent??this.getOrCreateAgent(e,o),hostname:n.hostname,path:`${n.pathname}${n.search}`,port:n.port,method:e.method,headers:e.headers.toJSON({preserveCase:!0}),...e.requestOverrides};return new Promise((n,a)=>{let c=o?T.request(s,n):E.request(s,n);c.once("error",t=>{a(new m(t.message,{code:t.code??m.REQUEST_SEND_ERROR,request:e}))}),t.signal.addEventListener("abort",()=>{let e=new i._("The operation was aborted. Rejecting from abort signal callback while making request.");c.destroy(e),a(e)}),r&&S(r)?r.pipe(c):r?"string"==typeof r||Buffer.isBuffer(r)?c.end(r):b(r)?c.end(ArrayBuffer.isView(r)?Buffer.from(r.buffer):Buffer.from(r)):(I.k.error("Unrecognized body type",r),a(new m("Unrecognized body type"))):c.end()})}getOrCreateAgent(e,t){let r=e.disableKeepAlive;if(t)return r?T.globalAgent:(this.cachedHttpAgent||(this.cachedHttpAgent=new T.Agent({keepAlive:!0})),this.cachedHttpAgent);{if(r&&!e.tlsSettings)return E.globalAgent;let t=e.tlsSettings??v,n=this.cachedHttpsAgents.get(t);return n&&!r===n.options.keepAlive||(I.k.info("No cached TLS Agent exist, creating a new Agent"),n=new E.Agent({keepAlive:!r,...t}),this.cachedHttpsAgents.set(t,n)),n}}}function k(){return new _}var O=r(83110),P=r(11222),N=r(21525),M=r(28455),D=r(77691),U=r(45091),x=r(69826),$=r(38073),q=r(65914),L=r(45796),F=r(63450);let H=!1;function j(e,t){if(!e.url.toLowerCase().startsWith("https://")){if(function(e,t){if(t.allowInsecureConnection&&e.allowInsecureConnection){let t=new URL(e.url);if("localhost"===t.hostname||"127.0.0.1"===t.hostname)return!0}return!1}(e,t))!function(){let e="Sending token over insecure transport. Assume any token issued is compromised.";I.k.warning(e),"function"!=typeof process?.emitWarning||H||(H=!0,process.emitWarning(e))}();else throw Error("Authentication is not permitted for non-TLS protected (non-https) URLs when allowInsecureConnection is false.")}}var B=r(98185),z=r(10951);function G(e,t){if(e.headers){let r=Object.keys(e.headers).find(e=>e.toLowerCase()===t.toLowerCase());if(r)return e.headers[r]}}function V(e){return JSON.stringify(e)}function K(e){let t=function(e){let t=G(e,"content-type");if(t)return t;if(null===e.contentType)return;if(e.contentType)return e.contentType;let{body:r}=e;return null==r?void 0:"string"==typeof r||"number"==typeof r||"boolean"==typeof r?"text/plain; charset=UTF-8":r instanceof Blob?r.type||"application/octet-stream":(0,z.Qm)(r)?"application/octet-stream":"application/json"}(e),r=function(e){let t;let r=G(e,"content-disposition");if(r)return r;if(void 0===e.dispositionType&&void 0===e.name&&void 0===e.filename)return;let n=e.dispositionType??"form-data";if(e.name&&(n+=`; name=${V(e.name)}`),e.filename)t=e.filename;else if("undefined"!=typeof File&&e.body instanceof File){let r=e.body.name;""!==r&&(t=r)}return t&&(n+=`; filename=${V(t)}`),n}(e),n=(0,o.d)(e.headers??{});return t&&n.set("content-type",t),r&&n.set("content-disposition",r),{headers:n,body:function(e,t){if(void 0===e)return new Uint8Array([]);if((0,z.Qm)(e))return e;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return(0,B.s)(String(e),"utf-8");if(t&&/application\/(.+\+)?json(;.+)?/i.test(String(t)))return(0,B.s)(JSON.stringify(e),"utf-8");throw new m(`Unsupported body/content-type combination: ${e}, ${t}`)}(e.body,t)}}async function Y(e,t,r,i={},s){let a=s??(n||(n=k()),n),l=function(e,t,r={}){let n=function(e={}){return e.contentType??e.headers?.["content-type"]??function(e){if(ArrayBuffer.isView(e))return"application/octet-stream";if("string"==typeof e)try{JSON.parse(e)}catch(e){return}return"application/json"}(e.body)}(r),{body:i,multipartBody:s}=function(e,t=""){if(void 0===e)return{body:void 0};if("undefined"!=typeof FormData&&e instanceof FormData||(0,z.Os)(e))return{body:e};if(ArrayBuffer.isView(e))return{body:e instanceof Uint8Array?e:JSON.stringify(e)};switch(t.split(";")[0]){case"application/json":return{body:JSON.stringify(e)};case"multipart/form-data":if(Array.isArray(e))return{multipartBody:{parts:e.map(K)}};return{body:JSON.stringify(e)};case"text/plain":return{body:String(e)};default:if("string"==typeof e)return{body:e};return{body:JSON.stringify(e)}}}(r.body,n),a=(0,o.d)({...r.headers?r.headers:{},accept:r.accept??r.headers?.accept??"application/json",...(void 0!==i||void 0!==s)&&n&&{"content-type":n}});return c({url:t,method:e,body:i,multipartBody:s,headers:a,allowInsecureConnection:r.allowInsecureConnection,abortSignal:r.abortSignal,onUploadProgress:r.onUploadProgress,onDownloadProgress:r.onDownloadProgress,timeout:r.timeout,enableBrowserStreams:!0,streamResponseStatusCodes:r.responseAsStream?new Set([Number.POSITIVE_INFINITY]):void 0})}(e,t,i);try{let e=await r.sendRequest(a,l),t=e.headers.toJSON(),n=e.readableStreamBody??e.browserStreamBody,o=i.responseAsStream||void 0!==n?void 0:function(e){let t=(e.headers.get("content-type")??"").split(";")[0],r=e.bodyAsText??"";if("text/plain"===t)return String(r);try{return r?JSON.parse(r):void 0}catch(n){if("application/json"===t)throw function(e,t){let r=`Error "${t}" occurred while parsing the response body - ${e.bodyAsText}.`,n=t.code??m.PARSE_ERROR;return new m(r,{code:n,statusCode:e.status,request:e.request,response:e})}(e,n);return String(r)}}(e),s=n??o;return i?.onResponse&&i.onResponse({...e,request:l,rawHeaders:t,parsedBody:o}),{request:l,headers:t,status:`${e.status}`,body:s}}catch(e){if(y(e)&&e.response&&i.onResponse){let{response:t}=e,r=t.headers.toJSON();i?.onResponse({...t,request:l,rawHeaders:r},e)}throw e}}function W(e,t,r,n){let i;i="pipeDelimited"===r?"|":"spaceDelimited"===r?"%20":",";let o=(Array.isArray(n)?n:"object"==typeof n&&n.toString===Object.prototype.toString?Object.entries(n).flat():[n]).map(r=>{if(null==r)return"";if(!r.toString||"function"!=typeof r.toString)throw Error(`Query parameters must be able to be represented as string, ${e} can't`);let n=void 0!==r.toISOString?r.toISOString():r.toString();return t?n:encodeURIComponent(n)}).join(i);return`${t?e:encodeURIComponent(e)}=${o}`}function Q(e,t={}){let r=t.pipeline??function(e={}){var t,r,n,i;let o=function(e){let t=d();return x.Lr&&(e.agent&&t.addPolicy((0,q.d)(e.agent)),e.tlsOptions&&t.addPolicy((0,L.X)(e.tlsOptions)),t.addPolicy((0,$.Rc)(e.proxyOptions)),t.addPolicy((0,M.$)())),t.addPolicy((0,U.a)(),{beforePolicies:[F.m]}),t.addPolicy((0,N.o)(e.userAgentOptions)),t.addPolicy((0,F.I)(),{afterPhase:"Deserialize"}),t.addPolicy((0,D.F)(e.retryOptions),{phase:"Retry"}),x.Lr&&t.addPolicy((0,P.M)(e.redirectOptions),{afterPhase:"Retry"}),t.addPolicy((0,O._)(e.loggingOptions),{afterPhase:"Sign"}),t}(e);o.addPolicy({name:"ApiVersionPolicy",sendRequest:(t,r)=>{let n=new URL(t.url);return!n.searchParams.get("api-version")&&e.apiVersion&&(t.url=`${t.url}${Array.from(n.searchParams.keys()).length>0?"&":"?"}api-version=${e.apiVersion}`),r(t)}});let{credential:s,authSchemes:a,allowInsecureConnection:c}=e;return s&&("key"in s?o.addPolicy((t={authSchemes:a,credential:s,allowInsecureConnection:c},{name:"apiKeyAuthenticationPolicy",async sendRequest(e,r){j(e,t);let n=(e.authSchemes??t.authSchemes)?.find(e=>"apiKey"===e.kind);if(!n)return r(e);if("header"!==n.apiKeyLocation)throw Error(`Unsupported API key location: ${n.apiKeyLocation}`);return e.headers.set(n.name,t.credential.key),r(e)}})):"username"in s&&"password"in s?o.addPolicy((r={authSchemes:a,credential:s,allowInsecureConnection:c},{name:"bearerAuthenticationPolicy",async sendRequest(e,t){if(j(e,r),!(e.authSchemes??r.authSchemes)?.find(e=>"http"===e.kind&&"basic"===e.scheme))return t(e);let{username:n,password:i}=r.credential,o=(0,B.D)((0,B.s)(`${n}:${i}`,"utf-8"),"base64");return e.headers.set("Authorization",`Basic ${o}`),t(e)}})):"getBearerToken"in s?o.addPolicy((n={authSchemes:a,credential:s,allowInsecureConnection:c},{name:"bearerAuthenticationPolicy",async sendRequest(e,t){if(j(e,n),!(e.authSchemes??n.authSchemes)?.find(e=>"http"===e.kind&&"bearer"===e.scheme))return t(e);let r=await n.credential.getBearerToken({abortSignal:e.abortSignal});return e.headers.set("Authorization",`Bearer ${r}`),t(e)}})):"getOAuth2Token"in s&&o.addPolicy((i={authSchemes:a,credential:s,allowInsecureConnection:c},{name:"oauth2AuthenticationPolicy",async sendRequest(e,t){j(e,i);let r=(e.authSchemes??i.authSchemes)?.find(e=>"oauth2"===e.kind);if(!r)return t(e);let n=await i.credential.getOAuth2Token(r.flows,{abortSignal:e.abortSignal});return e.headers.set("Authorization",`Bearer ${n}`),t(e)}}))),o}(t);if(t.additionalPolicies?.length)for(let{policy:e,position:n}of t.additionalPolicies){let t="perRetry"===n?"Sign":void 0;r.addPolicy(e,{afterPhase:t})}let{allowInsecureConnection:n,httpClient:i}=t,o=t.endpoint??e,s=(e,...t)=>{let s=r=>(function(e,t,r,n={}){return t.startsWith("https://")||t.startsWith("http://")?t:(e=function(e,t){if(!t.pathParameters)return e;for(let[o,s]of Object.entries(t.pathParameters)){var r,n,i;if(null==s)throw Error(`Path parameters ${o} must not be undefined or null`);if(!s.toString||"function"!=typeof s.toString)throw Error(`Path parameters must be able to be represented as string, ${o} can't`);let a=void 0!==s.toISOString?s.toISOString():String(s);t.skipUrlEncoding||(a=encodeURIComponent(s)),r=e,n=`{${o}}`,i=a,e=(r&&n?r.split(n).join(i||""):r)??""}return e}(e,n),t=function(e,t,r={}){for(let n of t){let t="object"==typeof n&&(n.allowReserved??!1),i="object"==typeof n?n.value:n;r.skipUrlEncoding||t||(i=encodeURIComponent(i)),e=e.replace(/\{[\w-]+\}/,String(i))}return e}(t,r,n),new URL(function(e,t={}){if(!t.queryParameters)return e;let r=new URL(e),n=t.queryParameters,i=[];for(let e of Object.keys(n)){let r=n[e];if(null==r)continue;let o=function(e){let t=e.value;return void 0!==t&&void 0!==t.toString&&"function"==typeof t.toString}(r),s=o?r.value:r,a=!!o&&(r.explode??!1),c=o&&r.style?r.style:"form";if(a){if(Array.isArray(s))for(let r of s)i.push(W(e,t.skipUrlEncoding??!1,c,r));else if("object"==typeof s)for(let[e,r]of Object.entries(s))i.push(W(e,t.skipUrlEncoding??!1,c,r));else throw Error("explode can only be set to true for objects and arrays")}else i.push(W(e,t.skipUrlEncoding??!1,c,s))}return""!==r.search&&(r.search+="&"),r.search+=i.join("&"),r.toString()}(`${e}/${t}`,n)).toString().replace(/([^:]\/)\/+/g,"$1"))})(o,e,t,{allowInsecureConnection:n,...r});return{get:(e={})=>J("GET",s(e),r,e,n,i),post:(e={})=>J("POST",s(e),r,e,n,i),put:(e={})=>J("PUT",s(e),r,e,n,i),patch:(e={})=>J("PATCH",s(e),r,e,n,i),delete:(e={})=>J("DELETE",s(e),r,e,n,i),head:(e={})=>J("HEAD",s(e),r,e,n,i),options:(e={})=>J("OPTIONS",s(e),r,e,n,i),trace:(e={})=>J("TRACE",s(e),r,e,n,i)}};return{path:s,pathUnchecked:s,pipeline:r}}function J(e,t,r,n,i,o){return i=n.allowInsecureConnection??i,{then:function(s,a){return Y(e,t,r,{...n,allowInsecureConnection:i},o).then(s,a)},async asBrowserStream(){if(!x.Lr)return Y(e,t,r,{...n,allowInsecureConnection:i,responseAsStream:!0},o);throw Error("`asBrowserStream` is supported only in the browser environment. Use `asNodeStream` instead to obtain the response body stream. If you require a Web stream of the response in Node, consider using `Readable.toWeb` on the result of `asNodeStream`.")},async asNodeStream(){if(x.Lr)return Y(e,t,r,{...n,allowInsecureConnection:i,responseAsStream:!0},o);throw Error("`isNodeStream` is not supported in the browser environment. Use `asBrowserStream` to obtain the response body stream.")}}}function Z(e){return{allowInsecureConnection:e.requestOptions?.allowInsecureConnection,timeout:e.requestOptions?.timeout,skipUrlEncoding:e.requestOptions?.skipUrlEncoding,abortSignal:e.abortSignal,onUploadProgress:e.requestOptions?.onUploadProgress,onDownloadProgress:e.requestOptions?.onDownloadProgress,headers:{...e.requestOptions?.headers},onResponse:e.onResponse}}function X(e,t){let r="string"==typeof e?t:e,n=r.body?.error??r.body;return new m("string"==typeof e?e:n?.message??`Unexpected status code: ${r.status}`,{statusCode:ee(r.status),code:n?.code,request:r.request,response:{headers:(0,o.d)(r.headers),request:r.request,status:ee(r.status)??-1}})}function ee(e){let t=Number.parseInt(e);return Number.isNaN(t)?void 0:t}},3070:(e,t,r)=>{"use strict";r.d(t,{k:()=>n});let n=(0,r(2518).YR)("ts-http-runtime")},2518:(e,t,r)=>{"use strict";let n;r.d(t,{YR:()=>S,oc:()=>I});var i=r(70612),o=r(47261),s=r(97742);let a="undefined"!=typeof process&&process.env&&process.env.DEBUG||void 0,c=[],l=[],u=[];a&&h(a);let d=Object.assign(e=>g(e),{enable:h,enabled:p,disable:function(){let e=n||"";return h(""),e},log:function(e,...t){s.stderr.write(`${o.format(e,...t)}${i.EOL}`)}});function h(e){for(let t of(n=e,c=[],l=[],e.split(",").map(e=>e.trim())))t.startsWith("-")?l.push(t.substring(1)):c.push(t);for(let e of u)e.enabled=p(e.namespace)}function p(e){if(e.endsWith("*"))return!0;for(let t of l)if(f(e,t))return!1;for(let t of c)if(f(e,t))return!0;return!1}function f(e,t){if(-1===t.indexOf("*"))return e===t;let r=t;if(-1!==t.indexOf("**")){let e=[],n="";for(let r of t)("*"!==r||"*"!==n)&&(n=r,e.push(r));r=e.join("")}let n=0,i=0,o=r.length,s=e.length,a=-1,c=-1;for(;n<s&&i<o;){if("*"===r[i]){if(a=i,++i===o)return!0;for(;e[n]!==r[i];)if(++n===s)return!1;c=n,n++,i++;continue}if(r[i]===e[n])i++,n++;else{if(!(a>=0)||(i=a+1,(n=c+1)===s))return!1;for(;e[n]!==r[i];)if(++n===s)return!1;c=n,n++,i++;continue}}let l=n===e.length,u=i===r.length,d=i===r.length-1&&"*"===r[i];return l&&(u||d)}function g(e){let t=Object.assign(function(...r){t.enabled&&(r.length>0&&(r[0]=`${e} ${r[0]}`),t.log(...r))},{enabled:p(e),destroy:m,log:d.log,namespace:e,extend:y});return u.push(t),t}function m(){let e=u.indexOf(this);return e>=0&&(u.splice(e,1),!0)}function y(e){let t=g(`${this.namespace}:${e}`);return t.log=this.log,t}let T=["verbose","info","warning","error"],E={verbose:400,info:300,warning:200,error:100};function C(e,t){t.log=(...t)=>{e.log(...t)}}function A(e){return T.includes(e)}function I(e){let t;let r=new Set,n="undefined"!=typeof process&&process.env&&process.env[e.logLevelEnvVarName]||void 0,i=d(e.namespace);function o(e){if(e&&!A(e))throw Error(`Unknown log level '${e}'. Acceptable values: ${T.join(",")}`);t=e;let n=[];for(let e of r)s(e)&&n.push(e.namespace);d.enable(n.join(","))}function s(e){return!!(t&&E[e.level]<=E[t])}function a(e,t){let n=Object.assign(e.extend(t),{level:t});if(C(e,n),s(n)){let e=d.disable();d.enable(e+","+n.namespace)}return r.add(n),n}return i.log=(...e)=>{d.log(...e)},n&&(A(n)?o(n):console.error(`${e.logLevelEnvVarName} set to unknown log level '${n}'; logging is not enabled. Acceptable values: ${T.join(", ")}.`)),{setLogLevel:o,getLogLevel:function(){return t},createClientLogger:function(e){let t=i.extend(e);return C(i,t),{error:a(t,"error"),warning:a(t,"warning"),info:a(t,"info"),verbose:a(t,"verbose")}},logger:i}}let v=I({logLevelEnvVarName:"TYPESPEC_RUNTIME_LOG_LEVEL",namespace:"typeSpecRuntime"});function S(e){return v.createClientLogger(e)}v.logger},65914:(e,t,r)=>{"use strict";function n(e){return{name:"agentPolicy",sendRequest:async(t,r)=>(t.agent||(t.agent=e),r(t))}}r.d(t,{d:()=>n})},28455:(e,t,r)=>{"use strict";function n(){return{name:"decompressResponsePolicy",sendRequest:async(e,t)=>("HEAD"!==e.method&&e.headers.set("Accept-Encoding","gzip,deflate"),t(e))}}r.d(t,{$:()=>n})},77691:(e,t,r)=>{"use strict";r.d(t,{F:()=>a});var n=r(54757),i=r(36750),o=r(99287),s=r(26840);function a(e={}){return{name:"defaultRetryPolicy",sendRequest:(0,o.b)([(0,i.F)(),(0,n.IW)(e)],{maxRetries:e.maxRetries??s.I}).sendRequest}}},45091:(e,t,r)=>{"use strict";r.d(t,{a:()=>s});var n=r(98185),i=r(69826),o=r(72119);function s(){return{name:"formDataPolicy",async sendRequest(e,t){if(i.Lr&&"undefined"!=typeof FormData&&e.body instanceof FormData&&(e.formData=function(e){let t={};for(let[r,n]of e.entries())t[r]??=[],t[r].push(n);return t}(e.body),e.body=void 0),e.formData){let t=e.headers.get("Content-Type");t&&-1!==t.indexOf("application/x-www-form-urlencoded")?e.body=function(e){let t=new URLSearchParams;for(let[r,n]of Object.entries(e))if(Array.isArray(n))for(let e of n)t.append(r,e.toString());else t.append(r,n.toString());return t.toString()}(e.formData):await a(e.formData,e),e.formData=void 0}return t(e)}}}async function a(e,t){let r=t.headers.get("Content-Type");if(r&&!r.startsWith("multipart/form-data"))return;t.headers.set("Content-Type",r??"multipart/form-data");let i=[];for(let[t,r]of Object.entries(e))for(let e of Array.isArray(r)?r:[r])if("string"==typeof e)i.push({headers:(0,o.d)({"Content-Disposition":`form-data; name="${t}"`}),body:(0,n.s)(e,"utf-8")});else if(null==e||"object"!=typeof e)throw Error(`Unexpected value for key ${t}: ${e}. Value should be serialized to string first.`);else{let r=e.name||"blob",n=(0,o.d)();n.set("Content-Disposition",`form-data; name="${t}"; filename="${r}"`),n.set("Content-Type",e.type||"application/octet-stream"),i.push({headers:n,body:e})}t.multipartBody={parts:i}}},83110:(e,t,r)=>{"use strict";r.d(t,{_:()=>o});var n=r(3070),i=r(9002);function o(e={}){let t=e.logger??n.k.info,r=new i.T({additionalAllowedHeaderNames:e.additionalAllowedHeaderNames,additionalAllowedQueryParameters:e.additionalAllowedQueryParameters});return{name:"logPolicy",async sendRequest(e,n){if(!t.enabled)return n(e);t(`Request: ${r.sanitize(e)}`);let i=await n(e);return t(`Response status code: ${i.status}`),t(`Headers: ${r.sanitize(i.headers)}`),i}}}},63450:(e,t,r)=>{"use strict";r.d(t,{I:()=>f,m:()=>h});var n=r(98185),i=r(10951),o=r(68117),s=r(76162);async function*a(){let e=this.getReader();try{for(;;){let{done:t,value:r}=await e.read();if(t)return;yield r}}finally{e.releaseLock()}}function c(e){return e instanceof ReadableStream?(e[Symbol.asyncIterator]||(e[Symbol.asyncIterator]=a.bind(e)),e.values||(e.values=a.bind(e)),s.Readable.fromWeb(e)):e}function l(e){return e instanceof Uint8Array?s.Readable.from(Buffer.from(e)):(0,i.Lj)(e)?c(e.stream()):c(e)}async function u(e){return function(){let t=e.map(e=>"function"==typeof e?e():e).map(l);return s.Readable.from(async function*(){for(let e of t)for await(let t of e)yield t}())}}async function d(e,t,r){let o=[(0,n.s)(`--${r}`,"utf-8"),...t.flatMap(e=>[(0,n.s)("\r\n","utf-8"),(0,n.s)(function(e){let t="";for(let[r,n]of e)t+=`${r}: ${n}\r
`;return t}(e.headers),"utf-8"),(0,n.s)("\r\n","utf-8"),e.body,(0,n.s)(`\r
--${r}`,"utf-8")]),(0,n.s)("--\r\n\r\n","utf-8")],s=function(e){let t=0;for(let r of e){let e=r instanceof Uint8Array?r.byteLength:(0,i.Lj)(r)?-1===r.size?void 0:r.size:void 0;if(void 0===e)return;t+=e}return t}(o);s&&e.headers.set("Content-Length",s),e.body=await u(o)}let h="multipartPolicy",p=new Set("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'()+,-./:=?");function f(){return{name:h,async sendRequest(e,t){if(!e.multipartBody)return t(e);if(e.body)throw Error("multipartBody and regular body cannot be set at the same time");let r=e.multipartBody.boundary,n=e.headers.get("Content-Type")??"multipart/mixed",i=n.match(/^(multipart\/[^ ;]+)(?:; *boundary=(.+))?$/);if(!i)throw Error(`Got multipart request body, but content-type header was not multipart: ${n}`);let[,s,a]=i;if(a&&r&&a!==r)throw Error(`Multipart boundary was specified as ${a} in the header, but got ${r} in the request body`);return(r??=a)?function(e){if(e.length>70)throw Error(`Multipart boundary "${e}" exceeds maximum length of 70 characters`);if(Array.from(e).some(e=>!p.has(e)))throw Error(`Multipart boundary "${e}" contains invalid characters`)}(r):r=`----AzSDKFormBoundary${(0,o.H)()}`,e.headers.set("Content-Type",`${s}; boundary=${r}`),await d(e,e.multipartBody.parts,r),e.multipartBody=void 0,t(e)}}}},38073:(e,t,r)=>{"use strict";r.d(t,{Rc:()=>h});var n=r(30890),i=r(37766),o=r(3070);let s=[],a=!1,c=new Map;function l(e){return process.env[e]?process.env[e]:process.env[e.toLowerCase()]?process.env[e.toLowerCase()]:void 0}function u(e){let t;try{t=new URL(e.host)}catch{throw Error(`Expecting a valid host string in proxy settings, but found "${e.host}".`)}return t.port=String(e.port),e.username&&(t.username=e.username),e.password&&(t.password=e.password),t}function d(e,t,r){if(e.agent)return;let s="https:"!==new URL(e.url).protocol;e.tlsSettings&&o.k.warning("TLS settings are not supported in combination with custom Proxy, certificates provided to the client will be ignored.");let a=e.headers.toJSON();s?(t.httpProxyAgent||(t.httpProxyAgent=new i.HttpProxyAgent(r,{headers:a})),e.agent=t.httpProxyAgent):(t.httpsProxyAgent||(t.httpsProxyAgent=new n.HttpsProxyAgent(r,{headers:a})),e.agent=t.httpsProxyAgent)}function h(e,t){a||s.push(...function(){let e=l("NO_PROXY");return(a=!0,e)?e.split(",").map(e=>e.trim()).filter(e=>e.length):[]}());let r=e?u(e):function(){let e=function(){if(!process)return;let e=l("HTTPS_PROXY"),t=l("ALL_PROXY"),r=l("HTTP_PROXY");return e||t||r}();return e?new URL(e):void 0}(),n={};return{name:"proxyPolicy",sendRequest:async(e,i)=>(!e.proxySettings&&r&&!function(e,t,r){if(0===t.length)return!1;let n=new URL(e).hostname;if(r?.has(n))return r.get(n);let i=!1;for(let e of t)"."===e[0]?n.endsWith(e)?i=!0:n.length===e.length-1&&n===e.slice(1)&&(i=!0):n===e&&(i=!0);return r?.set(n,i),i}(e.url,t?.customNoProxyList??s,t?.customNoProxyList?void 0:c)?d(e,n,r):e.proxySettings&&d(e,n,u(e.proxySettings)),i(e))}}},11222:(e,t,r)=>{"use strict";r.d(t,{M:()=>i});let n=["GET","HEAD"];function i(e={}){let{maxRetries:t=20}=e;return{name:"redirectPolicy",async sendRequest(e,r){let n=await r(e);return o(r,n,t)}}}async function o(e,t,r,i=0){let{request:s,status:a,headers:c}=t,l=c.get("location");if(l&&(300===a||301===a&&n.includes(s.method)||302===a&&n.includes(s.method)||303===a&&"POST"===s.method||307===a)&&i<r){let t=new URL(l,s.url);s.url=t.toString(),303===a&&(s.method="GET",s.headers.delete("Content-Length"),delete s.body),s.headers.delete("Authorization");let n=await e(s);return o(e,n,r,i+1)}return t}},99287:(e,t,r)=>{"use strict";r.d(t,{b:()=>c});var n=r(12238),i=r(18193),o=r(2518),s=r(26840);let a=(0,o.YR)("ts-http-runtime retryPolicy");function c(e,t={maxRetries:s.I}){let r=t.logger||a;return{name:"retryPolicy",async sendRequest(o,a){let c,l;let u=-1;t:for(;;){u+=1,c=void 0,l=void 0;try{r.info(`Retry ${u}: Attempting to send request`,o.requestId),c=await a(o),r.info(`Retry ${u}: Received a response from request`,o.requestId)}catch(e){if(r.error(`Retry ${u}: Received an error from request`,o.requestId),l=e,!e||"RestError"!==l.name)throw e;c=l.response}if(o.abortSignal?.aborted)throw r.error(`Retry ${u}: Request aborted.`),new i._;if(u>=(t.maxRetries??s.I)){if(r.info(`Retry ${u}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),l)throw l;if(c)return c;throw Error("Maximum retries reached with no response or error to throw")}for(let t of(r.info(`Retry ${u}: Processing ${e.length} retry strategies.`),e)){let e=t.logger||r;e.info(`Retry ${u}: Processing retry strategy ${t.name}.`);let i=t.retry({retryCount:u,response:c,responseError:l});if(i.skipStrategy){e.info(`Retry ${u}: Skipped.`);continue}let{errorToThrow:s,retryAfterInMs:a,redirectTo:d}=i;if(s)throw e.error(`Retry ${u}: Retry strategy ${t.name} throws error:`,s),s;if(a||0===a){e.info(`Retry ${u}: Retry strategy ${t.name} retries after ${a}`),await (0,n.g)(a,void 0,{abortSignal:o.abortSignal});continue t}if(d){e.info(`Retry ${u}: Retry strategy ${t.name} redirects to ${d}`),o.url=d;continue t}}if(l)throw r.info("None of the retry strategies could work with the received error. Throwing it."),l;if(c)return r.info("None of the retry strategies could work with the received response. Returning it."),c}}}}},45796:(e,t,r)=>{"use strict";function n(e){return{name:"tlsPolicy",sendRequest:async(t,r)=>(t.tlsSettings||(t.tlsSettings=e),r(t))}}r.d(t,{X:()=>n})},21525:(e,t,r)=>{"use strict";r.d(t,{o:()=>l});var n=r(70612),i=r(97742);async function o(e){if(i&&i.versions){let t=i.versions;t.bun?e.set("Bun",t.bun):t.deno?e.set("Deno",t.deno):t.node&&e.set("Node",t.node)}e.set("OS",`(${n.arch()}-${n.type()}-${n.release()})`)}var s=r(26840);async function a(e){let t=new Map;t.set("ts-http-runtime",s.J),await o(t);let r=function(e){let t=[];for(let[r,n]of e){let e=n?`${r}/${n}`:r;t.push(e)}return t.join(" ")}(t);return e?`${e} ${r}`:r}let c="User-Agent";function l(e={}){let t=a(e.userAgentPrefix);return{name:"userAgentPolicy",sendRequest:async(e,r)=>(e.headers.has(c)||e.headers.set(c,await t),r(e))}}},54757:(e,t,r)=>{"use strict";r.d(t,{IW:()=>o});var n=r(2078),i=r(36750);function o(e={}){let t=e.retryDelayInMs??1e3,r=e.maxRetryDelayInMs??64e3;return{name:"exponentialRetryStrategy",retry({retryCount:o,response:s,responseError:a}){let c=!!a&&("ETIMEDOUT"===a.code||"ESOCKETTIMEDOUT"===a.code||"ECONNREFUSED"===a.code||"ECONNRESET"===a.code||"ENOENT"===a.code||"ENOTFOUND"===a.code),l=c&&e.ignoreSystemErrors,u=!!(s&&void 0!==s.status&&(s.status>=500||408===s.status)&&501!==s.status&&505!==s.status),d=u&&e.ignoreHttpStatusCodes;return s&&((0,i.M)(s)||!u)||d||l?{skipStrategy:!0}:!a||c||u?(0,n.b)(o,{retryDelayInMs:t,maxRetryDelayInMs:r}):{errorToThrow:a}}}}},36750:(e,t,r)=>{"use strict";r.d(t,{F:()=>c,M:()=>a});var n=r(12238);let i="Retry-After",o=["retry-after-ms","x-ms-retry-after-ms",i];function s(e){if(e&&[429,503].includes(e.status))try{for(let t of o){let r=(0,n._)(e,t);if(0===r||r){let e=t===i?1e3:1;return r*e}}let t=e.headers.get(i);if(!t)return;let r=Date.parse(t)-Date.now();return Number.isFinite(r)?Math.max(0,r):void 0}catch{return}}function a(e){return Number.isFinite(s(e))}function c(){return{name:"throttlingRetryStrategy",retry({response:e}){let t=s(e);return Number.isFinite(t)?{retryAfterInMs:t}:{skipStrategy:!0}}}}},98185:(e,t,r)=>{"use strict";function n(e,t){return Buffer.from(e).toString(t)}function i(e,t){return Buffer.from(e,t)}r.d(t,{D:()=>n,s:()=>i})},69826:(e,t,r)=>{"use strict";r.d(t,{Lr:()=>a,PW:()=>s,b$:()=>l,co:()=>o,db:()=>c,jU:()=>n,n2:()=>i});let n="undefined"!=typeof window&&void 0!==window.document,i="object"==typeof self&&"function"==typeof self?.importScripts&&(self.constructor?.name==="DedicatedWorkerGlobalScope"||self.constructor?.name==="ServiceWorkerGlobalScope"||self.constructor?.name==="SharedWorkerGlobalScope"),o="undefined"!=typeof Deno&&void 0!==Deno.version&&void 0!==Deno.version.deno,s="undefined"!=typeof Bun&&void 0!==Bun.version,a=void 0!==globalThis.process&&!!globalThis.process.version&&!!globalThis.process.versions?.node,c=a&&!s&&!o,l="undefined"!=typeof navigator&&navigator?.product==="ReactNative"},2078:(e,t,r)=>{"use strict";function n(e,t){var r,n;let i=t.retryDelayInMs*Math.pow(2,e),o=Math.min(t.maxRetryDelayInMs,i);return{retryAfterInMs:o/2+(r=0,n=o/2,r=Math.ceil(r),Math.floor(Math.random()*((n=Math.floor(n))-r+1))+r)}}r.d(t,{b:()=>n})},14091:(e,t,r)=>{"use strict";r.d(t,{V:()=>i});var n=r(6800);function i(e){if((0,n.K)(e)){let t="string"==typeof e.name,r="string"==typeof e.message;return t&&r}return!1}},12238:(e,t,r)=>{"use strict";r.d(t,{_:()=>o,g:()=>i});var n=r(18193);function i(e,t,r){return new Promise((i,o)=>{let s,a;let c=()=>o(new n._(r?.abortErrorMsg?r?.abortErrorMsg:"The operation was aborted.")),l=()=>{r?.abortSignal&&a&&r.abortSignal.removeEventListener("abort",a)};if(a=()=>(s&&clearTimeout(s),l(),c()),r?.abortSignal&&r.abortSignal.aborted)return c();s=setTimeout(()=>{l(),i(t)},e),r?.abortSignal&&r.abortSignal.addEventListener("abort",a)})}function o(e,t){let r=e.headers.get(t);if(!r)return;let n=Number(r);if(!Number.isNaN(n))return n}},2010:(e,t,r)=>{"use strict";r.d(t,{Ti:()=>a.T,b3:()=>n.b,jU:()=>o.jU,PW:()=>o.PW,co:()=>o.co,VZ:()=>i.V,Lr:()=>o.Lr,db:()=>o.db,b$:()=>o.b$,n2:()=>o.n2,sy:()=>s.s,DA:()=>s.D});var n=r(2078),i=r(14091);r(6005),r(68117);var o=r(69826),s=r(98185),a=r(9002)},6800:(e,t,r)=>{"use strict";function n(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&!(e instanceof RegExp)&&!(e instanceof Date)}r.d(t,{K:()=>n})},9002:(e,t,r)=>{"use strict";r.d(t,{T:()=>a});var n=r(6800);let i="REDACTED",o=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],s=["api-version"];class a{allowedHeaderNames;allowedQueryParameters;constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:t=[]}={}){e=o.concat(e),t=s.concat(t),this.allowedHeaderNames=new Set(e.map(e=>e.toLowerCase())),this.allowedQueryParameters=new Set(t.map(e=>e.toLowerCase()))}sanitize(e){let t=new Set;return JSON.stringify(e,(e,r)=>{if(r instanceof Error)return{...r,name:r.name,message:r.message};if("headers"===e)return this.sanitizeHeaders(r);if("url"===e)return this.sanitizeUrl(r);if("query"===e)return this.sanitizeQuery(r);if("body"!==e){if("response"===e)return;if("operationSpec"===e)return;else if(Array.isArray(r)||(0,n.K)(r)){if(t.has(r))return"[Circular]";t.add(r)}return r}},2)}sanitizeUrl(e){if("string"!=typeof e||null===e||""===e)return e;let t=new URL(e);if(!t.search)return e;for(let[e]of t.searchParams)this.allowedQueryParameters.has(e.toLowerCase())||t.searchParams.set(e,i);return t.toString()}sanitizeHeaders(e){let t={};for(let r of Object.keys(e))this.allowedHeaderNames.has(r.toLowerCase())?t[r]=e[r]:t[r]=i;return t}sanitizeQuery(e){if("object"!=typeof e||null===e)return e;let t={};for(let r of Object.keys(e))this.allowedQueryParameters.has(r.toLowerCase())?t[r]=e[r]:t[r]=i;return t}}},10951:(e,t,r)=>{"use strict";function n(e){return void 0!==e&&(e instanceof Uint8Array||i(e)||"function"==typeof e||e instanceof Blob)}function i(e){return!!(e&&"function"==typeof e.pipe)||!!(e&&"function"==typeof e.getReader&&"function"==typeof e.tee)}function o(e){return"function"==typeof e.stream}r.d(t,{Lj:()=>o,Os:()=>i,Qm:()=>n})},68117:(e,t,r)=>{"use strict";r.d(t,{H:()=>o});var n=r(6005);let i="function"==typeof globalThis?.crypto?.randomUUID?globalThis.crypto.randomUUID.bind(globalThis.crypto):n.randomUUID;function o(){return i()}}};