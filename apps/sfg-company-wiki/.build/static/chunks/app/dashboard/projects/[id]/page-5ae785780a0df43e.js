(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6618],{3578:function(e,s,t){Promise.resolve().then(t.bind(t,18))},18:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return C}});var a=t(5444),r=t(9300),n=t(9047),l=t(9827),i=t(2422),c=t(4678),d=t(4635),o=t(7012),u=t(489),x=t(6765),h=t(1335),m=t(5738),j=t(6772),p=t(8155),g=t(6629),b=t(6771),f=t(4670),v=t(1084),N=t(5287),y=t(6948),w=t(6706);function C(){let e=(0,n.useParams)();(0,n.useRouter)();let[s,t]=(0,r.useState)(null),[h,w]=(0,r.useState)(!0),[C,D]=(0,r.useState)(!1),[S,_]=(0,r.useState)(""),[Z,T]=(0,r.useState)(!1),[O,E]=(0,r.useState)({});(0,r.useEffect)(()=>{A()},[e.id]);let A=async()=>{try{w(!0);let s=await fetch(`/api/projects/${e.id}`);if(s.ok){let e=await s.json();t(e),E(e)}else _("Project not found")}catch(e){_("Failed to load project")}finally{w(!1)}},I=async()=>{try{D(!0),_("");let s=await fetch(`/api/projects/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to update project")}let a=await s.json();t(a),E(a),T(!1)}catch(e){_(e.message)}finally{D(!1)}},V=async s=>{try{D(!0),_("");let a=await fetch(`/api/projects/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to update status")}let r=await a.json();t(r),E(r)}catch(e){_(e.message)}finally{D(!1)}};return h?(0,a.jsx)("div",{className:"container mx-auto p-6",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"text-gray-600 mt-4",children:"Loading project..."})]})}):s?(0,a.jsxs)("div",{className:"container mx-auto p-6 max-w-6xl",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)(v.default,{href:"/dashboard/projects",children:(0,a.jsxs)(i.z,{variant:"ghost",className:"mb-4",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Back to Projects"]})}),(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[(0,a.jsxs)("span",{className:"text-blue-600",children:[s.baseNumber,"-",s.prefix]}),(0,a.jsx)(m.$,{status:s.status})]}),(0,a.jsxs)("p",{className:"text-gray-600 mt-1",children:[s.customer," • ",s.project]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:Z?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.z,{onClick:()=>{T(!1),E(s)},variant:"outline",children:"Cancel"}),(0,a.jsx)(i.z,{onClick:I,disabled:C,className:"bg-blue-600 hover:bg-blue-700",children:C?"Saving...":"Save Changes"})]}):(0,a.jsx)(i.z,{onClick:()=>T(!0),variant:"outline",children:"Edit Details"})})]})]}),S&&(0,a.jsxs)(y.bZ,{variant:"destructive",className:"mb-6",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4"}),(0,a.jsx)(y.X,{children:S})]}),(0,a.jsxs)(x.mQ,{defaultValue:"details",className:"space-y-6",children:[(0,a.jsxs)(x.dr,{children:[(0,a.jsx)(x.SP,{value:"details",children:"Details"}),(0,a.jsxs)(x.SP,{value:"product-count",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"Product Count"]}),(0,a.jsxs)(x.SP,{value:"documents",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 mr-2"}),"Documents"]}),(0,a.jsxs)(x.SP,{value:"timeline",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Timeline"]})]}),(0,a.jsxs)(x.nU,{value:"details",className:"space-y-6",children:[(0,a.jsxs)(l.Zb,{className:"bg-white/60 backdrop-blur-sm border-gray-200/50",children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsx)(l.ll,{children:"Project Status"}),(0,a.jsx)(l.SZ,{children:"ENQ → QUO → ORD → INV → DEL → PAID"})]}),(0,a.jsx)(l.aY,{children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:["ENQ","QUO","ORD","INV","DEL","PAID"].map(e=>(0,a.jsx)(i.z,{onClick:()=>V(e),disabled:C,variant:s.status===e?"default":"outline",className:s.status===e?"bg-blue-600 hover:bg-blue-700":"",children:e},e))})})]}),(0,a.jsxs)(l.Zb,{className:"bg-white/60 backdrop-blur-sm border-gray-200/50",children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Project Information"})}),(0,a.jsx)(l.aY,{className:"space-y-4",children:Z?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{children:"Customer Name"}),(0,a.jsx)(c.I,{value:O.customer||"",onChange:e=>E({...O,customer:e.target.value}),className:"bg-white/80"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{children:"Project Name"}),(0,a.jsx)(c.I,{value:O.project||"",onChange:e=>E({...O,project:e.target.value}),className:"bg-white/80"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{children:"Location"}),(0,a.jsx)(c.I,{value:O.location||"",onChange:e=>E({...O,location:e.target.value}),className:"bg-white/80"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{children:"Product Type"}),(0,a.jsxs)(u.Ph,{value:O.productType||"",onValueChange:e=>E({...O,productType:e}),children:[(0,a.jsx)(u.i4,{className:"bg-white/80",children:(0,a.jsx)(u.ki,{placeholder:"Select product type"})}),(0,a.jsx)(u.Bw,{children:N.nB.PRODUCT_TYPES.map(e=>(0,a.jsx)(u.Ql,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{children:"Delivery Type"}),(0,a.jsxs)(u.Ph,{value:O.deliveryType||"",onValueChange:e=>E({...O,deliveryType:e}),children:[(0,a.jsx)(u.i4,{className:"bg-white/80",children:(0,a.jsx)(u.ki,{placeholder:"Select delivery type"})}),(0,a.jsx)(u.Bw,{children:N.nB.DELIVERY_TYPES.map(e=>(0,a.jsx)(u.Ql,{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{children:"Customer Order Number"}),(0,a.jsx)(c.I,{value:O.customerOrderNumber||"",onChange:e=>E({...O,customerOrderNumber:e.target.value}),className:"bg-white/80"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{children:"Notes"}),(0,a.jsx)(o.g,{value:O.notes||"",onChange:e=>E({...O,notes:e.target.value}),rows:4,className:"bg-white/80"})]})]}):(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{className:"text-gray-500",children:"Customer"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:s.customer||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{className:"text-gray-500",children:"Project"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:s.project||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{className:"text-gray-500",children:"Location"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:s.location||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{className:"text-gray-500",children:"Product Type"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:s.productType||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{className:"text-gray-500",children:"Delivery Type"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:s.deliveryType?N.nB.DELIVERY_TYPES.find(e=>e.value===s.deliveryType)?.label:"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{className:"text-gray-500",children:"Customer Order Number"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:s.customerOrderNumber||"N/A"})]}),s.notes&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(d._,{className:"text-gray-500",children:"Notes"}),(0,a.jsx)("p",{className:"text-lg",children:s.notes})]})]})})]})]}),(0,a.jsx)(x.nU,{value:"product-count",children:(0,a.jsx)(P,{project:s,onUpdate:A})}),(0,a.jsx)(x.nU,{value:"documents",children:(0,a.jsxs)(l.Zb,{className:"bg-white/60 backdrop-blur-sm border-gray-200/50",children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsx)(l.ll,{children:"Documents & Attachments"}),(0,a.jsx)(l.SZ,{children:"Coming soon - File upload and management"})]}),(0,a.jsx)(l.aY,{children:(0,a.jsx)("p",{className:"text-gray-600",children:"Document management will be implemented in Phase 2"})})]})}),(0,a.jsx)(x.nU,{value:"timeline",children:(0,a.jsxs)(l.Zb,{className:"bg-white/60 backdrop-blur-sm border-gray-200/50",children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Project Timeline"})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[s.enquiryDate&&(0,a.jsx)(k,{status:"ENQ",date:s.enquiryDate,label:"Enquiry Received"}),s.quoteDate&&(0,a.jsx)(k,{status:"QUO",date:s.quoteDate,label:"Quote Issued"}),s.orderDate&&(0,a.jsx)(k,{status:"ORD",date:s.orderDate,label:"Order Confirmed"}),s.invoiceDate&&(0,a.jsx)(k,{status:"INV",date:s.invoiceDate,label:"Invoice Raised"}),s.deliveryDate&&(0,a.jsx)(k,{status:"DEL",date:s.deliveryDate,label:"Delivered"}),s.paidDate&&(0,a.jsx)(k,{status:"PAID",date:s.paidDate,label:"Payment Received"})]})})]})})]})]}):(0,a.jsx)("div",{className:"container mx-auto p-6",children:(0,a.jsxs)(y.bZ,{variant:"destructive",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4"}),(0,a.jsx)(y.X,{children:"Project not found"})]})})}function k({status:e,date:s,label:t}){return(0,a.jsxs)("div",{className:"flex items-center gap-4 p-3 bg-white/40 rounded-lg border border-gray-200/50",children:[(0,a.jsx)(m.$,{status:e}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium",children:t}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:(0,w.B)(new Date(s),new Date,{addSuffix:!0})})]})]})}function P({project:e,onUpdate:s}){let[t,n]=(0,r.useState)(e.currentProductCount||0),[u,x]=(0,r.useState)(""),[m,p]=(0,r.useState)(!1),[g,b]=(0,r.useState)(""),f=async()=>{try{if(p(!0),b(""),!(await fetch(`/api/projects/${e.id}/product-count`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newCount:t,note:u,source:"Manual",pricingStatus:"Pricing Needed"})})).ok)throw Error("Failed to update product count");x(""),s()}catch(e){b(e.message)}finally{p(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(l.Zb,{className:"bg-white/60 backdrop-blur-sm border-gray-200/50",children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsx)(l.ll,{children:"Current Product Count"}),(0,a.jsx)(l.SZ,{children:"Track product count changes throughout project lifecycle"})]}),(0,a.jsxs)(l.aY,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,a.jsx)(d._,{className:"text-gray-600",children:"Initial Count"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:e.enquiryInitialCount||0})]}),(0,a.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,a.jsx)(d._,{className:"text-gray-600",children:"Current Count"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-green-600 mt-2",children:e.currentProductCount||0})]}),(0,a.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[(0,a.jsx)(d._,{className:"text-gray-600",children:"Delivered"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-purple-600 mt-2",children:e.deliveredCount+e.collectedCount})]})]}),g&&(0,a.jsxs)(y.bZ,{variant:"destructive",className:"mb-4",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4"}),(0,a.jsx)(y.X,{children:g})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{children:"New Product Count"}),(0,a.jsx)(c.I,{type:"number",min:"0",value:t,onChange:e=>n(parseInt(e.target.value)||0),className:"bg-white/80"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{children:"Note (reason for change)"}),(0,a.jsx)(o.g,{value:u,onChange:e=>x(e.target.value),placeholder:"Explain the reason for count change...",rows:3,className:"bg-white/80"})]}),(0,a.jsx)(i.z,{onClick:f,disabled:m||t===e.currentProductCount,className:"w-full bg-blue-600 hover:bg-blue-700",children:m?"Updating...":"Update Product Count"})]})]})]}),(0,a.jsxs)(l.Zb,{className:"bg-white/60 backdrop-blur-sm border-gray-200/50",children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"Product Count History"})}),(0,a.jsx)(l.aY,{children:e.productCountLogs?.length>0?(0,a.jsx)("div",{className:"space-y-3",children:e.productCountLogs.map(e=>(0,a.jsxs)("div",{className:"p-4 bg-white/40 rounded-lg border border-gray-200/50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)(h.C,{variant:"outline",children:e.source}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:(0,w.B)(new Date(e.createdAt),new Date,{addSuffix:!0})})]}),(0,a.jsxs)("p",{className:"font-medium",children:[null!==e.oldCount?`${e.oldCount} → `:"",e.newCount," products",0!==e.delta&&(0,a.jsxs)("span",{className:e.delta>0?"text-green-600":"text-red-600",children:[" ","(",e.delta>0?"+":"",e.delta,")"]})]}),e.note&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.note}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[!e.estimatorSignoff&&(0,a.jsx)(h.C,{variant:"secondary",className:"text-xs",children:"Awaiting Estimator Sign-off"}),!e.financeAcknowledged&&(0,a.jsx)(h.C,{variant:"secondary",className:"text-xs",children:"Awaiting Finance Acknowledgment"})]})]},e.id))}):(0,a.jsx)("p",{className:"text-gray-600 text-center py-6",children:"No product count changes yet"})})]})]})}},5738:function(e,s,t){"use strict";t.d(s,{$:function(){return l}});var a=t(5444),r=t(5287),n=t(1335);function l({status:e,className:s=""}){let t=(0,r.z2)(e);return(0,a.jsx)(n.C,{className:`${s}`,style:{backgroundColor:t.bg,color:t.color,borderColor:t.border,borderWidth:"1px",borderStyle:"solid"},children:t.name})}},1335:function(e,s,t){"use strict";t.d(s,{C:function(){return i}});var a=t(5444);t(9300);var r=t(2371),n=t(5522);let l=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i({className:e,variant:s,...t}){return(0,a.jsx)("div",{className:(0,n.cn)(l({variant:s}),e),...t})}},6765:function(e,s,t){"use strict";t.d(s,{SP:function(){return d},dr:function(){return c},mQ:function(){return i},nU:function(){return o}});var a=t(5444),r=t(9300),n=t(4367),l=t(5522);let i=n.fC,c=r.forwardRef(({className:e,...s},t)=>(0,a.jsx)(n.aV,{ref:t,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));c.displayName=n.aV.displayName;let d=r.forwardRef(({className:e,...s},t)=>(0,a.jsx)(n.xz,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s}));d.displayName=n.xz.displayName;let o=r.forwardRef(({className:e,...s},t)=>(0,a.jsx)(n.VY,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));o.displayName=n.VY.displayName},6771:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(2154).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},6629:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(2154).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},4670:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(2154).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])}},function(e){e.O(0,[6730,5558,9727,1666,4367,6706,6441,2386,7156,1744],function(){return e(e.s=3578)}),_N_E=e.O()}]);