 'use client'; import { useState, useEffect } from 'react'; import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Badge } from '@/components/ui/badge'; import { Zap, Play, Pause, Settings, CheckCircle, Clock, AlertTriangle, ArrowRight, Bell, Mail, MessageSquare, Calendar, Users, Building2 } from 'lucide-react'; import { motion } from 'framer-motion'; interface WorkflowRule { id: string; name: string; description: string; trigger: string; conditions: string[]; actions: string[]; isActive: boolean; lastTriggered?: Date; triggerCount: number; } interface WorkflowExecution { id: string; ruleId: string; ruleName: string; status: 'running' | 'completed' | 'failed'; startTime: Date; endTime?: Date; jobNumber?: string; quoteNumber?: string; details: string; } export default function WorkflowAutomation() { const [workflows, setWorkflows] = useState<WorkflowRule[]>([ { id: '1', name: 'Job Status Notifications', description: 'Automatically notify team when job status changes', trigger: 'Job status updated', conditions: ['Status changed to FABRICATION', 'Status changed to COMPLETED'], actions: ['Send Teams notification', 'Update SharePoint', 'Email project manager'], isActive: true, lastTriggered: new Date('2025-01-15T14:30:00'), triggerCount: 23 }, { id: '2', name: 'Quote Follow-up Automation', description: 'Automatically follow up on pending quotes after 7 days', trigger: 'Quote pending for 7 days', conditions: ['Quote status is PENDING', 'No customer response'], actions: ['Send follow-up email', 'Create reminder task', 'Notify sales team'], isActive: true, lastTriggered: new Date('2025-01-14T09:15:00'), triggerCount: 12 }, { id: '3', name: 'Order Approval Workflow', description: 'Route orders over £1000 for manager approval', trigger: 'New order created', conditions: ['Order value > £1000'], actions: ['Send approval request', 'Hold order processing', 'Notify finance team'], isActive: true, lastTriggered: new Date('2025-01-15T11:20:00'), triggerCount: 8 }, { id: '4', name: 'Installation Scheduling', description: 'Automatically schedule installations when jobs are ready', trigger: 'Job status changed to READY_FOR_INSTALL', conditions: ['All fabrication completed', 'Customer approval received'], actions: ['Create calendar event', 'Assign installation team', 'Send customer notification'], isActive: false, lastTriggered: new Date('2025-01-13T16:45:00'), triggerCount: 5 }, { id: '5', name: 'Document Management', description: 'Organize documents by job number automatically', trigger: 'Document uploaded', conditions: ['Document contains job number'], actions: ['Move to job folder', 'Update document index', 'Notify relevant team'], isActive: true, lastTriggered: new Date('2025-01-15T13:10:00'), triggerCount: 34 } ]); const [executions, setExecutions] = useState<WorkflowExecution[]>([ { id: '1', ruleId: '1', ruleName: 'Job Status Notifications', status: 'completed', startTime: new Date('2025-01-15T14:30:00'), endTime: new Date('2025-01-15T14:30:15'), jobNumber: '18456', details: 'Notified team about job 18456 status change to FABRICATION' }, { id: '2', ruleId: '3', ruleName: 'Order Approval Workflow', status: 'running', startTime: new Date('2025-01-15T14:25:00'), details: 'Processing approval request for order £1,250' }, { id: '3', ruleId: '5', ruleName: 'Document Management', status: 'completed', startTime: new Date('2025-01-15T13:10:00'), endTime: new Date('2025-01-15T13:10:05'), jobNumber: '18457', details: 'Organized specification document for job 18457' }, { id: '4', ruleId: '2', ruleName: 'Quote Follow-up Automation', status: 'failed', startTime: new Date('2025-01-15T09:00:00'), endTime: new Date('2025-01-15T09:00:30'), quoteNumber: '21473', details: 'Failed to send follow-up email - invalid email address' } ]); const toggleWorkflow = (id: string) => { setWorkflows(prev => prev.map(workflow => workflow.id === id ? { ...workflow, isActive: !workflow.isActive } : workflow )); }; const getStatusColor = (status: string) => { switch (status) { case 'running': return 'default'; case 'completed': return 'success'; case 'failed': return 'destructive'; default: return 'secondary'; } }; const getStatusIcon = (status: string) => { switch (status) { case 'running': return Clock; case 'completed': return CheckCircle; case 'failed': return AlertTriangle; default: return Clock; } }; const WorkflowCard = ({ workflow }: { workflow: WorkflowRule }) => ( <div> <Card className="hover:shadow-lg transition-shadow duration-300"> <CardHeader className="pb-3"> <div className="flex items-center justify-between"> <div className="flex items-center space-x-3"> <Zap className={`h-5 w-5 ${workflow.isActive ? 'text-green-600' : 'text-gray-400'}`} /> <CardTitle className="text-lg">{workflow.name}</CardTitle> <Badge variant={workflow.isActive ? 'success' : 'secondary'}> {workflow.isActive ? 'Active' : 'Inactive'} </Badge> </div> <div className="flex space-x-2"> <Button variant="outline" size="sm" onClick={() => toggleWorkflow(workflow.id)} > {workflow.isActive ? <Pause className="h-4 w-4" /> : <Play className="h-4 w-4" />} </Button> <Button variant="outline" size="sm"> <Settings className="h-4 w-4" /> </Button> </div> </div> <CardDescription>{workflow.description}</CardDescription> </CardHeader> <CardContent> <div className="space-y-4"> <div> <p className="text-sm font-medium mb-2">Trigger</p> <Badge variant="outline" className="text-xs"> {workflow.trigger} </Badge> </div> <div> <p className="text-sm font-medium mb-2">Conditions</p> <div className="flex flex-wrap gap-1"> {workflow.conditions.map((condition, index) => ( <Badge key={index} variant="secondary" className="text-xs"> {condition} </Badge> ))} </div> </div> <div> <p className="text-sm font-medium mb-2">Actions</p> <div className="space-y-1"> {workflow.actions.map((action, index) => ( <div key={index} className="flex items-center text-xs text-muted-foreground"> <ArrowRight className="h-3 w-3 mr-1" /> {action} </div> ))} </div> </div> <div className="flex items-center justify-between text-xs text-muted-foreground pt-2 border-t"> <span>Triggered {workflow.triggerCount} times</span> {workflow.lastTriggered && ( <span>Last: {workflow.lastTriggered.toLocaleDateString()}</span> )} </div> </div> </CardContent> </Card> </div> ); const ExecutionRow = ({ execution }: { execution: WorkflowExecution }) => { const StatusIcon = getStatusIcon(execution.status); return ( <div className="flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors"> <div className="flex items-center space-x-4"> <StatusIcon className={`h-5 w-5 ${ execution.status === 'completed' ? 'text-green-600' : execution.status === 'failed' ? 'text-red-600' : 'text-blue-600' }`} /> <div> <h4 className="font-medium">{execution.ruleName}</h4> <p className="text-sm text-muted-foreground">{execution.details}</p> </div> </div> <div className="flex items-center space-x-4"> {execution.jobNumber && ( <Badge variant="outline">Job {execution.jobNumber}</Badge> )} {execution.quoteNumber && ( <Badge variant="outline">Quote {execution.quoteNumber}</Badge> )} <Badge variant={getStatusColor(execution.status) as any}> {execution.status} </Badge> <div className="text-right"> <p className="text-sm">{execution.startTime.toLocaleTimeString()}</p> <p className="text-xs text-muted-foreground"> {execution.endTime ? `${Math.round((execution.endTime.getTime() - execution.startTime.getTime()) / 1000)}s` : 'Running...' } </p> </div> </div> </div> ); }; return ( <div className="space-y-6"> {/* Header */} <div className="flex items-center justify-between"> <div> <h1 className="text-3xl font-bold tracking-tight flex items-center"> <Zap className="h-8 w-8 mr-3 text-blue-600" /> Workflow Automation </h1> <p className="text-muted-foreground"> Automate business processes and streamline operations </p> </div> <Button> <Zap className="h-4 w-4 mr-2" /> Create Workflow </Button> </div> {/* Stats */} <div className="grid gap-4 md:grid-cols-4"> <Card> <CardContent className="pt-6"> <div className="flex items-center justify-between"> <div> <p className="text-sm font-medium text-muted-foreground">Active Workflows</p> <p className="text-2xl font-bold"> {workflows.filter(w => w.isActive).length} </p> </div> <Zap className="h-8 w-8 text-green-600" /> </div> </CardContent> </Card> <Card> <CardContent className="pt-6"> <div className="flex items-center justify-between"> <div> <p className="text-sm font-medium text-muted-foreground">Total Executions</p> <p className="text-2xl font-bold"> {workflows.reduce((sum, w) => sum + w.triggerCount, 0)} </p> </div> <Play className="h-8 w-8 text-blue-600" /> </div> </CardContent> </Card> <Card> <CardContent className="pt-6"> <div className="flex items-center justify-between"> <div> <p className="text-sm font-medium text-muted-foreground">Success Rate</p> <p className="text-2xl font-bold"> {Math.round((executions.filter(e => e.status === 'completed').length / executions.length) * 100)}% </p> </div> <CheckCircle className="h-8 w-8 text-green-600" /> </div> </CardContent> </Card> <Card> <CardContent className="pt-6"> <div className="flex items-center justify-between"> <div> <p className="text-sm font-medium text-muted-foreground">Running Now</p> <p className="text-2xl font-bold"> {executions.filter(e => e.status === 'running').length} </p> </div> <Clock className="h-8 w-8 text-orange-600" /> </div> </CardContent> </Card> </div> {/* Workflow Rules */} <Card> <CardHeader> <CardTitle>Workflow Rules</CardTitle> <CardDescription> Automated rules that trigger actions based on business events </CardDescription> </CardHeader> <CardContent> <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3"> {workflows.map((workflow) => ( <WorkflowCard key={workflow.id} workflow={workflow} /> ))} </div> </CardContent> </Card> {/* Recent Executions */} <Card> <CardHeader> <CardTitle>Recent Executions</CardTitle> <CardDescription> Latest workflow executions and their status </CardDescription> </CardHeader> <CardContent> <div className="space-y-3"> {executions.map((execution) => ( <ExecutionRow key={execution.id} execution={execution} /> ))} </div> </CardContent> </Card> {/* Integration Points */} <div className="grid gap-4 md:grid-cols-3"> <Card> <CardHeader> <CardTitle className="flex items-center"> <MessageSquare className="h-5 w-5 mr-2 text-blue-600" /> Teams Integration </CardTitle> </CardHeader> <CardContent> <p className="text-sm text-muted-foreground mb-4"> Send notifications and updates directly to Microsoft Teams channels </p> <div className="space-y-2"> <Badge variant="success">Connected</Badge> <p className="text-xs text-muted-foreground"> Last notification: 2 minutes ago </p> </div> </CardContent> </Card> <Card> <CardHeader> <CardTitle className="flex items-center"> <Mail className="h-5 w-5 mr-2 text-green-600" /> Email Automation </CardTitle> </CardHeader> <CardContent> <p className="text-sm text-muted-foreground mb-4"> Automated email notifications for quotes, orders, and status updates </p> <div className="space-y-2"> <Badge variant="success">Active</Badge> <p className="text-xs text-muted-foreground"> 12 emails sent today </p> </div> </CardContent> </Card> <Card> <CardHeader> <CardTitle className="flex items-center"> <Calendar className="h-5 w-5 mr-2 text-purple-600" /> Calendar Sync </CardTitle> </CardHeader> <CardContent> <p className="text-sm text-muted-foreground mb-4"> Automatically create calendar events for installations and meetings </p> <div className="space-y-2"> <Badge variant="success">Synced</Badge> <p className="text-xs text-muted-foreground"> 3 events created this week </p> </div> </CardContent> </Card> </div> </div> ); } 