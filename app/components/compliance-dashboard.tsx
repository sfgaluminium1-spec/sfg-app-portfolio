 'use client'; import { useState, useEffect } from 'react'; import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'; import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'; import { Progress } from '@/components/ui/progress'; import { Shield, CheckCircle, AlertTriangle, Clock, Search, Filter, FileCheck, AlertCircle, Calendar, Award } from 'lucide-react'; import { motion } from 'framer-motion'; interface ComplianceRecord { id: string; status: string; rating: string; checkedBy: string; checkedAt: string; validUntil: string; certificateNumber: string; certificateExpiry: string; standard: { id: string; standardCode: string; name: string; category: string; }; specification: { id: string; specificationNumber: string; customer: { firstName: string; lastName: string; }; glassType: { name: string; }; }; } export default function ComplianceDashboard() { const [complianceRecords, setComplianceRecords] = useState<ComplianceRecord[]>([]); const [filteredRecords, setFilteredRecords] = useState<ComplianceRecord[]>([]); const [loading, setLoading] = useState(true); const [searchTerm, setSearchTerm] = useState(''); const [statusFilter, setStatusFilter] = useState('all'); const [standardFilter, setStandardFilter] = useState('all'); const [pagination, setPagination] = useState({ page: 1, limit: 20, total: 0, pages: 0 }); useEffect(() => { fetchComplianceRecords(); }, [pagination.page]); useEffect(() => { filterRecords(); }, [complianceRecords, searchTerm, statusFilter, standardFilter]); const fetchComplianceRecords = async () => { try { const response = await fetch(`/api/spec/compliance?page=${pagination.page}&limit=${pagination.limit}`); if (response.ok) { const data = await response.json(); setComplianceRecords(data.complianceRecords); setPagination(prev => ({ ...prev, ...data.pagination })); } } catch (error) { console.error('Error fetching compliance records:', error); } finally { setLoading(false); } }; const filterRecords = () => { let filtered = complianceRecords; if (searchTerm) { filtered = filtered.filter(record => record.specification.specificationNumber.toLowerCase().includes(searchTerm.toLowerCase()) || record.standard.standardCode.toLowerCase().includes(searchTerm.toLowerCase()) || record.standard.name.toLowerCase().includes(searchTerm.toLowerCase()) || `${record.specification.customer.firstName} ${record.specification.customer.lastName}`.toLowerCase().includes(searchTerm.toLowerCase()) ); } if (statusFilter !== 'all') { filtered = filtered.filter(record => record.status === statusFilter); } if (standardFilter !== 'all') { filtered = filtered.filter(record => record.standard.category === standardFilter); } setFilteredRecords(filtered); }; const getStatusIcon = (status: string) => { switch (status) { case 'COMPLIANT': return <CheckCircle className="h-4 w-4 text-green-600" />; case 'NON_COMPLIANT': return <AlertTriangle className="h-4 w-4 text-red-600" />; case 'PENDING': return <Clock className="h-4 w-4 text-yellow-600" />; case 'IN_PROGRESS': return <Clock className="h-4 w-4 text-blue-600" />; case 'EXPIRED': return <AlertCircle className="h-4 w-4 text-red-600" />; default: return <Clock className="h-4 w-4 text-gray-600" />; } }; const getStatusColor = (status: string) => { switch (status) { case 'COMPLIANT': return 'default'; case 'NON_COMPLIANT': return 'destructive'; case 'PENDING': return 'secondary'; case 'IN_PROGRESS': return 'default'; case 'EXPIRED': return 'destructive'; default: return 'secondary'; } }; const getComplianceStats = () => { const total = complianceRecords.length; const compliant = complianceRecords.filter(r => r.status === 'COMPLIANT').length; const nonCompliant = complianceRecords.filter(r => r.status === 'NON_COMPLIANT').length; const pending = complianceRecords.filter(r => r.status === 'PENDING').length; const expired = complianceRecords.filter(r => r.status === 'EXPIRED').length; return { total, compliant, nonCompliant, pending, expired, complianceRate: total > 0 ? (compliant / total) * 100 : 0 }; }; const stats = getComplianceStats(); if (loading) { return ( <div className="flex items-center justify-center h-64"> <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div> </div> ); } return ( <div className="space-y-6"> {/* Header */} <div className="flex items-center justify-between"> <div> <h2 className="text-2xl font-bold">Security Compliance Dashboard</h2> <p className="text-muted-foreground">Monitor and manage security standard compliance</p> </div> <Badge variant="secondary">{stats.total} compliance records</Badge> </div> {/* Stats Overview */} <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4"> <div> <Card> <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2"> <CardTitle className="text-sm font-medium">Total Records</CardTitle> <FileCheck className="h-4 w-4 text-muted-foreground" /> </CardHeader> <CardContent> <div className="text-2xl font-bold">{stats.total}</div> </CardContent> </Card> </div> <div> <Card> <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2"> <CardTitle className="text-sm font-medium">Compliant</CardTitle> <CheckCircle className="h-4 w-4 text-green-600" /> </CardHeader> <CardContent> <div className="text-2xl font-bold text-green-600">{stats.compliant}</div> </CardContent> </Card> </div> <div> <Card> <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2"> <CardTitle className="text-sm font-medium">Non-Compliant</CardTitle> <AlertTriangle className="h-4 w-4 text-red-600" /> </CardHeader> <CardContent> <div className="text-2xl font-bold text-red-600">{stats.nonCompliant}</div> </CardContent> </Card> </div> <div> <Card> <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2"> <CardTitle className="text-sm font-medium">Pending</CardTitle> <Clock className="h-4 w-4 text-yellow-600" /> </CardHeader> <CardContent> <div className="text-2xl font-bold text-yellow-600">{stats.pending}</div> </CardContent> </Card> </div> <div> <Card> <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2"> <CardTitle className="text-sm font-medium">Compliance Rate</CardTitle> <Shield className="h-4 w-4 text-blue-600" /> </CardHeader> <CardContent> <div className="text-2xl font-bold">{Math.round(stats.complianceRate)}%</div> <Progress value={stats.complianceRate} className="mt-2" /> </CardContent> </Card> </div> </div> {/* Filters */} <Card> <CardHeader> <CardTitle className="flex items-center space-x-2"> <Filter className="h-5 w-5" /> <span>Filters</span> </CardTitle> </CardHeader> <CardContent> <div className="grid grid-cols-1 md:grid-cols-4 gap-4"> <div className="space-y-2"> <label className="text-sm font-medium">Search</label> <div className="relative"> <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground" /> <Input placeholder="Search records..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="pl-10" /> </div> </div> <div className="space-y-2"> <label className="text-sm font-medium">Status</label> <Select value={statusFilter} onValueChange={setStatusFilter}> <SelectTrigger> <SelectValue /> </SelectTrigger> <SelectContent> <SelectItem value="all">All Statuses</SelectItem> <SelectItem value="COMPLIANT">Compliant</SelectItem> <SelectItem value="NON_COMPLIANT">Non-Compliant</SelectItem> <SelectItem value="PENDING">Pending</SelectItem> <SelectItem value="IN_PROGRESS">In Progress</SelectItem> <SelectItem value="EXPIRED">Expired</SelectItem> </SelectContent> </Select> </div> <div className="space-y-2"> <label className="text-sm font-medium">Standard Category</label> <Select value={standardFilter} onValueChange={setStandardFilter}> <SelectTrigger> <SelectValue /> </SelectTrigger> <SelectContent> <SelectItem value="all">All Categories</SelectItem> <SelectItem value="RESIDENTIAL">Residential</SelectItem> <SelectItem value="COMMERCIAL">Commercial</SelectItem> <SelectItem value="INDUSTRIAL">Industrial</SelectItem> <SelectItem value="GOVERNMENT">Government</SelectItem> </SelectContent> </Select> </div> <div className="flex items-end"> <Button variant="outline" onClick={() => { setSearchTerm(''); setStatusFilter('all'); setStandardFilter('all'); }} className="w-full" > Clear Filters </Button> </div> </div> </CardContent> </Card> {/* Compliance Records */} <Card> <CardHeader> <CardTitle>Compliance Records</CardTitle> <CardDescription>Security standard compliance tracking and validation</CardDescription> </CardHeader> <CardContent> <div className="space-y-4"> {filteredRecords.length === 0 ? ( <div className="text-center py-8"> <Shield className="h-12 w-12 text-muted-foreground mx-auto mb-4" /> <h3 className="text-lg font-medium mb-2">No compliance records found</h3> <p className="text-muted-foreground">Try adjusting your filters or search terms</p> </div> ) : ( filteredRecords.map((record, index) => ( <div className="p-4 border rounded-lg hover:bg-muted/50 transition-colors" key={record.id}> <div className="flex items-start justify-between"> <div className="flex items-start space-x-4"> <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center"> {getStatusIcon(record.status)} </div> <div className="space-y-1"> <div className="flex items-center space-x-2"> <p className="font-medium">{record.specification.specificationNumber}</p> <Badge variant="outline">{record.standard.standardCode}</Badge> </div> <p className="text-sm text-muted-foreground"> {record.specification.customer.firstName} {record.specification.customer.lastName} • {record.specification.glassType.name} </p> <p className="text-sm text-muted-foreground"> Standard: {record.standard.name} </p> {record.checkedBy && ( <p className="text-sm text-muted-foreground"> Checked by: {record.checkedBy} • {new Date(record.checkedAt).toLocaleDateString()} </p> )} </div> </div> <div className="flex flex-col items-end space-y-2"> <Badge variant={getStatusColor(record.status) as any}> {record.status.replace('_', ' ')} </Badge> {record.rating && ( <Badge variant="secondary">{record.rating}</Badge> )} {record.certificateNumber && ( <div className="flex items-center space-x-1 text-sm text-muted-foreground"> <Award className="h-3 w-3" /> <span>{record.certificateNumber}</span> </div> )} {record.validUntil && ( <div className="flex items-center space-x-1 text-sm text-muted-foreground"> <Calendar className="h-3 w-3" /> <span>Valid until {new Date(record.validUntil).toLocaleDateString()}</span> </div> )} </div> </div> </div> )) )} </div> {/* Pagination */} {pagination.pages > 1 && ( <div className="flex items-center justify-between mt-6"> <p className="text-sm text-muted-foreground"> Showing {((pagination.page - 1) * pagination.limit) + 1} to {Math.min(pagination.page * pagination.limit, pagination.total)} of {pagination.total} records </p> <div className="flex items-center space-x-2"> <Button variant="outline" size="sm" onClick={() => setPagination(prev => ({ ...prev, page: prev.page - 1 }))} disabled={pagination.page === 1} > Previous </Button> <span className="text-sm"> Page {pagination.page} of {pagination.pages} </span> <Button variant="outline" size="sm" onClick={() => setPagination(prev => ({ ...prev, page: prev.page + 1 }))} disabled={pagination.page === pagination.pages} > Next </Button> </div> </div> )} </CardContent> </Card> </div> ); } 